[{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\InAppBrowserGuard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[442,445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[442,445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\InAppBrowserGuard.tsx:17:13\n  15 |\n  16 |         if (isInstagram || isFacebook || isLinkedIn) {\n> 17 |             setIsInApp(true);\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |         }\n  19 |     }, []);\n  20 |","line":17,"column":13,"nodeType":null,"endLine":17,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\r\nimport { ExternalLink, X } from 'lucide-react';\r\nimport styles from './InAppBrowserGuard.module.css';\r\n\r\nexport const InAppBrowserGuard = ({ children }: { children: React.ReactNode }) => {\r\n    const [isInApp, setIsInApp] = useState(false);\r\n    const [dismissed, setDismissed] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const ua = navigator.userAgent || navigator.vendor || (window as any).opera;\r\n        // Detect Instagram, Facebook, Messenger, LinkedIn in-app browsers\r\n        const isInstagram = ua.indexOf('Instagram') > -1;\r\n        const isFacebook = ua.indexOf('FBAN') > -1 || ua.indexOf('FBAV') > -1;\r\n        const isLinkedIn = ua.indexOf('LinkedIn') > -1;\r\n\r\n        if (isInstagram || isFacebook || isLinkedIn) {\r\n            setIsInApp(true);\r\n        }\r\n    }, []);\r\n\r\n    if (!isInApp || dismissed) {\r\n        return <>{children}</>;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {children}\r\n            <div className={styles.overlay}>\r\n                <div className={styles.card}>\r\n                    <div className={styles.iconWrapper}>\r\n                        <ExternalLink size={32} />\r\n                    </div>\r\n                    <h2>Open in System Browser</h2>\r\n                    <p>\r\n                        Instagram's browser restricts location access needed for VanaMap.\r\n                        <br /><br />\r\n                        <strong>Tap the <span className={styles.dots}>ΓÇóΓÇóΓÇó</span> menu above and select \"Open in browser\" or \"Open in Chrome/Safari\".</strong>\r\n                    </p>\r\n                    <button className={styles.dismissBtn} onClick={() => setDismissed(true)}>\r\n                        <X size={16} />\r\n                        I'll try anyway\r\n                    </button>\r\n                    <div className={styles.arrow} />\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\InstallPrompt.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":54,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2947,2950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2947,2950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Smartphone, X, Download, Share, PlusSquare } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n// ... (Keep existing helper functions if needed, or re-implement if they were just for push - strictly speaking push logic was mixed in here, I should preserve the push subscription logic if it was relevant, but the file name implies InstallPrompt. The previous code had `subscribeUser` mixed in. I will keep the subscription logic but clean up the UI.)\r\n\r\nconst urlBase64ToUint8Array = (base64String: string) => {\r\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\r\n    const base64 = (base64String + padding)\r\n        .replace(/-/g, '+')\r\n        .replace(/_/g, '/');\r\n    const rawData = window.atob(base64);\r\n    const outputArray = new Uint8Array(rawData.length);\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n};\r\n\r\nconst getVapidKey = async () => {\r\n    try {\r\n        const API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n        const res = await fetch(`${API_URL}/notifications/vapid-key`);\r\n        const data = await res.json();\r\n        return data.publicKey;\r\n    } catch (e) {\r\n        console.error(\"Failed to fetch VAPID key\", e);\r\n        return null;\r\n    }\r\n};\r\n\r\nconst subscribeUser = async () => {\r\n    if (!('serviceWorker' in navigator) || !('PushManager' in window)) return;\r\n    try {\r\n        const registration = await navigator.serviceWorker.ready;\r\n        const publicKey = await getVapidKey();\r\n        if (!publicKey) return;\r\n\r\n        const existingSub = await registration.pushManager.getSubscription();\r\n        if (existingSub) return;\r\n\r\n        const subscription = await registration.pushManager.subscribe({\r\n            userVisibleOnly: true,\r\n            applicationServerKey: urlBase64ToUint8Array(publicKey)\r\n        });\r\n\r\n        const API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n        await fetch(`${API_URL}/notifications/subscribe`, {\r\n            method: 'POST',\r\n            body: JSON.stringify(subscription),\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n        toast.success(\"Notifications enabled! ≡ƒî┐\");\r\n    } catch (e) {\r\n        // Silent fail\r\n    }\r\n};\r\n\r\ninterface BeforeInstallPromptEvent extends Event {\r\n    prompt: () => Promise<void>;\r\n    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\r\n}\r\n\r\nexport const InstallPrompt = () => {\r\n    const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\r\n    const [isVisible, setIsVisible] = useState(false);\r\n\r\n    // Move detection to initial state to avoid cascading renders in useEffect\r\n    const [isIOS] = useState(() => {\r\n        return /iPad|iPhone|iPod/.test(navigator.userAgent) && !((window as unknown as { MSStream: any }).MSStream);\r\n    });\r\n\r\n    const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\r\n\r\n    useEffect(() => {\r\n        const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n        window.addEventListener('resize', handleResize);\r\n\r\n        const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator as unknown as { standalone: boolean }).standalone;\r\n\r\n        if (isIOS && !isInStandaloneMode) {\r\n            setTimeout(() => setIsVisible(true), 5000);\r\n        }\r\n\r\n        if (isInStandaloneMode || window.matchMedia('(display-mode: standalone)').matches) {\r\n            // Already installed - ask for perms silently/toast\r\n            setTimeout(() => {\r\n                if (Notification.permission === 'default') Notification.requestPermission();\r\n                subscribeUser();\r\n            }, 3000);\r\n        } else {\r\n            // Android/Desktop PWA\r\n            const handler = (e: Event) => {\r\n                e.preventDefault();\r\n                setDeferredPrompt(e as BeforeInstallPromptEvent);\r\n                setTimeout(() => setIsVisible(true), 5000);\r\n            };\r\n            window.addEventListener('beforeinstallprompt', handler);\r\n            return () => {\r\n                window.removeEventListener('beforeinstallprompt', handler);\r\n                window.removeEventListener('resize', handleResize);\r\n            };\r\n        }\r\n    }, [isIOS]);\r\n\r\n\r\n    const handleInstallClick = async () => {\r\n        if (!deferredPrompt) {\r\n            if (isIOS) return; // iOS handles viewing instructions\r\n            return;\r\n        }\r\n\r\n        deferredPrompt.prompt();\r\n        const { outcome } = await deferredPrompt.userChoice;\r\n        if (outcome === 'accepted') {\r\n            setIsVisible(false);\r\n            subscribeUser();\r\n        }\r\n        setDeferredPrompt(null);\r\n    };\r\n\r\n    if (!isVisible) return null;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed',\r\n            bottom: isMobile ? '90px' : '40px', // Sit above the 75px MobileTabBar\r\n            left: isMobile ? '50%' : 'auto',\r\n            right: isMobile ? 'auto' : '40px',\r\n            transform: isMobile ? 'translateX(-50%)' : 'none',\r\n            zIndex: 10000,\r\n            width: isMobile ? 'calc(100% - 32px)' : '420px',\r\n            maxWidth: '450px',\r\n            perspective: '1000px',\r\n            animation: 'slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1)'\r\n        }}>\r\n            <style>{`\r\n                @keyframes slideUpFade {\r\n                    from { opacity: 0; transform: ${isMobile ? 'translate(-50%, 50px)' : 'translateY(50px)'}; }\r\n                    to { opacity: 1; transform: ${isMobile ? 'translate(-50%, 0)' : 'translateY(0)'}; }\r\n                }\r\n                .glass-panel {\r\n                    background: rgba(15, 23, 42, 0.85); /* Slate 900 with opacity */\r\n                    backdrop-filter: blur(20px);\r\n                    -webkit-backdrop-filter: blur(20px);\r\n                    border: 1px solid rgba(255, 255, 255, 0.08);\r\n                    box-shadow: \r\n                        0 20px 40px -5px rgba(0, 0, 0, 0.4),\r\n                        0 10px 20px -5px rgba(0, 0, 0, 0.3),\r\n                        inset 0 1px 0 rgba(255, 255, 255, 0.1);\r\n                }\r\n            `}</style>\r\n\r\n            <div className=\"glass-panel\" style={{\r\n                borderRadius: '24px',\r\n                padding: '24px',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: '20px',\r\n                color: 'white',\r\n                position: 'relative',\r\n                overflow: 'hidden'\r\n            }}>\r\n                {/* Background Glow Effect */}\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    top: '-50%',\r\n                    left: '-20%',\r\n                    width: '150%',\r\n                    height: '200%',\r\n                    background: 'radial-gradient(circle at 50% 50%, rgba(56, 189, 248, 0.08), transparent 60%)',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 0\r\n                }} />\r\n\r\n                <div style={{ display: 'flex', alignItems: 'flex-start', justifyContent: 'space-between', zIndex: 1, gap: '16px' }}>\r\n                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>\r\n                        <div style={{\r\n                            width: '56px',\r\n                            height: '56px',\r\n                            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n                            borderRadius: '16px',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            boxShadow: '0 8px 16px -4px rgba(16, 185, 129, 0.3), inset 0 2px 4px rgba(255,255,255,0.2)'\r\n                        }}>\r\n                            <Smartphone size={28} color=\"white\" strokeWidth={2} />\r\n                        </div>\r\n                        <div>\r\n                            <h3 style={{ margin: 0, fontSize: '1.25rem', fontWeight: 700, letterSpacing: '-0.02em', lineHeight: 1.2 }}>\r\n                                Get the VanaMap App\r\n                            </h3>\r\n                            <p style={{ margin: '4px 0 0', fontSize: '0.9rem', color: '#94a3b8', lineHeight: 1.4 }}>\r\n                                Browse 2x faster with the native experience.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={() => setIsVisible(false)}\r\n                        style={{\r\n                            background: 'rgba(255,255,255,0.05)',\r\n                            border: 'none',\r\n                            color: '#94a3b8',\r\n                            cursor: 'pointer',\r\n                            borderRadius: '50%',\r\n                            width: '32px',\r\n                            height: '32px',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            transition: 'all 0.2s'\r\n                        }}\r\n                    >\r\n                        <X size={18} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content Body */}\r\n                <div style={{ zIndex: 1 }}>\r\n                    {!isIOS ? (\r\n                        <button\r\n                            onClick={handleInstallClick}\r\n                            style={{\r\n                                width: '100%',\r\n                                background: 'linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)',\r\n                                color: 'white',\r\n                                border: 'none',\r\n                                borderRadius: '16px',\r\n                                padding: '16px',\r\n                                fontSize: '1rem',\r\n                                fontWeight: 700,\r\n                                cursor: 'pointer',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                gap: '10px',\r\n                                boxShadow: '0 8px 20px -4px rgba(14, 165, 233, 0.4), inset 0 1px 2px rgba(255,255,255,0.2)',\r\n                                transition: 'transform 0.2s active'\r\n                            }}\r\n                        >\r\n                            <Download size={20} className=\"animate-bounce\" /> Install Now\r\n                        </button>\r\n                    ) : (\r\n                        <div style={{\r\n                            background: 'rgba(255,255,255,0.03)',\r\n                            borderRadius: '16px',\r\n                            padding: '16px',\r\n                            border: '1px solid rgba(255,255,255,0.05)'\r\n                        }}>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px', fontSize: '0.95rem', color: '#cbd5e1' }}>\r\n                                <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: '8px', padding: '6px' }}><Share size={16} /></div>\r\n                                <span>1. Tap simple <strong style={{ color: '#38bdf8' }}>Share</strong> button below</span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', fontSize: '0.95rem', color: '#cbd5e1' }}>\r\n                                <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: '8px', padding: '6px' }}><PlusSquare size={16} /></div>\r\n                                <span>2. Select <strong style={{ color: '#38bdf8' }}>Add to Home Screen</strong></span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\LocationNag.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\NetworkIndicator.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":23,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":23,"endColumn":52,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[816,855],"text":"// @ts-expect-error - Network Information API"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":42,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":42,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1603,1616],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { WifiOff, AlertTriangle, Wifi } from 'lucide-react';\r\nimport styles from './NetworkIndicator.module.css';\r\n\r\nexport const NetworkIndicator: React.FC = () => {\r\n    const [isVisible, setIsVisible] = useState(false);\r\n    const [statusType, setStatusType] = useState<'offline' | 'slow' | 'back-online'>('offline');\r\n\r\n    useEffect(() => {\r\n        const handleOnline = () => {\r\n            setStatusType('back-online');\r\n            setIsVisible(true);\r\n            // Hide \"back online\" after 3 seconds\r\n            setTimeout(() => setIsVisible(false), 3000);\r\n        };\r\n\r\n        const handleOffline = () => {\r\n            setStatusType('offline');\r\n            setIsVisible(true);\r\n        };\r\n\r\n        const updateConnection = () => {\r\n            // @ts-ignore - Network Information API\r\n            const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\r\n            if (conn) {\r\n                const isSlowConn = conn.effectiveType === '2g' || conn.effectiveType === 'slow-2g';\r\n                if (isSlowConn && navigator.onLine) {\r\n                    setStatusType('slow');\r\n                    setIsVisible(true);\r\n                } else {\r\n                    if (navigator.onLine && statusType === 'slow') {\r\n                        setIsVisible(false);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener('online', handleOnline);\r\n        window.addEventListener('offline', handleOffline);\r\n\r\n        // Slow connection check\r\n        // @ts-ignore\r\n        const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\r\n        if (conn) {\r\n            conn.addEventListener('change', updateConnection);\r\n            updateConnection();\r\n        }\r\n\r\n        // Initial state for offline\r\n        if (!navigator.onLine) handleOffline();\r\n\r\n        return () => {\r\n            window.removeEventListener('online', handleOnline);\r\n            window.removeEventListener('offline', handleOffline);\r\n            if (conn) conn.removeEventListener('change', updateConnection);\r\n        };\r\n    }, [statusType]);\r\n\r\n    if (!isVisible) return null;\r\n\r\n    const renderContent = () => {\r\n        switch (statusType) {\r\n            case 'offline':\r\n                return (\r\n                    <>\r\n                        <div className={styles.iconWrapper}><WifiOff size={20} /></div>\r\n                        <div className={styles.textWrapper}>\r\n                            <span className={styles.title}>You are offline</span>\r\n                            <span className={styles.desc}>Check your internet connection.</span>\r\n                        </div>\r\n                    </>\r\n                );\r\n            case 'slow':\r\n                return (\r\n                    <>\r\n                        <div className={styles.iconWrapper}><AlertTriangle size={20} /></div>\r\n                        <div className={styles.textWrapper}>\r\n                            <span className={styles.title}>Slow connection</span>\r\n                            <span className={styles.desc}>Optimizing experience for low bandwidth.</span>\r\n                        </div>\r\n                    </>\r\n                );\r\n            case 'back-online':\r\n                return (\r\n                    <>\r\n                        <div className={styles.iconWrapper} style={{ backgroundColor: '#10b981' }}><Wifi size={20} /></div>\r\n                        <div className={styles.textWrapper}>\r\n                            <span className={styles.title} style={{ color: '#10b981' }}>Back Online</span>\r\n                            <span className={styles.desc}>Connection restored successfully.</span>\r\n                        </div>\r\n                    </>\r\n                );\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`${styles.container} ${styles[statusType]}`}>\r\n            <div className={styles.content}>\r\n                {renderContent()}\r\n            </div>\r\n            {statusType !== 'back-online' && (\r\n                <div className={styles.reconnecting}>\r\n                    <div className={styles.dot} />\r\n                    <span>Monitoring...</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\PermissionCenter.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":24,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":34,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":41,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":23},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\PermissionCenter.tsx:49:9\n  47 |\n  48 |     useEffect(() => {\n> 49 |         checkPermissions();\n     |         ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  50 |\n  51 |         const handleToggle = () => setIsOpen(true);\n  52 |         window.addEventListener('toggleVanaPermissions', handleToggle);","line":49,"column":9,"nodeType":null,"endLine":49,"endColumn":25}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { MapPin, Bell, Camera, ShieldCheck, Info, Bot } from 'lucide-react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport styles from './PermissionCenter.module.css';\r\nimport toast from 'react-hot-toast';\r\n\r\ntype PermissionState = 'granted' | 'denied' | 'prompt' | 'unsupported';\r\n\r\nexport const PermissionCenter = () => {\r\n    const [geo, setGeo] = useState<PermissionState>('prompt');\r\n    const [notif, setNotif] = useState<PermissionState>('prompt');\r\n    const [cam, setCam] = useState<PermissionState>('prompt');\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n\r\n    const checkPermissions = async () => {\r\n        // Geolocation\r\n        if ('permissions' in navigator) {\r\n            try {\r\n                const geoStatus = await navigator.permissions.query({ name: 'geolocation' as PermissionName });\r\n                setGeo(geoStatus.state as PermissionState);\r\n                geoStatus.onchange = () => setGeo(geoStatus.state as PermissionState);\r\n            } catch (e) { setGeo('unsupported'); }\r\n\r\n            // Notifications\r\n            try {\r\n                if ('Notification' in window) {\r\n                    const state = Notification.permission;\r\n                    setNotif(state === 'default' ? 'prompt' : state as PermissionState);\r\n                } else {\r\n                    setNotif('unsupported');\r\n                }\r\n            } catch (e) { setNotif('unsupported'); }\r\n\r\n            // Camera (Not queryable via permissions API in all browsers, so we assume prompt)\r\n            try {\r\n                const camStatus = await navigator.permissions.query({ name: 'camera' as PermissionName });\r\n                setCam(camStatus.state as PermissionState);\r\n                camStatus.onchange = () => setCam(camStatus.state as PermissionState);\r\n            } catch (e) {\r\n                // Fallback for camera\r\n                setCam('prompt');\r\n            }\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        checkPermissions();\r\n\r\n        const handleToggle = () => setIsOpen(true);\r\n        window.addEventListener('toggleVanaPermissions', handleToggle);\r\n        return () => window.removeEventListener('toggleVanaPermissions', handleToggle);\r\n    }, []);\r\n\r\n    const requestGeo = () => {\r\n        navigator.geolocation.getCurrentPosition(\r\n            () => { setGeo('granted'); toast.success(\"Location Synced!\"); },\r\n            () => { setGeo('denied'); toast.error(\"Location Access Denied\"); }\r\n        );\r\n    };\r\n\r\n    const requestNotif = () => {\r\n        if (!('Notification' in window)) return;\r\n        Notification.requestPermission().then(permission => {\r\n            setNotif(permission === 'default' ? 'prompt' : permission as PermissionState);\r\n        });\r\n    };\r\n\r\n    const requestCam = () => {\r\n        navigator.mediaDevices.getUserMedia({ video: true })\r\n            .then(stream => {\r\n                stream.getTracks().forEach(track => track.stop());\r\n                setCam('granted');\r\n            })\r\n            .catch(() => setCam('denied'));\r\n    };\r\n\r\n    const getStatusStyle = (state: PermissionState) => {\r\n        switch (state) {\r\n            case 'granted': return styles.statusGranted;\r\n            case 'denied': return styles.statusDenied;\r\n            case 'prompt': return styles.statusPrompt;\r\n            default: return styles.statusUnsupported;\r\n        }\r\n    };\r\n\r\n    // Only show on Home page (unless modal is open)\r\n    // Moving this check AFTER all hooks to prevent \"Rendered fewer hooks than expected\" error\r\n    if (location.pathname !== '/' && !isOpen) {\r\n        return null;\r\n    }\r\n\r\n    if (!isOpen) {\r\n        return (\r\n            <>\r\n                {/* AI Doctor Bot Button */}\r\n                <button\r\n                    className={styles.aiFab}\r\n                    onClick={() => navigate('/admin/ai-doctor')}\r\n                    title=\"AI Plant Doctor\"\r\n                >\r\n                    <Bot size={20} />\r\n                    <span className={styles.fabText}>AI Doctor</span>\r\n                </button>\r\n\r\n                {/* Permissions Button */}\r\n                <button className={styles.fab} onClick={() => setIsOpen(true)} title=\"Permissions\">\r\n                    <ShieldCheck size={20} />\r\n                    <span className={styles.fabText}>Permissions</span>\r\n                </button>\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={styles.overlay}>\r\n            <div className={styles.modal}>\r\n                <div className={styles.header}>\r\n                    <div className={styles.titleArea}>\r\n                        <ShieldCheck className={styles.headerIcon} />\r\n                        <div>\r\n                            <h2>System Permissions</h2>\r\n                            <p>Manage how VanaMap accesses your device</p>\r\n                        </div>\r\n                    </div>\r\n                    <button className={styles.closeBtn} onClick={() => setIsOpen(false)}>├ù</button>\r\n                </div>\r\n\r\n                <div className={styles.content}>\r\n                    {/* Geolocation */}\r\n                    <div className={styles.item}>\r\n                        <div className={styles.itemIcon} style={{ background: 'rgba(16, 185, 129, 0.1)' }}>\r\n                            <MapPin size={22} color=\"#10b981\" />\r\n                        </div>\r\n                        <div className={styles.itemDetails}>\r\n                            <h3>Real-time Location</h3>\r\n                            <p>Required for Plant Aptness scores and finding nearby shops.</p>\r\n                            <span className={getStatusStyle(geo)}>{geo.toUpperCase()}</span>\r\n                        </div>\r\n                        {geo !== 'granted' && geo !== 'unsupported' && (\r\n                            <button onClick={requestGeo} className={styles.actionBtn}>Enable</button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Notifications */}\r\n                    <div className={styles.item}>\r\n                        <div className={styles.itemIcon} style={{ background: 'rgba(56, 189, 248, 0.1)' }}>\r\n                            <Bell size={22} color=\"#38bdf8\" />\r\n                        </div>\r\n                        <div className={styles.itemDetails}>\r\n                            <h3>Live Notifications</h3>\r\n                            <p>Get alerted about rare species and order updates.</p>\r\n                            <span className={getStatusStyle(notif)}>{notif.toUpperCase()}</span>\r\n                        </div>\r\n                        {notif !== 'granted' && notif !== 'unsupported' && (\r\n                            <button onClick={requestNotif} className={styles.actionBtn}>Enable</button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Camera */}\r\n                    <div className={styles.item}>\r\n                        <div className={styles.itemIcon} style={{ background: 'rgba(168, 85, 247, 0.1)' }}>\r\n                            <Camera size={22} color=\"#a855f7\" />\r\n                        </div>\r\n                        <div className={styles.itemDetails}>\r\n                            <h3>Vision & AR</h3>\r\n                            <p>Necessary for the 'Make It Real' AR plant preview.</p>\r\n                            <span className={getStatusStyle(cam)}>{cam.toUpperCase()}</span>\r\n                        </div>\r\n                        {cam !== 'granted' && cam !== 'unsupported' && (\r\n                            <button onClick={requestCam} className={styles.actionBtn}>Enable</button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.footer}>\r\n                    <div className={styles.infoBox}>\r\n                        <Info size={16} />\r\n                        <p>\r\n                            <b>Mobile Shortcut:</b> Long-press the app icon (touch for a second) {'>'} Site Settings.<br />\r\n                            Or enable in <b>Browser {'>'} Site Settings</b>.\r\n                        </p>\r\n                    </div>\r\n                    <button className={styles.finishBtn} onClick={() => setIsOpen(false)}>Done</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\RestrictedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\SystemGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\ai\\DoctorAI.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\games\\PotMaker.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: This value cannot be modified\n\nModifying a value returned from a hook is not allowed. Consider moving the modification into the hook where the value is constructed.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\games\\PotMaker.tsx:65:13\n  63 |     useEffect(() => {\n  64 |         if (texture) {\n> 65 |             texture.wrapS = THREE.ClampToEdgeWrapping;\n     |             ^^^^^^^ `texture` cannot be modified\n  66 |             texture.wrapT = THREE.ClampToEdgeWrapping;\n  67 |             texture.anisotropy = 16;\n  68 |             texture.minFilter = THREE.LinearMipmapLinearFilter;","line":65,"column":13,"nodeType":null,"endLine":65,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { Upload, Camera, Save, ShoppingCart, Layers, RotateCcw, X, Check, Move, Maximize, RotateCw } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport Cropper from 'react-easy-crop';\r\nimport { Canvas, useLoader, useThree } from '@react-three/fiber';\r\nimport { Stage, PresentationControls } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport styles from './PotMaker.module.css';\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\r\n\r\ninterface PotMakerProps {\r\n    onBack: () => void;\r\n}\r\n\r\ntype PotShape = 'classic' | 'modern' | 'wide';\r\ntype PotSize = 'small' | 'medium' | 'large';\r\n\r\n// --- UTILS FOR CROPPING ---\r\nconst createImage = (url: string): Promise<HTMLImageElement> =>\r\n    new Promise((resolve, reject) => {\r\n        const image = new Image();\r\n        image.addEventListener('load', () => resolve(image));\r\n        image.addEventListener('error', (error) => reject(error));\r\n        if (!url.startsWith('data:')) image.setAttribute('crossOrigin', 'anonymous');\r\n        image.src = url;\r\n    });\r\n\r\nconst getCroppedImg = async (imageSrc: string, pixelCrop: { width: number; height: number; x: number; y: number }) => {\r\n    const image = await createImage(imageSrc);\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return null;\r\n    canvas.width = pixelCrop.width;\r\n    canvas.height = pixelCrop.height;\r\n    ctx.drawImage(image, pixelCrop.x, pixelCrop.y, pixelCrop.width, pixelCrop.height, 0, 0, pixelCrop.width, pixelCrop.height);\r\n    return canvas.toDataURL('image/jpeg');\r\n};\r\n\r\n\r\n// --- 3D POT COMPONENT ---\r\ninterface TexturedCylinderProps {\r\n    textureUrl: string;\r\n    geometryArgs: [number, number, number, number];\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    rotation: number;\r\n}\r\n\r\nconst TexturedCylinder = ({\r\n    textureUrl,\r\n    geometryArgs,\r\n    scaleX,\r\n    scaleY,\r\n    offsetX,\r\n    offsetY,\r\n    rotation\r\n}: TexturedCylinderProps) => {\r\n    const texture = useLoader(THREE.TextureLoader, textureUrl) as THREE.Texture;\r\n\r\n    useEffect(() => {\r\n        if (texture) {\r\n            texture.wrapS = THREE.ClampToEdgeWrapping;\r\n            texture.wrapT = THREE.ClampToEdgeWrapping;\r\n            texture.anisotropy = 16;\r\n            texture.minFilter = THREE.LinearMipmapLinearFilter;\r\n            texture.magFilter = THREE.LinearFilter;\r\n            texture.generateMipmaps = true;\r\n            texture.repeat.set(1 / scaleX, 1 / scaleY);\r\n            texture.offset.set(offsetX, offsetY);\r\n            texture.center.set(0.5, 0.5);\r\n            texture.rotation = rotation * (Math.PI / 180);\r\n            texture.needsUpdate = true;\r\n        }\r\n    }, [texture, scaleX, scaleY, offsetX, offsetY, rotation]);\r\n\r\n    return (\r\n        <mesh castShadow receiveShadow position={[0, 0.5, 0]}>\r\n            <cylinderGeometry args={geometryArgs} />\r\n            <meshStandardMaterial\r\n                attach=\"material-0\"\r\n                color=\"#ffffff\"\r\n                roughness={0.4}\r\n                metalness={0.05}\r\n                map={texture}\r\n            />\r\n            <meshStandardMaterial attach=\"material-1\" color=\"#ffffff\" roughness={0.5} />\r\n            <meshStandardMaterial attach=\"material-2\" color=\"#ffffff\" roughness={0.5} />\r\n        </mesh>\r\n    );\r\n};\r\n\r\nconst PotModel = ({\r\n    textureUrl,\r\n    shape,\r\n    size,\r\n    scaleX,\r\n    scaleY,\r\n    offsetX,\r\n    offsetY,\r\n    rotation\r\n}: {\r\n    textureUrl: string | null,\r\n    shape: PotShape,\r\n    size: PotSize,\r\n    scaleX: number,\r\n    scaleY: number,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    rotation: number\r\n}) => {\r\n    // Size multiplier\r\n    const scale = size === 'small' ? 0.8 : size === 'medium' ? 1 : 1.2;\r\n\r\n    // Geometry args based on shape\r\n    let geometryArgs: [number, number, number, number] = [1.2, 1, 2.2, 64];\r\n\r\n    if (shape === 'modern') geometryArgs = [1.1, 1.1, 2.2, 64];\r\n    if (shape === 'wide') geometryArgs = [1.4, 1.2, 1.8, 64];\r\n\r\n    return (\r\n        <group dispose={null} scale={[scale, scale, scale]}>\r\n            {textureUrl ? (\r\n                <TexturedCylinder\r\n                    textureUrl={textureUrl}\r\n                    geometryArgs={geometryArgs}\r\n                    scaleX={scaleX}\r\n                    scaleY={scaleY}\r\n                    offsetX={offsetX}\r\n                    offsetY={offsetY}\r\n                    rotation={rotation}\r\n                />\r\n            ) : (\r\n                <mesh castShadow receiveShadow position={[0, 0.5, 0]}>\r\n                    <cylinderGeometry args={geometryArgs} />\r\n                    <meshStandardMaterial color=\"#ffffff\" roughness={0.5} />\r\n                </mesh>\r\n            )}\r\n\r\n            {/* Soil */}\r\n            <mesh position={[0, shape === 'wide' ? 1.3 : 1.59, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <circleGeometry args={[shape === 'wide' ? 1.3 : 1.1, 32]} />\r\n                <meshStandardMaterial color=\"#2d1e18\" roughness={1} />\r\n            </mesh>\r\n        </group>\r\n    );\r\n};\r\n\r\n\r\n\r\n// --- CAPTURE HELPER ---\r\nconst CaptureRelay = ({ captureRef }: { captureRef: React.MutableRefObject<(() => string) | null> }) => {\r\n    const { gl, scene, camera } = useThree();\r\n\r\n    useEffect(() => {\r\n        captureRef.current = () => {\r\n            // Force a high-quality render for the snapshot\r\n            const originalRatio = gl.getPixelRatio();\r\n            gl.setPixelRatio(2); // High resolution snapshot\r\n            gl.render(scene, camera);\r\n            const dataUrl = gl.domElement.toDataURL('image/png', 1.0);\r\n            gl.setPixelRatio(originalRatio); // Restore\r\n            return dataUrl;\r\n        };\r\n    }, [gl, scene, camera, captureRef]);\r\n\r\n    return null;\r\n};\r\n\r\nexport const PotMaker = ({ onBack }: PotMakerProps) => {\r\n    const [step, setStep] = useState<'select' | 'upload' | 'crop' | 'preview' | 'result'>('select');\r\n\r\n    // Selection State\r\n    const [selectedShape, setSelectedShape] = useState<PotShape>('classic');\r\n    const [selectedSize, setSelectedSize] = useState<PotSize>('medium');\r\n\r\n    const [imageSrc, setImageSrc] = useState<string | null>(null);\r\n    const [croppedImage, setCroppedImage] = useState<string | null>(null);\r\n    const [finalImage, setFinalImage] = useState<string | null>(null); // The 3D render snapshot\r\n\r\n    const [crop, setCrop] = useState({ x: 0, y: 0 });\r\n    const [zoom, setZoom] = useState(1);\r\n    const [croppedAreaPixels, setCroppedAreaPixels] = useState<{ width: number; height: number; x: number; y: number } | null>(null);\r\n    const [saving, setSaving] = useState(false);\r\n\r\n\r\n    // 3D Texture Transforms\r\n    const [texScale, setTexScale] = useState(1);\r\n    const [texOffsetX, setTexOffsetX] = useState(0);\r\n    const [texOffsetY, setTexOffsetY] = useState(0);\r\n    const [texRotation, setTexRotation] = useState(0);\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const captureRef = useRef<() => string>(null);\r\n\r\n    const onCropComplete = useCallback((_: unknown, croppedAreaPixels: { width: number; height: number; x: number; y: number }) => {\r\n        setCroppedAreaPixels(croppedAreaPixels);\r\n    }, []);\r\n\r\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files?.length) {\r\n            const reader = new FileReader();\r\n            reader.onload = () => { currentImageToCrop(reader.result as string); };\r\n            reader.readAsDataURL(e.target.files[0]);\r\n        }\r\n    };\r\n\r\n    const currentImageToCrop = (src: string) => {\r\n        setImageSrc(src);\r\n        setStep('crop');\r\n    };\r\n\r\n    const handleCropSave = async () => {\r\n        if (imageSrc && croppedAreaPixels) {\r\n            const cropped = await getCroppedImg(imageSrc, croppedAreaPixels);\r\n            setCroppedImage(cropped);\r\n            setStep('preview');\r\n        }\r\n    };\r\n\r\n    const handleFinalize = () => {\r\n        if (captureRef.current) {\r\n            const snapshot = captureRef.current();\r\n            setFinalImage(snapshot);\r\n            setStep('result');\r\n            toast.success(\"3D View Captured!\");\r\n        }\r\n    };\r\n\r\n    const handleDownload = () => {\r\n        if (!finalImage) return;\r\n        const link = document.createElement('a');\r\n        link.href = finalImage;\r\n        link.download = `VanaMap_MyPot_${Date.now()}.png`;\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        toast.success(\"Design downloading...\");\r\n    };\r\n\r\n\r\n\r\n    const handleSaveDesign = async () => {\r\n        handleDownload(); // Always download as requested\r\n\r\n        // Also save to database silently\r\n        setSaving(true);\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n            await fetch(`${API_URL}/user/designs`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\r\n                body: JSON.stringify({\r\n                    imageUrl: finalImage,\r\n                    shape: selectedShape,\r\n                    size: selectedSize\r\n                })\r\n            });\r\n            toast.success(\"Saved to Profile!\");\r\n        } catch {\r\n            toast.error(\"Error saving to profile\");\r\n        }\r\n        setSaving(false);\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <button onClick={onBack} className={styles.backBtnWrapper}>&larr; Back to Menu</button>\r\n                <h2 className={styles.title}><Layers color=\"#10b981\" /> 3D Pot Studio</h2>\r\n                <p className={styles.subtitle}>\r\n                    {step === 'select' && \"Step 1: Choose your base\"}\r\n                    {step === 'upload' && \"Step 2: Upload your art\"}\r\n                    {step === 'crop' && \"Step 3: Crop\"}\r\n                    {step === 'preview' && \"Step 4: Customize\"}\r\n                    {step === 'result' && \"Final Step: Review & Save\"}\r\n                </p>\r\n            </div>\r\n\r\n            <div className={styles.workspace}>\r\n                {/* STEP 1: SELECTION */}\r\n                {step === 'select' && (\r\n                    <div className={styles.selectionContainer}>\r\n                        {/* Live Preview of Base Pot */}\r\n                        <div className={styles.miniPreview}>\r\n                            <Canvas shadows camera={{ position: [0, 1, 4], fov: 45 }}>\r\n                                <ambientLight intensity={0.5} />\r\n                                <spotLight position={[10, 10, 10]} angle={0.15} penumbra={1} />\r\n                                <PresentationControls speed={2} global zoom={0.8} polar={[-0.1, Math.PI / 4]}>\r\n                                    <Stage environment={null} intensity={1} castShadow={false}>\r\n                                        <PotModel\r\n                                            textureUrl={null} shape={selectedShape} size={selectedSize}\r\n                                            scaleX={1} scaleY={1} offsetX={0} offsetY={0} rotation={0}\r\n                                        />\r\n                                    </Stage>\r\n                                </PresentationControls>\r\n                            </Canvas>\r\n                            <div className={styles.rotateHint}><RotateCcw size={12} /> Spin Me</div>\r\n                        </div>\r\n\r\n                        <div className={styles.optionsGrid}>\r\n                            <div className={styles.optionGroup}>\r\n                                <h3>Shape</h3>\r\n                                <div className={styles.visualOptions}>\r\n                                    <div\r\n                                        className={`${styles.visualOption} ${selectedShape === 'classic' ? styles.visualActive : ''}`}\r\n                                        onClick={() => setSelectedShape('classic')}\r\n                                    >\r\n                                        <img src=\"/pot-classic.png\" alt=\"Classic Pot\" />\r\n                                        <span>Classic</span>\r\n                                    </div>\r\n                                    <div\r\n                                        className={`${styles.visualOption} ${selectedShape === 'modern' ? styles.visualActive : ''}`}\r\n                                        onClick={() => setSelectedShape('modern')}\r\n                                    >\r\n                                        <img src=\"/pot-modern.png\" alt=\"Modern Pot\" />\r\n                                        <span>Modern</span>\r\n                                    </div>\r\n                                    <div\r\n                                        className={`${styles.visualOption} ${selectedShape === 'wide' ? styles.visualActive : ''}`}\r\n                                        onClick={() => setSelectedShape('wide')}\r\n                                    >\r\n                                        <img src=\"/pot-wide.png\" alt=\"Wide Pot\" />\r\n                                        <span>Wide</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.optionGroup}>\r\n                                <h3>Size</h3>\r\n                                <div className={styles.optionRow}>\r\n                                    <button className={`${styles.optBtn} ${selectedSize === 'small' ? styles.optActive : ''}`} onClick={() => setSelectedSize('small')}>S</button>\r\n                                    <button className={`${styles.optBtn} ${selectedSize === 'medium' ? styles.optActive : ''}`} onClick={() => setSelectedSize('medium')}>M</button>\r\n                                    <button className={`${styles.optBtn} ${selectedSize === 'large' ? styles.optActive : ''}`} onClick={() => setSelectedSize('large')}>L</button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button className={styles.nextBtn} onClick={() => setStep('upload')}>\r\n                                Next: Add Design &rarr;\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 2: UPLOAD */}\r\n                {step === 'upload' && (\r\n                    <div className={styles.uploadBox} onClick={() => fileInputRef.current?.click()}>\r\n                        <Upload size={48} color=\"#94a3b8\" />\r\n                        <h3>Upload Your Art</h3>\r\n                        <p>Click to browse images</p>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 3: CROP (Flexible Aspect) */}\r\n                {step === 'crop' && (\r\n                    <div className={styles.cropContainer}>\r\n                        <div className={styles.cropperWrapper}>\r\n                            <Cropper\r\n                                image={imageSrc || ''}\r\n                                crop={crop}\r\n                                zoom={zoom}\r\n                                aspect={1}\r\n                                minZoom={0.5}\r\n                                onCropChange={setCrop}\r\n                                onCropComplete={onCropComplete}\r\n                                onZoomChange={setZoom}\r\n                            />\r\n                        </div>\r\n                        <p style={{ fontSize: '0.8rem', color: '#94a3b8', textAlign: 'center' }}>\r\n                            Crop the part of the image you want. You can resize it on the pot in the next step.\r\n                        </p>\r\n                        <div className={styles.cropButtons}>\r\n                            <button onClick={() => setStep('upload')} className={styles.cancelBtn}><X size={18} /></button>\r\n                            <button onClick={handleCropSave} className={styles.applyBtn}><Check size={18} /> Apply</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 4: PREVIEW & CUSTOMIZE */}\r\n                {step === 'preview' && (\r\n                    <div className={styles.previewContainer}>\r\n                        <div className={styles.canvasWrapper}>\r\n                            <Canvas\r\n                                shadows\r\n                                gl={{ preserveDrawingBuffer: true }} // Allow screenshot\r\n                                camera={{ position: [0, 2, 5], fov: 45 }}\r\n                            >\r\n                                <CaptureRelay captureRef={captureRef} />\r\n                                <ambientLight intensity={0.5} />\r\n                                <spotLight position={[10, 10, 10]} angle={0.15} penumbra={1} />\r\n                                <PresentationControls speed={1.5} global zoom={0.7} polar={[-0.1, Math.PI / 4]}>\r\n                                    <Stage environment={null} intensity={1} castShadow={false}>\r\n                                        <PotModel\r\n                                            textureUrl={croppedImage}\r\n                                            shape={selectedShape}\r\n                                            size={selectedSize}\r\n                                            scaleX={texScale}\r\n                                            scaleY={texScale}\r\n                                            offsetX={texOffsetX}\r\n                                            offsetY={texOffsetY}\r\n                                            rotation={texRotation}\r\n                                        />\r\n                                    </Stage>\r\n                                </PresentationControls>\r\n                            </Canvas>\r\n                            <div className={styles.rotateHint}><RotateCcw size={16} /> Drag to rotate</div>\r\n                        </div>\r\n\r\n                        {/* TEXTURE CONTROLS */}\r\n                        <div className={styles.textureControls}>\r\n                            <div className={styles.controlRow}>\r\n                                <Maximize size={16} />\r\n                                <input type=\"range\" min=\"0.5\" max=\"3\" step=\"0.1\" value={texScale} onChange={(e) => setTexScale(parseFloat(e.target.value))} />\r\n                            </div>\r\n                            <div className={styles.controlRow}>\r\n                                <Move size={16} />\r\n                                <input type=\"range\" min=\"-1\" max=\"1\" step=\"0.1\" value={texOffsetX} onChange={(e) => setTexOffsetX(parseFloat(e.target.value))} />\r\n                                <input type=\"range\" min=\"-1\" max=\"1\" step=\"0.1\" value={texOffsetY} onChange={(e) => setTexOffsetY(parseFloat(e.target.value))} />\r\n                            </div>\r\n                            <div className={styles.controlRow}>\r\n                                <RotateCw size={16} />\r\n                                <input type=\"range\" min=\"0\" max=\"360\" step=\"10\" value={texRotation} onChange={(e) => setTexRotation(parseFloat(e.target.value))} />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={styles.controls}>\r\n                            <button className={styles.actionBtn} onClick={() => setStep('crop')}><Camera size={20} /> Re-Crop</button>\r\n                            <div className={styles.divider} />\r\n                            {/* Finalize Button */}\r\n                            <button className={styles.saveBtn} onClick={handleFinalize} style={{ width: '100%', justifyContent: 'center' }}>\r\n                                <Check size={20} /> Generate Final View\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 5: FINAL RESULT */}\r\n                {step === 'result' && finalImage && (\r\n                    <div className={styles.previewContainer}>\r\n                        <div className={styles.canvasWrapper} style={{ background: '#fff', overflow: 'hidden' }}>\r\n                            {/* Display the Captured Image */}\r\n                            <img src={finalImage} alt=\"Final Design\" style={{ width: '100%', height: '100%', objectFit: 'contain' }} />\r\n                        </div>\r\n                        <p style={{ color: '#94a3b8', fontSize: '0.9rem' }}>This is how your masterpiece looks!</p>\r\n\r\n                        <div className={styles.controls}>\r\n                            <button className={styles.actionBtn} onClick={() => setStep('preview')}>\r\n                                <RotateCcw size={20} /> Keep Editing\r\n                            </button>\r\n                            <div className={styles.divider} />\r\n                            <button className={styles.saveBtn} onClick={() => handleSaveDesign()} disabled={saving}>\r\n                                <Save size={20} /> Save & Download\r\n                            </button>\r\n                            <button className={styles.buyBtn} disabled={true} style={{ opacity: 0.7, cursor: 'not-allowed' }}>\r\n                                <ShoppingCart size={20} /> Coming Soon\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <input type=\"file\" ref={fileInputRef} hidden accept=\"image/*\" onChange={handleFileUpload} />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\market\\PlantVendorsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\plants\\PlantCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\plants\\PlantDetailsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[697,700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[697,700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8232,8235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8232,8235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8959,8962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8959,8962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { X, Sun, Wind, Droplet, Leaf, Lightbulb, Fan, AlertTriangle, Sparkles, Stethoscope, BookOpen, GraduationCap, Hourglass, ShoppingBag, HelpCircle, Activity } from 'lucide-react';\r\nimport type { Plant } from '../../../types';\r\nimport styles from './PlantDetailsModal.module.css';\r\nimport { useState, useMemo, useEffect } from 'react';\r\nimport { Button } from '../../common/Button';\r\nimport toast from 'react-hot-toast';\r\nimport { runRoomSimulationMC, generatePlantInsights } from '../../../utils/logic';\r\n\r\ninterface PlantDetailsModalProps {\r\n    plant: Plant;\r\n    score?: number;\r\n    weather: {\r\n        avgTemp30Days?: number;\r\n        avgHumidity30Days?: number;\r\n        [key: string]: any;\r\n    } | null;\r\n    onClose: () => void;\r\n    onBuy?: () => void;\r\n}\r\n\r\nexport const PlantDetailsModal = ({ plant, score = 0, weather, onClose, onBuy }: PlantDetailsModalProps) => {\r\n    const [isMobile, setIsMobile] = useState(window.innerWidth < 1024);\r\n\r\n    useEffect(() => {\r\n        const handleResize = () => setIsMobile(window.innerWidth < 1024);\r\n        window.addEventListener('resize', handleResize);\r\n        return () => window.removeEventListener('resize', handleResize);\r\n    }, []);\r\n\r\n    // UI States\r\n    const [activeTab, setActiveTab] = useState<'overview' | 'simulation'>('overview');\r\n\r\n    // Simulation States\r\n    const [numPeople, setNumPeople] = useState(1);\r\n    const [simulationHours, setSimulationHours] = useState(24); // New State\r\n    const [isACMode, setIsACMode] = useState(false);\r\n    const [targetTemp, setTargetTemp] = useState(22);\r\n    const [lightLevel, setLightLevel] = useState(70);\r\n\r\n    // Environment\r\n    const currentTemp = isACMode ? targetTemp : (weather?.avgTemp30Days || 25);\r\n    const currentHumidity = weather?.avgHumidity30Days || 50;\r\n\r\n\r\n    // ==========================================\r\n    // SCIENTIFIC LOGIC\r\n    // ==========================================\r\n    // ==========================================\r\n    // SCIENTIFIC LOGIC\r\n    // ==========================================\r\n\r\n    // Parse the specific L/day from string \"30 L/day\"\r\n\r\n    const simResults = useMemo(() => {\r\n        const roomSize = 20; // Default room size in m┬▓\r\n        const aqi = weather?.air_quality?.aqi || 50; // Get AQI from weather or default\r\n\r\n        return runRoomSimulationMC(\r\n            plant,\r\n            roomSize,\r\n            simulationHours,\r\n            numPeople,\r\n            currentTemp,\r\n            currentHumidity,\r\n            aqi,\r\n            lightLevel // Added lightLevel\r\n        );\r\n    }, [plant, numPeople, simulationHours, currentTemp, currentHumidity, weather, lightLevel]); // Added lightLevel to dep array\r\n\r\n    const plantsNeeded = simResults.plantsNeeded;\r\n\r\n\r\n    // Stop Propagation Helper\r\n    const stopProp = (e: React.BaseSyntheticEvent) => e.stopPropagation();\r\n\r\n    // ==========================================\r\n    // SHARED COMPONENTS\r\n    // ==========================================\r\n\r\n    const renderGrowthVerdict = () => {\r\n        const aqi = weather?.air_quality?.aqi || 50;\r\n        const insights = generatePlantInsights(plant, currentTemp, currentHumidity, aqi);\r\n\r\n        const getVerdict = () => {\r\n            if (score >= 90) return { label: 'Optimal Match', color: '#10b981', desc: 'Condition analysis complete. Vital signs are within optimal ranges for peak physiological productivity.' };\r\n            if (score >= 75) return { label: 'Resilient Fit', color: '#38bdf8', desc: 'Biological compatibility is high. The specimen is capable of adapting to current atmospheric variance.' };\r\n            if (score >= 50) return { label: 'Struggling Match', color: '#fb923c', desc: 'Ecosystem stress detected. Metabolic efficiency is compromised due to environmental mismatch.' };\r\n            return { label: 'Non-Viable', color: '#f87171', desc: 'Critical life-energy deficit. Continuous exposure to these conditions may lead to permanent cellular damage.' };\r\n        };\r\n\r\n        const verdict = getVerdict();\r\n        const circumference = 2 * Math.PI * 45;\r\n        const offset = circumference - (score / 100) * circumference;\r\n\r\n        return (\r\n            <div className={styles.verdictSection}>\r\n                <div className={styles.verdictHeader}>\r\n                    <div className={styles.verdictTitle}><Activity size={18} /> Ecosystem Viability Analysis</div>\r\n                    <div className=\"text-[10px] font-mono opacity-50\">SCAN_ENGINE_V4.2</div>\r\n                </div>\r\n\r\n                <div className={styles.analysisScanner}>\r\n                    <div className={styles.scannerRing}>\r\n                        <svg className={styles.svgRing} width=\"110\" height=\"110\">\r\n                            <circle className={styles.ringBg} cx=\"55\" cy=\"55\" r=\"45\" />\r\n                            <circle\r\n                                className={styles.ringFill}\r\n                                cx=\"55\" cy=\"55\" r=\"45\"\r\n                                style={{\r\n                                    strokeDasharray: circumference,\r\n                                    strokeDashoffset: offset,\r\n                                    stroke: verdict.color\r\n                                }}\r\n                            />\r\n                        </svg>\r\n                        <div className={styles.scoreCounter}>\r\n                            <span className={styles.scoreLarge}>{score.toFixed(1)}</span>\r\n                            <span className={styles.scorePct}>APTNESS</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.scannerData}>\r\n                        <div className={styles.verdictBadge} style={{ background: `${verdict.color}20`, color: verdict.color }}>\r\n                            {verdict.label}\r\n                        </div>\r\n                        <p className={styles.growthVerdictText}>{verdict.desc}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.tipsGrid}>\r\n                    <div className={styles.tipCard} style={{ borderColor: verdict.color }}>\r\n                        <h5>Growth Prediction</h5>\r\n                        <p>{insights.prediction}</p>\r\n                    </div>\r\n                    <div className={styles.tipCard} style={{ borderColor: '#38bdf8' }}>\r\n                        <h5>Environment Tip</h5>\r\n                        <p>{insights.tip}</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const renderControls = () => (\r\n        <div className={styles.mobileControlsContainer}>\r\n            {/* GPS Warning */}\r\n            <div className={styles.instructionNotice}>\r\n                <AlertTriangle size={16} className=\"text-yellow-500\" style={{ marginTop: 2, flexShrink: 0 }} />\r\n                <div><strong>Pro Tip:</strong> Enable GPS for accurate local climate simulation results.</div>\r\n            </div>\r\n\r\n            {/* People */}\r\n            <div className={styles.controlItem}>\r\n                <div className={styles.controlHeader}>\r\n                    <span>Occupants</span>\r\n                    <span className={styles.controlValue}>{numPeople}</span>\r\n                </div>\r\n                <input\r\n                    type=\"range\" min=\"1\" max=\"10\" value={numPeople}\r\n                    onChange={(e) => setNumPeople(Number(e.target.value))}\r\n                    className={styles.rangeInput}\r\n                />\r\n            </div>\r\n\r\n            {/* Simulation Duration */}\r\n            <div className={styles.controlItem}>\r\n                <div className={styles.controlHeader}>\r\n                    <span style={{ display: 'flex', alignItems: 'center', gap: 6 }}><Hourglass size={14} /> Duration (Hours)</span>\r\n                    <span className={styles.controlValue} style={{ color: '#38bdf8' }}>{simulationHours}h</span>\r\n                </div>\r\n                <input\r\n                    type=\"range\" min=\"1\" max=\"24\" value={simulationHours}\r\n                    onChange={(e) => setSimulationHours(Number(e.target.value))}\r\n                    className={styles.rangeInput}\r\n                    style={{ '--thumb-color': '#38bdf8' } as any}\r\n                />\r\n            </div>\r\n\r\n            {/* Light */}\r\n            <div className={styles.controlItem}>\r\n                <div className={styles.controlHeader}>\r\n                    <span style={{ display: 'flex', alignItems: 'center', gap: 6 }}><Lightbulb size={14} /> Light Level</span>\r\n                    <span className={styles.controlValue} style={{ color: '#facc15' }}>{lightLevel}%</span>\r\n                </div>\r\n                <input\r\n                    type=\"range\" min=\"10\" max=\"100\" value={lightLevel}\r\n                    onChange={(e) => setLightLevel(Number(e.target.value))}\r\n                    className={styles.rangeInput}\r\n                    style={{ '--thumb-color': '#facc15' } as any}\r\n                />\r\n            </div>\r\n\r\n            {/* AC/Temp */}\r\n            <div className={styles.controlItem}>\r\n                <div className={styles.controlHeader}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}><Fan size={14} /> AC Control</div>\r\n                    <button\r\n                        onClick={() => setIsACMode(!isACMode)}\r\n                        className={`${styles.toggleSwitch} ${isACMode ? styles.active : ''}`}\r\n                    />\r\n                </div>\r\n\r\n                {isACMode ? (\r\n                    <div className=\"animate-fade-in space-y-2 mt-2\">\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.8rem', color: '#64748b' }}>\r\n                            <span>Target Temp</span>\r\n                            <span className={styles.controlValue}>{targetTemp}┬░C</span>\r\n                        </div>\r\n                        <input\r\n                            type=\"range\" min=\"16\" max=\"30\" value={targetTemp}\r\n                            onChange={(e) => setTargetTemp(Number(e.target.value))}\r\n                            className={styles.rangeInput}\r\n                        />\r\n                    </div>\r\n                ) : (\r\n                    <div style={{ fontSize: '0.8rem', color: '#64748b', fontStyle: 'italic', display: 'flex', flexDirection: 'column', gap: '4px' }}>\r\n                        <span>Using 30-Day Avg Temp: <strong style={{ color: '#94a3b8' }}>{weather?.avgTemp30Days || 25}┬░C</strong></span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Humidity (Read Only) */}\r\n            <div className={styles.controlItem} style={{ opacity: 0.8 }}>\r\n                <div className={styles.controlHeader}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}><Droplet size={14} /> Avg Humidity (30-Day)</div>\r\n                    <span className={styles.controlValue} style={{ color: '#60a5fa' }}>{weather?.avgHumidity30Days || 50}%</span>\r\n                </div>\r\n                <div style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '4px' }}>\r\n                    Based on your location frequency\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderVisualizer = () => (\r\n        <div style={{ position: 'relative', background: 'rgba(0,0,0,0.3)', borderRadius: '1.5rem', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '220px', border: '1px dashed rgba(255,255,255,0.1)', overflow: 'hidden' }}>\r\n            <div style={{ position: 'absolute', top: '1rem', left: '1rem', fontSize: '0.75rem', color: '#94a3b8', fontWeight: 600, zIndex: 2 }}>RESULTS</div>\r\n            <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap', gap: '8px', maxWidth: '80%', margin: '1rem 0', zIndex: 2 }}>\r\n                {[...Array(Math.min(plantsNeeded, 12))].map((_, i) => (\r\n                    <div key={i} className=\"pop-in\" style={{\r\n                        width: '32px', height: '32px', background: '#10b981', borderRadius: '50%',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                        boxShadow: '0 0 15px rgba(16, 185, 129, 0.4)',\r\n                        animationDelay: `${i * 0.05}s`\r\n                    }}>\r\n                        <Leaf size={14} fill=\"rgba(255,255,255,0.5)\" color=\"white\" />\r\n                    </div>\r\n                ))}\r\n                {plantsNeeded > 12 && <div style={{ color: '#10b981', fontWeight: 700, fontSize: '1.2rem' }}>+{plantsNeeded - 12}</div>}\r\n            </div>\r\n            <div style={{ textAlign: 'center', marginTop: 'auto', marginBottom: '1.5rem', zIndex: 2 }}>\r\n                <div style={{ fontSize: '3rem', fontWeight: 900, color: 'white', lineHeight: 1, textShadow: '0 0 30px rgba(16, 185, 129, 0.3)' }}>\r\n                    {plantsNeeded}\r\n                </div>\r\n                <div\r\n                    style={{\r\n                        fontSize: '0.9rem', color: '#10b981', fontWeight: 600,\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px',\r\n                        cursor: 'help'\r\n                    }}\r\n                    onClick={() => {\r\n                        toast(\r\n                            \"≡ƒö¼ Biological Simulation: We run 250 Monte Carlo iterations across a stochastic 168-hour environmental window. \" +\r\n                            \"This accurately predicts plant performance based on your specific local temperature and humidity patterns. \" +\r\n                            \"This number ensures you have optimal oxygen supply for your entire duration!\",\r\n                            { icon: '≡ƒî▒', duration: 6000, style: { background: '#1e293b', color: '#fff', borderRadius: '12px', border: '1px solid #10b981' } }\r\n                        );\r\n                    }}\r\n                >\r\n                    Plants Needed <HelpCircle size={14} />\r\n                </div>\r\n                <div style={{ fontSize: '0.8rem', color: '#64748b' }}>For {numPeople} People (Needs {numPeople * 550}L OΓéé)</div>\r\n            </div>\r\n            <div style={{ position: 'absolute', inset: 0, background: 'radial-gradient(circle at center, rgba(16, 185, 129, 0.1), transparent 70%)' }}></div>\r\n        </div>\r\n    );\r\n\r\n    // ==========================================\r\n    // MOBILE VIEW\r\n    // ==========================================\r\n    if (isMobile) {\r\n        return (\r\n            <div\r\n                className={`${styles.overlay} no-swipe`}\r\n                onClick={onClose}\r\n                onMouseDown={stopProp}\r\n                onMouseUp={stopProp}\r\n                onTouchStart={stopProp}\r\n                onTouchMove={stopProp}\r\n                onTouchEnd={stopProp}\r\n                style={{ zIndex: 9999, padding: '10px' }}\r\n            >\r\n                <div className={styles.modal} onClick={(e) => e.stopPropagation()} style={{\r\n                    maxHeight: '90vh', overflowY: 'auto', borderRadius: '24px',\r\n                    background: '#0f172a', border: '1px solid rgba(255,255,255,0.1)'\r\n                }}>\r\n                    <div style={{ height: '200px', position: 'relative' }}>\r\n                        <img src={plant.imageUrl} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                        <div style={{ position: 'absolute', inset: 0, background: 'linear-gradient(to top, #0f172a 0%, transparent 100%)' }}></div>\r\n                        <button onClick={onClose} style={{ position: 'absolute', top: 15, right: 15, background: 'rgba(0,0,0,0.5)', borderRadius: '50%', padding: 8, color: 'white', border: 'none' }}>\r\n                            <X size={20} />\r\n                        </button>\r\n                        <div style={{ position: 'absolute', bottom: 10, left: 20 }}>\r\n                            <h2 style={{ fontSize: '2rem', fontWeight: 800, color: 'white', margin: 0 }}>{plant.name}</h2>\r\n                            <div style={{ display: 'flex', gap: 10, marginTop: 5 }}>\r\n                                <span style={{ fontSize: '0.75rem', background: '#334155', padding: '2px 8px', borderRadius: 4 }}>{plant.oxygenLevel} O2</span>\r\n                                <span style={{ fontSize: '0.75rem', background: '#334155', padding: '2px 8px', borderRadius: 4 }}>{plant.sunlight}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '2rem' }}>\r\n                        <div className={styles.overviewContainer}>\r\n                            <h3 style={{ fontSize: '1.2rem', color: 'white', marginBottom: '0.5rem' }}>Ecosystem Status</h3>\r\n                            {renderGrowthVerdict()}\r\n\r\n                            <h3 style={{ fontSize: '1.2rem', color: 'white', marginBottom: '0.5rem', marginTop: '2rem' }}>Overview</h3>\r\n                            <p className={styles.descriptionText}>{plant.description}</p>\r\n\r\n                            {/* Mobile Advantages & Medicine */}\r\n                            <div className={styles.infoGrid}>\r\n                                {plant.advantages && plant.advantages.length > 0 && (\r\n                                    <div className={`${styles.infoCard} ${styles.cardGreen}`}>\r\n                                        <div className={`${styles.cardHeader} ${styles.textGreen}`}>\r\n                                            <Sparkles size={16} /> Key Advantages\r\n                                        </div>\r\n                                        <div className={styles.chipsContainer}>\r\n                                            {plant.advantages.map((adv, i) => (\r\n                                                <span key={i} className={`${styles.chip} ${styles.chipGreen}`}>\r\n                                                    {adv}\r\n                                                </span>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {plant.medicinalValues && plant.medicinalValues.length > 0 && (\r\n                                    <div className={`${styles.infoCard} ${styles.cardRose}`}>\r\n                                        <div className={`${styles.cardHeader} ${styles.textRose}`}>\r\n                                            <Stethoscope size={16} /> Medicinal Uses\r\n                                        </div>\r\n                                        <div className={styles.chipsContainer}>\r\n                                            {plant.medicinalValues.map((med, i) => (\r\n                                                <span key={i} className={`${styles.chip} ${styles.chipRose}`}>\r\n                                                    {med}\r\n                                                </span>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: '2rem' }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\r\n                                <h3 style={{ margin: 0, color: '#38bdf8', display: 'flex', alignItems: 'center', gap: 6 }}>\r\n                                    <Wind size={20} /> Room Lab\r\n                                </h3>\r\n                                <div className=\"text-xs text-emerald-400 font-bold border border-emerald-500 rounded px-2\">ACTIVE</div>\r\n                            </div>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>\r\n                                {renderControls()}\r\n                                {renderVisualizer()}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {onBuy && (\r\n                            <div style={{ marginTop: '1rem', paddingBottom: '1rem' }}>\r\n                                <Button onClick={onBuy} variant=\"primary\" style={{ width: '100%', padding: '1rem', fontSize: '1.1rem', background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', boxShadow: '0 4px 15px rgba(16, 185, 129, 0.4)' }}>\r\n                                    <ShoppingBag size={20} style={{ marginRight: '8px' }} /> Buy Now\r\n                                </Button>\r\n                            </div>\r\n                        )}\r\n\r\n                    </div>\r\n                </div>\r\n                <style>{`\r\n                    .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards; }\r\n                    .animate-fade-in { animation: fadeIn 0.3s ease-out; }\r\n                    @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }\r\n                    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\r\n                `}</style>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ==========================================\r\n    // DESKTOP VIEW\r\n    // ==========================================\r\n    return (\r\n        <div\r\n            className={`${styles.overlay} no-swipe`}\r\n            onClick={onClose}\r\n            onMouseDown={stopProp}\r\n            onMouseUp={stopProp}\r\n            onTouchStart={stopProp}\r\n            onTouchMove={stopProp}\r\n            onTouchEnd={stopProp}\r\n            style={{ zIndex: 9999 }}\r\n        >\r\n            <div className={styles.modal} onClick={(e) => e.stopPropagation()} style={{ overflow: 'hidden', padding: 0 }}>\r\n                <div style={{ display: 'flex', height: '100%', flexDirection: 'row' }}>\r\n\r\n                    <div style={{ flex: '0 0 45%', position: 'relative', background: '#0f172a' }}>\r\n                        <img src={plant.imageUrl} alt={plant.name} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                        <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', background: 'linear-gradient(to bottom, rgba(0,0,0,0.2), transparent 50%, rgba(0,0,0,0.8))' }}></div>\r\n                        <button onClick={onClose} style={{ position: 'absolute', top: '2rem', left: '2rem', background: 'rgba(0,0,0,0.5)', padding: '10px', borderRadius: '50%', color: 'white', border: 'none', cursor: 'pointer', backdropFilter: 'blur(4px)' }}>\r\n                            <X size={24} />\r\n                        </button>\r\n                        <div style={{ position: 'absolute', bottom: '3rem', left: '3rem', color: 'white' }}>\r\n                            <h1 style={{ fontSize: '3rem', fontWeight: 900, lineHeight: 1, textShadow: '0 2px 10px rgba(0,0,0,0.5)' }}>{plant.name}</h1>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: '#1e293b', borderLeft: '1px solid rgba(255,255,255,0.05)' }}>\r\n                        <div style={{ padding: '2rem 3rem', borderBottom: '1px solid rgba(255,255,255,0.05)', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                            <div style={{ display: 'flex', background: 'rgba(0,0,0,0.2)', padding: '4px', borderRadius: '12px' }}>\r\n                                <button onClick={() => setActiveTab('overview')} style={{ padding: '10px 24px', borderRadius: '8px', border: 'none', cursor: 'pointer', fontWeight: 600, background: activeTab === 'overview' ? '#334155' : 'transparent', color: activeTab === 'overview' ? 'white' : '#64748b', transition: 'all 0.2s' }}>Overview</button>\r\n                                <button onClick={() => setActiveTab('simulation')} style={{ padding: '10px 24px', borderRadius: '8px', border: 'none', cursor: 'pointer', fontWeight: 600, background: activeTab === 'simulation' ? '#334155' : 'transparent', color: activeTab === 'simulation' ? '#38bdf8' : '#64748b', transition: 'all 0.2s' }}>Simulation</button>\r\n                            </div>\r\n\r\n                            {/* Desktop Buy Button */}\r\n                            {onBuy && (\r\n                                <button\r\n                                    onClick={onBuy}\r\n                                    style={{\r\n                                        display: 'flex', alignItems: 'center', gap: '8px',\r\n                                        background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n                                        color: 'white',\r\n                                        padding: '10px 24px', borderRadius: '12px',\r\n                                        border: 'none', fontWeight: 700, cursor: 'pointer',\r\n                                        boxShadow: '0 4px 15px rgba(16, 185, 129, 0.3)',\r\n                                        transition: 'transform 0.2s',\r\n                                        marginRight: '20px' // Added margin to move it left from edge\r\n                                    }}\r\n                                    className=\"hover-scale\"\r\n                                >\r\n                                    <ShoppingBag size={18} /> Buy Now\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div style={{ flex: 1, overflowY: 'auto', padding: '3rem' }}>\r\n                            {activeTab === 'overview' ? (\r\n                                <div className={`${styles.overviewContainer} animate-fade-in`}>\r\n                                    <h3 style={{ fontSize: '1.5rem', color: 'white', marginBottom: '1.5rem' }}>Ecosystem Status</h3>\r\n                                    {renderGrowthVerdict()}\r\n\r\n                                    <h3 style={{ fontSize: '1.5rem', color: 'white', marginBottom: '1.5rem', marginTop: '3rem' }}>Botanical Overview</h3>\r\n                                    <p className={styles.descriptionText}>{plant.description}</p>\r\n\r\n                                    {/* Desktop Advantages & Medicine */}\r\n                                    <div className={styles.infoGrid}>\r\n                                        {plant.advantages && plant.advantages.length > 0 && (\r\n                                            <div className={`${styles.infoCard} ${styles.cardGreen}`}>\r\n                                                <div className={`${styles.cardHeader} ${styles.textGreen}`}>\r\n                                                    <Sparkles size={16} /> Key Advantages\r\n                                                </div>\r\n                                                <div className={styles.chipsContainer}>\r\n                                                    {plant.advantages.map((adv, i) => (\r\n                                                        <span key={i} className={`${styles.chip} ${styles.chipGreen}`}>\r\n                                                            {adv}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {plant.medicinalValues && plant.medicinalValues.length > 0 && (\r\n                                            <div className={`${styles.infoCard} ${styles.cardRose}`}>\r\n                                                <div className={`${styles.cardHeader} ${styles.textRose}`}>\r\n                                                    <Stethoscope size={16} /> Medicinal Uses\r\n                                                </div>\r\n                                                <div className={styles.chipsContainer}>\r\n                                                    {plant.medicinalValues.map((med, i) => (\r\n                                                        <span key={i} className={`${styles.chip} ${styles.chipRose}`}>\r\n                                                            {med}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <div className={styles.statsRow}>\r\n                                        <div className={styles.statItem}>\r\n                                            <div className={styles.statIcon}><Sun className=\"text-yellow-400\" /></div>\r\n                                            <div className={styles.statText}>\r\n                                                <span className={styles.statLabel}>Sunlight</span>\r\n                                                <span className={styles.statValue}>{plant.sunlight}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.statItem}>\r\n                                            <div className={styles.statIcon}><Droplet className=\"text-blue-400\" /></div>\r\n                                            <div className={styles.statText}>\r\n                                                <span className={styles.statLabel}>Water</span>\r\n                                                <span className={styles.statValue}>Weekly</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.statItem}>\r\n                                            <div className={styles.statIcon}><Hourglass className=\"text-pink-400\" /></div>\r\n                                            <div className={styles.statText}>\r\n                                                <span className={styles.statLabel}>Life Exp.</span>\r\n                                                <span className={styles.statValue}>{plant.lifespan || '3-5 Years'}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* ≡ƒÄô Educational Deep Dive */}\r\n                                    <div className={styles.educationalSection}>\r\n                                        <div className={styles.eduHeader}>\r\n                                            <GraduationCap size={20} color=\"#38bdf8\" />\r\n                                            <h3>Botanical Deep Dive</h3>\r\n                                        </div>\r\n                                        <div className={styles.eduGrid}>\r\n                                            <div className={styles.eduCard}>\r\n                                                <BookOpen size={16} />\r\n                                                <h4>Scientific Trivia</h4>\r\n                                                <p>Did you know? The {plant.name} uses CAM photosynthesis to purify air even during the nocturnal cycle.</p>\r\n                                            </div>\r\n                                            <div className={styles.eduCard}>\r\n                                                <Sparkles size={16} />\r\n                                                <h4>Beginner Friendly</h4>\r\n                                                <p>Top tip: Avoid overwatering. This species thrives when the top 2 inches of soil are dry.</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"animate-fade-in\" style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '2rem' }}>\r\n                                    {renderVisualizer()}\r\n                                    {renderControls()}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Desktop Footer Removed */}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <style>{` .animate-fade-in { animation: fadeIn 0.4s ease-out; } `}</style>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\plants\\PlantSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\vendor\\MarketInsights.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[415,418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[415,418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1930,1933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1930,1933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3137,3140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3137,3140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { TrendingUp, Map, Award, Lightbulb, ArrowUpRight } from 'lucide-react';\r\nimport { fetchVendorAnalytics } from '../../../services/api';\r\nimport styles from './MarketInsights.module.css';\r\n\r\ninterface MarketInsightsProps {\r\n    vendorId: string;\r\n}\r\n\r\nexport const MarketInsights = ({ vendorId }: MarketInsightsProps) => {\r\n    const [stats, setStats] = useState<any>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const load = async () => {\r\n            try {\r\n                const res = await fetchVendorAnalytics(vendorId);\r\n                setStats(res);\r\n            } catch (e) {\r\n                console.error(\"Analytics failure\", e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        load();\r\n    }, [vendorId]);\r\n\r\n    if (loading) return <div style={{ color: '#64748b', padding: '2rem', textAlign: 'center' }}>Synchronizing local market data...</div>;\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <header className={styles.header}>\r\n                <div className={styles.titleGroup}>\r\n                    <div className={styles.iconBox}>\r\n                        <TrendingUp size={24} />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className={styles.title}>Market Intelligence</h2>\r\n                        <p className={styles.subtitle}>Real-time search trends and regional demand within 5km.</p>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <div className={styles.grid}>\r\n                {/* TOP SEARCHES */}\r\n                <div className={styles.card}>\r\n                    <div className={styles.cardHeader}>\r\n                        <Award size={16} /> Most Wanted Species\r\n                    </div>\r\n                    {stats?.topSearches?.map((item: any, idx: number) => (\r\n                        <div key={idx} className={styles.listItem}>\r\n                            <div className={styles.indicator}>\r\n                                <div className={styles.rank}>{idx + 1}</div>\r\n                                <span className={styles.label}>{item._id}</span>\r\n                            </div>\r\n                            <div className={styles.valueGroup}>\r\n                                <span className={styles.count}>{item.count}</span>\r\n                                <span className={styles.growth}>searches</span>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                    {!stats?.topSearches?.length && <div style={{ color: '#475569', textAlign: 'center', padding: '2rem' }}>No search data yet.</div>}\r\n                </div>\r\n\r\n                {/* DEMAND BY CITY */}\r\n                <div className={styles.card}>\r\n                    <div className={styles.cardHeader}>\r\n                        <Map size={16} /> Regional Interest\r\n                    </div>\r\n                    <div className={styles.barContainer}>\r\n                        {stats?.demandByLocation?.map((item: any, idx: number) => {\r\n                            const max = stats.demandByLocation[0].count;\r\n                            const percentage = (item.count / max) * 100;\r\n                            return (\r\n                                <div key={idx} className={styles.barWrapper}>\r\n                                    <div className={styles.barLabel}>\r\n                                        <span className={styles.barName}>{item._id || 'Nearby'}</span>\r\n                                        <span className={styles.barValue}>{item.count} requests</span>\r\n                                    </div>\r\n                                    <div className={styles.track}>\r\n                                        <div className={styles.fill} style={{ width: `${percentage}%` }} />\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                        {!stats?.demandByLocation?.length && <div style={{ color: '#475569', textAlign: 'center', padding: '2rem' }}>Awaiting local GPS signals.</div>}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* AI INSIGHT */}\r\n                <div className={styles.insightBanner}>\r\n                    <Lightbulb className={styles.insightIcon} size={28} />\r\n                    <div className={styles.insightText}>\r\n                        <strong>Smart Tip:</strong> {stats?.topSearches?.[0] ?\r\n                            `There is a 30% surge in searches for \"${stats.topSearches[0]._id}\". Consider restocking this species to maximize visibility.` :\r\n                            \"Keep your inventory updated to track which of your specimens are attracting the most interest.\"\r\n                        }\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '4px', marginTop: '4px', cursor: 'pointer', color: '#10b981', fontWeight: 700 }}>\r\n                            View detailed report <ArrowUpRight size={14} />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\vendor\\VendorInventory.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPlants'. Either include it or remove the dependency array.","line":33,"column":8,"nodeType":"ArrayExpression","endLine":33,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadPlants]","fix":{"range":[1512,1514],"text":"[loadPlants]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1973,1976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1973,1976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2821,2824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2821,2824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":142,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":166,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":166,"endColumn":21}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Search, Save, AlertCircle, CheckCircle, Package, DollarSign, Trash2 } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { fetchPlants, updateVendor } from '../../../services/api';\r\nimport { formatCurrency } from '../../../utils/currency';\r\nimport type { Plant, Vendor } from '../../../types';\r\nimport styles from './VendorInventory.module.css';\r\n\r\ninterface VendorInventoryProps {\r\n    vendor: Vendor;\r\n    onUpdate: () => void; // Callback to refresh parent data\r\n}\r\n\r\nexport const VendorInventory = ({ vendor, onUpdate }: VendorInventoryProps) => {\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [editValues, setEditValues] = useState<Record<string, { price: string, quantity: string, inStock: boolean }>>({});\r\n\r\n    useEffect(() => {\r\n        // Restore state after forced refresh\r\n        const restoreState = sessionStorage.getItem('vendor_restore');\r\n        if (restoreState) {\r\n            const { query, scroll } = JSON.parse(restoreState);\r\n            setSearchQuery(query);\r\n            setTimeout(() => {\r\n                window.scrollTo(0, scroll);\r\n                toast.success(\"Data verified & synched from server!\", { icon: '≡ƒöÉ' });\r\n            }, 500); // Small delay to allow rendering\r\n            sessionStorage.removeItem('vendor_restore');\r\n        }\r\n        loadPlants();\r\n    }, []);\r\n\r\n    // Auto-refresh: Sync local state when vendor data updates (e.g. after save)\r\n    useEffect(() => {\r\n        if (vendor.inventory && plants.length > 0) {\r\n            const serverState: Record<string, { price: string, quantity: string, inStock: boolean }> = {};\r\n            vendor.inventory.forEach(item => {\r\n                serverState[item.plantId] = {\r\n                    price: item.price.toString(),\r\n                    quantity: ((item as any).quantity || 0).toString(),\r\n                    inStock: item.inStock\r\n                };\r\n            });\r\n            // Merge with existing to keep unsaved input, but overwrite saved ones\r\n            setEditValues(prev => ({ ...prev, ...serverState }));\r\n        }\r\n    }, [vendor, plants]);\r\n\r\n    const loadPlants = async () => {\r\n        try {\r\n            const data = await fetchPlants();\r\n            setPlants(data);\r\n\r\n            // Initialize edit values from existing inventory\r\n            const initialEdits: Record<string, { price: string, quantity: string, inStock: boolean }> = {};\r\n            if (vendor.inventory) {\r\n                vendor.inventory.forEach(item => {\r\n                    initialEdits[item.plantId] = {\r\n                        price: item.price.toString(),\r\n                        quantity: ((item as any).quantity || 0).toString(),\r\n                        inStock: item.inStock\r\n                    };\r\n                });\r\n            }\r\n            setEditValues(initialEdits);\r\n        } catch (err) {\r\n            console.error(err);\r\n            toast.error(\"Failed to load plant catalog\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleFieldChange = (plantId: string, field: 'price' | 'quantity', val: string) => {\r\n        setEditValues(prev => ({\r\n            ...prev,\r\n            [plantId]: {\r\n                ...prev[plantId],\r\n                [field]: val,\r\n                inStock: prev[plantId]?.inStock ?? true\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toggleStock = (plantId: string) => {\r\n        setEditValues(prev => ({\r\n            ...prev,\r\n            [plantId]: { ...prev[plantId], inStock: !prev[plantId]?.inStock }\r\n        }));\r\n    };\r\n\r\n    const handleSaveItem = async (plant: Plant) => {\r\n        const edits = editValues[plant.id];\r\n        if (!edits || !edits.price) {\r\n            toast.error(\"Please set a valid price\");\r\n            return;\r\n        }\r\n\r\n        const newPrice = parseFloat(edits.price);\r\n        const newQty = parseInt(edits.quantity || '0');\r\n\r\n        if (isNaN(newPrice) || newPrice <= 0) {\r\n            toast.error(\"Invalid price entered\");\r\n            return;\r\n        }\r\n\r\n        // Prepare new inventory array\r\n        const currentInventory = vendor.inventory || [];\r\n        const existingIndex = currentInventory.findIndex(i => i.plantId === plant.id);\r\n\r\n        const newInventory = [...currentInventory];\r\n        const newItem = {\r\n            plantId: plant.id,\r\n            price: newPrice,\r\n            quantity: newQty,\r\n            status: 'approved' as const,\r\n            inStock: edits.inStock\r\n        };\r\n\r\n        if (existingIndex >= 0) {\r\n            newInventory[existingIndex] = newItem;\r\n        } else {\r\n            newInventory.push(newItem);\r\n        }\r\n\r\n        const tid = toast.loading(\"Securely saving...\");\r\n        try {\r\n            const success = await updateVendor(vendor.id, { inventory: newInventory });\r\n            if (success) {\r\n                onUpdate();\r\n                // FORCE REFRESH LOGIC\r\n                sessionStorage.setItem('vendor_restore', JSON.stringify({\r\n                    query: searchQuery,\r\n                    scroll: window.scrollY\r\n                }));\r\n                window.location.reload();\r\n            } else {\r\n                throw new Error(\"Update failed\");\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Failed to update inventory\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleRemoveItem = async (plantId: string) => {\r\n        if (!confirm(\"Remove this plant from your inventory?\")) return;\r\n\r\n        const currentInventory = vendor.inventory || [];\r\n        const newInventory = currentInventory.filter(i => i.plantId !== plantId);\r\n\r\n        const tid = toast.loading(\"Removing...\");\r\n        try {\r\n            const success = await updateVendor(vendor.id, { inventory: newInventory });\r\n            if (success) {\r\n                onUpdate();\r\n                sessionStorage.setItem('vendor_restore', JSON.stringify({\r\n                    query: searchQuery,\r\n                    scroll: window.scrollY\r\n                }));\r\n                window.location.reload();\r\n            } else {\r\n                throw new Error(\"Update failed\");\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Failed to remove item\", { id: tid });\r\n        }\r\n    };\r\n\r\n\r\n    const filteredPlants = plants.filter(p =>\r\n        p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        p.scientificName.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    const getInventoryItem = (plantId: string) => {\r\n        return vendor.inventory?.find(i => i.plantId === plantId);\r\n    };\r\n\r\n    if (!vendor.verified) {\r\n        return (\r\n            <div className={styles.container} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '400px', textAlign: 'center' }}>\r\n                <div style={{ background: 'rgba(234, 179, 8, 0.1)', padding: '3rem', borderRadius: '1rem', border: '1px dashed rgba(234, 179, 8, 0.3)' }}>\r\n                    <AlertCircle size={48} color=\"#facc15\" style={{ margin: '0 auto 1.5rem' }} />\r\n                    <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#facc15', marginBottom: '1rem' }}>Account Verification Pending</h2>\r\n                    <p style={{ color: '#94a3b8', maxWidth: '400px', lineHeight: '1.6' }}>\r\n                        Your partner account is currently being reviewed by our administration team.\r\n                        <br /><br />\r\n                        Pricing and inventory controls will be unlocked as soon as your profile is verified by an admin.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.titleGroup}>\r\n                    <h2 className={styles.title}>\r\n                        <Package className=\"text-emerald-400\" /> Inventory & Pricing\r\n                    </h2>\r\n                    <p className={styles.subtitle}>\r\n                        Manage your catalog and pricing.\r\n                    </p>\r\n                </div>\r\n                <div className={styles.searchWrapper}>\r\n                    <Search className={styles.searchIcon} size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search species...\"\r\n                        value={searchQuery}\r\n                        onChange={e => setSearchQuery(e.target.value)}\r\n                        className={styles.searchInput}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"p-12 text-center text-slate-500 animate-pulse\">Loading catalog...</div>\r\n            ) : (\r\n                <div className={styles.grid}>\r\n                    {filteredPlants.map(plant => {\r\n                        const invItem = getInventoryItem(plant.id);\r\n                        const editState = editValues[plant.id] || { price: '', inStock: true };\r\n                        const isPending = invItem?.status === 'pending';\r\n\r\n                        return (\r\n                            <div key={plant.id} className={styles.card}>\r\n                                <div className={styles.imageWrapper}>\r\n                                    <img src={plant.imageUrl} className={styles.image} alt={plant.name} />\r\n                                    {invItem && (\r\n                                        <div className={`${styles.statusBadge} ${isPending ? styles.statusPending : styles.statusLive}`}>\r\n                                            {isPending ? <AlertCircle size={10} /> : <CheckCircle size={10} />}\r\n                                            {isPending ? 'Pending' : 'Live'}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className={styles.cardContent}>\r\n                                    <h3 className={styles.plantName}>{plant.name}</h3>\r\n                                    <p className={styles.scientificName}>{plant.scientificName}</p>\r\n\r\n                                    <div className={styles.controls}>\r\n                                        <div className={styles.guidelineRow}>\r\n                                            <span>Market Guideline:</span>\r\n                                            <span className={styles.guidelineValue}>{formatCurrency(plant.price)}</span>\r\n                                        </div>\r\n\r\n                                        <div className={styles.inputGroup}>\r\n                                            <div className={styles.priceInputWrapper}>\r\n                                                <DollarSign size={14} className={styles.currencySymbol} />\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    placeholder=\"Price\"\r\n                                                    value={editState.price}\r\n                                                    onChange={e => handleFieldChange(plant.id, 'price', e.target.value)}\r\n                                                    className={styles.priceInput}\r\n                                                />\r\n                                            </div>\r\n                                            <div className={styles.priceInputWrapper} style={{ width: '80px', marginLeft: '0.5rem' }}>\r\n                                                <span style={{ fontSize: '0.7rem', color: '#64748b', paddingLeft: '8px' }}>Qty:</span>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    placeholder=\"Qty\"\r\n                                                    value={editState.quantity}\r\n                                                    onChange={e => handleFieldChange(plant.id, 'quantity', e.target.value)}\r\n                                                    className={styles.priceInput}\r\n                                                    style={{ paddingLeft: '4px' }}\r\n                                                />\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={() => handleSaveItem(plant)}\r\n                                                className={styles.saveBtn}\r\n                                                title=\"Save Price\"\r\n                                            >\r\n                                                <Save size={18} />\r\n                                            </button>\r\n                                            {invItem && (\r\n                                                <button\r\n                                                    onClick={() => handleRemoveItem(plant.id)}\r\n                                                    className={styles.deleteBtn}\r\n                                                    title=\"Remove from Inventory\"\r\n                                                    style={{ marginLeft: '0.5rem', padding: '0.5rem', borderRadius: '8px', background: 'rgba(239, 68, 68, 0.1)', color: '#ef4444', border: 'none', cursor: 'pointer' }}\r\n                                                >\r\n                                                    <Trash2 size={18} />\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {invItem && (\r\n                                            <div className={styles.stockToggle}>\r\n                                                <label className={styles.switch}>\r\n                                                    <input\r\n                                                        type=\"checkbox\"\r\n                                                        checked={editState.inStock}\r\n                                                        onChange={() => toggleStock(plant.id)}\r\n                                                    />\r\n                                                    <span className={styles.slider}></span>\r\n                                                </label>\r\n                                                <span className={styles.stockLabel}>\r\n                                                    {editState.inStock ? 'In Stock' : 'Out of Stock'}\r\n                                                </span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\AnimatedRoutes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\MobileBottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\MobileTabBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\Navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\SwipeNavigator.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'tabs'. Either include it or remove the dependency array.","line":98,"column":8,"nodeType":"ArrayExpression","endLine":98,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [navigate, tabs]","fix":{"range":[4428,4438],"text":"[navigate, tabs]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport const SwipeNavigator = () => {\r\n    const navigate = useNavigate();\r\n\r\n    // Use Refs to maintain mutable state without triggering re-renders or stale closures in listeners\r\n    const touchStartX = useRef<number | null>(null);\r\n    const touchStartY = useRef<number | null>(null);\r\n    const touchEndX = useRef<number | null>(null);\r\n    const touchEndY = useRef<number | null>(null);\r\n\r\n    // Navigation Order (Matches MobileTabBar)\r\n    // Navigation Order (Matches MobileTabBar)\r\n    const tabs = ['/', '/nearby', '/shops', '/leaderboard', '/heaven', '/cart'];\r\n    const minSwipeDistance = 70; // px\r\n\r\n    useEffect(() => {\r\n        const handleTouchStart = (e: TouchEvent) => {\r\n            if (window.location.pathname === '/pot-designer' || window.location.pathname === '/ai-doctor') return;\r\n            touchEndX.current = null;\r\n            touchEndY.current = null;\r\n            touchStartX.current = e.targetTouches[0].clientX;\r\n            touchStartY.current = e.targetTouches[0].clientY;\r\n        };\r\n\r\n        const handleTouchMove = (e: TouchEvent) => {\r\n            touchEndX.current = e.targetTouches[0].clientX;\r\n            touchEndY.current = e.targetTouches[0].clientY;\r\n        };\r\n\r\n        const handleTouchEnd = (e: TouchEvent) => {\r\n            if (touchStartX.current === null || touchEndX.current === null) return;\r\n\r\n            const startX = touchStartX.current;\r\n            const endX = touchEndX.current;\r\n            const startY = touchStartY.current || 0;\r\n            const endY = touchEndY.current || 0;\r\n\r\n            const distanceX = startX - endX;\r\n            const distanceY = startY - endY;\r\n\r\n            // 1. Dominant Axis Check (Must be horizontal swipe)\r\n            if (Math.abs(distanceY) > Math.abs(distanceX)) return;\r\n\r\n            // 2. Minimum Distance Check\r\n            if (Math.abs(distanceX) < minSwipeDistance) return;\r\n\r\n            // 3. Conflict Check (Leaflet Map or No-Swipe zones)\r\n            const target = e.target as HTMLElement;\r\n            if (target.closest('.leaflet-container')) return;\r\n            if (target.closest('.no-swipe')) return;\r\n            // Also ignore sliders if we had them (e.g. .overflow-x-scroll)\r\n            // Ideally check if target is scrollable horizontally? \r\n            // For now, strict Map check is critical.\r\n\r\n            const isLeftSwipe = distanceX > 0; // Swipe Left -> Next\r\n            const isRightSwipe = distanceX < 0; // Swipe Right -> Prev\r\n\r\n            // Get current path (use latest location from closure if this effect re-runs, \r\n            // OR use a generic look up if the effect is mounted once. \r\n            // Location changes re-run this effect, so `location.pathname` is fresh.)\r\n\r\n            // Wait, if I bind once, `location.pathname` is stale.\r\n            // I should emit a custom event or navigate based on valid stable check?\r\n            // Actually, if I include `location.pathname` in dependency, it re-binds.\r\n            // Re-binding on route change (navigation) is perfectly fine.\r\n\r\n            // We need to find the index *inside* the event handler, using fresh location?\r\n            // Since this effect depends on location.pathname, the closure *will* have the fresh pathname.\r\n\r\n            const currentPath = window.location.pathname; // Always fresh\r\n            const currentIndex = tabs.findIndex(path => path === currentPath);\r\n\r\n            if (currentIndex === -1) return;\r\n\r\n            if (isLeftSwipe) {\r\n                if (currentIndex < tabs.length - 1) {\r\n                    navigate(tabs[currentIndex + 1]);\r\n                }\r\n            } else if (isRightSwipe) {\r\n                if (currentIndex > 0) {\r\n                    navigate(tabs[currentIndex - 1]);\r\n                }\r\n            }\r\n        };\r\n\r\n        // Attach listeners\r\n        document.addEventListener('touchstart', handleTouchStart, { passive: true });\r\n        document.addEventListener('touchmove', handleTouchMove, { passive: true });\r\n        document.addEventListener('touchend', handleTouchEnd);\r\n\r\n        return () => {\r\n            document.removeEventListener('touchstart', handleTouchStart);\r\n            document.removeEventListener('touchmove', handleTouchMove);\r\n            document.removeEventListener('touchend', handleTouchEnd);\r\n        };\r\n    }, [navigate]); // navigate is stable. location.pathname is handled by window.location check.\r\n\r\n    return null;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\context\\AuthContext.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":264,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":264,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\context\\CartContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2469,2472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2469,2472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2487,2490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2487,2490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3467,3470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3467,3470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5732,5735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5732,5735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":205,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":205,"endColumn":21}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';\r\nimport type { Plant, CartItem } from '../types';\r\nimport { useAuth } from './AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\ninterface RawCartItem {\r\n    plantId?: string;\r\n    _id?: string;\r\n    quantity: number;\r\n    plant?: Plant;\r\n}\r\n\r\ninterface CartContextType {\r\n    items: CartItem[];\r\n    addToCart: (plant: Plant, vendorId?: string, price?: number) => void;\r\n    removeFromCart: (plantId: string, vendorId?: string) => void;\r\n    removeItems: (itemsToRemove: { plantId: string, vendorId?: string }[]) => void;\r\n    updateQuantity: (plantId: string, quantity: number, vendorId?: string) => void;\r\n}\r\n\r\nconst CartContext = createContext<CartContextType | undefined>(undefined);\r\n\r\nexport const CartProvider = ({ children }: { children: ReactNode }) => {\r\n    const { user, updateUser } = useAuth();\r\n\r\n    // Initial load from localStorage (either from user or guest_cart)\r\n    const [items, setItems] = useState<CartItem[]>(() => {\r\n        const savedUser = localStorage.getItem('user');\r\n        if (savedUser) {\r\n            const parsed = JSON.parse(savedUser);\r\n            if (parsed.cart) {\r\n                // Prevent crash: Only use cached cart if it contains full plant objects.\r\n                if (parsed.cart.length > 0 && !parsed.cart[0].plant) {\r\n                    return [];\r\n                }\r\n                return parsed.cart;\r\n            }\r\n        }\r\n        const guestCart = localStorage.getItem('guest_cart');\r\n        if (guestCart) return JSON.parse(guestCart);\r\n        return [];\r\n    });\r\n\r\n    // Sync local cart with user's DB cart on login\r\n    useEffect(() => {\r\n        const hydrateCart = async () => {\r\n            if (user && user.cart && user.cart.length > 0) {\r\n                const firstItem = user.cart[0] as unknown as RawCartItem;\r\n                const needsHydration = !firstItem.plant && (firstItem.plantId || firstItem._id);\r\n\r\n                if (needsHydration) {\r\n                    try {\r\n                        const { fetchPlants, fetchMyCustomPots } = await import('../services/api');\r\n                        const [allPlants, myDesigns] = await Promise.all([\r\n                            fetchPlants(),\r\n                            fetchMyCustomPots().catch(() => []) // Fallback to empty if fails\r\n                        ]);\r\n\r\n                        const hydratedItems: CartItem[] = (user.cart as any[]).map((item: any) => {\r\n                            const raw = item as RawCartItem;\r\n                            const targetId = raw.plantId || raw._id;\r\n                            if (!targetId) return null;\r\n\r\n                            // Try finding in standard plants\r\n                            const fullPlant = allPlants.find(p => p.id === targetId);\r\n                            if (fullPlant) {\r\n                                return {\r\n                                    plant: fullPlant,\r\n                                    quantity: item.quantity || 1,\r\n                                    vendorId: item.vendorId,\r\n                                    vendorPrice: item.vendorPrice\r\n                                } as CartItem;\r\n                            }\r\n\r\n                            // Try finding in user's custom designs\r\n                            const cleanId = targetId.replace('cp_', '');\r\n                            const customPot = myDesigns.find((d: any) => d._id === cleanId);\r\n                            if (customPot) {\r\n                                return {\r\n                                    plant: {\r\n                                        id: `cp_${customPot._id}`,\r\n                                        name: 'Your Custom Design',\r\n                                        scientificName: `Studio Ceramic (${customPot.potColor})`,\r\n                                        description: 'Handcrafted design from your VanaMap Studio session.',\r\n                                        imageUrl: customPot.potWithDesignUrl,\r\n                                        price: 299,\r\n                                        type: 'indoor',\r\n                                        medicinalValues: [],\r\n                                        advantages: ['Unique Style', 'High Quality'],\r\n                                        idealTempMin: 0, idealTempMax: 50, minHumidity: 0,\r\n                                        sunlight: 'Any', oxygenLevel: 'N/A'\r\n                                    },\r\n                                    quantity: item.quantity || 1,\r\n                                    vendorId: item.vendorId || 'vanamap',\r\n                                    vendorPrice: item.vendorPrice || 299\r\n                                } as CartItem;\r\n                            }\r\n\r\n                            return null;\r\n                        }).filter((i): i is CartItem => i !== null);\r\n\r\n                        setItems(hydratedItems);\r\n                    } catch (err) {\r\n                        console.error(\"Failed to hydrate cart\", err);\r\n                    }\r\n                } else {\r\n                    setItems(user.cart as unknown as CartItem[]);\r\n                }\r\n            } else if (user && (!user.cart || user.cart.length === 0)) {\r\n                setItems([]);\r\n            }\r\n        };\r\n\r\n        hydrateCart();\r\n    }, [user]);\r\n\r\n    const persistCart = (newItems: CartItem[]) => {\r\n        const cartPayload = newItems.map(i => ({\r\n            plantId: i.plant.id,\r\n            quantity: i.quantity,\r\n            vendorId: i.vendorId,\r\n            vendorPrice: i.vendorPrice\r\n        }));\r\n        if (user) {\r\n            updateUser({ cart: cartPayload as any });\r\n            import('../services/api').then(({ syncCart }) => syncCart(cartPayload));\r\n        } else {\r\n            localStorage.setItem('guest_cart', JSON.stringify(newItems));\r\n        }\r\n    };\r\n\r\n    const addToCart = (plant: Plant, vendorId?: string, price?: number) => {\r\n        setItems(prev => {\r\n            // Check for existing item with same plant AND same vendor\r\n            const existing = prev.find(i => i.plant.id === plant.id && i.vendorId === vendorId);\r\n            let newItems: CartItem[];\r\n\r\n            if (existing) {\r\n                newItems = prev.map(i =>\r\n                    (i.plant.id === plant.id && i.vendorId === vendorId)\r\n                        ? { ...i, quantity: i.quantity + 1 }\r\n                        : i\r\n                );\r\n            } else {\r\n                newItems = [...prev, {\r\n                    plant,\r\n                    quantity: 1,\r\n                    vendorId,\r\n                    vendorPrice: price\r\n                }];\r\n            }\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n        toast.success(`${plant.name} added to cart!`);\r\n    };\r\n\r\n    const updateQuantity = (plantId: string, quantity: number, vendorId?: string) => {\r\n        setItems(prev => {\r\n            let newItems;\r\n            if (quantity <= 0) {\r\n                newItems = prev.filter(i => !(i.plant.id === plantId && i.vendorId === vendorId));\r\n            } else {\r\n                newItems = prev.map(i =>\r\n                    (i.plant.id === plantId && i.vendorId === vendorId)\r\n                        ? { ...i, quantity }\r\n                        : i\r\n                );\r\n            }\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n    };\r\n\r\n    const removeFromCart = (plantId: string, vendorId?: string) => {\r\n        setItems(prev => {\r\n            // Remove specific item matching plantId and vendorId (if provided)\r\n            // If vendorId is undefined, it removes generic entries (or all matching plantId? usually specialized logic needed)\r\n            // For now, assume exact match needed\r\n            const newItems = prev.filter(i => !(i.plant.id === plantId && i.vendorId === vendorId));\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n        toast.success(`Item removed`);\r\n    };\r\n\r\n    const removeItems = (itemsToRemove: { plantId: string, vendorId?: string }[]) => {\r\n        setItems(prev => {\r\n            const newItems = prev.filter(i =>\r\n                !itemsToRemove.some(r => r.plantId === i.plant.id && r.vendorId === i.vendorId)\r\n            );\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n        toast.success(`Items removed from cart`);\r\n    };\r\n\r\n    return (\r\n        <CartContext.Provider value={{ items, addToCart, removeFromCart, removeItems, updateQuantity }}>\r\n            {children}\r\n        </CartContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useCart = () => {\r\n    const context = useContext(CartContext);\r\n    if (!context) throw new Error('useCart must be used within a CartProvider');\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\context\\ThemeContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":54,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":54,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState, type ReactNode } from 'react';\r\n\r\ntype Theme = 'dark' | 'light';\r\n\r\ninterface ThemeContextType {\r\n    theme: Theme;\r\n    isPremium: boolean;\r\n    toggleTheme: () => void;\r\n    togglePremium: () => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport const ThemeProvider = ({ children }: { children: ReactNode }) => {\r\n    const [theme, setTheme] = useState<Theme>(() => {\r\n        const saved = localStorage.getItem('theme');\r\n        return (saved as Theme) || 'dark';\r\n    });\r\n\r\n    const [isPremium, setIsPremium] = useState<boolean>(() => {\r\n        return localStorage.getItem('isPremium') === 'true';\r\n    });\r\n\r\n    useEffect(() => {\r\n        document.documentElement.setAttribute('data-theme', theme);\r\n        localStorage.setItem('theme', theme);\r\n    }, [theme]);\r\n\r\n    useEffect(() => {\r\n        document.documentElement.setAttribute('data-premium', isPremium ? 'true' : 'false');\r\n        if (isPremium) {\r\n            document.body.classList.add('premium-mode');\r\n        } else {\r\n            document.body.classList.remove('premium-mode');\r\n        }\r\n        localStorage.setItem('isPremium', String(isPremium));\r\n    }, [isPremium]);\r\n\r\n    const toggleTheme = () => {\r\n        setTheme(prev => prev === 'dark' ? 'light' : 'dark');\r\n    };\r\n\r\n    const togglePremium = () => {\r\n        setIsPremium(prev => !prev);\r\n    };\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, isPremium, toggleTheme, togglePremium }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useTheme = () => {\r\n    const context = useContext(ThemeContext);\r\n    if (!context) throw new Error('useTheme must be used within a ThemeProvider');\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\countryCodes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\indianPlants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\mocks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\states.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\worldFlora.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\AIDoctor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4154,4157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4154,4157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":132,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":240,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9327,9330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9327,9330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'synth'. Either include it or remove the dependency array.","line":364,"column":8,"nodeType":"ArrayExpression","endLine":364,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [synth]","fix":{"range":[14078,14080],"text":"[synth]"}}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":379,"column":25,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":379,"endColumn":26,"suggestions":[{"messageId":"removeEscape","fix":{"range":[14562,14563],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[14562,14562],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'synth'. Either include it or remove the dependency array.","line":542,"column":8,"nodeType":"ArrayExpression","endLine":542,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [voiceEnabled, synth, messages]","fix":{"range":[23076,23100],"text":"[voiceEnabled, synth, messages]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'speak'. Either include it or remove the dependency array.","line":566,"column":8,"nodeType":"ArrayExpression","endLine":566,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [messages, speak, voiceEnabled]","fix":{"range":[23907,23931],"text":"[messages, speak, voiceEnabled]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":572,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":572,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24141,24144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24141,24144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":581,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":581,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24372,24375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24372,24375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":581,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":581,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24409,24412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24409,24412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":617,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":617,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25706,25709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25706,25709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":636,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":636,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26361,26364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26361,26364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useEffect, useCallback } from 'react';\nimport { Send, Sparkles, Leaf, Bot, User, Trash2, Download, Calendar, Globe, Camera, Mic, Volume2, VolumeX, Zap, Loader2 } from 'lucide-react';\nimport { chatWithDrFlora, API_URL } from '../services/api';\nimport toast from 'react-hot-toast';\nimport { useAuth } from '../context/AuthContext';\nimport styles from './AIDoctor.module.css';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\n\ninterface Message {\n    id: string;\n    role: 'user' | 'assistant';\n    content: string;\n    timestamp: Date;\n    image?: string;\n    images?: string[]; // Support for multiple AI models (Flux & SDXL)\n}\n\nconst ImageLoader = ({ idx }: { idx: number }) => {\n    const [progress, setProgress] = useState(0);\n\n    useEffect(() => {\n        const interval = setInterval(() => {\n            setProgress(old => {\n                if (old >= 95) return old;\n                // Random jump to simulate network traffic\n                const jump = Math.floor(Math.random() * 5) + 1;\n                return Math.min(old + jump, 95);\n            });\n        }, 300); // Update every 300ms\n        return () => clearInterval(interval);\n    }, []);\n\n    return (\n        <div style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n            background: 'rgba(255,255,255,0.85)',\n            backdropFilter: 'blur(8px)',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            gap: '12px',\n            zIndex: 5,\n            transition: 'opacity 0.3s'\n        }}>\n            <div style={{ animation: 'spin 1.5s linear infinite', display: 'flex', color: '#059669' }}>\n                <Loader2 size={42} />\n            </div>\n            <div style={{ textAlign: 'center' }}>\n                <div style={{ fontSize: '1rem', fontWeight: 800, color: '#059669', marginBottom: '4px' }}>\n                    {idx === 0 ? 'Painting Botanical Art...' : 'Developing Photo...'}\n                </div>\n                <div style={{ fontSize: '0.8rem', color: '#64748b' }}>\n                    Estimated Progress: {progress}%\n                </div>\n                {/* Visual Progress Bar */}\n                <div style={{\n                    width: '120px',\n                    height: '4px',\n                    background: '#e2e8f0',\n                    borderRadius: '2px',\n                    marginTop: '8px',\n                    overflow: 'hidden'\n                }}>\n                    <div style={{\n                        width: `${progress}%`,\n                        height: '100%',\n                        background: '#10b981',\n                        transition: 'width 0.3s ease-out'\n                    }} />\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport const AIDoctor = () => {\n    const { user } = useAuth();\n    const [messages, setMessages] = useState<Message[]>([\n        {\n            id: '1',\n            role: 'assistant',\n            content: \"≡ƒî┐ Hello! I'm Dr. Flora, your AI Plant Doctor. I have extensive knowledge about plant care, diseases, and treatments. How can I help your plants thrive today?\",\n            timestamp: new Date()\n        }\n    ]);\n    const [downloadingIds, setDownloadingIds] = useState<Set<string>>(new Set());\n    const [loadedImageIds, setLoadedImageIds] = useState<Set<string>>(new Set());\n\n    const [input, setInput] = useState('');\n    const [loading, setLoading] = useState(false);\n\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n    const lastSpokenMessageIdRef = useRef<string | null>(null);\n    const timeoutIdsRef = useRef<number[]>([]);\n\n    const [neuralMeta, setNeuralMeta] = useState<{ current: number; max: number } | null>(null);\n\n\n    const scrollToBottom = () => {\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    };\n\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n\n    // Web Search for Scientific Plant Data\n\n    const handleSend = async (contentOverride?: string | any) => {\n        const textToSend = typeof contentOverride === 'string' ? contentOverride : input;\n\n        if (!textToSend.trim() && !selectedImage) return;\n\n        const messageContent = textToSend || \"What plant is this?\"; // Default question if only image\n        let base64Image: string | null = null;\n\n        if (selectedImage) {\n            try {\n                const reader = new FileReader();\n                base64Image = await new Promise((resolve, reject) => {\n                    reader.onload = () => resolve(reader.result as string);\n                    reader.onerror = reject;\n                    reader.readAsDataURL(selectedImage);\n                });\n                // Don't add text, just store image\n            } catch (e) {\n                toast.error(\"Failed to process image\");\n                return;\n            }\n        }\n\n        const userMessage: Message = {\n            id: Date.now().toString(),\n            role: 'user',\n            content: messageContent,\n            timestamp: new Date(),\n            image: base64Image || undefined // Store image in message\n        };\n\n        setMessages(prev => [...prev, userMessage]);\n        setInput('');\n        setLoading(true);\n\n\n        clearImage();\n\n        try {\n            // Include the new user message in the API call\n            // We ensure that if there's an image, it's sent along with the history\n            const conversationHistory = [...messages, userMessage].map(m => ({\n                role: m.role,\n                content: m.content,\n                // If the message has an image, the backend can now potentially use it\n                metadata: m.image ? { hasImage: true } : undefined\n            }));\n\n            const response = await chatWithDrFlora(\n                conversationHistory,\n                { timezone: Intl.DateTimeFormat().resolvedOptions().timeZone },\n                base64Image // Current turn image\n            );\n\n            console.log('[AI Doctor] Raw API Response:', response); // Debugging\n\n            // --- Update Neural Energy Levels ---\n            if (response.usageMeta) {\n                const remaining = parseInt(response.usageMeta.remaining || '0') || 0;\n                const limit = parseInt(response.usageMeta.limit || '100000') || 100000;\n                setNeuralMeta({ current: remaining, max: limit });\n\n                if (remaining > 0 && remaining < 20000) {\n                    toast(\"ΓÜá∩╕Å Neural Energy Low!\", { icon: 'ΓÜí' });\n                }\n            }\n\n            let aiText = response.choices?.[0]?.message?.content;\n\n            if (!aiText) {\n                // Context-aware Fallbacks\n                if (response.refusal) {\n                    aiText = `I cannot answer that: ${response.refusal}`;\n                } else if (base64Image) {\n                    aiText = \"I couldn't analyze the image. Please ensure it's clear and contains a plant.\";\n                } else {\n                    aiText = \"I apologize, I'm having trouble connecting right now. Please try asking again.\";\n                }\n                console.warn('[AI Doctor] Empty content received', response);\n            }\n\n            const assistantMessage: Message = {\n                id: (Date.now() + 1).toString(),\n                role: 'assistant',\n                content: aiText,\n                image: response.choices?.[0]?.message?.image,\n                images: response.choices?.[0]?.message?.images, // CAPTURE BOTH FLUX & SDXL\n                timestamp: new Date()\n            };\n\n            // Debug logging for image generation\n            if (assistantMessage.images || assistantMessage.image) {\n                console.log('[AI Doctor] ≡ƒÄ¿ Images detected in response:');\n                console.log('  - Single image:', assistantMessage.image);\n                console.log('  - Multiple images:', assistantMessage.images);\n                console.log('  - Total images:', assistantMessage.images?.length || (assistantMessage.image ? 1 : 0));\n            } else {\n                console.log('[AI Doctor] Γä╣∩╕Å No images in this response');\n            }\n\n\n            setMessages(prev => [...prev, assistantMessage]);\n\n        } catch (error) {\n            console.error(error);\n            setMessages(prev => [...prev, {\n                id: (Date.now() + 1).toString(),\n                role: 'assistant',\n                content: \"ΓÜá∩╕Å **Dr. Flora is offline.** Please check your connection or try again later.\",\n                timestamp: new Date()\n            }]);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleCareCalendar = () => {\n        let prompt = \"Please create a detailed weekly care calendar (watering, light, fertilizer) for my plants.\";\n\n        // Smart Context: Use cart items if available\n        // Assuming 'user' is available in the component's scope, e.g., from a context or prop\n        // For this example, 'user' is not defined in the provided snippet, so this part might need adjustment\n        // based on your actual application structure.\n\n        if (user?.cart && user.cart.length > 0) {\n            const plantNames = user.cart.map((i: any) => i.name || \"plants\").join(\", \");\n            prompt = `Please create a detailed weekly care calendar for these plants: ${plantNames}. Include specific days for watering.`;\n        }\n\n        handleSend(prompt);\n    };\n\n    const handleClear = () => {\n        setMessages([{\n            id: '1',\n            role: 'assistant',\n            content: \"Welcome back! ≡ƒî┐ I hope your garden is thriving today. How can I help your green friends?\",\n            timestamp: new Date()\n        }]);\n    };\n\n    const downloadImage = async (base64OrUrl: string, messageId: string) => {\n        try {\n            setDownloadingIds(prev => new Set(prev).add(messageId));\n            toast.loading(\"Preparing high-quality PNG...\", { id: `dl-${messageId}` });\n\n            // Robust URL resolution\n            let urlToFetch = base64OrUrl;\n            if (base64OrUrl.startsWith('/')) {\n                const baseUrl = API_URL.replace(/\\/api$/, '');\n                urlToFetch = `${baseUrl}${base64OrUrl}`;\n            }\n\n            // Check if it's base64 data\n            if (urlToFetch.startsWith('data:')) {\n                const link = document.createElement('a');\n                link.href = urlToFetch;\n                link.download = `DrFlora_Scan_${messageId}.png`;\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n                completeDownload(messageId);\n                return;\n            }\n\n            // For http/https URLs (including our backend generated ones), fetch as Blob\n            const response = await fetch(urlToFetch);\n            if (!response.ok) throw new Error(`Download failed: ${response.statusText}`);\n\n            const blob = await response.blob();\n            const blobUrl = window.URL.createObjectURL(blob);\n\n            const link = document.createElement('a');\n            link.href = blobUrl;\n            link.download = `DrFlora_Botanical_${messageId}.png`;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n\n            // Cleanup\n            window.URL.revokeObjectURL(blobUrl);\n            completeDownload(messageId);\n\n        } catch (error) {\n            console.error('Download failed:', error);\n            setDownloadingIds(prev => {\n                const next = new Set(prev);\n                next.delete(messageId);\n                return next;\n            });\n            toast.error('Download failed. Opening in new tab...', { id: `dl-${messageId}` });\n            window.open(base64OrUrl, '_blank');\n        }\n    };\n\n    const completeDownload = (messageId: string) => {\n        setDownloadingIds(prev => {\n            const next = new Set(prev);\n            next.delete(messageId);\n            return next;\n        });\n        toast.success(\"Image saved! Γ£à\", { id: `dl-${messageId}` });\n    };\n    const handleExport = () => {\n        const transcript = messages.map(m =>\n            `[${m.timestamp.toLocaleTimeString()}] ${m.role === 'user' ? 'You' : 'Dr. Flora'}: ${m.content}`\n        ).join('\\n\\n');\n\n        const blob = new Blob([transcript], { type: 'text/plain' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `plant-consultation-${Date.now()}.txt`;\n        a.click();\n        toast.success('Conversation exported!');\n    };\n\n    // --- VOICE ASSISTANT (Dr. Flora's Voice) ---\n    const [voiceEnabled, setVoiceEnabled] = useState(true);\n    const [isSpeaking, setIsSpeaking] = useState(false);\n    const synth = window.speechSynthesis;\n\n    // --- LANGUAGE SELECTION ---\n    const [selectedLanguage, setSelectedLanguage] = useState('English');\n    const [showLanguageMenu, setShowLanguageMenu] = useState(false);\n\n    const languages = [\n        'English', 'αñ╣αñ┐αñéαñªαÑÇ (Hindi)', 'α┤«α┤▓α┤»α┤╛α┤│α┤é (Malayalam)', 'α«ñα««α«┐α«┤α»ì (Tamil)',\n        'α░ñα▒åα░▓α▒üα░ùα▒ü (Telugu)', 'α▓òα▓¿α│ìα▓¿α▓í (Kannada)', 'αª¼αª╛αªéαª▓αª╛ (Bengali)', 'αª«αñ░αñ╛αñáαÑÇ (Marathi)',\n        'α¬ùα½üα¬£α¬░α¬╛α¬ñα½Ç (Gujarati)', 'α¿¬α⌐░α¿£α¿╛α¿¼α⌐Ç (Punjabi)', 'Espa├▒ol', 'Fran├ºais', 'Deutsch',\n        'Σ╕¡µûç', 'µùÑµ£¼Φ¬₧', '╪º┘ä╪╣╪▒╪¿┘è╪⌐'\n    ];\n\n    useEffect(() => {\n        // Preload voices\n        const loadVoices = () => {\n            const voices = synth.getVoices();\n            console.log(\"Available voices:\", voices.map(v => v.name));\n        };\n        loadVoices();\n        if (speechSynthesis.onvoiceschanged !== undefined) {\n            speechSynthesis.onvoiceschanged = loadVoices;\n        }\n        return () => {\n            // Cleanup on unmount\n            synth.cancel(); // Stop speaking on unmount\n            timeoutIdsRef.current.forEach(id => clearTimeout(id)); // Clear all pending timeouts\n            timeoutIdsRef.current = [];\n        }\n    }, []);\n\n    const speak = useCallback((text: string) => {\n        if (!voiceEnabled) return;\n\n        // Clear any pending timeouts\n        timeoutIdsRef.current.forEach(id => clearTimeout(id));\n        timeoutIdsRef.current = [];\n\n        // Cancel any current speech\n        synth.cancel();\n\n        // 1. Advanced Text Cleanup & Convert Emotions to Speakable Sounds\n        const cleanText = text\n            .replace(/\\*/g, '') // Remove bold/italic markers\n            .replace(/[#\\-]/g, '') // Remove headers/lists\n            .replace(/\\[.*?\\]/g, '') // Remove [Citation] or [Image] tags\n            // Convert emotional expressions to speakable sounds\n            .replace(/\\*giggles\\*/gi, 'hehe') // *giggles* ΓåÆ \"hehe\"\n            .replace(/\\*laughs\\*/gi, 'haha') // *laughs* ΓåÆ \"haha\"\n            .replace(/\\*happy dance\\*/gi, 'yay!') // *happy dance* ΓåÆ \"yay!\"\n            .replace(/\\*sighs\\*/gi, 'hmm') // *sighs* ΓåÆ \"hmm\"\n            .replace(/\\*gasps\\*/gi, 'oh!') // *gasps* ΓåÆ \"oh!\"\n            .replace(/\\*chuckles\\*/gi, 'hehe') // *chuckles* ΓåÆ \"hehe\"\n            // Keep natural interjections\n            .replace(/haha+/gi, (match) => match.toLowerCase()) // Normalize \"haha\"\n            .replace(/hehe+/gi, (match) => match.toLowerCase()) // Normalize \"hehe\"\n            .replace(/aww+/gi, (match) => match.toLowerCase()) // Normalize \"aww\"\n            .replace(/omg/gi, 'oh my gosh') // OMG ΓåÆ speakable\n            .replace(/lol/gi, 'haha') // LOL ΓåÆ \"haha\"\n            // Remove remaining emojis AFTER converting text emotions\n            .replace(/[\\u{1F300}-\\u{1F9FF}]/gu, '')\n            // Fix common pronunciation issues\n            .replace(/\\bDr\\.\\s*/gi, 'Doctor ') // \"Dr.\" ΓåÆ \"Doctor\"\n            .replace(/\\bMr\\.\\s*/gi, 'Mister ')\n            .replace(/\\bMs\\.\\s*/gi, 'Miss ')\n            .replace(/\\bMrs\\.\\s*/gi, 'Missus ')\n            .replace(/\\bSt\\.\\s*/gi, 'Saint ')\n            .replace(/\\bAve\\.\\s*/gi, 'Avenue ')\n            .replace(/\\betc\\.\\s*/gi, 'et cetera ')\n            .replace(/\\be\\.g\\.\\s*/gi, 'for example ')\n            .replace(/\\bi\\.e\\.\\s*/gi, 'that is ')\n            // Add natural pauses and breathing patterns for human-like speech\n            .replace(/([.!?])\\s+/g, '$1 ')\n            .replace(/,\\s+/g, ', ')\n            .replace(/:\\s+/g, ': ')\n            .replace(/;\\s+/g, '; ')\n            .replace(/\\b(and|but|so|because|however|therefore)\\b/gi, ' $1 ')\n            .replace(/\\b(well|um|uh|like|you know)\\b/gi, '$1, ')\n            .trim();\n\n        // Split into natural speech units (sentences/phrases) without creating duplicates\n        // Split on sentence boundaries but keep the punctuation with the sentence\n        const speechUnits: string[] = cleanText\n            .split(/(?<=[.!?])\\s+/)  // Split after punctuation followed by space\n            .filter(unit => unit.trim().length > 0)  // Remove empty units\n            .map(unit => unit.trim());  // Clean up whitespace\n\n        // 2. Multi-Language Accent & Voice Selection\n        const voices = synth.getVoices();\n\n        // Detect language of the text\n        const detectLanguage = (text: string) => {\n            if (/[\\u0900-\\u097F]/.test(text)) return 'hi-IN'; // Hindi\n            if (/[\\u4E00-\\u9FFF]/.test(text)) return 'zh-CN'; // Chinese\n            if (/[\\u3040-\\u30FF]/.test(text)) return 'ja-JP'; // Japanese\n            if (/[\\u0600-\\u06FF]/.test(text)) return 'ar-SA'; // Arabic\n            if (/[\\u0400-\\u04FF]/.test(text)) return 'ru-RU'; // Russian\n            // Fallback to browser language if Latin-based, or default English\n            return navigator.language || 'en-US';\n        };\n\n        const targetLang = detectLanguage(cleanText);\n        const langCode = targetLang.split('-')[0];\n\n        // Find the absolute best voice for this specific language/accent\n        const preferredVoice =\n            // 1. Natural/Neural for the specific language\n            voices.find(v => v.lang.startsWith(langCode) && (v.name.includes(\"Natural\") || v.name.includes(\"Neural\")) && v.name.includes(\"Female\")) ||\n            voices.find(v => v.lang.startsWith(langCode) && (v.name.includes(\"Natural\") || v.name.includes(\"Neural\"))) ||\n            // 2. High-quality platform specific triggers\n            voices.find(v => v.lang.startsWith(langCode) && (v.name.includes(\"Google\") || v.name.includes(\"Microsoft\"))) ||\n            // 3. Generic language match\n            voices.find(v => v.lang.startsWith(langCode) && v.name.toLowerCase().includes(\"female\")) ||\n            voices.find(v => v.lang.startsWith(langCode)) ||\n            // 4. Ultimate English fallback (if target lang not found)\n            voices.find(v => v.name.includes(\"Natural\") && v.name.includes(\"Female\") && v.lang.startsWith(\"en\")) ||\n            voices.find(v => v.lang.startsWith(\"en-US\")) ||\n            voices.find(v => v.lang.startsWith(\"en\"));\n\n        if (preferredVoice) console.log(`[Voice System] Speaking in ${targetLang} accent using: ${preferredVoice.name}`);\n\n        // 3. Detect Global Emotional Mood from the last user message\n        const userMessages = messages.filter(m => m.role === 'user');\n        const lastUserMsg = userMessages[userMessages.length - 1]?.content.toLowerCase() || '';\n\n        let globalMood = 'natural';\n        if (lastUserMsg.includes('sad') || lastUserMsg.includes('died') || lastUserMsg.includes('poor') || lastUserMsg.includes('help')) globalMood = 'concerned';\n        if (lastUserMsg.includes('happy') || lastUserMsg.includes('yay') || lastUserMsg.includes('great')) globalMood = 'joyful';\n\n        // Remove any duplicate units (safety check)\n        const uniqueUnits = [...new Set(speechUnits)];\n        console.log('[Voice] Speech units:', uniqueUnits);\n\n        // 4. Speak Phrase-by-Phrase with EXTREME Expression\n        uniqueUnits.forEach((unit: string, index: number) => {\n            if (!unit.trim()) return;\n\n            const utterance = new SpeechSynthesisUtterance(unit.trim());\n            utterance.lang = targetLang; // Match browser engine to text language\n            if (preferredVoice) utterance.voice = preferredVoice;\n\n            // --- Human Imperfection & Texture Modulation ---\n            const microPitch = (Math.random() - 0.5) * 0.12;\n            const microRate = (Math.random() - 0.5) * 0.1;\n\n            let basePitch = 1.2;\n            let baseRate = 1.0;\n            let baseVolume = 1.0;\n\n            if (globalMood === 'joyful') {\n                basePitch = 1.4; // Happier base\n                baseRate = 1.1;\n            } else if (globalMood === 'concerned') {\n                basePitch = 1.0; // Sober base\n                baseRate = 0.9;\n            }\n\n            const lowerUnit = unit.toLowerCase();\n\n            // ≡ƒÆ¡ THINKING FILLER MODULATION\n            if (lowerUnit.match(/\\b(um|uh|well|hmm)\\b/)) {\n                basePitch *= 0.85; baseRate *= 0.8; baseVolume *= 0.8;\n            }\n\n            // ≡ƒñ½ WHISPER / SOFT MODE\n            if (lowerUnit.includes('(softly)') || lowerUnit.includes('shh')) {\n                basePitch *= 0.82; baseRate *= 0.88; baseVolume *= 0.55;\n            }\n\n            // EXTREME EMOTIONAL TRIGGERS\n            if (lowerUnit.includes('haha') || lowerUnit.includes('hehe') || lowerUnit.includes('lol')) {\n                basePitch = 1.6; baseRate = 1.35; baseVolume = 1.15;\n            }\n            else if (lowerUnit.includes('wow') || lowerUnit.includes('yay') || lowerUnit.includes('!') || lowerUnit.includes('amazing')) {\n                basePitch = 1.5; baseRate = 1.25; baseVolume = 1.2;\n            }\n            else if (lowerUnit.includes('sad') || lowerUnit.includes('died') || lowerUnit.includes('sorry') || lowerUnit.includes('poor')) {\n                basePitch = 0.65; baseRate = 0.75; baseVolume = 0.85;\n            }\n            else if (lowerUnit.includes('worry') || lowerUnit.includes('fix') || lowerUnit.includes('together') || lowerUnit.includes('okay')) {\n                basePitch = 1.1; baseRate = 0.85; baseVolume = 0.95;\n            }\n\n            // Questions - Rising excitement/curiosity\n            if (unit.includes('?')) {\n                basePitch += 0.25; baseRate -= 0.05;\n            }\n\n            utterance.pitch = basePitch + microPitch;\n            utterance.rate = baseRate + microRate;\n            utterance.volume = baseVolume;\n\n            // Tracking speaking state\n            if (index === 0) utterance.onstart = () => setIsSpeaking(true);\n            if (index === uniqueUnits.length - 1) {\n                utterance.onend = () => setIsSpeaking(false);\n                utterance.onerror = () => setIsSpeaking(false);\n            }\n\n            // Breath/Thought Pacing with proper cleanup\n            if (unit.length > 50 || unit.includes('.') || unit.includes('!')) {\n                const timeoutId = window.setTimeout(() => synth.speak(utterance), 20);\n                timeoutIdsRef.current.push(timeoutId);\n            } else {\n                synth.speak(utterance);\n            }\n        });\n    }, [voiceEnabled, messages]);\n\n    const toggleVoice = () => {\n        if (voiceEnabled) {\n            synth.cancel();\n            setVoiceEnabled(false);\n            setIsSpeaking(false);\n            toast(\"Voice Assistant Disabled\", { icon: '≡ƒöç' });\n        } else {\n            setVoiceEnabled(true);\n            toast(\"Dr. Flora's Voice Enabled! ≡ƒÄº\", { icon: '≡ƒùú∩╕Å' });\n        }\n    };\n\n    // Auto-speak new AI messages\n    useEffect(() => {\n        const lastMsg = messages[messages.length - 1];\n        if (voiceEnabled && lastMsg.role === 'assistant' && lastMsg.id !== '1') {\n            // Prevent repeating the same message ID\n            if (lastSpokenMessageIdRef.current !== lastMsg.id) {\n                lastSpokenMessageIdRef.current = lastMsg.id;\n                speak(lastMsg.content);\n            }\n        }\n    }, [messages, voiceEnabled]);\n\n\n    // --- SPEECH RECOGNITION (Microphone Input) ---\n    const [isListening, setIsListening] = useState(false);\n    // Use a ref to keep track of the recognition instance\n    const recognitionRef = useRef<any>(null);\n\n    const toggleListening = () => {\n        if (isListening) {\n            recognitionRef.current?.stop();\n            setIsListening(false);\n            return;\n        }\n\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n        if (!SpeechRecognition) {\n            toast.error(\"Your browser doesn't support speech recognition. Try Chrome or Edge!\");\n            return;\n        }\n\n        const recognition = new SpeechRecognition();\n\n        // Enhanced Configuration for Better Recognition\n        recognition.continuous = false; // Stop after one phrase\n        recognition.interimResults = true; // Show real-time results\n\n        // Auto-detect user's language or use browser default\n        // Supports: en-US, hi-IN, es-ES, fr-FR, de-DE, ja-JP, zh-CN, ar-SA, etc.\n        const userLang = navigator.language || 'en-US';\n        recognition.lang = userLang;\n\n        console.log(`[Voice Input] Using language: ${userLang}`);\n\n        recognition.onstart = () => {\n            setIsListening(true);\n            // Stop AI from speaking when user starts talking\n            if (synth.speaking) {\n                synth.cancel();\n                setIsSpeaking(false);\n            }\n            toast(`≡ƒÄñ Listening in ${userLang}...`, {\n                icon: '≡ƒæé',\n                duration: 3000,\n                style: {\n                    background: '#10b981',\n                    color: 'white'\n                }\n            });\n        };\n\n        recognition.onresult = (event: any) => {\n            // Only process FINAL results to avoid duplication\n            const lastResult = event.results[event.results.length - 1];\n\n            if (lastResult.isFinal) {\n                const transcript = lastResult[0].transcript.trim();\n\n                if (transcript) {\n                    // Replace input entirely with final transcript (no appending)\n                    setInput(transcript);\n\n                    toast.success(`Heard: \"${transcript}\"`, {\n                        icon: 'Γ£à',\n                        duration: 2000\n                    });\n                }\n            }\n        };\n\n        recognition.onerror = (event: any) => {\n            console.error(\"Speech recognition error:\", event.error);\n            setIsListening(false);\n\n            // User-friendly error messages\n            switch (event.error) {\n                case 'not-allowed':\n                case 'permission-denied':\n                    toast.error(\"≡ƒÜ½ Microphone access denied. Please allow microphone in browser settings.\");\n                    break;\n                case 'no-speech':\n                    toast(\"No speech detected. Please try again.\", { icon: '≡ƒñö' });\n                    break;\n                case 'network':\n                    toast.error(\"Network error. Check your internet connection.\");\n                    break;\n                case 'language-not-supported':\n                    toast.error(`Language ${userLang} not supported. Switching to English.`);\n                    recognition.lang = 'en-US';\n                    break;\n                default:\n                    toast.error(`Speech recognition error: ${event.error}`);\n            }\n        };\n\n        recognition.onend = () => {\n            setIsListening(false);\n        };\n\n        recognitionRef.current = recognition;\n\n        try {\n            recognition.start();\n        } catch (error) {\n            console.error(\"Failed to start recognition:\", error);\n            toast.error(\"Could not start voice recognition. Please try again.\");\n            setIsListening(false);\n        }\n    };\n\n    // --- IMAGE UPLOAD (Plant Diagnosis) ---\n    const [selectedImage, setSelectedImage] = useState<File | null>(null);\n    const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n    const fileInputRef = useRef<HTMLInputElement>(null);\n\n    const handleScanClick = () => {\n        if (fileInputRef.current) {\n            fileInputRef.current.click();\n        }\n    };\n\n    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const file = e.target.files?.[0];\n        if (file) {\n            // Validate file type\n            if (!file.type.startsWith('image/')) {\n                toast.error(\"Please select an image file.\");\n                return;\n            }\n\n            // Validate file size (max 5MB)\n            if (file.size > 5 * 1024 * 1024) {\n                toast.error(\"Image too large. Please select an image under 5MB.\");\n                return;\n            }\n\n            const url = URL.createObjectURL(file);\n            setSelectedImage(file);\n            setPreviewUrl(url);\n            toast.success(\"Image added! Type your question and send.\");\n        }\n    };\n\n    const clearImage = () => {\n        setSelectedImage(null);\n        if (previewUrl) URL.revokeObjectURL(previewUrl);\n        setPreviewUrl(null);\n        if (fileInputRef.current) fileInputRef.current.value = '';\n    };\n\n    return (\n        <div className={styles.container}>\n            {/* Header */}\n            <header className={styles.header}>\n                <div className={styles.headerContent}>\n                    <div className={styles.logoIcon}>\n                        <Bot size={20} />\n                    </div>\n                    <div className={styles.titleBlock}>\n                        <h1 className={styles.title}>Dr. Flora</h1>\n                        <span className={styles.subtitle}>AI Plant Specialist ΓÇó VanaMap</span>\n                    </div>\n\n                    <div className={styles.actions}>\n                        {/* Neural Energy Display */}\n                        {neuralMeta && (\n                            <div style={{\n                                fontSize: 'clamp(10px, 2vw, 12px)',\n                                padding: '4px 10px',\n                                background: neuralMeta.current < 20000 ? '#fef2f2' : 'rgba(255,255,255,0.6)',\n                                color: neuralMeta.current < 20000 ? '#ef4444' : '#10b981',\n                                borderRadius: '99px',\n                                border: `1px solid ${neuralMeta.current < 20000 ? '#fecaca' : '#bbf7d0'}`,\n                                display: 'flex',\n                                alignItems: 'center',\n                                gap: '4px',\n                                fontWeight: 600,\n                                marginRight: '8px',\n                                backdropFilter: 'blur(4px)',\n                                boxShadow: '0 2px 5px rgba(0,0,0,0.05)'\n                            }} title={`Daily Neural Operations Remaining: ${neuralMeta.current.toLocaleString()}`}>\n                                <Zap size={14} fill={neuralMeta.current < 20000 ? \"#ef4444\" : \"#10b981\"} />\n                                <span>{(neuralMeta.current / 1000).toFixed(1)}k Ops</span>\n                            </div>\n                        )}\n                        <button\n                            className={styles.actionBtn}\n                            onClick={toggleVoice}\n                            style={voiceEnabled ? { color: '#10b981', borderColor: '#bbf7d0', background: '#f0fdf4', boxShadow: isSpeaking ? '0 0 10px rgba(16, 185, 129, 0.3)' : 'none' } : {}}\n                            title=\"Voice Output\"\n                        >\n                            {voiceEnabled ? <Volume2 size={18} /> : <VolumeX size={18} />}\n                        </button>\n\n                        {/* Stop Speaking Button (only shows when AI is speaking) */}\n                        {isSpeaking && (\n                            <button\n                                className={styles.actionBtn}\n                                onClick={() => {\n                                    synth.cancel();\n                                    setIsSpeaking(false);\n                                    toast.success(\"Stopped speaking\");\n                                }}\n                                style={{\n                                    color: '#ef4444',\n                                    borderColor: '#fecaca',\n                                    background: '#fef2f2',\n                                    animation: 'pulse 2s infinite'\n                                }}\n                                title=\"Stop Speaking\"\n                            >\n                                <VolumeX size={18} />\n                            </button>\n                        )}\n\n                        {/* Language Toggle */}\n                        <div style={{ position: 'relative' }}>\n                            <button\n                                className={styles.actionBtn}\n                                onClick={() => setShowLanguageMenu(!showLanguageMenu)}\n                                title={`Language: ${selectedLanguage}`}\n                            >\n                                <Globe size={18} />\n                            </button>\n                            {showLanguageMenu && (\n                                <div style={{\n                                    position: 'absolute', top: '100%', right: 0, marginTop: '8px',\n                                    background: 'white', border: '1px solid #e2e8f0', borderRadius: '12px',\n                                    padding: '4px', display: 'flex', flexDirection: 'column', gap: '2px',\n                                    width: '160px', maxHeight: '300px', overflowY: 'auto', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)', zIndex: 100\n                                }}>\n                                    {languages.map(lang => (\n                                        <button key={lang} onClick={() => { setSelectedLanguage(lang); setShowLanguageMenu(false); }}\n                                            style={{ textAlign: 'left', padding: '8px 12px', background: 'transparent', border: 'none', fontSize: '0.85rem', cursor: 'pointer', borderRadius: '8px', color: '#334155' }}\n                                            onMouseEnter={(e) => e.currentTarget.style.background = '#f1f5f9'}\n                                            onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n                                        >\n                                            {lang}\n                                        </button>\n                                    ))}\n                                </div>\n                            )}\n                        </div>\n\n                        <button className={styles.actionBtn} onClick={handleCareCalendar} title=\"Care Calendar\">\n                            <Calendar size={18} />\n                        </button>\n\n                        <button className={styles.actionBtn} onClick={handleExport} title=\"Export Chat\">\n                            <Download size={18} />\n                        </button>\n                        <button className={styles.actionBtn} onClick={handleClear} title=\"Clear\">\n                            <Trash2 size={18} />\n                        </button>\n                    </div>\n                </div>\n            </header>\n\n            {/* Chat Area */}\n            <div className={styles.chatContainer}>\n                <div className={styles.messagesWrapper}>\n                    {messages.map((message) => (\n                        <div key={message.id} className={`${styles.message} ${message.role === 'user' ? styles.userMessage : styles.assistantMessage}`}>\n                            <div className={styles.messageIcon}>\n                                {message.role === 'user' ? <User size={16} /> : <Leaf size={16} />}\n                            </div>\n                            <div className={styles.messageContent}>\n                                <div className={styles.messageSender}>\n                                    {message.role === 'user' ? 'You' : 'Dr. Flora'} ΓÇó {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                </div>\n                                {/* Display uploaded image if present */}\n                                {((message.images && message.images.length > 0) || message.image) && (\n                                    <div style={{\n                                        display: 'grid',\n                                        gridTemplateColumns: (message.images && message.images.length > 1) ? 'repeat(auto-fit, minmax(280px, 1fr))' : '1fr',\n                                        gap: '12px',\n                                        marginBottom: '0.75rem',\n                                        width: '100%'\n                                    }}>\n                                        {(message.images && message.images.length > 0 ? message.images : [message.image]).map((imgUrl, idx) => {\n                                            const imageKey = `${message.id}-${idx}`;\n                                            return (\n                                                <div key={imageKey} style={{\n                                                    position: 'relative',\n                                                    background: message.role === 'assistant' ? '#f8fafc' : 'rgba(0,0,0,0.1)',\n                                                    borderRadius: '16px',\n                                                    padding: '4px',\n                                                    border: '1px solid rgba(0,0,0,0.05)',\n                                                    overflow: 'hidden',\n                                                    minHeight: '200px'\n                                                }}>\n                                                    <img\n                                                        src={(() => {\n                                                            if (!imgUrl) return '';\n                                                            if (imgUrl.startsWith('data:')) return imgUrl; // Handle Base64 User Uploads\n                                                            if (imgUrl.startsWith('http')) return imgUrl;\n                                                            // Robust URL cleaning: remove trailing slashes from base, remove /api suffix if present\n                                                            const cleanBase = API_URL.replace(/\\/+$/, '').replace(/\\/api$/, '');\n                                                            const cleanPath = imgUrl.startsWith('/') ? imgUrl : `/${imgUrl}`;\n                                                            return `${cleanBase}${cleanPath}`;\n                                                        })()}\n                                                        alt={`Plant view ${idx + 1}`}\n                                                        onLoad={() => {\n                                                            setLoadedImageIds(prev => new Set(prev).add(imageKey));\n\n                                                        }}\n                                                        onError={(e) => {\n                                                            console.warn(\"Primary image load failed. Attempting fallback...\");\n                                                            setLoadedImageIds(prev => new Set(prev).add(imageKey));\n                                                            e.currentTarget.style.opacity = '1';\n\n                                                            // Auto-fallback to direct Pollinations URL if backend proxy fails\n                                                            const src = e.currentTarget.src;\n                                                            if (src.includes('/api/generate-image')) {\n                                                                try {\n                                                                    const url = new URL(src);\n                                                                    const params = new URLSearchParams(url.search);\n                                                                    const prompt = params.get('prompt');\n                                                                    const model = params.get('model') || 'flux';\n                                                                    const seed = params.get('seed') || '42';\n\n                                                                    if (prompt) {\n                                                                        const directUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?model=${model}&seed=${seed}&width=896&height=896&nologo=true`;\n                                                                        e.currentTarget.src = directUrl;\n                                                                    }\n                                                                } catch (err) {\n                                                                    console.error(\"Fallback failed\", err);\n                                                                }\n                                                            }\n                                                        }}\n                                                        style={{\n                                                            width: '100%',\n                                                            maxHeight: '400px',\n                                                            borderRadius: '12px',\n                                                            objectFit: 'contain',\n                                                            display: 'block',\n                                                            opacity: 1,\n                                                            transition: 'none',\n                                                            boxShadow: '0 4px 20px rgba(0,0,0,0.1)'\n                                                        }}\n                                                    />\n\n                                                    <div style={{\n                                                        position: 'absolute',\n                                                        top: '12px',\n                                                        left: '12px',\n                                                        background: 'rgba(5, 150, 105, 0.9)',\n                                                        color: 'white',\n                                                        padding: '4px 10px',\n                                                        borderRadius: '20px',\n                                                        fontSize: '0.7rem',\n                                                        fontWeight: 800,\n                                                        backdropFilter: 'blur(8px)',\n                                                        boxShadow: '0 4px 10px rgba(0,0,0,0.1)',\n                                                        zIndex: 8,\n                                                        textTransform: 'uppercase',\n                                                        letterSpacing: '0.5px'\n                                                    }}>\n                                                        {idx === 0 ? '≡ƒÄ¿ Botanical Art (Flux)' : '≡ƒô╕ Ultra-Realism (Pro)'}\n                                                    </div>\n\n                                                    <button\n                                                        onClick={() => downloadImage(imgUrl!, imageKey)}\n                                                        disabled={downloadingIds.has(imageKey)}\n                                                        style={{\n                                                            position: 'absolute',\n                                                            bottom: '12px',\n                                                            right: '12px',\n                                                            background: '#059669',\n                                                            color: 'white',\n                                                            border: 'none',\n                                                            borderRadius: '30px',\n                                                            padding: '8px 14px',\n                                                            display: 'flex',\n                                                            alignItems: 'center',\n                                                            gap: '8px',\n                                                            cursor: downloadingIds.has(imageKey) ? 'wait' : 'pointer',\n                                                            boxShadow: '0 6px 15px rgba(5, 150, 105, 0.4)',\n                                                            zIndex: 10,\n                                                            fontSize: '0.8rem',\n                                                            fontWeight: 700,\n                                                            transition: 'all 0.2s'\n                                                        }}\n                                                    >\n                                                        {downloadingIds.has(imageKey) ? (\n                                                            <div style={{ animation: 'spin 1s linear infinite', display: 'flex' }}>\n                                                                <Loader2 size={16} />\n                                                            </div>\n                                                        ) : (\n                                                            <Download size={16} />\n                                                        )}\n                                                        <span>Save PNG</span>\n                                                    </button>\n\n                                                    {(!loadedImageIds.has(imageKey)) && (\n                                                        <ImageLoader idx={idx} />\n                                                    )}\n                                                </div>\n                                            );\n                                        })}\n                                    </div>\n                                )}\n                                <div className={styles.messageText}>\n                                    <ReactMarkdown remarkPlugins={[remarkGfm]}>\n                                        {message.content}\n                                    </ReactMarkdown>\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n\n                    {loading && (\n                        <div className={`${styles.message} ${styles.assistantMessage}`}>\n                            <div className={styles.messageIcon}><Leaf size={16} /></div>\n                            <div className={styles.messageContent}>\n                                <div className={`${styles.messageText} ${styles.typing}`}>\n                                    <span></span><span></span><span></span>\n                                </div>\n                            </div>\n                        </div>\n                    )}\n                    <div ref={messagesEndRef} />\n                </div>\n            </div>\n\n            {/* Input Dock */}\n            <div className={styles.inputContainer}>\n                <div className={styles.inputDock}>\n                    <button\n                        className={styles.toolBtn}\n                        onClick={handleScanClick}\n                        title=\"Identify Plant (Scan)\"\n                    >\n                        <Camera size={20} />\n                    </button>\n                    <input\n                        type=\"file\"\n                        ref={fileInputRef}\n                        onChange={handleFileChange}\n                        accept=\"image/*\"\n                        style={{ display: 'none' }}\n                    />\n\n                    <button\n                        className={styles.toolBtn}\n                        onClick={toggleListening}\n                        style={isListening ? { color: '#ef4444', background: '#fef2f2' } : {}}\n                        title=\"Voice Input\"\n                    >\n                        <Mic size={20} />\n                    </button>\n\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column' }}>\n                        {previewUrl && (\n                            <div className={styles.previewArea}>\n                                <div className={styles.previewBadge}>\n                                    <img src={previewUrl} className={styles.previewThumb} alt=\"Scan\" />\n                                    <span>Image attached</span>\n                                    <button onClick={clearImage} style={{ background: 'none', border: 'none', cursor: 'pointer', color: '#0284c7', marginLeft: 'auto' }}>\n                                        <Trash2 size={14} />\n                                    </button>\n                                </div>\n                            </div>\n                        )}\n                        <textarea\n                            className={styles.textInput}\n                            placeholder=\"Type a message...\"\n                            value={input}\n                            onChange={(e) => setInput(e.target.value)}\n                            onKeyDown={(e) => {\n                                if (e.key === 'Enter' && !e.shiftKey) {\n                                    e.preventDefault();\n                                    if (!loading) handleSend();\n                                }\n                            }}\n                            disabled={loading}\n                            rows={1}\n                            style={{ height: 'auto', minHeight: '44px' }}\n                        />\n                    </div>\n\n                    <button\n                        className={styles.sendBtn}\n                        onClick={() => handleSend()}\n                        disabled={loading || (!input.trim() && !selectedImage)}\n                    >\n                        {loading ? <Sparkles size={18} /> : <Send size={18} />}\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\About.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Admin.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Admin.tsx:41:13\n  39 |     useEffect(() => {\n  40 |         if (!authLoading && user?.role === 'admin') {\n> 41 |             loadData();\n     |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  42 |         }\n  43 |     }, [user, loadData, authLoading]);\n  44 |","line":41,"column":13,"nodeType":null,"endLine":41,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n    fetchVendors, fetchPlants, fetchUsers\r\n} from '../services/api';\r\nimport {\r\n    Activity, Users, Sprout, MapPin,\r\n    ArrowUpRight, Zap\r\n} from 'lucide-react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { AdminLayout } from './admin/AdminLayout';\r\nimport styles from './Admin.module.css';\r\n\r\nexport const Admin = () => {\r\n    const { user, loading: authLoading } = useAuth();\r\n    const [stats, setStats] = useState({ plants: 0, users: 0, vendors: 0 });\r\n\r\n    const loadData = useCallback(async () => {\r\n        try {\r\n            const [vendors, plants, users] = await Promise.all([fetchVendors(), fetchPlants(), fetchUsers()]);\r\n            setStats({\r\n                vendors: vendors.length,\r\n                plants: plants.length,\r\n                users: users.length\r\n            });\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    }, []);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        if (!authLoading && (!user || user.role !== 'admin')) {\r\n            navigate('/auth', { replace: true });\r\n        }\r\n    }, [user, authLoading, navigate]);\r\n\r\n    useEffect(() => {\r\n        if (!authLoading && user?.role === 'admin') {\r\n            loadData();\r\n        }\r\n    }, [user, loadData, authLoading]);\r\n\r\n    if (authLoading || !user || user.role !== 'admin') {\r\n        return (\r\n            <div style={{ height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center', background: '#0f172a' }}>\r\n                <div className=\"pre-loader-pulse\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <AdminLayout title=\"System Overview\">\r\n            <div style={{ maxWidth: '1100px', margin: '0 auto' }}>\r\n                <div className={styles.dashboardGrid}>\r\n                    {/* STAT CARDS */}\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Total Users</span>\r\n                            <Users size={20} className=\"text-indigo-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>{stats.users}</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={styles.trendUp}><ArrowUpRight size={14} /> Live</span> Count\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Active Plants</span>\r\n                            <Sprout size={20} className=\"text-emerald-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>{stats.plants}</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={styles.trendUp}><ArrowUpRight size={14} /> Catalog</span> Size\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Partners</span>\r\n                            <MapPin size={20} className=\"text-amber-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>{stats.vendors}</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={styles.trendNeutral}><ArrowUpRight size={14} /> Network</span> Reach\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>System Load</span>\r\n                            <Zap size={20} className=\"text-blue-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>4%</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={`${styles.trendUp} text-emerald-500`}>Optimal</span> performance\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* CENTRAL MONITOR */}\r\n                    <div className={`${styles.card} ${styles.cardLarge}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>System Pulse</span>\r\n                            <Activity size={20} className=\"text-rose-500\" />\r\n                        </div>\r\n                        <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column', gap: '1rem', opacity: 0.5 }}>\r\n                            <Activity size={48} className=\"animate-pulse\" />\r\n                            <div className=\"text-center\">\r\n                                <h3 className=\"text-white font-bold\">Real-time monitoring active</h3>\r\n                                <p className=\"text-xs text-slate-400 max-w-xs\">Connecting to secure stream... metrics will populate shortly.</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* SERVER STATUS */}\r\n                    <div className={`${styles.card} ${styles.cardTall}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Server Nodes</span>\r\n                        </div>\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            {[\r\n                                { name: 'US-EAST-1', status: 'Online', color: '#10b981' },\r\n                                { name: 'EU-WEST-2', status: 'Online', color: '#10b981' },\r\n                                { name: 'AP-SOUTH-1', status: 'Healthy', color: '#10b981' },\r\n                                { name: 'REPLICA-01', status: 'Syncing', color: '#3b82f6' }\r\n                            ].map(node => (\r\n                                <div key={node.name} style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: 'rgba(255,255,255,0.02)', borderRadius: '0.75rem', fontSize: '0.8rem' }}>\r\n                                    <span className=\"font-bold\">{node.name}</span>\r\n                                    <span style={{ color: node.color }}>{node.status}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n\r\nexport default Admin;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Auth.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedCountry'. Either include it or remove the dependency array.","line":49,"column":8,"nodeType":"ArrayExpression","endLine":49,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCountry]","fix":{"range":[2058,2060],"text":"[selectedCountry]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":102,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5787,5790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5787,5790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9055,9058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9055,9058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":224,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":224,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10422,10425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10422,10425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":372,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":372,"endColumn":59}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate, useSearchParams, useLocation } from 'react-router-dom';\r\nimport { Button } from '../components/common/Button';\r\nimport { User, ArrowLeft, Store, Eye, EyeOff } from 'lucide-react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { Country, State, type ICountry, type IState } from 'country-state-city';\r\nimport { toast } from 'react-hot-toast';\r\nimport styles from './Auth.module.css';\r\n\r\nexport const Auth = () => {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const [searchParams] = useSearchParams();\r\n    const { login, signup, user, verify } = useAuth();\r\n\r\n    type AuthView = 'login' | 'signup' | 'forgot' | 'reset' | 'verify';\r\n\r\n    // Parse URL params\r\n    const initialView = searchParams.get('view') as AuthView || 'login';\r\n    const initialRole = searchParams.get('role') as 'user' | 'vendor' || 'user';\r\n\r\n    const [view, setView] = useState<AuthView>(initialView);\r\n\r\n    // Form States\r\n    const [role, setRole] = useState<'user' | 'vendor'>(initialRole);\r\n    const [email, setEmail] = useState('');\r\n    const [phone, setPhone] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [name, setName] = useState('');\r\n\r\n    // Vendor Specific\r\n    const [selectedCountry, setSelectedCountry] = useState<ICountry | null>(null);\r\n    const [selectedState, setSelectedState] = useState<IState | null>(null);\r\n\r\n    // Derived values for API\r\n    const [country, setCountry] = useState('India'); // defaulting to India if needed, but updated by selection\r\n    const [state, setState] = useState('');\r\n    const [city, setCity] = useState('');\r\n    const [phoneCode, setPhoneCode] = useState('91');\r\n\r\n    // Load initial country (India) if desired\r\n    useEffect(() => {\r\n        const india = Country.getCountryByCode('IN');\r\n        if (india && !selectedCountry) {\r\n            setSelectedCountry(india);\r\n            setCountry(india.name);\r\n            setPhoneCode(india.phonecode);\r\n        }\r\n    }, []);\r\n\r\n    // Handle country change\r\n    const handleCountryChange = (isoCode: string) => {\r\n        const c = Country.getCountryByCode(isoCode);\r\n        if (c) {\r\n            setSelectedCountry(c);\r\n            setCountry(c.name);\r\n            setPhoneCode(c.phonecode);\r\n            setSelectedState(null);\r\n            setState('');\r\n        }\r\n    };\r\n\r\n    // Handle state change\r\n    const handleStateChange = (isoCode: string) => {\r\n        if (!selectedCountry) return;\r\n        const s = State.getStateByCodeAndCountry(isoCode, selectedCountry.isoCode);\r\n        if (s) {\r\n            setSelectedState(s);\r\n            setState(s.name);\r\n        }\r\n    };\r\n\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            // Check if there is a pending redirect from a protected route\r\n            const origin = location.state?.from?.pathname || location.state?.from;\r\n\r\n            if (origin) {\r\n                navigate(origin, { replace: true });\r\n                return;\r\n            }\r\n\r\n            if (user.role === 'admin') {\r\n                localStorage.setItem('adminAuthenticated', 'true');\r\n                navigate('/admin', { replace: true });\r\n            } else if (user.role === 'vendor') {\r\n                navigate('/vendor', { replace: true });\r\n            } else {\r\n                navigate('/dashboard', { replace: true });\r\n            }\r\n        }\r\n    }, [user, navigate, location]);\r\n\r\n    const handleNudge = async () => {\r\n        if (!email) { toast.error(\"Please enter your email address first\"); return; }\r\n        const tid = toast.loading(\"Signaling Admin...\");\r\n        try {\r\n            const api = await import('../services/api');\r\n            await api.nudgeAdmin(email);\r\n            toast.success(\"Admin will change the password to 123456 for this email shortly. Please try after 1hr.\", { id: tid, duration: 6000 });\r\n        } catch (e) { toast.error(\"Failed to signal admin\", { id: tid }); }\r\n    };\r\n\r\n    const [showPassword, setShowPassword] = useState(false);\r\n    const [isEmailChecked, setIsEmailChecked] = useState(false);\r\n    const [emailLoading, setEmailLoading] = useState(false);\r\n    const [emailVerifiedResult, setEmailVerifiedResult] = useState<{ name: string, role: string } | null>(null);\r\n\r\n    // Password Validation\r\n    const validatePassword = (pass: string) => {\r\n        const minLen = 4;\r\n        const maxLen = 18;\r\n        const hasUpper = /[A-Z]/.test(pass);\r\n        const hasNumber = /[0-9]/.test(pass);\r\n        const hasSpecial = /[@#$%]/.test(pass);\r\n\r\n        if (pass.length < minLen || pass.length > maxLen) return \"Password must be 4-18 characters.\";\r\n        if (!hasUpper) return \"At least one capital letter required.\";\r\n        if (!hasNumber) return \"At least one number required.\";\r\n        if (!hasSpecial) return \"At least one special character (@,#,$,%) required.\";\r\n        return null; // OK\r\n    };\r\n\r\n    const handleEmailCheck = async () => {\r\n        if (!email) { toast.error(\"Please enter email or phone first\"); return; }\r\n\r\n        // Immediate bypass for Master Admin\r\n        if (email.trim().toLowerCase() === 'admin@plantai.com') {\r\n            setEmailVerifiedResult({ name: 'Master Admin', role: 'admin' });\r\n            setIsEmailChecked(true);\r\n            return;\r\n        }\r\n\r\n        setEmailLoading(true);\r\n        try {\r\n            const api = await import('../services/api');\r\n            const res = await api.checkEmail(email);\r\n            if (res.success && res.verified) {\r\n                toast.success(`Verified account found: ${res.name}`);\r\n                setEmailVerifiedResult({ name: res.name, role: res.role });\r\n                setIsEmailChecked(true);\r\n            }\r\n        } catch (err: any) {\r\n            toast.error(err.message || \"Account not found or not verified.\");\r\n            // If account found but not verified, we can offer to resent OTP?\r\n            if (err.message && err.message.includes(\"not yet verified\")) {\r\n                toast(\"Please sign up again or verify your account using the captcha.\", { icon: '≡ƒ¢í∩╕Å' });\r\n            }\r\n        } finally {\r\n            setEmailLoading(false);\r\n        }\r\n    };\r\n\r\n    const [otp, setOtp] = useState('');\r\n    const [captchaSvg, setCaptchaSvg] = useState<string | null>(null);\r\n    const [registrationToken, setRegistrationToken] = useState<string | null>(null);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        // Validate password for signup and reset\r\n        if (view === 'signup' || view === 'reset') {\r\n            const error = validatePassword(password);\r\n            if (error) { toast.error(error); return; }\r\n        }\r\n\r\n        if (view === 'login') {\r\n            if (!isEmailChecked) {\r\n                handleEmailCheck();\r\n                return;\r\n            }\r\n            const tid = toast.loading(\"Authenticating...\");\r\n            const result = await login({ email, password });\r\n            if (result.success) {\r\n                toast.success(\"Login Successful! Welcome back.\", { id: tid });\r\n            } else {\r\n                toast.error(\r\n                    result.message || \"Something is wrong. Please type it correctly or change your password.\",\r\n                    { id: tid, duration: 4000 }\r\n                );\r\n            }\r\n        } else if (view === 'signup') {\r\n            const fullPhone = phone ? `+${phoneCode}${phone.replace(/\\D/g, '')}` : undefined;\r\n            const result = await signup({ email, phone: fullPhone, password, name, role, city, state, country });\r\n            if (result.success) {\r\n                toast.success(\"Account ready! Please verify captcha.\");\r\n                if (result.captchaSvg) setCaptchaSvg(result.captchaSvg);\r\n                if (result.registrationToken) setRegistrationToken(result.registrationToken);\r\n                setView('verify');\r\n            } else {\r\n                toast.error(result.message || \"Signup failed\");\r\n            }\r\n        } else if (view === 'verify') {\r\n            if (!registrationToken) {\r\n                toast.error(\"Session expired. Please sign up again.\");\r\n                setView('signup');\r\n                return;\r\n            }\r\n            const tid = toast.loading(\"Verifying Captcha...\");\r\n            const result = await verify(registrationToken, otp);\r\n            if (result.success) {\r\n                toast.success(\"Identity Verified! Welcome.\", { id: tid });\r\n            } else {\r\n                toast.error(result.message || \"Invalid Captcha\", { id: tid });\r\n            }\r\n        } else if (view === 'forgot') {\r\n            const tid = toast.loading(\"Verifying Identity...\");\r\n            try {\r\n                const api = await import('../services/api');\r\n                await api.resetPasswordVerify(email, name, password);\r\n                toast.success(\"Password Reset Successful! Login with new credentials.\", { id: tid });\r\n                setView('login');\r\n            } catch (err: any) {\r\n                toast.error(err.message || \"Verification failed. Check Name/Email.\", { id: tid });\r\n            }\r\n        } else if (view === 'reset') {\r\n            const tid = toast.loading(\"Updating Password...\");\r\n            try {\r\n                const api = await import('../services/api');\r\n                await api.resetPassword(email, password);\r\n                toast.success(\"Password Updated! Please Login.\", { id: tid });\r\n                setView('login');\r\n            } catch (err) {\r\n                toast.error(\"Reset Failed. Try again.\", { id: tid });\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleResendOTP = async () => {\r\n        if (!registrationToken) return;\r\n        const tid = toast.loading(\"Refreshing captcha...\");\r\n        try {\r\n            const res = await fetch(`${import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api'}/auth/resend-otp`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ registrationToken })\r\n            });\r\n            const data = await res.json();\r\n            if (data.captchaSvg) setCaptchaSvg(data.captchaSvg);\r\n            if (data.registrationToken) setRegistrationToken(data.registrationToken);\r\n            toast.success(\"New code generated!\", { id: tid });\r\n        } catch (err: any) {\r\n            toast.error(err.message || \"Failed to refresh captcha\", { id: tid });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.authContainer}>\r\n            <div className={styles.authCard}>\r\n\r\n                {/* Unified Login Notice */}\r\n                {view === 'login' && (\r\n                    <div className={styles.noticeBox} style={{ borderColor: isEmailChecked ? '#10b981' : undefined }}>\r\n                        <div className={styles.noticeDot} style={{ background: isEmailChecked ? '#10b981' : undefined }}></div>\r\n                        <span>\r\n                            {isEmailChecked\r\n                                ? <strong>VanaMap Verified: {emailVerifiedResult?.name}</strong>\r\n                                : <><strong>Users and Vendors</strong> can login here.</>}\r\n                        </span>\r\n                    </div>\r\n                )}\r\n\r\n                <div className={styles.authHeader}>\r\n                    <h2 className={styles.authTitle}>\r\n                        {view === 'login' && (isEmailChecked ? 'Enter Password' : 'Welcome Back')}\r\n                        {view === 'signup' && 'Create Account'}\r\n                        {view === 'verify' && 'Verify Identity'}\r\n                        {view === 'forgot' && 'Reset Password'}\r\n                        {view === 'reset' && 'New Password'}\r\n                    </h2>\r\n                    <p className={styles.authSubtitle}>\r\n                        {view === 'login' && (isEmailChecked ? `Hi ${emailVerifiedResult?.name.split(' ')[0]}, please type your key.` : 'Enter email or phone to verify status')}\r\n                        {view === 'signup' && 'Join the VanaMap community today'}\r\n                        {view === 'verify' && `Please enter the characters shown below`}\r\n                        {view === 'forgot' && 'WeΓÇÖll help you get back in'}\r\n                    </p>\r\n                </div>\r\n\r\n\r\n                {/* Role Toggle */}\r\n                {view === 'signup' && (\r\n                    <div className={styles.roleToggle}>\r\n                        <button\r\n                            type=\"button\"\r\n                            className={`${styles.roleBtn} ${role === 'user' ? styles.active : ''} `}\r\n                            onClick={() => setRole('user')}\r\n                        >\r\n                            <div className={styles.roleIcon}>\r\n                                <User size={18} />\r\n                            </div>\r\n                            <span>Plant Lover</span>\r\n                        </button>\r\n                        <button\r\n                            type=\"button\"\r\n                            className={`${styles.roleBtn} ${role === 'vendor' ? styles.active : ''} `}\r\n                            onClick={() => setRole('vendor')}\r\n                        >\r\n                            <div className={styles.roleIcon}>\r\n                                <Store size={18} />\r\n                            </div>\r\n                            <span>Shop Owner</span>\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                <form onSubmit={handleSubmit}>\r\n                    {/* Signup Fields */}\r\n                    {view === 'signup' && (\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}>\r\n                                {role === 'vendor' ? 'Business Name' : 'Full Name'}\r\n                            </label>\r\n                            <input\r\n                                className={styles.input}\r\n                                type=\"text\"\r\n                                value={name}\r\n                                onChange={(e) => setName(e.target.value)}\r\n                                required\r\n                                placeholder={role === 'vendor' ? \"e.g. Green Earth Nursery\" : \"e.g. John Doe\"}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Unified Location Collection */}\r\n                    {view === 'signup' && (\r\n                        <>\r\n                            <div className={styles.formGroup}>\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>\r\n                                    <label className={styles.label} style={{ marginBottom: 0 }}>\r\n                                        {role === 'vendor' ? 'Business Location' : 'Your Location'}\r\n                                    </label>\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => {\r\n                                            if (!navigator.geolocation) return toast.error(\"Not supported\");\r\n                                            const tid = toast.loading(\"Detecting...\");\r\n                                            navigator.geolocation.getCurrentPosition(async (pos) => {\r\n                                                try {\r\n                                                    const { latitude, longitude } = pos.coords;\r\n                                                    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);\r\n                                                    const data = await res.json();\r\n\r\n                                                    if (data.address) {\r\n                                                        const code = data.address.country_code?.toUpperCase();\r\n                                                        const countryObj = Country.getCountryByCode(code);\r\n\r\n                                                        if (countryObj) {\r\n                                                            setSelectedCountry(countryObj);\r\n                                                            setCountry(countryObj.name);\r\n                                                            setPhoneCode(countryObj.phonecode);\r\n\r\n                                                            const stateName = data.address.state;\r\n                                                            if (stateName) {\r\n                                                                const states = State.getStatesOfCountry(countryObj.isoCode);\r\n                                                                const foundState = states.find(s =>\r\n                                                                    s.name.toLowerCase().includes(stateName.toLowerCase()) ||\r\n                                                                    stateName.toLowerCase().includes(s.name.toLowerCase())\r\n                                                                );\r\n                                                                if (foundState) {\r\n                                                                    setSelectedState(foundState);\r\n                                                                    setState(foundState.name);\r\n                                                                }\r\n                                                            }\r\n                                                        }\r\n\r\n                                                        const cityVal = data.address.city || data.address.town || data.address.village || data.address.county || '';\r\n                                                        if (cityVal) setCity(cityVal);\r\n\r\n                                                        toast.success(\"Location Detected!\", { id: tid });\r\n                                                    }\r\n                                                } catch (e) {\r\n                                                    toast.error(\"Failed to detect address\", { id: tid });\r\n                                                }\r\n                                            }, () => toast.error(\"Permission denied\", { id: tid }));\r\n                                        }}\r\n                                        style={{ background: 'none', border: 'none', color: '#10b981', cursor: 'pointer', fontSize: '0.85rem', fontWeight: 600, display: 'flex', alignItems: 'center', gap: '4px' }}\r\n                                    >\r\n                                        ≡ƒôì Auto-Detect\r\n                                    </button>\r\n                                </div>\r\n                                <div style={{ display: 'grid', gap: '0.75rem' }}>\r\n                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem' }}>\r\n                                        <select\r\n                                            className={styles.select}\r\n                                            value={selectedCountry?.isoCode || ''}\r\n                                            onChange={(e) => handleCountryChange(e.target.value)}\r\n                                            required\r\n                                        >\r\n                                            {Country.getAllCountries().map(c => (\r\n                                                <option key={c.isoCode} value={c.isoCode}>{c.name}</option>\r\n                                            ))}\r\n                                        </select>\r\n\r\n                                        <select\r\n                                            className={styles.select}\r\n                                            value={selectedState?.isoCode || ''}\r\n                                            onChange={(e) => handleStateChange(e.target.value)}\r\n                                            required\r\n                                        >\r\n                                            <option value=\"\">{selectedCountry ? 'Select State' : 'Select Country First'}</option>\r\n                                            {selectedCountry && State.getStatesOfCountry(selectedCountry.isoCode).map(s => (\r\n                                                <option key={s.isoCode} value={s.isoCode}>{s.name}</option>\r\n                                            ))}\r\n                                        </select>\r\n                                    </div>\r\n                                    <input\r\n                                        className={styles.input}\r\n                                        type=\"text\"\r\n                                        value={city}\r\n                                        onChange={(e) => setCity(e.target.value)}\r\n                                        placeholder={role === 'vendor' ? \"City / District\" : \"City (e.g. Kathmandu)\"}\r\n                                        required\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Vendor Specific Phone (Only for Vendor) - REMOVED redundant here, handled below */}\r\n                        </>\r\n                    )}\r\n\r\n                    {/* email/Phone Field - Step 1 for Login */}\r\n                    <div className={styles.formGroup} style={{ opacity: (isEmailChecked && view === 'login') ? 0.6 : 1, transition: '0.3s' }}>\r\n                        <label className={styles.label}>{view === 'login' ? 'Email or Phone Number' : 'Email Address'}</label>\r\n                        <input\r\n                            className={styles.input}\r\n                            type={view === 'login' ? \"text\" : \"email\"}\r\n                            value={email}\r\n                            onChange={(e) => { setEmail(e.target.value); setIsEmailChecked(false); }}\r\n                            required\r\n                            disabled={(isEmailChecked && view === 'login') || view === 'verify'}\r\n                            placeholder={view === 'login' ? \"Email or Mobile Number\" : \"name@example.com\"}\r\n                        />\r\n                        {isEmailChecked && view === 'login' && (\r\n                            <button\r\n                                type=\"button\"\r\n                                className={styles.changeEmailBtn}\r\n                                onClick={() => { setIsEmailChecked(false); setPassword(''); }}\r\n                            >\r\n                                Change\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {view === 'signup' && (\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}>WhatsApp / Mobile Number</label>\r\n                            <div className={styles.inputWrapper}>\r\n                                <div className={styles.phonePrefix}>+{phoneCode}</div>\r\n                                <input\r\n                                    className={styles.input}\r\n                                    type=\"tel\"\r\n                                    value={phone}\r\n                                    onChange={(e) => setPhone(e.target.value)}\r\n                                    required\r\n                                    placeholder=\"XXXXX XXXXX\"\r\n                                    style={{ paddingLeft: '4.5rem' }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {view === 'verify' && (\r\n                        <div className={`${styles.formGroup} ${styles.revealAnimation}`}>\r\n                            <label className={styles.label}>Enter Captcha</label>\r\n\r\n                            {captchaSvg && (\r\n                                <div\r\n                                    className={styles.captchaBox}\r\n                                    dangerouslySetInnerHTML={{ __html: captchaSvg }}\r\n                                    style={{\r\n                                        background: '#f8fafc',\r\n                                        padding: '10px',\r\n                                        borderRadius: '12px',\r\n                                        marginBottom: '1rem',\r\n                                        display: 'flex',\r\n                                        justifyContent: 'center',\r\n                                        border: '1px solid #e2e8f0'\r\n                                    }}\r\n                                />\r\n                            )}\r\n\r\n                            <input\r\n                                className={styles.input}\r\n                                type=\"text\"\r\n                                maxLength={4}\r\n                                value={otp}\r\n                                onChange={(e) => setOtp(e.target.value)}\r\n                                required\r\n                                placeholder=\"Type 4 characters\"\r\n                                autoFocus\r\n                                style={{ textAlign: 'center', fontSize: '1.5rem', letterSpacing: '4px', textTransform: 'lowercase' }}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {view === 'forgot' && (\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}>Username (As Before)</label>\r\n                            <input\r\n                                className={styles.input}\r\n                                type=\"text\"\r\n                                value={name}\r\n                                onChange={(e) => setName(e.target.value)}\r\n                                required\r\n                                placeholder=\"Verify your identity\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 2: Password Field */}\r\n                    {((view === 'signup' || view === 'reset' || view === 'forgot') || (view === 'login' && isEmailChecked)) && (\r\n                        <div className={`${styles.formGroup} ${styles.revealAnimation}`}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem', alignItems: 'center' }}>\r\n                                <label className={styles.label} style={{ marginBottom: 0 }}>\r\n                                    {(view === 'reset' || view === 'forgot') ? 'New Password' : 'Password'}\r\n                                </label>\r\n                                {(view === 'signup' || view === 'reset') && (\r\n                                    <span className={styles.hintText} style={{ color: password.length > 0 && validatePassword(password) ? '#ef4444' : '#10b981' }}>\r\n                                        {password.length === 0 ? '' : (validatePassword(password) || 'Strong Key')}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            <div className={styles.passwordWrapper}>\r\n                                <input\r\n                                    className={styles.input}\r\n                                    type={showPassword ? \"text\" : \"password\"}\r\n                                    value={password}\r\n                                    onChange={(e) => setPassword(e.target.value)}\r\n                                    required\r\n                                    autoFocus\r\n                                    placeholder=\"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó\"\r\n                                />\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className={styles.passwordToggle}\r\n                                    onClick={() => setShowPassword(!showPassword)}\r\n                                >\r\n                                    {showPassword ? (\r\n                                        <EyeOff size={18} className={styles.eyeIcon} />\r\n                                    ) : (\r\n                                        <Eye size={18} className={styles.eyeIcon} />\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n                            {view === 'signup' && (\r\n                                <p className={styles.passwordRules}>\r\n                                    4-18 chars, 1 Upper, 1 Number, 1 Special (@#$%)\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {!isEmailChecked && view === 'login' ? (\r\n                        <Button\r\n                            type=\"button\"\r\n                            onClick={handleEmailCheck}\r\n                            disabled={emailLoading}\r\n                            variant=\"primary\"\r\n                            className={styles.submitBtn}\r\n                        >\r\n                            {emailLoading ? 'Verifying...' : 'Next'}\r\n                        </Button>\r\n                    ) : (\r\n                        <Button type=\"submit\" variant=\"primary\" className={styles.submitBtn}>\r\n                            {view === 'login' && 'Log In'}\r\n                            {view === 'signup' && 'Send Code'}\r\n                            {view === 'verify' && 'Verify & Enter'}\r\n                            {view === 'forgot' && 'Reset Password'}\r\n                            {view === 'reset' && 'Update Password'}\r\n                        </Button>\r\n                    )}\r\n\r\n                    {view === 'login' && !isEmailChecked && (\r\n                        <div style={{ textAlign: 'center', marginTop: '1rem' }}>\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setView('forgot')}\r\n                                className={styles.forgotLink}\r\n                            >\r\n                                Forgot Password?\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n\r\n                    {view === 'forgot' && (\r\n                        <div style={{ marginTop: '1.5rem', textAlign: 'center', borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: '1rem' }}>\r\n                            <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '0.5rem' }}>\r\n                                Forgot username too?\r\n                            </p>\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleNudge}\r\n                                className={styles.linkBtn}\r\n                                style={{ color: '#f59e0b', fontSize: '0.9rem', marginBottom: '1rem' }}\r\n                            >\r\n                                Contact Admin (Manual Reset)\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </form>\r\n\r\n                <div className={styles.footer}>\r\n                    {view === 'login' && (\r\n                        <>\r\n                            <p style={{ marginBottom: '1rem', color: 'var(--color-text-muted)', fontSize: '0.9rem' }}>\r\n                                New to VanaMap? <button onClick={() => { setView('signup'); setIsEmailChecked(false); }} style={{ color: '#10b981', fontWeight: 600 }}>Create Account</button>\r\n                            </p>\r\n                        </>\r\n                    )}\r\n                    {view === 'signup' && (\r\n                        <>Already have an account? <button onClick={() => { setView('login'); setIsEmailChecked(false); }} style={{ color: '#10b981', fontWeight: 600 }}>Log In</button></>\r\n                    )}\r\n                    {view === 'verify' && (\r\n                        <div style={{ marginTop: '1rem', textAlign: 'center' }}>\r\n                            <div className={styles.hintText}>\r\n                                Can't read the code? <button type=\"button\" onClick={handleResendOTP} style={{ color: '#10b981', fontWeight: 600 }}>Refresh Captcha</button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    {(view === 'forgot' || view === 'reset') && (\r\n                        <><button onClick={() => { setView('login'); setIsEmailChecked(false); }} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem', margin: '0 auto', color: '#cbd5e1' }}>\r\n                            <ArrowLeft size={16} /> Return to Login\r\n                        </button></>\r\n                    )}\r\n                </div>\r\n            </div >\r\n        </div >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Cart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Contact.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2926,2929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2926,2929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Mail, Phone, MapPin, Send, Sparkles } from 'lucide-react';\r\nimport { Button } from '../components/common/Button';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-hot-toast';\r\nimport styles from './Contact.module.css';\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport const Contact = () => {\r\n    const navigate = useNavigate();\r\n    const [captchaText, setCaptchaText] = useState('');\r\n    const [userCaptcha, setUserCaptcha] = useState('');\r\n\r\n    useEffect(() => {\r\n        generateCaptcha();\r\n    }, []);\r\n\r\n    const generateCaptcha = () => {\r\n        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n        let result = '';\r\n        for (let i = 0; i < 4; i++) {\r\n            result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n        }\r\n        setCaptchaText(result);\r\n    };\r\n\r\n    const handleSendMessage = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (userCaptcha !== captchaText) {\r\n            toast.error(\"Incorrect Captcha Code. Please try again.\");\r\n            setUserCaptcha('');\r\n            generateCaptcha();\r\n            return;\r\n        }\r\n\r\n        // Check if user is logged in\r\n        const userStr = localStorage.getItem('user');\r\n        if (!userStr) {\r\n            toast.error(\"Please login to send an inquiry\", {\r\n                icon: '≡ƒöÆ',\r\n                duration: 5000,\r\n                style: {\r\n                    borderRadius: '1rem',\r\n                    background: '#0f172a',\r\n                    color: '#fff',\r\n                    border: '1px solid #f43f5e'\r\n                }\r\n            });\r\n            setTimeout(() => {\r\n                navigate('/auth');\r\n            }, 1500);\r\n            return;\r\n        }\r\n\r\n        const form = e.target as HTMLFormElement;\r\n        const name = (form.elements[0] as HTMLInputElement).value;\r\n        const message = (form.elements[2] as HTMLTextAreaElement).value;\r\n\r\n        const toastId = toast.loading(\"Dispatching to Admin HQ...\");\r\n\r\n        try {\r\n            // New Support Ticket Logic\r\n            const api = await import('../services/api');\r\n            await api.createSupportTicket({\r\n                subject: `Inquiry from ${name}`, // Auto-subject for now, or add field\r\n                message: message\r\n            });\r\n\r\n            toast.success(\"Message Dispatched! Reply will be given in 2 days and will be visible in your Dashboard.\", {\r\n                id: toastId,\r\n                duration: 6000,\r\n                icon: '≡ƒô¿',\r\n                style: {\r\n                    borderRadius: '1rem',\r\n                    background: '#0f172a',\r\n                    color: '#fff',\r\n                    border: '1px solid #10b981',\r\n                    maxWidth: '500px'\r\n                }\r\n            });\r\n            form.reset();\r\n            setUserCaptcha('');\r\n            generateCaptcha();\r\n        } catch (error: any) {\r\n            console.error(\"Support Ticket Error:\", error);\r\n            const errorMsg = error.message || \"Failed to send ticket. Please try again.\";\r\n            toast.error(errorMsg, {\r\n                id: toastId,\r\n                duration: 5000,\r\n                style: {\r\n                    borderRadius: '1rem',\r\n                    background: '#0f172a',\r\n                    color: '#fff',\r\n                    border: '1px solid #f43f5e'\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.contactContainer}>\r\n            {/* Header */}\r\n            <header className={styles.header}>\r\n                <div className={styles.badge}>\r\n                    READY TO ASSIST\r\n                </div>\r\n                <h1 className={styles.title}>VANAMAP<br />CONCIERGE</h1>\r\n                <p className={styles.subtitle}>\r\n                    Have questions about your specimens, orders, or ecosystem? Our botanical experts are standing by.\r\n                </p>\r\n            </header>\r\n\r\n            <div className={styles.grid}>\r\n                {/* Contact Information */}\r\n                <div className={styles.infoSection}>\r\n                    <div className={styles.infoCard}>\r\n                        <div className={styles.iconBox} style={{ background: 'rgba(56, 189, 248, 0.1)' }}>\r\n                            <Mail size={24} color=\"#38bdf8\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className={styles.cardTitle}>Email Support</h3>\r\n                            <p className={styles.cardValue}>jiibruh86@gmail.com</p>\r\n                            <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem' }}>Average response: 2h</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.infoCard}>\r\n                        <div className={styles.iconBox} style={{ background: 'rgba(16, 185, 129, 0.1)' }}>\r\n                            <Phone size={24} color=\"#10b981\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className={styles.cardTitle}>Botanist Hotline</h3>\r\n                            <p className={styles.cardValue}>+91 9188773534</p>\r\n                            <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem' }}>WhatsApp Available</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.infoCard}>\r\n                        <div className={styles.iconBox} style={{ background: 'rgba(244, 63, 94, 0.1)' }}>\r\n                            <MapPin size={24} color=\"#f43f5e\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className={styles.cardTitle}>Global HQ</h3>\r\n                            <p className={styles.cardValue}>Calicut, Kerala<br />India</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Contact Form */}\r\n                <div className={styles.formCard}>\r\n                    <h2 style={{ fontSize: '1.5rem', fontWeight: 800, color: 'white', marginBottom: '2rem' }}>Send Inquiry</h2>\r\n                    <form onSubmit={handleSendMessage}>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Identity</label>\r\n                            <input type=\"text\" placeholder=\"Your Name\" className={styles.input} required />\r\n                        </div>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Channel</label>\r\n                            <input type=\"email\" placeholder=\"Email Address\" className={styles.input} required />\r\n                        </div>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Manifesto</label>\r\n                            <textarea rows={4} placeholder=\"How can we help your ecosystem grow?\" className={styles.textarea} required />\r\n                        </div>\r\n\r\n                        {/* Captcha Section */}\r\n                        <div className={styles.inputGroup} style={{ marginBottom: '2rem' }}>\r\n                            <label className={styles.label}>Security Check</label>\r\n                            <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                                <div className={styles.captchaBox} style={{ position: 'relative', overflow: 'hidden' }}>\r\n                                    {/* Noise lines for effect */}\r\n                                    <div style={{ position: 'absolute', top: '50%', left: 0, width: '100%', height: '2px', background: 'rgba(0,0,0,0.3)', transform: 'rotate(5deg)' }}></div>\r\n                                    <div style={{ position: 'absolute', top: '20%', left: 0, width: '100%', height: '1px', background: 'rgba(0,0,0,0.3)', transform: 'rotate(-10deg)' }}></div>\r\n                                    {captchaText}\r\n                                </div>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Enter Code\"\r\n                                    className={styles.input}\r\n                                    style={{ letterSpacing: '2px', textTransform: 'uppercase' }}\r\n                                    value={userCaptcha}\r\n                                    onChange={(e) => setUserCaptcha(e.target.value.toUpperCase().slice(0, 4))}\r\n                                    maxLength={4}\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <Button\r\n                            variant=\"primary\"\r\n                            style={{ width: '100%', padding: '1.25rem', borderRadius: '1rem', fontWeight: '800', opacity: userCaptcha.length === 4 ? 1 : 0.6 }}\r\n                            disabled={userCaptcha.length !== 4}\r\n                        >\r\n                            <Send size={18} /> DISPATCH MESSAGE\r\n                        </Button>\r\n                    </form>\r\n                </div>\r\n\r\n                {/* Plant Suggestion Promotion */}\r\n                <div className={styles.suggestionPromo}>\r\n                    <div className={styles.promoContent}>\r\n                        <h2 className={styles.promoTitle}>Missing a Specimen?</h2>\r\n                        <p className={styles.promoDesc}>\r\n                            If you've discovered a rare plant species that isn't in our database yet, let us know!\r\n                            Our team will analyze its oxygen output and add it to the ecosystem.\r\n                        </p>\r\n                    </div>\r\n                    <button className={styles.suggestionBtn} onClick={() => navigate('/support')}>\r\n                        <Sparkles size={20} /> SUGGEST A PLANT\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\DailyNews.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[357,360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[357,360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import styles from './DailyNews.module.css';\r\nimport { ArrowRight, ArrowLeft } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useEffect, useState } from 'react';\r\nimport { fetchDailyNews } from '../services/api';\r\n\r\nexport const DailyNews = () => {\r\n    const navigate = useNavigate();\r\n    const [news, setNews] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        // Quest Check: Wise Reader (Action: read)\r\n        const activeQuest = sessionStorage.getItem('active_quest');\r\n        if (activeQuest) {\r\n            const quest = JSON.parse(activeQuest);\r\n            if (quest.action === 'read') {\r\n                import('../services/api').then(({ addPoints }) => {\r\n                    addPoints(quest.points).then(() => {\r\n                        import('react-hot-toast').then(({ default: toast }) => {\r\n                            toast.success(`Quest Complete: ${quest.title}! +${quest.points} CP`, { icon: '≡ƒÅå', duration: 5000 });\r\n                        });\r\n                        sessionStorage.removeItem('active_quest');\r\n                    }).catch(console.error);\r\n                });\r\n            }\r\n        }\r\n\r\n        // Fetch Live News\r\n        const load = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const data = await fetchDailyNews();\r\n                if (data && data.length > 0) {\r\n                    setNews(data);\r\n                } else {\r\n                    // Fallback to static if server yields nothing (safety net)\r\n                    setNews([\r\n                        {\r\n                            id: 1,\r\n                            title: \"Global Reforestation Efforts Hit 1 Billion Milestone\",\r\n                            source: \"Nature Weekly\",\r\n                            pubDate: new Date().toDateString(),\r\n                            image: \"https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?w=800&q=80\",\r\n                            content: \"A collective effort across 50 nations has resulted in the planting of one billion trees this year.\"\r\n                        },\r\n                        {\r\n                            id: 2,\r\n                            title: \"Urban Vertical Gardens Reduce City Heat by 5┬░C\",\r\n                            source: \"Science Daily\",\r\n                            pubDate: new Date().toDateString(),\r\n                            image: \"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&q=80\",\r\n                            content: \"New studies confirm that extensive green facades significantly cool metropolitan areas.\"\r\n                        }\r\n                    ]);\r\n                }\r\n            } catch (e) {\r\n                console.error(e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        load();\r\n    }, []);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <button\r\n                onClick={() => navigate('/heaven')}\r\n                className=\"fixed top-24 left-8 p-3 bg-white/10 hover:bg-white/20 rounded-full backdrop-blur-md transition-all z-50 border border-white/10\"\r\n            >\r\n                <ArrowLeft size={24} color=\"white\" />\r\n            </button>\r\n\r\n            <header className={styles.header}>\r\n                <h1 className={styles.title}>Botanical Daily</h1>\r\n                <p className={styles.subtitle}>Curated scientific insights and green news.</p>\r\n            </header>\r\n\r\n            {loading ? (\r\n                <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '50vh', flexDirection: 'column', gap: '1rem', color: '#94a3b8' }}>\r\n                    <div className={styles.pulse}></div>\r\n                    <p>Fetching latest planetary data...</p>\r\n                    <style>{`\r\n                        .${styles.pulse} {\r\n                            width: 50px; height: 50px;\r\n                            border: 3px solid #10b981; border-top-color: transparent; border-radius: 50%;\r\n                            animation: spin 1s linear infinite;\r\n                        }\r\n                        @keyframes spin { to { transform: rotate(360deg); } }\r\n                    `}</style>\r\n                </div>\r\n            ) : (\r\n                <div className={styles.newsGrid}>\r\n                    {news.map(item => (\r\n                        <article key={item.id} className={styles.newsCard}>\r\n                            <div className={styles.imageWrapper}>\r\n                                <img src={item.image} alt={item.title} className={styles.newsImage} loading=\"lazy\" />\r\n                                <span className={styles.category}>{item.source}</span>\r\n                            </div>\r\n                            <div className={styles.content}>\r\n                                <span className={styles.date}>{new Date(item.pubDate).toLocaleDateString()}</span>\r\n                                <h2 className={styles.headline}>{item.title}</h2>\r\n                                <p className={styles.excerpt}>\r\n                                    {item.content ? item.content.slice(0, 100) + '...' : 'Click below to read the full story.'}\r\n                                </p>\r\n                                <a href={item.link} target=\"_blank\" rel=\"noopener noreferrer\" className={styles.readMore}>\r\n                                    Read Full Story <ArrowRight size={16} />\r\n                                </a>\r\n                            </div>\r\n                        </article>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\ForestGame.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":106,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":106,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { ArrowLeft, Play, Trophy, Timer, Sparkles, Sprout, Heart, Leaf } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { addPoints } from '../services/api';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './ForestGame.module.css';\r\n\r\ninterface Target {\r\n    id: number;\r\n    x: number;\r\n    y: number;\r\n    type: 'seed' | 'leaf' | 'flower';\r\n}\r\n\r\nexport const ForestGame = () => {\r\n    const navigate = useNavigate();\r\n    const { user, updateUser } = useAuth();\r\n    const [score, setScore] = useState(0);\r\n    const [gameState, setGameState] = useState<'start' | 'playing' | 'end'>('start');\r\n    const [timeLeft, setTimeLeft] = useState(30);\r\n    const [targets, setTargets] = useState<Target[]>([]);\r\n    const [combo, setCombo] = useState(0);\r\n    const [showLevelUp, setShowLevelUp] = useState(false);\r\n    const [currentLevel, setCurrentLevel] = useState(1);\r\n    const gameTimerRef = useRef<number | null>(null);\r\n    const spawnTimerRef = useRef<number | null>(null);\r\n\r\n    // Load initial user data\r\n    useEffect(() => {\r\n        if (user) {\r\n            setCurrentLevel(user.gameLevel || 1);\r\n        }\r\n\r\n        // Quest Check: Forest Hero (Action: game)\r\n        const activeQuest = sessionStorage.getItem('active_quest');\r\n        if (activeQuest) {\r\n            const quest = JSON.parse(activeQuest);\r\n            if (quest.action === 'game') {\r\n                // Wait a bit to ensure they actually see the game first\r\n                setTimeout(() => {\r\n                    import('../services/api').then(({ addPoints }) => {\r\n                        addPoints(quest.points).then(() => {\r\n                            toast.success(`Quest Complete: ${quest.title}! +${quest.points} CP`, { icon: '≡ƒÅå', duration: 5000 });\r\n                            sessionStorage.removeItem('active_quest');\r\n                        }).catch(console.error);\r\n                    });\r\n                }, 2000);\r\n            }\r\n        }\r\n    }, [user]);\r\n\r\n    const spawnTarget = useCallback(() => {\r\n        const id = Date.now();\r\n        const x = Math.random() * 80 + 10; // 10% to 90%\r\n        const y = Math.random() * 60 + 15; // 15% to 75% (Keeping it higher for mobile visibility)\r\n        const types: Target['type'][] = ['seed', 'leaf', 'flower'];\r\n        const type = types[Math.floor(Math.random() * types.length)];\r\n\r\n        setTargets(prev => [...prev, { id, x, y, type }]);\r\n\r\n        // Auto remove target\r\n        setTimeout(() => {\r\n            setTargets(prev => prev.filter(t => t.id !== id));\r\n        }, 1800);\r\n    }, []);\r\n\r\n    const startGame = () => {\r\n        setScore(0);\r\n        setTimeLeft(30);\r\n        setCombo(0);\r\n        setGameState('playing');\r\n        setTargets([]);\r\n        setShowLevelUp(false);\r\n    };\r\n\r\n    const endGame = useCallback(async () => {\r\n        setGameState('end');\r\n        if (gameTimerRef.current) clearInterval(gameTimerRef.current);\r\n        if (spawnTimerRef.current) clearInterval(spawnTimerRef.current);\r\n\r\n        // Award Chlorophyll Points (10 per game)\r\n        try {\r\n            const POINTS_REWARD = 10;\r\n            await addPoints(POINTS_REWARD);\r\n\r\n            // Check for level up logic (every 100 points)\r\n            const newPoints = (user?.points || 0) + POINTS_REWARD;\r\n            const newLevel = Math.floor(newPoints / 100) + 1;\r\n\r\n            if (newLevel > currentLevel) {\r\n                setShowLevelUp(true);\r\n                setCurrentLevel(newLevel);\r\n                toast.success(`LEVEL UP! You are now Level ${newLevel}! ≡ƒîƒ`, { duration: 4000 });\r\n            }\r\n\r\n            // Optimistically update UI\r\n            if (user) {\r\n                updateUser({\r\n                    points: newPoints,\r\n                    gameLevel: newLevel\r\n                });\r\n            }\r\n            toast.success(`+${POINTS_REWARD} Chlorophyll Points added! ≡ƒî┐`, { icon: '≡ƒº¬' });\r\n        } catch (e) {\r\n            console.error(\"Points update failed\");\r\n        }\r\n    }, [user, updateUser, currentLevel]);\r\n\r\n    useEffect(() => {\r\n        if (gameState === 'playing') {\r\n            gameTimerRef.current = window.setInterval(() => {\r\n                setTimeLeft(prev => {\r\n                    if (prev <= 1) {\r\n                        endGame();\r\n                        return 0;\r\n                    }\r\n                    return prev - 1;\r\n                });\r\n            }, 1000);\r\n\r\n            spawnTimerRef.current = window.setInterval(() => {\r\n                spawnTarget();\r\n            }, 800);\r\n        }\r\n\r\n        return () => {\r\n            if (gameTimerRef.current) clearInterval(gameTimerRef.current);\r\n            if (spawnTimerRef.current) clearInterval(spawnTimerRef.current);\r\n        };\r\n    }, [gameState, spawnTarget, endGame]);\r\n\r\n    const handleTargetClick = (id: number) => {\r\n        setScore(s => s + 10 + (combo * 2));\r\n        setCombo(c => c + 1);\r\n        setTargets(prev => prev.filter(t => t.id !== id));\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.overlay}></div>\r\n\r\n            {/* Level Up Modal */}\r\n            {showLevelUp && (\r\n                <div className={styles.levelModal}>\r\n                    <div className={styles.levelTitle}>LEVEL UP!</div>\r\n                    <div className={styles.levelSub}>Rank {currentLevel} achieved</div>\r\n                    <div className=\"text-4xl animate-bounce\">Γ¡É</div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Header: High Density */}\r\n            <header className={styles.header}>\r\n                <button onClick={() => navigate('/heaven')} className={styles.backBtn}>\r\n                    <ArrowLeft size={18} color=\"white\" />\r\n                </button>\r\n                <div className={styles.statsGroup}>\r\n                    <div className={styles.miniStat}>\r\n                        <span>Lvl {currentLevel}</span>\r\n                    </div>\r\n                    <div className={`${styles.miniStat} ${timeLeft < 10 ? styles.pulseRed : ''}`}>\r\n                        <Timer size={timeLeft < 10 ? 20 : 14} />\r\n                        <span>{timeLeft}s</span>\r\n                    </div>\r\n                    <div className={styles.miniStat}>\r\n                        <Trophy size={14} color=\"#facc15\" />\r\n                        <span>{score}</span>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <main className={styles.mainContent}>\r\n                {gameState === 'start' && (\r\n                    <div className={styles.card}>\r\n                        <div className={styles.badge}>MISSION: REFORESTATION</div>\r\n                        <h1 className={styles.gameTitle}>Canopy Hero</h1>\r\n                        <p className={styles.missionText}>\r\n                            The digital Amazon is losing its glow. Tap emerging <strong>Seedlings</strong> to release oxygen and restore the canopy.\r\n                        </p>\r\n                        <div className={styles.featureGrid}>\r\n                            <div className={styles.featureItem}>\r\n                                <Sprout size={20} color=\"#10b981\" />\r\n                                <span>Save Nature</span>\r\n                            </div>\r\n                            <div className={styles.featureItem}>\r\n                                <Sparkles size={20} color=\"#facc15\" />\r\n                                <span>Earn Points</span>\r\n                            </div>\r\n                        </div>\r\n                        <button onClick={startGame} className={styles.startBtn}>\r\n                            <Play fill=\"currentColor\" size={20} /> Deploy Seedlings\r\n                        </button>\r\n                        <p className={styles.rewardNote}>≡ƒÅå Complete 1 session for 10 Chlorophyll Points</p>\r\n                    </div>\r\n                )}\r\n\r\n                {gameState === 'playing' && (\r\n                    <div className={styles.gameArea}>\r\n                        {targets.map(t => (\r\n                            <button\r\n                                key={t.id}\r\n                                className={styles.target}\r\n                                style={{ left: `${t.x}%`, top: `${t.y}%` }}\r\n                                onClick={() => handleTargetClick(t.id)}\r\n                            >\r\n                                <div className={styles.targetGlow}></div>\r\n                                <span className={styles.targetIcon}>\r\n                                    {t.type === 'seed' && <Sprout size={32} />}\r\n                                    {t.type === 'leaf' && <Leaf size={32} />}\r\n                                    {t.type === 'flower' && <Heart size={32} fill=\"#ef4444\" />}\r\n                                </span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {gameState === 'end' && (\r\n                    <div className={styles.card}>\r\n                        <div className={styles.successIcon}>≡ƒî┐</div>\r\n                        <h2 className={styles.endTitle}>Canopy Restored!</h2>\r\n                        <div className={styles.scoreBreakdown}>\r\n                            <div className={styles.finalScore}>\r\n                                <span className={styles.label}>Energy Generated</span>\r\n                                <span className={styles.value}>{score}</span>\r\n                            </div>\r\n                            <div className={styles.pointsEarned}>\r\n                                <span className={styles.label}>Chlorophyll Gained</span>\r\n                                <span className={styles.value}>+10 Points</span>\r\n                            </div>\r\n                        </div>\r\n                        <div className={styles.btnGroup}>\r\n                            <button onClick={startGame} className={styles.retryBtn}>Play Again</button>\r\n                            <button onClick={() => navigate('/heaven')} className={styles.exitBtn}>Return to Studio</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </main>\r\n\r\n            {/* Background elements */}\r\n            <div className={styles.bgGlow}></div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Heaven.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Home.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1544,1547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1544,1547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":29,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2201,2204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2201,2204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":86,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":86,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isFromCache' and 'plantsLoading'. Either include them or remove the dependency array.","line":125,"column":8,"nodeType":"ArrayExpression","endLine":125,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [isFromCache, plantsLoading]","fix":{"range":[6393,6395],"text":"[isFromCache, plantsLoading]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":312,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":312,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14271,14274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14271,14274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":557,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":557,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31048,31051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31048,31051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":699,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":699,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40385,40388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40385,40388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, lazy, Suspense, useMemo } from 'react';\r\nimport toast from 'react-hot-toast';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\nimport { PlantCard } from '../components/features/plants/PlantCard';\r\nimport { Button } from '../components/common/Button';\r\nimport { fetchPlants, fetchVendors } from '../services/api';\r\nimport { getWeather, geocodeCity, reverseGeocode } from '../services/weather';\r\nimport { calculateAptness, normalizeBatch } from '../utils/logic';\r\nimport type { Plant, Vendor } from '../types';\r\nimport { Sprout, MapPin, Thermometer, Wind, ArrowDown, Sparkles, Search, AlertCircle, Heart, Sun, Activity, GraduationCap, ShoppingBag, PlusCircle, MoveRight, MessageCircle, Droplets, Settings2 } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\n// Lazy load modal for performance\r\nconst PlantDetailsModal = lazy(() => import('../components/features/plants/PlantDetailsModal').then(module => ({ default: module.PlantDetailsModal })));\r\nimport { PlantSkeleton } from '../components/features/plants/PlantSkeleton';\r\nimport styles from './Home.module.css';\r\n\r\nexport const Home = () => {\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [vendors, setVendors] = useState<Vendor[]>([]);\r\n    const [filter, setFilter] = useState<'all' | 'indoor' | 'outdoor'>('all');\r\n\r\n\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [lightFilter, setLightFilter] = useState<'all' | 'low' | 'medium' | 'high'>('all');\r\n    const [weather, setWeather] = useState<any>(() => {\r\n        const cached = localStorage.getItem('vanamap_weather');\r\n        try {\r\n            return cached ? JSON.parse(cached) : null;\r\n        } catch (e) {\r\n            return null;\r\n        }\r\n    });\r\n    const [locationLoading, setLocationLoading] = useState(false);\r\n    const [plantsLoading, setPlantsLoading] = useState(true);\r\n    const [isFromCache, setIsFromCache] = useState(false);\r\n    const [isSlowLoading, setIsSlowLoading] = useState(false);\r\n    const [selectedPlant, setSelectedPlant] = useState<Plant | null>(null);\r\n    const [citySearch, setCitySearch] = useState('');\r\n    const [suggestions, setSuggestions] = useState<any[]>([]);\r\n    const [showSuggestions, setShowSuggestions] = useState(false);\r\n    const [visibleLimit, setVisibleLimit] = useState(() => window.innerWidth < 768 ? 4 : 10);\r\n\r\n    const plantsSectionRef = useRef<HTMLDivElement>(null);\r\n    const filterSectionRef = useRef<HTMLDivElement>(null);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    // Mobile Card Logic\r\n    const [expandedCards, setExpandedCards] = useState<Record<string, boolean>>({});\r\n\r\n    const toggleCard = (id: string) => {\r\n        setExpandedCards(prev => ({ ...prev, [id]: !prev[id] }));\r\n    };\r\n\r\n    const capabilities = [\r\n        { id: 'cap-smart', title: 'Smart Match', icon: <Sparkles size={32} />, color: '#34d399', bg: 'rgba(52, 211, 153, 0.1)', desc: 'We score plants based on your local temperature and air quality to ensure they survive.' },\r\n        { id: 'cap-oxygen', title: 'Oxygen Boost', icon: <Wind size={32} />, color: '#38bdf8', bg: 'rgba(56, 189, 248, 0.1)', desc: 'See how much oxygen each plant produces to help you breathe better and sleep deeper.' }\r\n    ];\r\n\r\n    const personas = [\r\n        { id: 'role-student', title: 'For Students', icon: <GraduationCap size={32} />, color: '#38bdf8', bg: 'rgba(56, 189, 248, 0.1)', desc: 'Learn plant biology, analyze local weather effects, and use our oxygen simulation for your research projects.', meta: 'Educational Mode' },\r\n        { id: 'role-vendor', title: 'For Vendors', icon: <ShoppingBag size={32} />, color: '#facc15', bg: 'rgba(250, 204, 21, 0.1)', desc: 'Register your nursery, list rare specimens, and connect with local plant lovers in your area instantly.', meta: 'Business Portal' },\r\n        { id: 'role-lover', title: 'For Plant Lovers', icon: <Heart size={32} />, color: '#10b981', bg: 'rgba(16, 185, 129, 0.1)', desc: 'Find the perfect match for your home, track your collection, and learn how to care for your green companions.', meta: 'Social Collector' }\r\n    ];\r\n\r\n    useEffect(() => {\r\n        const handlePopState = () => {\r\n            setSelectedPlant(null);\r\n        };\r\n        window.addEventListener('popstate', handlePopState);\r\n        return () => {\r\n            window.removeEventListener('popstate', handlePopState);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const cachedPlants = localStorage.getItem('vanamap_plants_cache');\r\n        if (cachedPlants) {\r\n            try {\r\n                const parsed = JSON.parse(cachedPlants);\r\n                if (Array.isArray(parsed) && parsed.length > 0) {\r\n                    setPlants(parsed);\r\n                    setPlantsLoading(false);\r\n                    setIsFromCache(true);\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Cache corrupted\");\r\n            }\r\n        }\r\n\r\n        const loadFreshData = async () => {\r\n            const timer = setTimeout(() => {\r\n                if (plantsLoading) setIsSlowLoading(true);\r\n            }, 3500);\r\n\r\n            try {\r\n                const [data, vendorData] = await Promise.all([\r\n                    fetchPlants(),\r\n                    fetchVendors()\r\n                ]);\r\n                setVendors(vendorData);\r\n                if (data.length === 0) {\r\n                    const { PLANTS } = await import('../data/mocks');\r\n                    await import('../services/api').then(api => api.seedDatabase(PLANTS, []));\r\n                    const newData = await fetchPlants();\r\n                    setPlants(newData);\r\n                    localStorage.setItem('vanamap_plants_cache', JSON.stringify(newData));\r\n                } else {\r\n                    if (!isFromCache || JSON.stringify(data) !== localStorage.getItem('vanamap_plants_cache')) {\r\n                        setPlants(data);\r\n                        localStorage.setItem('vanamap_plants_cache', JSON.stringify(data));\r\n                    }\r\n                }\r\n                setIsFromCache(false);\r\n            } catch (err) {\r\n                console.error(\"Fetch failed\", err);\r\n            } finally {\r\n                setPlantsLoading(false);\r\n                setIsSlowLoading(false);\r\n                clearTimeout(timer);\r\n            }\r\n        };\r\n\r\n        loadFreshData();\r\n    }, []);\r\n\r\n    const scrollToPlants = () => {\r\n        setTimeout(() => {\r\n            plantsSectionRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n        }, 300);\r\n    };\r\n\r\n    const scrollToFilters = () => {\r\n        setTimeout(() => {\r\n            filterSectionRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n        }, 100);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const timer = setTimeout(async () => {\r\n            if (citySearch.length > 2 && showSuggestions) {\r\n                try {\r\n                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(citySearch)}&limit=5`);\r\n                    const data = await response.json();\r\n                    setSuggestions(data);\r\n                } catch (e) {\r\n                    console.error(\"Suggestion fetch failed\", e);\r\n                }\r\n            } else {\r\n                setSuggestions([]);\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [citySearch, showSuggestions]);\r\n\r\n    const handleCitySearch = async (overrideCity?: string) => {\r\n        const query = overrideCity || citySearch;\r\n        if (!query) return;\r\n        setLocationLoading(true);\r\n        const result = await geocodeCity(query);\r\n        if (result) {\r\n            const weatherData = await getWeather(result.lat, result.lng);\r\n            if (weatherData) {\r\n                const cityName = query.split(',')[0].trim();\r\n                const cleanName = cityName.charAt(0).toUpperCase() + cityName.slice(1);\r\n                setWeather({ ...weatherData, locationName: cleanName });\r\n                toast.success(`Synced location: ${cleanName}`);\r\n\r\n                // Quest Check: Morning Dew (Action: search)\r\n                const activeQuest = sessionStorage.getItem('active_quest');\r\n                if (activeQuest) {\r\n                    const quest = JSON.parse(activeQuest);\r\n                    if (quest.action === 'search') {\r\n                        import('../services/api').then(({ addPoints }) => {\r\n                            addPoints(quest.points).then(() => {\r\n                                toast.success(`Quest Complete: ${quest.title}! +${quest.points} CP`, { icon: '≡ƒÅå', duration: 5000 });\r\n                                sessionStorage.removeItem('active_quest'); // Clear quest\r\n                            }).catch(console.error);\r\n                        });\r\n                    }\r\n                }\r\n\r\n                scrollToFilters();\r\n                setSuggestions([]);\r\n            } else {\r\n                toast.error(\"Data unavailable.\");\r\n            }\r\n        } else {\r\n            toast.error(\"City not found.\");\r\n        }\r\n        setLocationLoading(false);\r\n    };\r\n\r\n    const handleGetLocation = () => {\r\n        setLocationLoading(true);\r\n        const toastId = toast.loading(\"Finding your location...\");\r\n\r\n        const performIPFallback = async (reason: string) => {\r\n            console.log(`GPS fail: ${reason}. Trying IP fallback...`);\r\n            try {\r\n                // IP Geolocation fallback (ipapi.co is free and reliable)\r\n                const response = await fetch('https://ipapi.co/json/');\r\n                const data = await response.json();\r\n\r\n                if (data.latitude && data.longitude) {\r\n                    const { latitude, longitude, city, country_name } = data;\r\n                    const weatherData = await getWeather(latitude, longitude);\r\n                    if (weatherData) {\r\n                        const locName = city ? `${city}, ${country_name}` : \"Detected Location\";\r\n                        setWeather({ ...weatherData, locationName: locName });\r\n                        toast.success(`Located: ${locName}`, { id: toastId });\r\n                        scrollToFilters();\r\n                    } else {\r\n                        toast.error(\"Weather unavailable for your zone.\", { id: toastId });\r\n                    }\r\n                } else {\r\n                    toast.error(\"Could not detect location. Please search manually.\", { id: toastId });\r\n                }\r\n            } catch (err) {\r\n                console.error(\"IP fallback failed\", err);\r\n                toast.error(\"Location access failed. Please search manually.\", { id: toastId });\r\n            } finally {\r\n                setLocationLoading(false);\r\n            }\r\n        };\r\n\r\n        if (navigator.geolocation) {\r\n            const options = { enableHighAccuracy: true, timeout: 6000, maximumAge: 0 };\r\n            navigator.geolocation.getCurrentPosition(async (position) => {\r\n                const { latitude, longitude } = position.coords;\r\n                try {\r\n                    const [weatherData, locationName] = await Promise.all([\r\n                        getWeather(latitude, longitude),\r\n                        reverseGeocode(latitude, longitude)\r\n                    ]);\r\n\r\n                    if (weatherData) {\r\n                        setWeather({ ...weatherData, locationName: locationName });\r\n                        toast.success(`Located: ${locationName}`, { id: toastId });\r\n                        scrollToFilters();\r\n                    } else {\r\n                        toast.error(\"Weather data unavailable.\", { id: toastId });\r\n                    }\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    toast.error(\"Network error fetching weather.\", { id: toastId });\r\n                } finally {\r\n                    setLocationLoading(false);\r\n                }\r\n            }, (err) => {\r\n                let msg = \"GPS access denied.\";\r\n                if (err.code === 3) msg = \"Location timeout.\";\r\n                if (err.code === 2) msg = \"Location unavailable.\";\r\n                performIPFallback(msg);\r\n            }, options);\r\n        } else {\r\n            performIPFallback(\"GPS not supported.\");\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (weather) {\r\n            localStorage.setItem('vanamap_weather', JSON.stringify(weather));\r\n        }\r\n    }, [weather]);\r\n\r\n    // DISABLED: Auto-detect on mount\r\n    // Location detection now only happens when user clicks the GPS button\r\n    /*\r\n    useEffect(() => {\r\n        // Auto-detect on mount if nothing is cached\r\n        const hasNoLocation = !localStorage.getItem('vanamap_weather');\r\n        if (hasNoLocation) {\r\n            const timer = setTimeout(() => {\r\n                handleGetLocation();\r\n            }, 1200);\r\n\r\n            // Listen for permission changes to trigger detect immediately on 'allow'\r\n            if (navigator.permissions && navigator.permissions.query) {\r\n                navigator.permissions.query({ name: 'geolocation' as PermissionName }).then(status => {\r\n                    status.onchange = () => {\r\n                        if (status.state === 'granted') {\r\n                            handleGetLocation();\r\n                        }\r\n                    };\r\n                });\r\n            }\r\n\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, []);\r\n    */\r\n\r\n    const handleAddToCart = (plant: Plant) => {\r\n        // Navigate to Shops page with the selected plant ID to open it immediately\r\n        navigate('/shops', { state: { openPlantId: plant.id } });\r\n    };\r\n\r\n    const openDetails = (plant: Plant) => {\r\n        window.history.pushState({ modal: 'plantDetails' }, document.title);\r\n        setSelectedPlant(plant);\r\n    };\r\n\r\n    const getVendorStats = (plantId: string) => {\r\n        const sellingVendors = vendors.filter(v => v.inventory?.some(i => i.plantId === plantId && i.inStock));\r\n\r\n        let totalStock = 0;\r\n        sellingVendors.forEach(v => {\r\n            const item = v.inventory?.find(i => i.plantId === plantId);\r\n            if (item) {\r\n                const qty = (item as any).quantity;\r\n                totalStock += (typeof qty === 'number' ? qty : 1);\r\n            }\r\n        });\r\n\r\n        const prices = sellingVendors.map(v => v.inventory?.find(i => i.plantId === plantId)?.price || 99999);\r\n        const minPrice = prices.length > 0 ? Math.min(...prices) : null;\r\n\r\n        return { totalStock, minPrice, sellerCount: sellingVendors.length, hasStock: totalStock > 0 };\r\n    };\r\n\r\n    const getPollutionStatus = (aqi?: number) => {\r\n        if (aqi === undefined || aqi === null) return { label: 'Unknown', color: '#94a3b8', desc: 'No Data' };\r\n        if (aqi <= 20) return { label: 'Excellent', color: '#10b981', desc: 'Fresh Air' };\r\n        if (aqi <= 50) return { label: 'Good', color: '#facc15', desc: 'Air is Okay' };\r\n        if (aqi <= 100) return { label: 'Moderate', color: '#fb923c', desc: 'Not very Clean' };\r\n        return { label: 'High Pollution', color: '#f87171', desc: 'You need plants!' };\r\n    };\r\n\r\n    const displayedPlants = useMemo(() => {\r\n        const filtered = plants.filter(p => {\r\n            const matchesType = filter === 'all' ? true : p.type === filter;\r\n            const matchesSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                (p.scientificName || '').toLowerCase().includes(searchQuery.toLowerCase());\r\n            const matchesLight = lightFilter === 'all' ? true : (() => {\r\n                const s = p.sunlight?.toLowerCase() || '';\r\n                if (lightFilter === 'low') return s.includes('low') || s.includes('shade') || s.includes('shadow');\r\n                if (lightFilter === 'medium') return s.includes('indirect') || s.includes('partial') || s.includes('medium');\r\n                if (lightFilter === 'high') return s.includes('full') || s.includes('high') || s.includes('direct') || s.includes('bright');\r\n                return false;\r\n            })();\r\n            return matchesType && matchesSearch && matchesLight;\r\n        });\r\n\r\n        if (!weather) return filtered.map(p => ({ ...p, score: 0 }));\r\n\r\n        // Simple biological simulation - instant for both mobile and desktop\r\n        // 1. Calculate raw high-precision absolute scores\r\n        const scoredRaw = filtered.map(p => {\r\n            const rawScore = calculateAptness(p, weather.avgTemp30Days, weather.air_quality?.aqi, weather.avgHumidity30Days, undefined, true);\r\n            return { ...p, rawScore };\r\n        });\r\n\r\n        // 2. Normalize the batch relative to the highest raw score\r\n        const rawScores = scoredRaw.map(s => s.rawScore);\r\n        const normalizedScores = normalizeBatch(rawScores);\r\n\r\n        // 3. Map normalized scores back and sort\r\n        return scoredRaw\r\n            .map((p, i) => ({ ...p, score: normalizedScores[i] }))\r\n            .sort((a, b) => b.score - a.score);\r\n    }, [plants, filter, searchQuery, lightFilter, weather]);\r\n\r\n    return (\r\n        <div className={styles.homeContainer}>\r\n            {selectedPlant && (\r\n                <Suspense fallback={<div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 2000, backdropFilter: 'blur(10px)' }}>Starting Simulation...</div>}>\r\n                    <PlantDetailsModal\r\n                        plant={selectedPlant}\r\n                        score={selectedPlant.score}\r\n                        weather={weather}\r\n                        onClose={() => window.history.back()}\r\n                        onBuy={() => handleAddToCart(selectedPlant)}\r\n                    />\r\n                </Suspense>\r\n            )}\r\n\r\n            <section className={styles.hero}>\r\n                <div className={styles.heroContent}>\r\n                    <div className={styles.heroMainStack}>\r\n                        {/* Premium Instagram Icon */}\r\n                        <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                            <a\r\n                                href=\"https://www.instagram.com/vanamap.online/\"\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className={styles.instagramLink}\r\n                                aria-label=\"Follow VanaMap on Instagram\"\r\n                            >\r\n                                <div className={styles.instagramIcon}>\r\n                                    <svg\r\n                                        width=\"24\"\r\n                                        height=\"24\"\r\n                                        viewBox=\"0 0 24 24\"\r\n                                        fill=\"none\"\r\n                                        xmlns=\"http://www.w3.org/2000/svg\"\r\n                                    >\r\n                                        <path\r\n                                            d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z\"\r\n                                            fill=\"url(#instagramGradient)\"\r\n                                        />\r\n                                        <defs>\r\n                                            <linearGradient id=\"instagramGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#f09433\" />\r\n                                                <stop offset=\"25%\" stopColor=\"#e6683c\" />\r\n                                                <stop offset=\"50%\" stopColor=\"#dc2743\" />\r\n                                                <stop offset=\"75%\" stopColor=\"#cc2366\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#bc1888\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                    </svg>\r\n                                </div>\r\n                            </a>\r\n\r\n                            {/* Premium WhatsApp Icon */}\r\n                            <a\r\n                                href=\"https://wa.me/919188773534\"\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className={styles.whatsappLink}\r\n                                aria-label=\"Contact VanaMap on WhatsApp\"\r\n                            >\r\n                                <div className={styles.whatsappIcon}>\r\n                                    <svg\r\n                                        width=\"24\"\r\n                                        height=\"24\"\r\n                                        viewBox=\"0 0 24 24\"\r\n                                        fill=\"none\"\r\n                                        xmlns=\"http://www.w3.org/2000/svg\"\r\n                                    >\r\n                                        <path\r\n                                            d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.414 0 .018 5.396.015 12.03c0 2.12.554 4.189 1.602 6.06L0 24l6.117-1.605a11.782 11.782 0 005.925 1.585h.005c6.635 0 12.03-5.396 12.033-12.03a11.84 11.84 0 00-3.417-8.497\"\r\n                                            fill=\"url(#whatsappGradient)\"\r\n                                        />\r\n                                        <defs>\r\n                                            <linearGradient id=\"whatsappGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#25D366\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#128C7E\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                    </svg>\r\n                                </div>\r\n                            </a>\r\n                            {/* Premium Email Icon */}\r\n                            <a\r\n                                href=\"mailto:jiibruh86@gmail.com\"\r\n                                className={styles.emailLink}\r\n                                aria-label=\"Email VanaMap Support\"\r\n                            >\r\n                                <div className={styles.emailIcon}>\r\n                                    <svg\r\n                                        width=\"24\"\r\n                                        height=\"24\"\r\n                                        viewBox=\"0 0 24 24\"\r\n                                        fill=\"none\"\r\n                                        xmlns=\"http://www.w3.org/2000/svg\"\r\n                                    >\r\n                                        <path\r\n                                            d=\"M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z\"\r\n                                            stroke=\"url(#emailGradient)\"\r\n                                            strokeWidth=\"2\"\r\n                                            strokeLinecap=\"round\"\r\n                                            strokeLinejoin=\"round\"\r\n                                        />\r\n                                        <path\r\n                                            d=\"M22 6L12 13L2 6\"\r\n                                            stroke=\"url(#emailGradient)\"\r\n                                            strokeWidth=\"2\"\r\n                                            strokeLinecap=\"round\"\r\n                                            strokeLinejoin=\"round\"\r\n                                        />\r\n                                        <defs>\r\n                                            <linearGradient id=\"emailGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#38bdf8\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#818cf8\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                    </svg>\r\n                                </div>\r\n                            </a>\r\n\r\n                            {/* Premium X (Twitter) Icon */}\r\n                            <a\r\n                                href=\"https://x.com/VanaMap50945\"\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className={styles.twitterLink}\r\n                                aria-label=\"Follow VanaMap on X\"\r\n                            >\r\n                                <div className={styles.twitterIcon}>\r\n                                    <svg\r\n                                        width=\"24\"\r\n                                        height=\"24\"\r\n                                        viewBox=\"0 0 24 24\"\r\n                                        fill=\"none\"\r\n                                        xmlns=\"http://www.w3.org/2000/svg\"\r\n                                    >\r\n                                        <path\r\n                                            d=\"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932 6.064-6.932zm-1.29 19.497h2.039L6.486 3.24H4.298l13.313 17.41z\"\r\n                                            fill=\"url(#twitterGradient)\"\r\n                                        />\r\n                                        <defs>\r\n                                            <linearGradient id=\"twitterGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\r\n                                                <stop offset=\"0%\" stopColor=\"#ffffff\" />\r\n                                                <stop offset=\"100%\" stopColor=\"#94a3b8\" />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                    </svg>\r\n                                </div>\r\n                            </a>\r\n                        </div>\r\n\r\n                        <div className={styles.heroBadge}>\r\n                            <Sparkles size={16} /> Home Ecosystem Intelligence\r\n                        </div>\r\n                        <h1 className={styles.heroTitle}>Bring Nature<br />Home</h1>\r\n                        <p className={styles.heroSubtitle}>\r\n                            Turn your home into a green sanctuary.\r\n                            <strong> Detect your location</strong> to find plants that thrive in your space.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {!weather ? (\r\n                        <div id=\"location-action-area\" className={styles.heroActionArea}>\r\n                            <div className={styles.actionContainer}>\r\n                                <Button\r\n                                    variant=\"primary\"\r\n                                    onClick={handleGetLocation}\r\n                                    className={`${styles.gpsBtn} ${locationLoading ? styles.gpsBtnLoading : ''}`}\r\n                                    disabled={locationLoading}\r\n                                    aria-label=\"Detect current location for plant recommendations\"\r\n                                >\r\n                                    <MapPin size={22} className={locationLoading ? \"animate-spin\" : \"animate-bounce\"} style={{ marginRight: '12px' }} />\r\n                                    {locationLoading ? \"≡ƒîì DETERMINING CLIMATE...\" : \"Auto-Detect Local Climate\"}\r\n                                </Button>\r\n\r\n                                <div className={styles.divider}>\r\n                                    <span>OR SEARCH MANUALLY</span>\r\n                                </div>\r\n\r\n                                <div className={styles.searchBox}>\r\n                                    <Search size={22} className={styles.searchIcon} />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Enter your city...\"\r\n                                        value={citySearch}\r\n                                        onChange={(e) => setCitySearch(e.target.value)}\r\n                                        onFocus={() => setShowSuggestions(true)}\r\n                                        onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}\r\n                                        onKeyDown={(e) => e.key === 'Enter' && handleCitySearch()}\r\n                                        className={styles.searchInput}\r\n                                        aria-label=\"Search for a city manually\"\r\n                                    />\r\n                                    {showSuggestions && Array.isArray(suggestions) && suggestions.length > 0 && (\r\n                                        <ul className={styles.suggestionsList}>\r\n                                            {suggestions.map((place: any, i) => (\r\n                                                <li key={i} className={styles.suggestionItem} onClick={() => {\r\n                                                    const cityName = place.display_name.split(',')[0];\r\n                                                    setCitySearch(cityName);\r\n                                                    setShowSuggestions(false);\r\n                                                    handleCitySearch(cityName);\r\n                                                }}>\r\n                                                    <MapPin size={16} style={{ marginRight: '12px', color: '#10b981' }} />\r\n                                                    <span style={{ whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{place.display_name}</span>\r\n                                                </li>\r\n                                            ))}\r\n                                        </ul>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate('/nearby')} className={styles.ghostBtn}>\r\n                                    <Sprout size={16} style={{ marginRight: '8px' }} /> Find Nearby Shop Instead\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className={styles.weatherDashboard}>\r\n                            <div className={styles.weatherCard}>\r\n                                <div className={styles.statIcon} style={{ background: 'rgba(56, 189, 248, 0.15)', color: '#38bdf8' }}>\r\n                                    <MapPin size={24} />\r\n                                </div>\r\n                                <div className={styles.statInfo}>\r\n                                    <span className={styles.statLabel}>LOCATION</span>\r\n                                    <div className={styles.statValue}>\r\n                                        {weather.locationName || weather.city || 'Local Zone'}\r\n                                    </div>\r\n                                    <button onClick={() => {\r\n                                        setWeather(null);\r\n                                        localStorage.removeItem('vanamap_weather');\r\n                                    }} className={styles.changeLocationBtn}>\r\n                                        <Settings2 size={12} />\r\n                                        Change Location\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.weatherCard}>\r\n                                <div className={styles.statIcon} style={{ background: 'rgba(250, 204, 21, 0.15)', color: '#facc15' }}>\r\n                                    <Thermometer size={24} />\r\n                                </div>\r\n                                <div className={styles.statInfo}>\r\n                                    <span className={styles.statLabel}>LIVE TEMPERATURE</span>\r\n                                    <div className={styles.statValue}>\r\n                                        {typeof weather.avgTemp30Days === 'number' ? weather.avgTemp30Days.toFixed(1) : '--'}┬░C\r\n                                    </div>\r\n                                    <span className={styles.statDescription}>30-Day Simulation Base</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.weatherCard}>\r\n                                <div className={styles.statIcon} style={{ background: 'rgba(139, 92, 246, 0.15)', color: '#8b5cf6' }}>\r\n                                    <Droplets size={24} />\r\n                                </div>\r\n                                <div className={styles.statInfo}>\r\n                                    <span className={styles.statLabel}>LIVE HUMIDITY</span>\r\n                                    <div className={styles.statValue}>\r\n                                        {typeof weather.humidity === 'number' ? weather.humidity.toFixed(0) : '--'}%\r\n                                    </div>\r\n                                    <span className={styles.statDescription}>Current Moisture Level</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.weatherCard}>\r\n                                <div className={styles.statIcon} style={{\r\n                                    background: `${getPollutionStatus(weather.air_quality?.aqi).color}25`,\r\n                                    color: getPollutionStatus(weather.air_quality?.aqi).color\r\n                                }}>\r\n                                    <Activity size={24} />\r\n                                </div>\r\n                                <div className={styles.statInfo}>\r\n                                    <span className={styles.statLabel}>AIR QUALITY (AQI)</span>\r\n                                    <div className={styles.statValue}>\r\n                                        {weather.air_quality?.aqi ?? 'N/A'}\r\n                                    </div>\r\n                                    <span className={styles.statDescription} style={{ color: getPollutionStatus(weather.air_quality?.aqi).color, fontWeight: 800 }}>\r\n                                        {getPollutionStatus(weather.air_quality?.aqi).label.toUpperCase()}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </section>\r\n\r\n\r\n\r\n            {/* MOVED: Plant Grid (The Main Content) */}\r\n            <div className=\"container\" id=\"plant-grid\" style={{ scrollMarginTop: '2rem' }}>\r\n                <div className={styles.sectionHeader}>\r\n                    <span className={styles.sectionBadge}>PLANT DISCOVERY</span>\r\n                    <h2 className={styles.sectionTitle}>{weather ? 'SMART MATCHES FOR YOU' : 'GLOBAL SPECIES ARCHIVE'}</h2>\r\n                    <p className={styles.sectionSubtitle}>{weather ? 'Biologically optimized for your current atmospheric zone.' : 'Browse our scientific collection of air-purifying plants.'}</p>\r\n                </div>\r\n\r\n                <div className={styles.filterDiscoverySection} ref={filterSectionRef} style={{ scrollMarginTop: '100px' }}>\r\n\r\n                    <div className={styles.filterWrapper}>\r\n                        <h3 className={styles.filterQuestion}>Which plant are you looking for?</h3>\r\n\r\n                        {/* Column Layout Filter Cards - Matching Shops Design */}\r\n                        <div className={styles.typeFilterContainer}>\r\n                            <div\r\n                                className={`${styles.typeFilterCard} ${filter === 'indoor' ? styles.typeFilterActive : ''}`}\r\n                                onClick={() => {\r\n                                    setFilter(filter === 'indoor' ? 'all' : 'indoor');\r\n                                    scrollToPlants();\r\n                                }}\r\n                            >\r\n                                <div className={styles.typeFilterIcon}>≡ƒÅá</div>\r\n                                <div className={styles.typeFilterInfo}>\r\n                                    <span className={styles.typeFilterName}>Indoor</span>\r\n                                    <span className={styles.typeFilterDesc}>Interior Species</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div\r\n                                className={`${styles.typeFilterCard} ${filter === 'outdoor' ? styles.typeFilterActive : ''}`}\r\n                                onClick={() => {\r\n                                    setFilter(filter === 'outdoor' ? 'all' : 'outdoor');\r\n                                    scrollToPlants();\r\n                                }}\r\n                            >\r\n                                <div className={styles.typeFilterIcon}>≡ƒî▓</div>\r\n                                <div className={styles.typeFilterInfo}>\r\n                                    <span className={styles.typeFilterName}>Outdoor</span>\r\n                                    <span className={styles.typeFilterDesc}>Natural Resilience</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={styles.filterChipGroup}>\r\n                            <span className={styles.statLabel} style={{ fontSize: '0.7rem', marginBottom: '0.5rem', display: 'block' }}>PRECISE SUNLIGHT FILTER</span>\r\n                            <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>\r\n                                {['all', 'low', 'medium', 'high'].map((l) => (\r\n                                    <button\r\n                                        key={l}\r\n                                        className={`${styles.suggestionBtn} ${lightFilter === l ? styles.categoryCardActive : ''}`}\r\n                                        onClick={() => setLightFilter(l as any)}\r\n                                        style={{ padding: '0.5rem 1rem', fontSize: '0.8rem' }}\r\n                                    >\r\n                                        <Sun size={12} style={{ marginRight: '4px', display: 'inline-block' }} />\r\n                                        {l.toUpperCase()}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Aptness Explanation Panel - Premium Glassmorphic Design */}\r\n                <div className={styles.aptnessExplainer}>\r\n                    <div className={styles.explainerGlass}>\r\n                        <div className={styles.explainerHeader}>\r\n                            <Sparkles size={16} className={styles.explainerIcon} />\r\n                            <span className={styles.explainerTitle}>Understanding Aptness Scores</span>\r\n                        </div>\r\n                        <p className={styles.explainerText}>\r\n                            A precision score calculated from your local climate (Temp, Light, Humidity)ΓÇö<strong style={{ color: '#bae6fd' }}>100% means a perfect survival match</strong>.\r\n                        </p>\r\n                        <div className={styles.explainerLegend}>\r\n                            <div className={styles.legendItem}>\r\n                                <div className={styles.legendDot} style={{ background: 'linear-gradient(135deg, #10b981, #059669)' }}></div>\r\n                                <span>90-100%: Optimal Match</span>\r\n                            </div>\r\n                            <div className={styles.legendItem}>\r\n                                <div className={styles.legendDot} style={{ background: 'linear-gradient(135deg, #38bdf8, #0284c7)' }}></div>\r\n                                <span>75-89%: Resilient Fit</span>\r\n                            </div>\r\n                            <div className={styles.legendItem}>\r\n                                <div className={styles.legendDot} style={{ background: 'linear-gradient(135deg, #fb923c, #f97316)' }}></div>\r\n                                <span>50-74%: Moderate Stress</span>\r\n                            </div>\r\n                            <div className={styles.legendItem}>\r\n                                <div className={styles.legendDot} style={{ background: 'linear-gradient(135deg, #f87171, #ef4444)' }}></div>\r\n                                <span>&lt;50%: Non-Viable</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.searchBarWrapper} style={{ margin: '0 auto 3rem auto' }}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search by species name, genus, or air benefit...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className={styles.searchSpeciesInput}\r\n                    />\r\n                </div>\r\n\r\n                <div className={styles.grid} ref={plantsSectionRef} style={{ scrollMarginTop: '80px' }}>\r\n                    {plantsLoading ? (\r\n                        <div style={{ gridColumn: '1 / -1', display: 'flex', flexDirection: 'column', gap: '2rem' }}>\r\n                            {isSlowLoading && (\r\n                                <div style={{ background: 'rgba(251, 191, 36, 0.1)', border: '1px solid rgba(251, 191, 36, 0.2)', padding: '1.5rem', borderRadius: '1rem', textAlign: 'center' }}>\r\n                                    <h3 style={{ color: '#facc15', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>\r\n                                        <AlertCircle size={20} /> Loading Plants...\r\n                                    </h3>\r\n                                    <p style={{ color: '#94a3b8', fontSize: '0.9rem' }}>Getting fresh data from the server...</p>\r\n                                </div>\r\n                            )}\r\n                            <div style={{ display: 'grid', gridTemplateColumns: 'inherit', gap: 'inherit', width: '100%' }}>\r\n                                {[...Array(10)].map((_, i) => <PlantSkeleton key={i} />)}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        displayedPlants.slice(0, visibleLimit).map((plant: Plant, index: number) => (\r\n                            <div\r\n                                key={plant.id}\r\n                                onClick={() => openDetails(plant)}\r\n                                className={styles.fadeIn}\r\n                                style={{\r\n                                    animationDelay: isFromCache ? '0s' : `${Math.min(index * 0.05, 1)}s`,\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            >\r\n                                <PlantCard\r\n                                    plant={plant}\r\n                                    onAdd={handleAddToCart}\r\n                                    score={weather ? plant.score : undefined}\r\n                                    isTopMatch={weather ? (plant.score || 0) >= 100 : false}\r\n                                    priority={index < (window.innerWidth < 768 ? 4 : 6)}\r\n                                    stockStatus={getVendorStats(plant.id)}\r\n                                    hideBuyBtn={true}\r\n                                    hideStockBadge={true}\r\n                                />\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n\r\n                {!plantsLoading && displayedPlants.length > visibleLimit && (\r\n                    <div style={{ textAlign: 'center', marginTop: '3rem', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem' }}>\r\n                        <p style={{ color: 'var(--color-text-dim)', fontSize: '0.9rem', fontWeight: 500 }}>\r\n                            Showing {visibleLimit} of {displayedPlants.length} specimens\r\n                        </p>\r\n                        <Button\r\n                            onClick={() => setVisibleLimit(prev => prev + 12)}\r\n                            variant=\"primary\"\r\n                            size=\"lg\"\r\n                            className={styles.pulseBtn}\r\n                        >\r\n                            Load More <ArrowDown size={18} />\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n\r\n                <div className={styles.suggestionButtonSection} style={{ marginTop: '2rem', marginBottom: '2rem' }}>\r\n                    <Button onClick={() => navigate('/support')} className={styles.suggestionBtn}>\r\n                        <PlusCircle size={18} style={{ marginRight: '8px' }} /> Don't see a plant? Suggest it here\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* MOVED: Intelligence Section (Core Capabilities) */}\r\n            <div className={styles.intelligenceSection} style={{ marginTop: '0' }}>\r\n                <div className={styles.sectionHeader}>\r\n                    <span className={styles.sectionBadge}>CORE CAPABILITIES</span>\r\n                    <h2 className={styles.sectionTitle}>Built for Deep Biological Insights</h2>\r\n                    <p className={styles.sectionSubtitle}>VanaMap bridges the gap between atmospheric science and interior design.</p>\r\n                </div>\r\n                <div className={styles.onboardingGrid} style={{ marginTop: '4rem' }}>\r\n                    {capabilities.map((cap) => (\r\n                        <div\r\n                            key={cap.id}\r\n                            className={`${styles.capabilityCard} ${expandedCards[cap.id] ? styles.cardExpanded : ''}`}\r\n                            onClick={() => toggleCard(cap.id)}\r\n                            role=\"button\"\r\n                            tabIndex={0}\r\n                        >\r\n                            <div className={styles.onboardingIcon} style={{ background: cap.bg, color: cap.color }}>\r\n                                {cap.icon}\r\n                            </div>\r\n                            <h3>{cap.title}</h3>\r\n                            <p>{cap.desc}</p>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* MOVED: Onboarding Section (Personas) */}\r\n            <section className={styles.onboardingSection}>\r\n                <div className={styles.sectionHeader}>\r\n                    <span className={styles.sectionBadge}>WHO ARE YOU?</span>\r\n                    <h2 className={styles.sectionTitle}>Designed for our Community</h2>\r\n                    <p className={styles.sectionSubtitle}>Discover how VanaMap empowers different roles in our green ecosystem.</p>\r\n                </div>\r\n\r\n                <div className={styles.onboardingGrid}>\r\n                    {personas.map((p) => (\r\n                        <div\r\n                            key={p.id}\r\n                            className={`${styles.onboardingCard} ${expandedCards[p.id] ? styles.cardExpanded : ''}`}\r\n                            onClick={() => toggleCard(p.id)}\r\n                            role=\"button\"\r\n                            tabIndex={0}\r\n                        >\r\n                            <div className={styles.onboardingIcon} style={{ background: p.bg, color: p.color }}>\r\n                                {p.icon}\r\n                            </div>\r\n                            <h3>{p.title}</h3>\r\n                            <p>{p.desc}</p>\r\n                            {expandedCards[p.id] && p.id === 'role-vendor' && (\r\n                                <Button\r\n                                    size=\"sm\"\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        navigate('/auth?role=vendor&view=signup');\r\n                                    }}\r\n                                    style={{ marginTop: '1rem', width: '100%', background: p.color, color: 'black', fontWeight: 800 }}\r\n                                >\r\n                                    JOIN AS VENDOR\r\n                                </Button>\r\n                            )}\r\n                            <span className={styles.onboardingMeta}>{p.meta}</span>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </section>\r\n\r\n            {/* Footer Stuff */}\r\n            <div className={styles.sponsorCTA}>\r\n                <div className={styles.sponsorContent}>\r\n                    <div className={styles.sponsorIcon}>\r\n                        <Heart size={32} fill=\"#facc15\" color=\"#facc15\" />\r\n                    </div>\r\n                    <div className={styles.sponsorText}>\r\n                        <h3>Support the Green Future</h3>\r\n                        <p>Partner with VanaMap to help us grow our ecosystem database.</p>\r\n                    </div>\r\n                    <Button onClick={() => navigate('/sponsor')} className={styles.sponsorButton}>\r\n                        Become a Sponsor <MoveRight size={20} style={{ marginLeft: '12px' }} />\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            <div style={{ textAlign: 'center', marginTop: '4rem', marginBottom: '2rem' }}>\r\n                <p style={{ color: 'var(--color-text-dim)', marginBottom: '1rem' }}>Need help with the app?</p>\r\n                <Button\r\n                    onClick={() => navigate('/contact')}\r\n                    variant=\"ghost\"\r\n                    size=\"lg\"\r\n                    style={{ border: '1px solid var(--color-border)', borderRadius: '99px' }}\r\n                >\r\n                    <MessageCircle size={20} style={{ marginRight: '8px' }} /> Contact Support\r\n                </Button>\r\n            </div>\r\n\r\n            <footer style={{\r\n                marginTop: '6rem',\r\n                padding: '4rem 2rem 2rem',\r\n                borderTop: '1px solid var(--color-border)',\r\n                background: 'var(--color-bg-alt)',\r\n                textAlign: 'center'\r\n            }}>\r\n                <div style={{ display: 'flex', gap: '4rem', flexWrap: 'wrap', justifyContent: 'center', marginBottom: '4rem' }}>\r\n                    <div>\r\n                        <p style={{ color: 'var(--color-text-dim)', fontSize: '0.9rem', marginBottom: '1rem' }}>Get it on Mobile</p>\r\n                        <div style={{ padding: '0.75rem', background: 'white', border: '1px solid var(--color-border)', borderRadius: '1rem', display: 'inline-block' }}>\r\n                            <QRCodeSVG value=\"https://www.vanamap.online\" size={120} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ textAlign: 'left' }}>\r\n                        <h4 style={{ color: 'var(--color-text-main)', marginBottom: '1.5rem' }}>Ecosystem</h4>\r\n                        <ul style={{ listStyle: 'none', padding: 0, display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            <li><a href=\"/support\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>Suggestions</a></li>\r\n                            <li><a href=\"/sponsor\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>Sponsorship</a></li>\r\n                            <li><a href=\"/vendor\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>For Vendors</a></li>\r\n                            <li><a href=\"/about\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>About Us</a></li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <p style={{ color: 'var(--color-text-dim)', fontSize: '0.8rem' }}>┬⌐ 2025 VanaMap - Earth's Digital Botanical Archive</p>\r\n            </footer>\r\n\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Leaderboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[334,337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[334,337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[354,357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[354,357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1242,1245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1242,1245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3299,3302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3299,3302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Crown, MapPin, Building, Sprout, TrendingUp, Users, ArrowRight } from 'lucide-react';\r\nimport { fetchLeaderboard } from '../services/api';\r\nimport styles from './Leaderboard.module.css';\r\n\r\ninterface LeaderboardData {\r\n    users: any[];\r\n    cities: any[];\r\n}\r\n\r\nexport const Leaderboard = () => {\r\n    const [data, setData] = useState<LeaderboardData>({ users: [], cities: [] });\r\n    const [loading, setLoading] = useState(true);\r\n    const [showPromo, setShowPromo] = useState(false);\r\n\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        const load = async () => {\r\n            try {\r\n                // Safety timeout: If fetch hangs for >10s, stop loading\r\n                const timeoutPromise = new Promise((_, reject) =>\r\n                    setTimeout(() => reject(new Error(\"Request timeout\")), 10000)\r\n                );\r\n\r\n                const dataPromise = fetchLeaderboard();\r\n                const res = await Promise.race([dataPromise, timeoutPromise]) as LeaderboardData;\r\n\r\n                if (isMounted) setData(res);\r\n            } catch (e: any) {\r\n                console.error(\"Leaderboard load failed\", e);\r\n                if (isMounted) setError(e.message || \"Failed to load rankings\");\r\n            } finally {\r\n                if (isMounted) setLoading(false);\r\n            }\r\n        };\r\n        load();\r\n\r\n        // Show Promo\r\n        const hasSeenPromo = sessionStorage.getItem('seenLeaderboardPromo');\r\n        if (!hasSeenPromo) {\r\n            setShowPromo(true);\r\n            sessionStorage.setItem('seenLeaderboardPromo', 'true');\r\n        }\r\n\r\n        return () => { isMounted = false; };\r\n    }, []);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    // DYNAMIC QUESTS: Rotate based on day of year to keep it fresh!\r\n    const today = new Date();\r\n    const dayOfYear = Math.floor((today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) / 1000 / 60 / 60 / 24);\r\n\r\n    // Pool of missions - Easy for kids, engaging for adults\r\n    const missionPool = [\r\n        { title: 'Morning Scout', desc: 'Tap to find 3 plants near you!', points: 50, path: '/', action: 'search' },\r\n        { title: 'Green Shopper', desc: 'Tap to visit a plant shop.', points: 100, path: '/shops', action: 'shop' },\r\n        { title: 'Wise Reader', desc: 'Tap to read today\\'s news.', points: 30, path: '/daily-news', action: 'read' },\r\n        { title: 'Forest Hero', desc: 'Tap to play the Forest Game!', points: 50, path: '/forest-game', action: 'game' },\r\n        { title: 'Pot Designer', desc: 'Tap to paint a new pot!', points: 75, path: '/pot-designer', action: 'design' },\r\n        { title: 'Weather Watch', desc: 'Tap to check local weather.', points: 20, path: '/', action: 'weather' }\r\n    ];\r\n\r\n    // Select 3 missions based on the day automatically\r\n    const quests = [\r\n        { ...missionPool[dayOfYear % missionPool.length], id: 1, status: 'Active' },\r\n        { ...missionPool[(dayOfYear + 1) % missionPool.length], id: 2, status: 'Pending' },\r\n        { ...missionPool[(dayOfYear + 2) % missionPool.length], id: 3, status: 'Completed' }\r\n    ];\r\n\r\n    const handleQuestClick = (q: any) => {\r\n        // Simple and clear messaging\r\n        if (q.status === 'Completed') return;\r\n\r\n        // Persist mission\r\n        sessionStorage.setItem('active_quest', JSON.stringify({ id: q.id, action: q.action, points: q.points, title: q.title }));\r\n\r\n        // Go there\r\n        navigate(q.path);\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{\r\n                display: 'flex', height: '100vh', alignItems: 'center', justifyContent: 'center',\r\n                color: '#94a3b8', flexDirection: 'column', gap: '1rem', fontSize: '0.9rem'\r\n            }}>\r\n                <div style={{ width: 30, height: 30, border: '2px solid #10b981', borderTopColor: 'transparent', borderRadius: '50%', animation: 'spin 1s linear infinite' }}></div>\r\n                <span>Analyzing Ecosystem...</span>\r\n                <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // In case of error, we just render with empty/initial data, but maybe log it.\r\n    // The user will see empty leaderboard but at least the UI loads.\r\n    if (error) {\r\n        console.warn(\"Rendering Leaderboard in fallback state due to error:\", error);\r\n    }\r\n\r\n    // Sort top 3 for podium\r\n    const top3 = data.users.slice(0, 3);\r\n    const rest = data.users.slice(3);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            {/* PROMO MODAL */}\r\n            {showPromo && (\r\n                <div className={styles.modalOverlay}>\r\n                    <div className={styles.modalCard}>\r\n                        <div className={styles.modalBadge}>LIMITED TIME OFFER</div>\r\n                        <Crown size={48} className=\"text-yellow-400 mx-auto mb-4 animate-bounce\" />\r\n                        <h2 className={styles.modalTitle}>Become an Elite Guardian</h2>\r\n                        <p className={styles.modalText}>\r\n                            Reach <strong>2,000 Chlorophyll Points</strong> and unlock\r\n                            <br />\r\n                            <span className=\"text-emerald-400 font-bold text-lg\">1 YEAR FREE PREMIUM</span>\r\n                        </p>\r\n                        <button onClick={() => setShowPromo(false)} className={styles.modalBtn}>\r\n                            Challenge Accepted\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <header className={styles.header}>\r\n                <div className={styles.badge}>\r\n                    <Users size={11} /> Top Gardeners\r\n                </div>\r\n                <h1 className={styles.title}>Star Guardians</h1>\r\n                <p className={styles.subtitle}>\r\n                    See who is saving the planet!\r\n                </p>\r\n            </header>\r\n\r\n            {/* DAILY QUESTS BAR */}\r\n            <div className={styles.questBar}>\r\n                <div className={styles.questHeader}>\r\n                    <TrendingUp size={16} className=\"text-emerald-400\" />\r\n                    <span>Your Daily Missions</span>\r\n                </div>\r\n                <div className={styles.questGrid}>\r\n                    {quests.map(q => (\r\n                        <div\r\n                            key={q.id}\r\n                            onClick={() => handleQuestClick(q)}\r\n                            className={`${styles.questItem} ${q.status === 'Completed' ? styles.questDone : ''}`}\r\n                            style={{ cursor: q.status === 'Completed' ? 'default' : 'pointer' }}\r\n                        >\r\n                            <div className={styles.questInfo}>\r\n                                <span className={styles.questTitle}>{q.title}</span>\r\n                                <span className={styles.questDesc}>{q.desc}</span>\r\n                            </div>\r\n                            <div className={styles.questReward}>\r\n                                +{q.points} CP\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            {/* PODIUM SECTION */}\r\n            <div className={styles.podium}>\r\n                {/* 2nd Place */}\r\n                {top3[1] && (\r\n                    <div className={`${styles.podiumCard} ${styles.silver}`}>\r\n                        <div className={styles.avatar}>{top3[1].name.charAt(0)}</div>\r\n                        <h3 className={styles.userName}>{top3[1].name}</h3>\r\n                        <div className={styles.userPoints}>{top3[1].points.toLocaleString()}</div>\r\n                        <div className={styles.pointsLabel}>CP</div>\r\n                        <div className={styles.location}>\r\n                            <MapPin size={10} /> <span>{top3[1].city || 'Earth'}</span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* 1st Place */}\r\n                {top3[0] && (\r\n                    <div className={`${styles.podiumCard} ${styles.gold}`}>\r\n                        <Crown className={styles.crow} size={32} />\r\n                        <div className={styles.avatar}>{top3[0].name.charAt(0)}</div>\r\n                        <h3 className={styles.userName}>{top3[0].name}</h3>\r\n                        <div className={styles.userPoints}>{top3[0].points.toLocaleString()}</div>\r\n                        <div className={styles.pointsLabel}>CP</div>\r\n                        <div className={styles.location}>\r\n                            <MapPin size={10} /> <span>{top3[0].city || 'Earth'}</span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* 3rd Place */}\r\n                {top3[2] && (\r\n                    <div className={`${styles.podiumCard} ${styles.bronze}`}>\r\n                        <div className={styles.avatar}>{top3[2].name.charAt(0)}</div>\r\n                        <h3 className={styles.userName}>{top3[2].name}</h3>\r\n                        <div className={styles.userPoints}>{top3[2].points.toLocaleString()}</div>\r\n                        <div className={styles.pointsLabel}>CP</div>\r\n                        <div className={styles.location}>\r\n                            <MapPin size={10} /> <span>{top3[2].city || 'Earth'}</span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className={styles.contentGrid}>\r\n                {/* COLUMN 1: GLOBAL RANKINGS */}\r\n                <div>\r\n                    <h2 className={styles.sectionTitle}>\r\n                        <Users size={16} className=\"text-indigo-400\" /> Global Elite\r\n                    </h2>\r\n\r\n                    <div className={styles.tableContainer}>\r\n                        {rest.map((user, idx) => (\r\n                            <div key={idx} className={styles.row}>\r\n                                <span className={styles.rankNumber}>#{idx + 4}</span>\r\n                                <div className={styles.smallAvatar}>{user.name.charAt(0)}</div>\r\n                                <div className={styles.userInfo}>\r\n                                    <span className={styles.name}>{user.name}</span>\r\n                                    <span className={styles.levelText}>{user.city || 'Global'} ΓÇó Lvl {user.gameLevel || 1}</span>\r\n                                </div>\r\n                                <div className={styles.rowPoints}>{user.points.toLocaleString()}</div>\r\n                            </div>\r\n                        ))}\r\n                        {rest.length === 0 && (\r\n                            <div style={{ textAlign: 'center', padding: '2rem', color: '#64748b', fontSize: '0.85rem' }}>No other rankings yet.</div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* COLUMN 2: EARN GUIDE & ZONES */}\r\n                <div className=\"flex flex-col gap-6\">\r\n                    {/* EARN INFO CARD */}\r\n                    <div className={styles.infoCard}>\r\n                        <h3 className={styles.infoTitle}>How to Earn CP?</h3>\r\n                        <ul className={styles.earnList}>\r\n                            <li>\r\n                                <span className={styles.earnIcon}>≡ƒÄ«</span>\r\n                                <div>\r\n                                    <strong>Play Canopy Hero</strong>\r\n                                    <span>+10 CP per session</span>\r\n                                </div>\r\n                            </li>\r\n                            <li>\r\n                                <span className={styles.earnIcon}>≡ƒ¢ì∩╕Å</span>\r\n                                <div>\r\n                                    <strong>Shop Green</strong>\r\n                                    <span>+50 CP per purchase</span>\r\n                                </div>\r\n                            </li>\r\n                            <li>\r\n                                <span className={styles.earnIcon}>≡ƒî▒</span>\r\n                                <div>\r\n                                    <strong>Identify Plants</strong>\r\n                                    <span>+5 CP per scan</span>\r\n                                </div>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <h2 className={styles.sectionTitle}>\r\n                            <Building size={16} className=\"text-emerald-400\" /> Top Zones\r\n                        </h2>\r\n\r\n                        <div>\r\n                            {data.cities.length > 0 ? data.cities.map((cityData, idx) => (\r\n                                <div key={idx} className={styles.cityCard}>\r\n                                    <div className={styles.cityIcon}>\r\n                                        <TrendingUp size={18} />\r\n                                    </div>\r\n                                    <div className={styles.cityInfo}>\r\n                                        <span className={styles.cityName}>{cityData._id.city || 'Wilderness'}</span>\r\n                                        <div className={styles.cityMeta}>\r\n                                            {cityData.userCount} Citizens\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className={styles.cityPointsValue}>{cityData.totalPoints.toLocaleString()}</div>\r\n                                </div>\r\n                            )) : (\r\n                                <div style={{ color: '#64748b', textAlign: 'center', padding: '2rem', fontSize: '0.85rem' }}>\r\n                                    No urban ecosystem data yet.\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* CALL TO ACTION */}\r\n            <div className={styles.ctaBox}>\r\n                <Sprout size={32} color=\"#10b981\" style={{ marginBottom: '1rem', display: 'inline-block' }} />\r\n                <h2 style={{ color: 'white', fontSize: '1.2rem', fontWeight: 700, margin: '0 0 0.5rem' }}>Climb the Ranks</h2>\r\n                <p style={{ color: '#94a3b8', fontSize: '0.9rem', margin: '0 auto 1rem', maxWidth: '400px' }}>\r\n                    Grow your collection to earn CP and lead your city.\r\n                </p>\r\n                <button\r\n                    onClick={() => window.location.href = '/shops'}\r\n                    className={styles.ctaBtn}\r\n                    onMouseOver={(e) => e.currentTarget.style.transform = 'translateY(-2px)'}\r\n                    onMouseOut={(e) => e.currentTarget.style.transform = 'translateY(0)'}\r\n                >\r\n                    Get Plans <ArrowRight size={14} style={{ display: 'inline', marginLeft: 4 }} />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\MakeItReal.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'stopCamera'. Either include it or remove the dependency array.","line":83,"column":8,"nodeType":"ArrayExpression","endLine":83,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [stopCamera]","fix":{"range":[2915,2917],"text":"[stopCamera]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Nearby.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":206,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":206,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'fallbackErr' is defined but never used.","line":244,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":244,"endColumn":37}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { fetchVendors, seedDatabase, logVendorContact } from '../services/api';\r\nimport { getDistanceFromLatLonInKm, formatDistance } from '../utils/logic';\r\nimport type { Vendor } from '../types';\r\nimport { MessageCircle, MapPin, ExternalLink, RefreshCw, AlertCircle, Star, Sparkles, Search, Zap } from 'lucide-react';\r\nimport { Button } from '../components/common/Button';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useCart } from '../context/CartContext';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './Nearby.module.css';\r\n\r\ninterface OSMElement {\r\n    id: number;\r\n    lat: number;\r\n    lon: number;\r\n    tags?: {\r\n        name?: string;\r\n        shop?: string;\r\n        landuse?: string;\r\n        \"addr:full\"?: string;\r\n        \"addr:street\"?: string;\r\n        \"addr:city\"?: string;\r\n        phone?: string;\r\n        \"contact:phone\"?: string;\r\n        \"contact:whatsapp\"?: string;\r\n        [key: string]: string | undefined;\r\n    };\r\n}\r\n\r\n// Leaflet icon setup\r\nimport icon from 'leaflet/dist/images/marker-icon.png';\r\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\r\n\r\nconst DefaultIcon = L.icon({\r\n    iconUrl: icon,\r\n    shadowUrl: iconShadow,\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41]\r\n});\r\nL.Marker.prototype.options.icon = DefaultIcon;\r\n\r\nfunction ChangeView({ center }: { center: [number, number] }) {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        map.setView(center, map.getZoom());\r\n    }, [center, map]);\r\n    return null;\r\n}\r\n\r\nexport const Nearby = () => {\r\n    const { user } = useAuth();\r\n    const { items } = useCart();\r\n    const location = useLocation(); // Hook usage\r\n    const [position, setPosition] = useState<[number, number] | null>(null);\r\n    const [placeName, setPlaceName] = useState<string>(\"\");\r\n    const [nearbyVendors, setNearbyVendors] = useState<Vendor[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Initialize tab from navigation state or default to verified\r\n    const [activeTab, setActiveTab] = useState<'verified' | 'unverified' | 'all'>((location.state as { tab?: 'verified' | 'unverified' | 'all' })?.tab || 'all');\r\n\r\n    const [manualSearchQuery, setManualSearchQuery] = useState('');\r\n    const [searchRadius, setSearchRadius] = useState(50);\r\n    const [isScanningPublic, setIsScanningPublic] = useState(false);\r\n    const hasInitialLocateRef = useRef(false);\r\n\r\n    const handleManualLocationSearch = async () => {\r\n        if (!manualSearchQuery.trim()) return;\r\n        setLoading(true);\r\n        const tid = toast.loading(`Scanning satellite data for \"${manualSearchQuery}\"...`);\r\n\r\n        try {\r\n            // Forward Geocoding\r\n            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(manualSearchQuery)}`);\r\n            const data = await res.json();\r\n\r\n            if (data && data.length > 0) {\r\n                const { lat, lon, display_name } = data[0];\r\n                const latitude = parseFloat(lat);\r\n                const longitude = parseFloat(lon);\r\n\r\n                setPosition([latitude, longitude]);\r\n                setPlaceName(display_name.split(',')[0]); // Take safe first part\r\n                toast.success(\"Target area locked!\", { id: tid });\r\n\r\n                await fetchAllData(latitude, longitude, searchRadius);\r\n            } else {\r\n                toast.error(\"Location signature not found.\", { id: tid });\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            toast.error(\"Network triangulation failed.\", { id: tid });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchAllData = async (lat: number, lng: number, radiusKm: number) => {\r\n        setLoading(true);\r\n        setIsScanningPublic(true); // Start background scan tracker\r\n\r\n        let verifiedVendors: Vendor[] = [];\r\n\r\n        try {\r\n            // Reverse Geocoding\r\n            try {\r\n                const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);\r\n                const geoData = await geoRes.json();\r\n                if (geoData.address) {\r\n                    const city = geoData.address.city || geoData.address.town || geoData.address.village || geoData.address.suburb || \"Unknown Area\";\r\n                    setPlaceName(city);\r\n                }\r\n            } catch (e) {\r\n                console.warn(\"Geocoding failed\", e);\r\n            }\r\n\r\n            // 1. Fetch Backend Data (Fast)\r\n            let allVendors = await fetchVendors();\r\n            if (allVendors.length === 0) {\r\n                const { VENDORS } = await import('../data/mocks');\r\n                seedDatabase([], VENDORS);\r\n                allVendors = await fetchVendors();\r\n            }\r\n            verifiedVendors = allVendors.filter(v => v.verified === true);\r\n\r\n            // Initial Render with Verified Data ONLY\r\n            const nearbyBackend = verifiedVendors\r\n                .filter(v => getDistanceFromLatLonInKm(lat, lng, v.latitude, v.longitude) <= radiusKm)\r\n                .map(v => ({ ...v, distance: getDistanceFromLatLonInKm(lat, lng, v.latitude, v.longitude) }))\r\n                .sort((a, b) => (a.distance || 0) - (b.distance || 0));\r\n\r\n            setNearbyVendors(nearbyBackend);\r\n            setLoading(false); // <--- UNBLOCK UI FOR VERIFIED VENDORS IMMEDIATELY\r\n\r\n            // 2. Fetch OSM Data (Slower)\r\n            const radiusMeters = radiusKm * 1000;\r\n            const overpassQuery = `\r\n[out:json][timeout:25];\r\n(\r\n    node[\"shop\"=\"garden_centre\"](around:${radiusMeters},${lat},${lng});\r\n    node[\"shop\"=\"garden\"](around:${radiusMeters},${lat},${lng});\r\n    node[\"leisure\"=\"garden\"](around:${radiusMeters},${lat},${lng});\r\n    node[\"tourism\"=\"botanical_garden\"](around:${radiusMeters},${lat},${lng});\r\n    node[\"landuse\"=\"plant_nursery\"][\"name\"](around:${radiusMeters},${lat},${lng});\r\n);\r\nout body;\r\n>;\r\nout skel qt;\r\n`;\r\n\r\n            let unverifiedVendors: Vendor[] = [];\r\n            try {\r\n                const osmRes = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(overpassQuery)}`);\r\n                const osmData = await osmRes.json();\r\n                if (osmData.elements) {\r\n                    unverifiedVendors = osmData.elements\r\n                        .filter((el: OSMElement) => {\r\n                            if (!el.lat || !el.lon) return false;\r\n                            const tags = el.tags || {};\r\n                            const name = tags.name || \"Unknown Garden\";\r\n                            const nameLower = name.toLowerCase();\r\n                            const excludeKeywords = ['hardware', 'supermarket', 'grocery', 'general store', 'convenience', 'department store'];\r\n                            if (excludeKeywords.some(keyword => nameLower.includes(keyword))) return false;\r\n                            return true;\r\n                        })\r\n                        .map((el: OSMElement) => {\r\n                            const tags = el.tags || {};\r\n                            let category = \"Garden\";\r\n                            if (tags.shop === 'garden_centre' || tags.landuse === 'plant_nursery') {\r\n                                category = \"Plant Shop\";\r\n                            }\r\n\r\n                            return {\r\n                                id: `osm-${el.id}`,\r\n                                name: tags.name || (category === 'Garden' ? \"Public Garden\" : \"Local Nursery\"),\r\n                                latitude: el.lat,\r\n                                longitude: el.lon,\r\n                                address: tags[\"addr:full\"] || tags[\"addr:street\"] || tags[\"addr:city\"] || (category === 'Garden' ? \"Public Space\" : \"Local Listing\"),\r\n                                phone: tags.phone || tags[\"contact:phone\"] || \"N/A\",\r\n                                whatsapp: tags[\"contact:whatsapp\"] || \"\",\r\n                                verified: false,\r\n                                highlyRecommended: false,\r\n                                category: category,\r\n                                inventoryIds: []\r\n                            };\r\n                        });\r\n                }\r\n            } catch (err) { console.error(\"OSM Error\", err); }\r\n\r\n            // 3. Merge and Update with Public Data\r\n            // We re-filter everything to ensure distance correctness and sort order\r\n            const nearbyPublic = unverifiedVendors\r\n                .filter(v => getDistanceFromLatLonInKm(lat, lng, v.latitude, v.longitude) <= radiusKm)\r\n                .map(v => ({ ...v, distance: getDistanceFromLatLonInKm(lat, lng, v.latitude, v.longitude) }));\r\n\r\n            // Merge with previous backend results (re-calculate backend to be safe or use state setter)\r\n            // Using state setter is safer if user moved map, but here we are in one flow.\r\n            // Actually, we can just re-merge nearbyBackend and nearbyPublic.\r\n\r\n            const combined = [...nearbyBackend, ...nearbyPublic].sort((a, b) => (a.distance || 0) - (b.distance || 0));\r\n            setNearbyVendors(combined);\r\n\r\n        } catch (e) {\r\n            setLoading(false);\r\n        } finally {\r\n            setIsScanningPublic(false);\r\n        }\r\n    };\r\n\r\n    const handleGetLocation = useCallback((isManual = false) => {\r\n        if (loading) return;\r\n        const tid = isManual ? toast.loading(\"Syncing with satellite...\") : null;\r\n        setLoading(true);\r\n\r\n        if (!navigator.geolocation) {\r\n            if (tid) toast.error(\"GPS Not Supported\", { id: tid });\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        navigator.geolocation.getCurrentPosition(\r\n            async (pos) => {\r\n                const { latitude, longitude } = pos.coords;\r\n                setPosition([latitude, longitude]);\r\n                if (tid) toast.success(\"Satellites locked!\", { id: tid });\r\n                await fetchAllData(latitude, longitude, searchRadius);\r\n            },\r\n            async (err) => {\r\n                console.warn(`GPS failed: ${err.message}. Trying IP fallback...`);\r\n                try {\r\n                    const response = await fetch('https://ipapi.co/json/');\r\n                    const data = await response.json();\r\n                    if (data.latitude && data.longitude) {\r\n                        const { latitude, longitude, city } = data;\r\n                        setPosition([latitude, longitude]);\r\n                        if (tid) toast.success(`Located via IP: ${city || \"approximate\"}`, { id: tid });\r\n                        await fetchAllData(latitude, longitude, searchRadius);\r\n                    } else {\r\n                        throw new Error(\"No data\");\r\n                    }\r\n                } catch (fallbackErr) {\r\n                    if (tid) toast.error(\"Location tracking unavailable\", { id: tid });\r\n                    setPosition(prev => prev || [28.6139, 77.2090]); // Fallback to Delhi\r\n                    setLoading(false);\r\n                }\r\n            },\r\n            { enableHighAccuracy: true, timeout: 8000 }\r\n        );\r\n    }, [loading, searchRadius]); // Added searchRadius dependency\r\n\r\n    useEffect(() => {\r\n        if (!hasInitialLocateRef.current) {\r\n            hasInitialLocateRef.current = true;\r\n            handleGetLocation(false);\r\n        }\r\n    }, [handleGetLocation]);\r\n\r\n    const displayVendors = nearbyVendors.filter(v => {\r\n        if (activeTab === 'all') return true;\r\n        return activeTab === 'verified' ? v.verified : !v.verified;\r\n    });\r\n\r\n    const resultsHeaderRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        // Scroll logic only if really loaded or we have some vendors\r\n        if (!loading && displayVendors.length > 0 && position) {\r\n            // Scroll to first outlet after short delay for map zoom\r\n            setTimeout(() => {\r\n                resultsHeaderRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n            }, 800);\r\n        }\r\n    }, [loading, displayVendors.length, position]);\r\n\r\n    return (\r\n        <div className={styles.nearbyContainer}>\r\n            <div className={styles.noticeBanner} style={{ background: 'rgba(16, 185, 129, 0.1)', border: '1px solid rgba(16, 185, 129, 0.2)' }}>\r\n                <MapPin className={styles.noticeIcon} size={20} color=\"#10b981\" />\r\n                <div className={styles.noticeText} style={{ color: '#ecfdf5' }}>\r\n                    {placeName ? (\r\n                        <>\r\n                            <span style={{ color: '#34d399', fontWeight: 700 }}>{placeName.toUpperCase()}</span> ΓÇö Identifying nearby green spaces...\r\n                        </>\r\n                    ) : (\r\n                        <>\r\n                            <span>GPS Active:</span> Finding the best plant shops around you.\r\n                        </>\r\n                    )}\r\n                </div>\r\n                <Button variant=\"outline\" size=\"sm\" onClick={() => handleGetLocation(true)} disabled={loading} style={{ marginLeft: 'auto', borderColor: 'rgba(255,255,255,0.2)', color: 'white' }}>\r\n                    <RefreshCw size={14} className={loading ? 'animate-spin' : ''} /> Refresh GPS\r\n                </Button>\r\n            </div>\r\n\r\n            <div className={styles.headerSection} style={{ textAlign: 'center', marginBottom: '3rem' }}>\r\n                <h1 className={styles.title} style={{ fontSize: '2.5rem', fontWeight: 900, marginBottom: '0.5rem' }}>Plant Shops Near You</h1>\r\n                <p className={styles.subtitle} style={{ fontSize: '1.1rem', color: '#94a3b8', maxWidth: '600px', margin: '0 auto' }}>\r\n                    Find trusted local nurseries and garden centers in your neighborhood.\r\n                </p>\r\n            </div>\r\n\r\n            <div className={styles.splitLayout}>\r\n                <div className={styles.mapWrapper}>\r\n                    {/* Search by Location Bar Moved Above Map */}\r\n                    <div className={styles.mapSearchBarContainer} style={{ background: 'var(--color-bg-card)', padding: '1rem', borderRadius: '1rem', marginBottom: '1rem', border: '1px solid var(--glass-border)' }}>\r\n                        <div className={styles.mapSearchBar} style={{ marginBottom: '1rem' }}>\r\n                            <div className={styles.mapSearchInput}>\r\n                                <Search size={18} className={styles.mapSearchIcon} />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Search city, neighborhood, or zip...\"\r\n                                    value={manualSearchQuery}\r\n                                    onChange={(e) => setManualSearchQuery(e.target.value)}\r\n                                    onKeyDown={(e) => e.key === 'Enter' && handleManualLocationSearch()}\r\n                                />\r\n                            </div>\r\n                            <Button onClick={handleManualLocationSearch} disabled={loading} size=\"sm\" style={{ minWidth: '100px', height: '48px' }}>\r\n                                {loading ? <RefreshCw className=\"animate-spin\" size={20} /> : 'Search'}\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {/* Radius Slider Control */}\r\n                        <div style={{ padding: '0 0.5rem' }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem', fontSize: '0.85rem', color: 'var(--color-text-muted)', fontWeight: 600 }}>\r\n                                <span style={{ display: 'flex', alignItems: 'center', gap: '6px' }}><Zap size={14} className=\"text-yellow-400\" /> Search Radius</span>\r\n                                <span style={{ color: 'var(--color-text-main)' }}>{searchRadius} km</span>\r\n                            </div>\r\n                            <input\r\n                                type=\"range\"\r\n                                min=\"1\"\r\n                                max=\"1000\"\r\n                                value={searchRadius}\r\n                                className=\"no-swipe\"\r\n                                onChange={(e) => setSearchRadius(Number(e.target.value))}\r\n                                onMouseUp={() => position && fetchAllData(position[0], position[1], searchRadius)}\r\n                                onTouchEnd={() => position && fetchAllData(position[0], position[1], searchRadius)}\r\n                                style={{ width: '100%', cursor: 'pointer', height: '6px', background: 'rgba(255,255,255,0.1)', borderRadius: '3px', accentColor: 'var(--color-primary)' }}\r\n                            />\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '4px', fontSize: '0.7rem', color: 'rgba(255,255,255,0.3)' }}>\r\n                                <span>1km</span>\r\n                                <span>1000km</span>\r\n                            </div>\r\n                            {searchRadius > 600 && (\r\n                                <div style={{ fontSize: '0.75rem', color: '#facc15', marginTop: '0.5rem', display: 'flex', alignItems: 'center', gap: '6px', animation: 'fadeIn 0.3s' }}>\r\n                                    <AlertCircle size={12} /> Pro Tip: For global searches, try typing the city name in the box above.\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.mapContainer}>\r\n                        {position ? (\r\n                            <MapContainer center={position} zoom={11} style={{ height: '100%', width: '100%' }}>\r\n                                <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\r\n                                <ChangeView center={position} />\r\n                                <Marker position={position} icon={L.divIcon({\r\n                                    className: 'u-marker',\r\n                                    html: `<div style=\"background:transparent;width:30px;height:30px;display:flex;align-items:center;justify-content:center;\"><div style=\"background:var(--color-primary);width:14px;height:14px;border-radius:50%;border:2px solid #fff;box-shadow:0 0 15px var(--color-primary)\"></div></div>`\r\n                                })}><Popup>Origin point (You)</Popup></Marker>\r\n                                {displayVendors.map(v => (\r\n                                    <Marker key={v.id} position={[v.latitude, v.longitude]}>\r\n                                        <Popup><strong>{v.name}</strong><br />{formatDistance((v.distance || 0) * 1000)} away</Popup>\r\n                                    </Marker>\r\n                                ))}\r\n                            </MapContainer>\r\n                        ) : (\r\n                            <div style={{ background: 'var(--color-bg-card)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--color-text-muted)' }}>\r\n                                Initializing precision tracking...\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.resultsSection}>\r\n                    <div className={styles.resultsHeader} ref={resultsHeaderRef} style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem', scrollMarginTop: '2rem' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>\r\n                            <h3 style={{ margin: 0, fontSize: '1.25rem', fontWeight: 800 }}>Nearby Outlets ({displayVendors.length})</h3>\r\n\r\n                        </div>\r\n                        {/* Subtitle - hidden on very small screens via CSS/Inline if needed, but simpler text helps */}\r\n                        <p style={{ margin: '-0.25rem 0 0 0', fontSize: '0.75rem', color: 'var(--color-text-muted)', maxWidth: '100%', overflow: 'hidden', whiteSpace: 'nowrap', textOverflow: 'ellipsis' }}>\r\n                            Showing results within a {searchRadius}km radius\r\n                        </p>\r\n\r\n                        {/* ACTIVE SCANNER INDICATOR */}\r\n                        {isScanningPublic && (\r\n                            <div style={{ fontSize: '0.75rem', color: '#38bdf8', display: 'flex', alignItems: 'center', gap: '6px', marginTop: '0.25rem' }}>\r\n                                <RefreshCw size={10} className=\"animate-spin\" /> Updating public listings...\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className={styles.tabGroup} style={{ width: '100%', display: 'flex', gap: '0.5rem', overflowX: 'auto', paddingBottom: '4px' }}>\r\n                            <button className={`${styles.tabBtn} ${activeTab === 'all' ? styles.active : ''}`} onClick={() => setActiveTab('all')} style={{ flex: 1, justifyContent: 'center', whiteSpace: 'nowrap' }}>\r\n                                <Sparkles size={16} fill={activeTab === 'all' ? 'var(--color-primary)' : 'none'} /> All\r\n                            </button>\r\n                            <button className={`${styles.tabBtn} ${activeTab === 'verified' ? styles.active : ''}`} onClick={() => setActiveTab('verified')} style={{ flex: 1, justifyContent: 'center', whiteSpace: 'nowrap' }}>\r\n                                <Star size={16} fill={activeTab === 'verified' ? 'var(--color-text-main)' : 'none'} /> Verified\r\n                            </button>\r\n                            <button className={`${styles.tabBtn} ${activeTab === 'unverified' ? styles.active : ''}`} onClick={() => setActiveTab('unverified')} style={{ flex: 1, justifyContent: 'center', whiteSpace: 'nowrap' }}>\r\n                                <AlertCircle size={16} /> Public\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Public/All Tab Warning Hint Actions - Shown only when no results found AND not scanning */}\r\n                    {!loading && !isScanningPublic && (activeTab === 'unverified' || activeTab === 'all') && displayVendors.length === 0 && (\r\n                        <div style={{\r\n                            marginBottom: '1rem',\r\n                            padding: '1rem',\r\n                            background: 'var(--color-bg-card)',\r\n                            border: '1px solid var(--glass-border)',\r\n                            borderRadius: '16px',\r\n                            boxShadow: '0 4px 15px rgba(0,0,0,0.05)',\r\n                            display: 'flex',\r\n                            flexDirection: 'column', // Ensures vertical layout\r\n                            gap: '1rem',\r\n                            animation: 'fadeIn 0.5s ease-out'\r\n                        }}>\r\n                            <div style={{ display: 'flex', gap: '0.8rem', alignItems: 'flex-start' }}>\r\n                                <div style={{\r\n                                    padding: '10px',\r\n                                    background: 'rgba(234, 179, 8, 0.1)',\r\n                                    borderRadius: '12px',\r\n                                    flexShrink: 0\r\n                                }}>\r\n                                    <AlertCircle size={20} color=\"#fbbf24\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h4 style={{ margin: '0 0 4px 0', fontSize: '0.95rem', fontWeight: 700 }}>Don't see any shops?</h4>\r\n                                    <p style={{ margin: 0, fontSize: '0.85rem', lineHeight: '1.4', color: 'var(--color-text-muted)' }}>\r\n                                        The map might be looking in the wrong spot. Sync your GPS to find public nurseries near you.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <Button\r\n                                size=\"md\"\r\n                                onClick={() => handleGetLocation(false)}\r\n                                style={{\r\n                                    width: '100%',\r\n                                    background: 'var(--color-text-main)',\r\n                                    color: 'var(--color-bg-main)',\r\n                                    borderRadius: '10px',\r\n                                    fontWeight: 600,\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center',\r\n                                    gap: '8px'\r\n                                }}\r\n                            >\r\n                                <MapPin size={16} /> Sync My Location\r\n                            </Button>\r\n                        </div>\r\n                    )}\r\n\r\n                    {loading ? (\r\n                        <div style={{ padding: '2rem', textAlign: 'center', animation: 'fadeIn 0.3s' }}>\r\n                            <div className=\"pulse-fast\" style={{ display: 'inline-block', marginBottom: '1rem' }}>\r\n                                <Zap size={56} color=\"#facc15\" fill=\"#facc15\" style={{ filter: 'drop-shadow(0 0 10px #facc15)' }} />\r\n                            </div>\r\n                            <h3 style={{ color: '#facc15', margin: '0 0 0.5rem', fontWeight: 800 }}>Searching for Vendors...</h3>\r\n                            <p style={{ color: 'var(--color-text-muted)', fontSize: '0.9rem' }}>Scanning nearby network at lightning speed</p>\r\n                            <style>{`\r\n                                @keyframes pulseFast {\r\n                                    0% { transform: scale(1); opacity: 1; }\r\n                                    50% { transform: scale(1.15); opacity: 0.8; }\r\n                                    100% { transform: scale(1); opacity: 1; }\r\n                                }\r\n                                .pulse-fast { animation: pulseFast 0.6s infinite ease-in-out; }\r\n                            `}</style>\r\n                        </div>\r\n                    ) : displayVendors.length === 0 && activeTab === 'verified' ? (\r\n                        <div style={{ textAlign: 'center', padding: '4rem', background: 'var(--color-bg-card)', borderRadius: '2rem', border: '1px dashed var(--glass-border)' }}>\r\n                            <MapPin size={48} color=\"var(--color-text-muted)\" style={{ marginBottom: '1rem' }} />\r\n                            <p style={{ color: 'var(--color-text-muted)' }}>No confirmed partners found. Try the 'Public' tab.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <>\r\n                            <div className={styles.vendorGrid}>\r\n                                {displayVendors.map(vendor => (\r\n                                    <div key={vendor.id} className={`${styles.vendorCard} ${vendor.highlyRecommended ? styles.premiumCard : ''}`}>\r\n                                        <div className={styles.cardContentWrapper}>\r\n                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.2rem' }}>\r\n                                                <h4 className={styles.vendorName}>{vendor.name} {vendor.verified && <Star size={14} fill=\"var(--color-primary)\" color=\"var(--color-primary)\" style={{ display: 'inline', verticalAlign: 'text-bottom' }} />}</h4>\r\n                                            </div>\r\n                                            <div className={styles.vendorMeta}>\r\n                                                <div className={styles.vendorDist}>{formatDistance((vendor.distance || 0) * 1000)} away</div>\r\n                                                {vendor.category && <div className={styles.categoryTag}>{vendor.category}</div>}\r\n                                            </div>\r\n                                            <p className={styles.vendorAddr}>{vendor.address}</p>\r\n                                        </div>\r\n\r\n                                        {vendor.highlyRecommended && <div className={styles.premiumBadge}>Partner</div>}\r\n\r\n                                        <div className={styles.cardActions}>\r\n                                            <Button variant=\"outline\" size=\"sm\" className={styles.actionBtn} onClick={() => window.open(`https://www.google.com/maps/dir/?api=1&destination=${vendor.latitude},${vendor.longitude}`)}>\r\n                                                <ExternalLink size={14} /> <span className=\"hidden sm:inline\">Navigate</span>\r\n                                            </Button>\r\n                                            <Button variant=\"outline\" size=\"sm\" className={styles.actionBtn} onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(vendor.name)}&query_place_id=${vendor.latitude},${vendor.longitude}`)}>\r\n                                                <MapPin size={14} /> <span className=\"hidden sm:inline\">Map</span>\r\n                                            </Button>\r\n                                            {(vendor.whatsapp || vendor.phone !== 'N/A') && (\r\n                                                <Button size=\"sm\" className={styles.actionBtn} style={{ background: '#25D366', color: '#fff', border: 'none' }} onClick={() => {\r\n                                                    logVendorContact({ vendorId: vendor.id, vendorName: vendor.name, userEmail: user?.email || 'guest', contactType: 'whatsapp' });\r\n                                                    let message = `Hi ${vendor.name},`;\r\n                                                    if (items.length > 0) {\r\n                                                        message += ` I am interested in checking availability for:\\n`;\r\n                                                        items.forEach(item => message += `- ${item.plant.name} (x${item.quantity})\\n`);\r\n                                                        message += `\\nDo you have these in stock?`;\r\n                                                    } else {\r\n                                                        message += ` I saw your shop on VanaMap. Do you have stock?`;\r\n                                                    }\r\n                                                    window.open(`https://wa.me/${(vendor.whatsapp || vendor.phone).replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`, '_blank');\r\n                                                }}>\r\n                                                    <MessageCircle size={14} /> <span className=\"hidden sm:inline\">Chat</span>\r\n                                                </Button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n\r\n                            {/* Partnership CTA */}\r\n                            <div style={{\r\n                                marginTop: '3rem',\r\n                                background: 'linear-gradient(45deg, rgba(25,25,25,0.8), rgba(16,185,129,0.1))',\r\n                                border: '1px solid rgba(16,185,129,0.2)',\r\n                                borderRadius: '1.5rem',\r\n                                padding: '2rem',\r\n                                textAlign: 'center'\r\n                            }}>\r\n                                <h4 style={{ margin: '0 0 0.5rem 0', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>\r\n                                    <Sparkles size={18} color=\"#facc15\" /> Join VanaMap as a Seller\r\n                                </h4>\r\n                                <p style={{ color: '#94a3b8', fontSize: '0.9rem', marginBottom: '1.5rem', maxWidth: '600px', marginInline: 'auto' }}>\r\n                                    Own a nursery or plant shop? List your business here to reach more local customers.\r\n                                </p>\r\n                                <Button variant=\"primary\" size=\"sm\" onClick={() => {\r\n                                    import('react-hot-toast').then(({ default: toast }) => toast.success(\"Opening WhatsApp contact...\"));\r\n                                    window.open('https://wa.me/9188773534', '_blank');\r\n                                }}>\r\n                                    Apply via WhatsApp (+91 88773534)\r\n                                </Button>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\PotDesigner.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1265,1268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1265,1268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1969,1972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1969,1972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7740,7743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7740,7743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":258,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10379,10382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10379,10382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, Suspense, useRef, useEffect } from 'react';\r\nimport { Canvas, useLoader } from '@react-three/fiber';\r\nimport { OrbitControls, ContactShadows, Decal, Float, PerspectiveCamera } from '@react-three/drei';\r\nimport { TextureLoader } from 'three';\r\nimport { ArrowLeft, Upload, Download, ShoppingBag, Palette, Move, RotateCcw, Box, Maximize } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useCart } from '../context/CartContext';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './PotDesigner.module.css';\r\nimport { saveCustomPot } from '../services/api';\r\n\r\n// ==========================================\r\n// 3D COMPONENTS\r\n// ==========================================\r\n\r\nfunction StandardPot({ color, children }: { color: string, children?: React.ReactNode }) {\r\n    return (\r\n        <mesh position={[0, 0.5, 0]} castShadow receiveShadow>\r\n            <cylinderGeometry args={[1, 0.7, 2, 64]} />\r\n            <meshStandardMaterial\r\n                color={color}\r\n                roughness={0.4}\r\n                metalness={0.1}\r\n                envMapIntensity={1}\r\n            />\r\n            {children}\r\n        </mesh>\r\n    );\r\n}\r\n\r\nfunction ArtDecal({ image, decalProps }: { image: string, decalProps: any }) {\r\n    // Isolated loader component to prevent main crash\r\n    const decalTexture = useLoader(TextureLoader, image);\r\n\r\n    return (\r\n        <Decal\r\n            position={[0, decalProps.y - 0.5, 0.95]} // Adjusted Y since mesh is now at origin relative to parent\r\n            rotation={[0, 0, decalProps.rotation]}\r\n            scale={[decalProps.scale, decalProps.scale, 1]}\r\n        >\r\n            <meshStandardMaterial\r\n                map={decalTexture}\r\n                transparent\r\n                polygonOffset\r\n                polygonOffsetFactor={-10}\r\n                roughness={0.5}\r\n            />\r\n        </Decal>\r\n    );\r\n}\r\n\r\nfunction PotComposition({ color, image, decalProps }: any) {\r\n    return (\r\n        <Float speed={1.5} rotationIntensity={0.2} floatIntensity={0.5}>\r\n            <StandardPot color={color}>\r\n                {image && (\r\n                    <Suspense fallback={null}>\r\n                        <ArtDecal image={image} decalProps={decalProps} />\r\n                    </Suspense>\r\n                )}\r\n            </StandardPot>\r\n        </Float>\r\n    );\r\n}\r\n\r\n// ==========================================\r\n// MAIN PAGE COMPONENT\r\n// ==========================================\r\n\r\nexport const PotDesigner = () => {\r\n    const navigate = useNavigate();\r\n    const { addToCart } = useCart();\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [color, setColor] = useState('#d97706'); // Terracotta\r\n    const [image, setImage] = useState<string | null>(null);\r\n    const [rawImageBase64, setRawImageBase64] = useState<string | null>(null);\r\n    const [decalProps, setDecalProps] = useState({\r\n        scale: 1,\r\n        y: 0.5,\r\n        rotation: 0\r\n    });\r\n\r\n    useEffect(() => {\r\n        // Quest Check: Pot Designer (Action: design)\r\n        const activeQuest = sessionStorage.getItem('active_quest');\r\n        if (activeQuest) {\r\n            const quest = JSON.parse(activeQuest);\r\n            if (quest.action === 'design') {\r\n                setTimeout(() => {\r\n                    import('../services/api').then(({ addPoints }) => {\r\n                        addPoints(quest.points).then(() => {\r\n                            import('react-hot-toast').then(({ default: toast }) => {\r\n                                toast.success(`Quest Complete: ${quest.title}! +${quest.points} CP`, { icon: '≡ƒÅå', duration: 5000 });\r\n                            });\r\n                            sessionStorage.removeItem('active_quest');\r\n                        }).catch(console.error);\r\n                    });\r\n                }, 1500);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    const potColors = [\r\n        { name: 'Terracotta', value: '#d97706' },\r\n        { name: 'Pure White', value: '#f8fafc' },\r\n        { name: 'Midnight', value: '#1e293b' },\r\n        { name: 'Sage', value: '#10b981' },\r\n        { name: 'Ocean', value: '#3b82f6' },\r\n        { name: 'Rose', value: '#fb7185' },\r\n        { name: 'Basalt', value: '#334155' },\r\n        { name: 'Clay', value: '#a8a29e' },\r\n        { name: 'Teal', value: '#0d9488' },\r\n        { name: 'Lemon', value: '#eab308' },\r\n    ];\r\n\r\n    const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (file) {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                setRawImageBase64(reader.result as string);\r\n                setImage(URL.createObjectURL(file));\r\n                toast.success(\"Design Applied! Adjust the sliders below.\");\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleAddToCart = async () => {\r\n        const userStr = localStorage.getItem('user');\r\n        if (!userStr) {\r\n            toast.error(\"Please login to save your design!\");\r\n            navigate('/auth'); // Updated to /auth for consistent login flow\r\n            return;\r\n        }\r\n\r\n        const loadingToast = toast.loading(\"Capturing and saving your design...\");\r\n\r\n        try {\r\n            // Capture the 3D Snapshots\r\n            const canvas = canvasRef.current;\r\n            if (!canvas) throw new Error(\"3D Engine not ready. Please try again in a moment.\");\r\n\r\n            // Generate snapshot - Use JPEG for smaller size (saves DB space)\r\n            let potWithDesignUrl = '';\r\n            try {\r\n                potWithDesignUrl = canvas.toDataURL('image/jpeg', 0.8);\r\n            } catch (e) {\r\n                console.error(\"Canvas capture failed\", e);\r\n                throw new Error(\"Unable to capture image from 3D view.\");\r\n            }\r\n\r\n            if (!potWithDesignUrl || potWithDesignUrl.length < 50) {\r\n                throw new Error(\"Design snapshot failed. Is the hardware accelerator active?\");\r\n            }\r\n\r\n            // 1. Save to Database\r\n            const design = await saveCustomPot({\r\n                potColor: color,\r\n                potWithDesignUrl,\r\n                rawDesignUrl: rawImageBase64 || '',\r\n                decalProps\r\n            });\r\n\r\n            const stableId = design?.design?._id || Date.now().toString();\r\n\r\n            // 2. Add to Shopping Cart\r\n            addToCart({\r\n                id: `cp_${stableId}`,\r\n                name: 'Your Custom Pot Design',\r\n                scientificName: 'Handcrafted Ceramic',\r\n                description: 'A unique ceramic pot designed by you in the VanaMap Studio.',\r\n                imageUrl: potWithDesignUrl,\r\n                price: 299,\r\n                type: 'indoor',\r\n                medicinalValues: [],\r\n                advantages: ['Unique Aesthetic', 'Custom Fit', 'Studio Grade'],\r\n                idealTempMin: 0,\r\n                idealTempMax: 50,\r\n                minHumidity: 0,\r\n                sunlight: 'Direct/Indirect',\r\n                oxygenLevel: 'High'\r\n            }, 'vanamap', 299);\r\n\r\n            toast.dismiss(loadingToast);\r\n            toast.success(\"Design saved and added to cart!\", {\r\n                icon: '≡ƒ¢ì∩╕Å',\r\n                style: { background: '#0f172a', color: '#fff', border: '1px solid #10b981' }\r\n            });\r\n\r\n            setTimeout(() => {\r\n                toast(\"This buying option is coming soon, stay tuned! ≡ƒî┐\", {\r\n                    icon: '≡ƒÜÇ',\r\n                    duration: 5000,\r\n                    style: { background: '#020617', color: '#10b981', border: '1px solid #10b981' }\r\n                });\r\n            }, 1000);\r\n\r\n        } catch (err: any) {\r\n            toast.dismiss(loadingToast);\r\n            console.error(\"Collection Save Error:\", err);\r\n            // Show the actual error message from the API logic\r\n            const msg = err.message || \"Failed to save design. Network interruption?\";\r\n            toast.error(msg, {\r\n                duration: 4000\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleDownload = () => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) {\r\n            toast.error(\"3D Engine not ready for download.\");\r\n            return;\r\n        }\r\n        try {\r\n            const dataUrl = canvas.toDataURL('image/jpeg', 0.9);\r\n            const link = document.createElement('a');\r\n            link.href = dataUrl;\r\n            link.download = `Vana_Custom_Pot_${new Date().getTime()}.jpg`;\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n            toast.success(\"Design downloaded! ≡ƒôü\");\r\n        } catch (e) {\r\n            console.error(\"Download failed\", e);\r\n            toast.error(\"Failed to generate download file.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`${styles.designerContainer} no-swipe`}>\r\n            {/* Top Bar */}\r\n            <header className={styles.header}>\r\n                <button className={styles.backBtn} onClick={() => navigate(-1)}>\r\n                    <ArrowLeft size={18} /> EXIT\r\n                </button>\r\n                <div className={styles.title}>VANA STUDIO ΓÇó POT CONFIGURATOR</div>\r\n                <div style={{ width: 60 }} className=\"hidden sm:block\"></div>\r\n            </header>\r\n\r\n            <main className={styles.mainWrapper}>\r\n                {/* 3D Canvas Area */}\r\n                <div className={styles.canvasContainer}>\r\n                    <Suspense fallback={\r\n                        <div className={styles.loading}>\r\n                            <div className={styles.pulse} />\r\n                            <p style={{ fontSize: '0.8rem', fontWeight: 700, letterSpacing: '1px' }}>INITIALIZING ENGINE...</p>\r\n                        </div>\r\n                    }>\r\n                        <div className={styles.canvasWrapper}>\r\n                            {/* gl={{ preserveDrawingBuffer: true }} is CRITICAL for toDataURL to work */}\r\n                            <Canvas\r\n                                shadows\r\n                                gl={{ preserveDrawingBuffer: true }}\r\n                                onCreated={({ gl }) => {\r\n                                    // Make the canvas available via ref\r\n                                    (canvasRef as any).current = gl.domElement;\r\n                                }}\r\n                            >\r\n                                <PerspectiveCamera makeDefault position={[0, 2, 5]} fov={35} />\r\n\r\n                                <ambientLight intensity={0.6} />\r\n                                <spotLight position={[10, 20, 10]} angle={0.2} penumbra={1} intensity={2.5} castShadow />\r\n                                <directionalLight position={[-5, 5, -5]} intensity={1.2} color=\"#3b82f6\" />\r\n                                <pointLight position={[0, -2, 5]} intensity={0.6} color=\"#10b981\" />\r\n\r\n                                <PotComposition color={color} image={image} decalProps={decalProps} />\r\n\r\n                                <ContactShadows position={[0, -0.5, 0]} opacity={0.5} scale={10} blur={2.4} far={4.5} />\r\n                                <OrbitControls\r\n                                    enablePan={false}\r\n                                    minPolarAngle={Math.PI / 4}\r\n                                    maxPolarAngle={Math.PI / 1.6}\r\n                                    autoRotate={!image}\r\n                                    autoRotateSpeed={0.4}\r\n                                />\r\n                            </Canvas>\r\n                        </div>\r\n                    </Suspense>\r\n\r\n                    {/* Desktop Interaction Tips */}\r\n                    <div style={{ position: 'absolute', bottom: '1.5rem', left: '1.5rem', display: 'flex', gap: '0.75rem' }} className=\"hidden sm:flex\">\r\n                        <div style={{ background: 'rgba(0,0,0,0.6)', padding: '0.4rem 0.8rem', borderRadius: '8px', fontSize: '0.65rem', fontWeight: 800, backdropFilter: 'blur(12px)', border: '1px solid rgba(255,255,255,0.05)', color: '#94a3b8' }}>\r\n                            ROTATE <span style={{ color: '#fff' }}>DRAG</span>\r\n                        </div>\r\n                        <div style={{ background: 'rgba(0,0,0,0.6)', padding: '0.4rem 0.8rem', borderRadius: '8px', fontSize: '0.65rem', fontWeight: 800, backdropFilter: 'blur(12px)', border: '1px solid rgba(255,255,255,0.05)', color: '#94a3b8' }}>\r\n                            ZOOM <span style={{ color: '#fff' }}>SCROLL</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Scrollable Config Panel */}\r\n                <div className={styles.scrollArea}>\r\n                    <div className={styles.content}>\r\n                        {/* Base Finish */}\r\n                        <section className={styles.section}>\r\n                            <div className={styles.sectionHeader}>\r\n                                <Palette size={16} />\r\n                                <h3>Material Finish</h3>\r\n                            </div>\r\n                            <div className={styles.colorGrid}>\r\n                                {potColors.map((c) => (\r\n                                    <div\r\n                                        key={c.value}\r\n                                        className={`${styles.colorItem} ${color === c.value ? styles.colorActive : ''}`}\r\n                                        style={{ backgroundColor: c.value }}\r\n                                        onClick={() => setColor(c.value)}\r\n                                        title={c.name}\r\n                                    />\r\n                                ))}\r\n                            </div>\r\n                        </section>\r\n\r\n                        {/* Custom Artwork */}\r\n                        <section className={styles.section}>\r\n                            <div className={styles.sectionHeader}>\r\n                                <Box size={16} />\r\n                                <h3>Artwork Overlay</h3>\r\n                            </div>\r\n\r\n                            <input type=\"file\" id=\"pot-upload\" hidden accept=\"image/*\" onChange={handleImageUpload} />\r\n                            <label htmlFor=\"pot-upload\" className={styles.uploadBox}>\r\n                                <div className={styles.uploadInfo}>\r\n                                    <Upload size={28} color={image ? '#10b981' : '#475569'} />\r\n                                    <span>{image ? <b>SWITCH IMAGE</b> : <>UPLOAD <b>CUSTOM ART</b></>}</span>\r\n                                </div>\r\n                            </label>\r\n\r\n                            {image && (\r\n                                <div className={styles.sliders}>\r\n                                    <div className={styles.sliderGroup}>\r\n                                        <div className={styles.sliderHead}>\r\n                                            <span><Maximize size={12} /> SCALE</span>\r\n                                            <span>{Math.round(decalProps.scale * 100)}%</span>\r\n                                        </div>\r\n                                        <input\r\n                                            type=\"range\" min=\"0.4\" max=\"2.2\" step=\"0.01\"\r\n                                            value={decalProps.scale}\r\n                                            onChange={(e) => setDecalProps(p => ({ ...p, scale: parseFloat(e.target.value) }))}\r\n                                            className={styles.range}\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className={styles.sliderGroup}>\r\n                                        <div className={styles.sliderHead}>\r\n                                            <span><Move size={12} /> ELEVATION</span>\r\n                                            <span>{Math.round(decalProps.y * 100)}</span>\r\n                                        </div>\r\n                                        <input\r\n                                            type=\"range\" min=\"-0.6\" max=\"1.6\" step=\"0.01\"\r\n                                            value={decalProps.y}\r\n                                            onChange={(e) => setDecalProps(p => ({ ...p, y: parseFloat(e.target.value) }))}\r\n                                            className={styles.range}\r\n                                        />\r\n                                    </div>\r\n\r\n                                    <div className={styles.sliderGroup}>\r\n                                        <div className={styles.sliderHead}>\r\n                                            <span><RotateCcw size={12} /> ROTATION</span>\r\n                                            <span>{Math.round(decalProps.rotation * 57.3)}┬░</span>\r\n                                        </div>\r\n                                        <input\r\n                                            type=\"range\" min=\"-3.14\" max=\"3.14\" step=\"0.01\"\r\n                                            value={decalProps.rotation}\r\n                                            onChange={(e) => setDecalProps(p => ({ ...p, rotation: parseFloat(e.target.value) }))}\r\n                                            className={styles.range}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </section>\r\n\r\n                        <div style={{ height: '40px' }} /> {/* Margin spacer */}\r\n                    </div>\r\n\r\n                    <div className={styles.footer} style={{ display: 'flex', gap: '8.1px' }}>\r\n                        <button className={styles.downloadBtn} onClick={handleDownload} title=\"Download Locally\">\r\n                            <Download size={18} />\r\n                        </button>\r\n                        <button className={styles.checkoutBtn} onClick={handleAddToCart}>\r\n                            <ShoppingBag size={18} /> ADD TO COLLECTION\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Premium.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'API_URL'. Either include it or remove the dependency array.","line":45,"column":8,"nodeType":"ArrayExpression","endLine":45,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [user, canView, navigate, API_URL]","fix":{"range":[1799,1824],"text":"[user, canView, navigate, API_URL]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3767,3770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3767,3770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5211,5214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5211,5214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Crown, Check, Shield, Zap, Heart, Bot, Headset } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './Premium.module.css';\r\n\r\nexport const Premium = () => {\r\n    const { user, refreshUser } = useAuth();\r\n    const token = user?.token;\r\n    const [loading, setLoading] = useState(false);\r\n    const [config, setConfig] = useState({ price: 10, activePromo: false, freeEnd: '' });\r\n    const [configLoading, setConfigLoading] = useState(true);\r\n    const navigate = useNavigate();\r\n\r\n    // Derived State\r\n    const isFreeMode = config.activePromo || config.price === 0 || String(config.price) === '0';\r\n\r\n    // Access Control\r\n    const canView = user && (user.favorites?.length > 3 || user.isPremium || user.role === 'admin');\r\n    const API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n\r\n    useEffect(() => {\r\n        // 1. Fetch Config (Price/Promo)\r\n        const fetchConfig = async () => {\r\n            try {\r\n                const res = await fetch(`${API_URL}/public/premium-config`);\r\n                const data = await res.json();\r\n                setConfig(data);\r\n            } catch (e) {\r\n                console.error(\"Config fetch failed\", e);\r\n            } finally {\r\n                setConfigLoading(false);\r\n            }\r\n        };\r\n        fetchConfig();\r\n\r\n        // 2. Route Protection\r\n        if (user && !canView && user.role !== 'admin') {\r\n            toast(\"Add more than 3 plants to favorites to unlock Premium!\", { icon: '≡ƒöÆ' });\r\n            navigate('/');\r\n        } else if (user?.isPremium) {\r\n            navigate('/heaven');\r\n        }\r\n    }, [user, canView, navigate]);\r\n\r\n    // Helpers\r\n    const loadRazorpay = () => {\r\n        return new Promise((resolve) => {\r\n            const script = document.createElement('script');\r\n            script.src = 'https://checkout.razorpay.com/v1/checkout.js';\r\n            script.onload = () => resolve(true);\r\n            script.onerror = () => resolve(false);\r\n            document.body.appendChild(script);\r\n        });\r\n    };\r\n\r\n    const handlePaidSubscription = async () => {\r\n        setLoading(true);\r\n        const res = await loadRazorpay();\r\n        if (!res) {\r\n            toast.error(\"Razorpay SDK failed to load\");\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const result = await fetch(`${API_URL}/payments/create-order`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            if (!result.ok) {\r\n                const errorData = await result.json().catch(() => ({}));\r\n                if (result.status === 503) {\r\n                    toast.error(\"Payment Gateway disabled. Try again later.\");\r\n                } else {\r\n                    console.error(\"Order Error:\", errorData);\r\n                    toast.error(`Order Failed: ${errorData.error || result.statusText || \"Server Error\"}`);\r\n                }\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            const order = await result.json();\r\n\r\n            const options = {\r\n                key: order.key, // Dynamic backend key\r\n                amount: order.amount,\r\n                currency: order.currency,\r\n                name: \"VanaMap Premium\",\r\n                description: \"Monthly Subscription\",\r\n                image: \"/logo.png\",\r\n                order_id: order.id,\r\n                handler: async function (response: any) {\r\n                    const verifyRes = await fetch(`${API_URL}/payments/verify`, {\r\n                        method: 'POST',\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            'Authorization': `Bearer ${token}`\r\n                        },\r\n                        body: JSON.stringify({\r\n                            orderId: response.razorpay_order_id,\r\n                            paymentId: response.razorpay_payment_id,\r\n                            signature: response.razorpay_signature,\r\n                            planType: 'monthly'\r\n                        })\r\n                    });\r\n                    const verifyData = await verifyRes.json();\r\n                    if (verifyData.success || verifyRes.ok) {\r\n                        toast.success(\"Payment Successful! Welcome to Premium.\");\r\n                        await refreshUser();\r\n                        navigate('/heaven');\r\n                    } else {\r\n                        toast.error(\"Payment Verification Failed\");\r\n                    }\r\n                },\r\n                prefill: {\r\n                    name: user?.name,\r\n                    email: user?.email,\r\n                    contact: user?.phone\r\n                },\r\n                theme: {\r\n                    color: \"#10b981\"\r\n                }\r\n            };\r\n\r\n            const paymentObject = new (window as any).Razorpay(options);\r\n            paymentObject.open();\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            toast.error(\"Payment initiation failed\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleFreeClaim = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const response = await fetch(`${API_URL}/payments/claim-free`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                }\r\n            });\r\n\r\n            const data = await response.json();\r\n            if (response.ok && data.success) {\r\n                toast.success(\"Welcome to Premium Heaven! ≡ƒîƒ\");\r\n                await refreshUser();\r\n                navigate('/heaven');\r\n            } else {\r\n                toast.error(data.error || \"Activation failed\");\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Something went wrong\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handlePayment = async () => {\r\n        if (!user) {\r\n            navigate('/auth', { state: { from: '/premium' } });\r\n            return;\r\n        }\r\n\r\n        if (isFreeMode) {\r\n            await handleFreeClaim();\r\n        } else {\r\n            await handlePaidSubscription();\r\n        }\r\n    };\r\n\r\n    const getButtonText = () => {\r\n        if (configLoading) return 'Checking Offers...';\r\n        if (loading) return 'Processing...';\r\n        if (user?.isPremium) return 'Premium Active';\r\n\r\n        if (isFreeMode) {\r\n            if (!user) return 'Login to Claim Free Access';\r\n            return 'Claim Free Access Now';\r\n        } else {\r\n            if (!user) return 'Login to Upgrade';\r\n            return 'Upgrade to Premium';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.backgroundEffects}>\r\n                <div className={`${styles.orb} ${styles.orb1}`}></div>\r\n                <div className={`${styles.orb} ${styles.orb2}`}></div>\r\n            </div>\r\n\r\n            <div className={styles.content}>\r\n                <header className={styles.hero}>\r\n                    <div className={styles.crownBadge}>\r\n                        <Crown size={40} className=\"text-slate-900\" strokeWidth={2.5} />\r\n                    </div>\r\n                    <h1 className={styles.title}>\r\n                        Unlock <span className={styles.titleHighlight}>VanaMap+</span>\r\n                    </h1>\r\n                    <p className={styles.subtitle}>\r\n                        Elevate your plant journey with exclusive AI tools, unlimited collections,\r\n                        and premium community status.\r\n                    </p>\r\n                </header>\r\n\r\n                <div className={styles.plansGrid}>\r\n\r\n                    {/* Free Plan */}\r\n                    <div className={`${styles.card} ${styles.cardFree}`}>\r\n                        <div className={styles.planName}>Standard</div>\r\n                        <div className={styles.price}>Free</div>\r\n                        <div className={styles.promoText}>Forever free for basic use</div>\r\n\r\n                        <ul className={styles.features}>\r\n                            <li className={styles.featureItem}>\r\n                                <Check size={18} className={styles.checkIcon} />\r\n                                Unlimited Global Plant Search\r\n                            </li>\r\n                            <li className={styles.featureItem}>\r\n                                <Check size={18} className={styles.checkIcon} />\r\n                                Access Public Garden Community\r\n                            </li>\r\n                            <li className={styles.featureItem}>\r\n                                <Check size={18} className={styles.checkIcon} />\r\n                                Create up to 3 Plant Collections\r\n                            </li>\r\n                        </ul>\r\n                        <button className={`${styles.button} ${styles.btnFree}`} disabled>\r\n                            Current Plan\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Premium Plan */}\r\n                    <div className={`${styles.card} ${styles.cardPremium}`}>\r\n                        {(isFreeMode || configLoading) && <div className={styles.badge}>Limited Offer</div>}\r\n\r\n                        <div className={styles.planName}>\r\n                            Premium <Crown size={24} fill=\"currentColor\" className=\"text-yellow-400\" />\r\n                        </div>\r\n\r\n                        <div className=\"flex items-baseline mb-1\">\r\n                            {configLoading ? (\r\n                                <span className={styles.price} style={{ fontSize: '1.5rem', opacity: 0.7 }}>Checking...</span>\r\n                            ) : (\r\n                                <>\r\n                                    <span className={styles.price}>{isFreeMode ? 'Γé╣0' : `Γé╣${config.price}`}</span>\r\n                                    <span className={styles.priceStrike}>{isFreeMode ? `Γé╣${config.price}` : ''}</span>\r\n                                    <span className={styles.priceDuration}>/mo</span>\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                        <div className={styles.promoText}>\r\n                            {configLoading\r\n                                ? 'Checking for exclusive offers...'\r\n                                : (isFreeMode\r\n                                    ? (config.activePromo\r\n                                        ? `Free until ${config.freeEnd ? new Date(config.freeEnd).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' }) : 'Limited Time'}!`\r\n                                        : 'Free Access for Everyone!')\r\n                                    : 'Best Value for Serious Gardeners'\r\n                                )\r\n                            }\r\n                        </div>\r\n\r\n                        <ul className={styles.features}>\r\n                            <li className={`${styles.featureItem} ${styles.premium}`}>\r\n                                <Heart size={18} className={styles.checkIcon} />\r\n                                <span><strong>Unlimited</strong> Personal Garden Collections</span>\r\n                            </li>\r\n                            <li className={`${styles.featureItem} ${styles.premium}`}>\r\n                                <Crown size={18} className={styles.checkIcon} />\r\n                                <span>Exclusive <strong>Heaven</strong> Metaverse Access</span>\r\n                            </li>\r\n                            <li className={`${styles.featureItem} ${styles.premium}`}>\r\n                                <Bot size={18} className={styles.checkIcon} />\r\n                                <span>Dr. Flora: <strong>Groq AI</strong> (Llama 3.3 70B)</span>\r\n                            </li>\r\n                            <li className={`${styles.featureItem} ${styles.premium}`}>\r\n                                <Headset size={18} className={styles.checkIcon} />\r\n                                <span>24/7 Priority Concierge Support</span>\r\n                            </li>\r\n                        </ul>\r\n\r\n                        <button\r\n                            onClick={handlePayment}\r\n                            disabled={loading || user?.isPremium || configLoading}\r\n                            className={`${styles.button} ${user?.isPremium ? styles.btnActive : styles.btnPremium}`}\r\n                        >\r\n                            {getButtonText()}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <section className={styles.valueProps}>\r\n                    <h3 className=\"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-cyan-400\">\r\n                        Why Go Premium?\r\n                    </h3>\r\n                    <div className={styles.propsGrid}>\r\n                        <div className={styles.propCard}>\r\n                            <Heart className=\"text-pink-500 mb-4\" size={32} />\r\n                            <h4 className={styles.propTitle}>Unlimited Collections</h4>\r\n                            <p className={styles.propDesc}>Build your dream garden without limits. Save every plant you love.</p>\r\n                        </div>\r\n                        <div className={styles.propCard}>\r\n                            <Zap className=\"text-yellow-400 mb-4\" size={32} />\r\n                            <h4 className={styles.propTitle}>Early Access</h4>\r\n                            <p className={styles.propDesc}>Be the first to try new features like AI-powered placement visualization.</p>\r\n                        </div>\r\n                        <div className={styles.propCard}>\r\n                            <Shield className=\"text-emerald-400 mb-4\" size={32} />\r\n                            <h4 className={styles.propTitle}>Elite Status</h4>\r\n                            <p className={styles.propDesc}>Stand out in the community leaderboard with a special Premium badge.</p>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n                <div className=\"mt-8 text-center text-xs text-slate-500 pb-8\">\r\n                    <p>Secured by Razorpay. By subscribing, you agree to our <a href=\"#\" className=\"underline hover:text-emerald-400\">Terms of Service</a> and <a href=\"#\" className=\"underline hover:text-emerald-400\">Privacy Policy</a>.</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Shops.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1857,1860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1857,1860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1930,1933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1930,1933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":78,"column":8,"nodeType":"ArrayExpression","endLine":78,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadData]","fix":{"range":[3374,3376],"text":"[loadData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3965,3968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3965,3968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'getStockStatus'. Either include it or remove the dependency array.","line":143,"column":8,"nodeType":"ArrayExpression","endLine":143,"endColumn":67,"suggestions":[{"desc":"Update the dependencies array to be: [plants, activeCategory, searchQuery, getStockStatus, stockFilter]","fix":{"range":[5714,5773],"text":"[plants, activeCategory, searchQuery, getStockStatus, stockFilter]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport type { Plant, Vendor } from '../types';\r\nimport { fetchPlants, fetchVendors, logSearch } from '../services/api';\r\nimport { Search, ShoppingBag, AlertCircle } from 'lucide-react';\r\nimport { PlantVendorsModal } from '../components/features/market/PlantVendorsModal';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport styles from './Shops.module.css';\r\n\r\nexport const Shops = () => {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [vendors, setVendors] = useState<Vendor[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [activeCategory, setActiveCategory] = useState<'all' | 'indoor' | 'outdoor'>('all');\r\n    const [stockFilter, setStockFilter] = useState<'all' | 'inStock' | 'outOfStock'>('all');\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [selectedPlant, setSelectedPlant] = useState<Plant | null>(null);\r\n    const [isSlow, setIsSlow] = useState(false);\r\n\r\n    const loadData = async () => {\r\n        setLoading(true);\r\n        setError(null);\r\n        const slowTimer = setTimeout(() => setIsSlow(true), 3000);\r\n\r\n        try {\r\n            const [plantsData, vendorsData] = await Promise.all([\r\n                fetchPlants(),\r\n                fetchVendors()\r\n            ]);\r\n\r\n            if (plantsData.length === 0) {\r\n                // Potential silent fail or empty DB\r\n                console.warn(\"No plants fetched from server\");\r\n            }\r\n\r\n            setPlants(plantsData);\r\n            setVendors(vendorsData.filter(v => v.verified));\r\n\r\n            // Check for auto-open request from navigation\r\n            if (location.state && (location.state as any).openPlantId) {\r\n                const targetId = (location.state as any).openPlantId;\r\n                const found = plantsData.find(p => p.id === targetId);\r\n                if (found) {\r\n                    setSelectedPlant(found);\r\n                    window.history.replaceState({}, document.title);\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Failed to load shop items\", err);\r\n            setError(\"The market systems are currently offline. Please try again in a moment.\");\r\n        } finally {\r\n            clearTimeout(slowTimer);\r\n            setLoading(false);\r\n            setIsSlow(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n\r\n        // Quest Check: Green Shopper (Action: shop)\r\n        const activeQuest = sessionStorage.getItem('active_quest');\r\n        if (activeQuest) {\r\n            const quest = JSON.parse(activeQuest);\r\n            if (quest.action === 'shop') {\r\n                import('../services/api').then(({ addPoints }) => {\r\n                    addPoints(quest.points).then(() => {\r\n                        import('react-hot-toast').then(({ default: toast }) => {\r\n                            toast.success(`Quest Complete: ${quest.title}! +${quest.points} CP`, { icon: '≡ƒÅå', duration: 5000 });\r\n                        });\r\n                        sessionStorage.removeItem('active_quest'); // Clear quest\r\n                    }).catch(console.error);\r\n                });\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // Log search with debounce\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) return;\r\n        const timer = setTimeout(() => {\r\n            logSearch(searchQuery);\r\n        }, 1500);\r\n        return () => clearTimeout(timer);\r\n    }, [searchQuery]);\r\n\r\n    const getStockStatus = (plant: Plant) => {\r\n        const selling = vendors.filter(v => v.inventory?.some(i => i.plantId === plant.id && i.inStock));\r\n        let count = 0;\r\n        selling.forEach(v => {\r\n            const item = v.inventory?.find(i => i.plantId === plant.id);\r\n            const qty = (item as any).quantity;\r\n            count += (typeof qty === 'number' ? qty : 1);\r\n        });\r\n        return { inStock: count > 0, count };\r\n    };\r\n\r\n    const getPriceInfo = (plant: Plant) => {\r\n        // Collect all potential prices\r\n        const potentialPrices: number[] = [];\r\n\r\n        vendors.forEach(v => {\r\n            const invItem = v.inventory?.find(i => i.plantId === plant.id && i.inStock);\r\n            if (invItem) {\r\n                potentialPrices.push(invItem.price);\r\n            }\r\n        });\r\n\r\n        if (potentialPrices.length > 0) {\r\n            const minPrice = Math.min(...potentialPrices);\r\n            return {\r\n                display: `From Rs. ${minPrice}`,\r\n                value: minPrice,\r\n                hasVendors: true,\r\n                count: potentialPrices.length\r\n            };\r\n        }\r\n\r\n        // Fallback to base price\r\n        const base = plant.price || ((plant.name.charCodeAt(0) % 5 + 1) * 150);\r\n        return {\r\n            display: `Approx Rs. ${base}`,\r\n            value: base,\r\n            hasVendors: false,\r\n            count: 0\r\n        };\r\n    };\r\n\r\n    const filteredPlants = useMemo(() => {\r\n        return plants.filter(p => {\r\n            const matchesCategory = activeCategory === 'all' ? true : p.type === activeCategory;\r\n            const q = searchQuery.toLowerCase();\r\n            const matchesSearch = p.name.toLowerCase().includes(q) ||\r\n                (p.scientificName?.toLowerCase().includes(q) ?? false);\r\n\r\n            const { inStock } = getStockStatus(p);\r\n            const matchesStock = stockFilter === 'all' ? true : (stockFilter === 'inStock' ? inStock : !inStock);\r\n\r\n            return matchesCategory && matchesSearch && matchesStock;\r\n        });\r\n    }, [plants, activeCategory, searchQuery, stockFilter, vendors]);\r\n\r\n    return (\r\n        <div className={styles.shopContainer}>\r\n            {/* Header Section */}\r\n            <div className={styles.header}>\r\n                <div className={styles.badgeMain}>\r\n                    <ShoppingBag size={16} /> OFFICIAL MARKET\r\n                </div>\r\n                <h1 className={styles.titleMain}>VANAMAP<br />MARKET</h1>\r\n                <p className={styles.subtitleMain}>Curated specimens for your premium home ecosystem.</p>\r\n\r\n                {/* Search Bar */}\r\n                <div className={styles.searchContainer}>\r\n                    <Search size={20} className={styles.searchIcon} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search species...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className={styles.searchInput}\r\n                    />\r\n                </div>\r\n\r\n                {/* New Premium Filter Section */}\r\n                <div className={styles.filterContainer}>\r\n                    <div\r\n                        className={`${styles.filterCard} ${activeCategory === 'indoor' ? styles.active : ''}`}\r\n                        onClick={() => setActiveCategory(activeCategory === 'indoor' ? 'all' : 'indoor')}\r\n                    >\r\n                        <div className={styles.filterIcon}>≡ƒÅá</div>\r\n                        <div className={styles.filterInfo}>\r\n                            <span className={styles.filterName}>Indoor</span>\r\n                            <span className={styles.filterDesc}>Interior Species</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div\r\n                        className={`${styles.filterCard} ${activeCategory === 'outdoor' ? styles.active : ''}`}\r\n                        onClick={() => setActiveCategory(activeCategory === 'outdoor' ? 'all' : 'outdoor')}\r\n                    >\r\n                        <div className={styles.filterIcon}>≡ƒî▓</div>\r\n                        <div className={styles.filterInfo}>\r\n                            <span className={styles.filterName}>Outdoor</span>\r\n                            <span className={styles.filterDesc}>Natural Resilience</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Stock Filters */}\r\n                <div className={styles.stockFilterContainer}>\r\n                    <button\r\n                        className={`${styles.stockBtn} ${stockFilter === 'inStock' ? styles.activeIn : ''}`}\r\n                        onClick={() => setStockFilter(stockFilter === 'inStock' ? 'all' : 'inStock')}\r\n                    >\r\n                        {stockFilter === 'inStock' ? 'Γ£ô ' : ''}In Stock\r\n                    </button>\r\n                    <button\r\n                        className={`${styles.stockBtn} ${stockFilter === 'outOfStock' ? styles.activeOut : ''}`}\r\n                        onClick={() => setStockFilter(stockFilter === 'outOfStock' ? 'all' : 'outOfStock')}\r\n                    >\r\n                        {stockFilter === 'outOfStock' ? 'Γ£ò ' : ''}Out of Stock\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Product Grid */}\r\n            {loading ? (\r\n                <div style={{ textAlign: 'center', padding: '6rem 2rem', color: '#94a3b8', display: 'flex', flexDirection: 'column', gap: '1rem', alignItems: 'center' }}>\r\n                    <div className=\"pre-loader-pulse\"></div>\r\n                    <div style={{ fontWeight: 600, fontSize: '1.1rem', color: '#fff' }}>Syncing Market Data...</div>\r\n                    {isSlow && <p style={{ fontSize: '0.85rem', opacity: 0.7 }}>Our servers are waking up, thank you for your patience.</p>}\r\n                </div>\r\n            ) : error ? (\r\n                <div style={{ textAlign: 'center', padding: '6rem 2rem', color: '#ef4444' }}>\r\n                    <AlertCircle size={48} style={{ marginBottom: '1rem', opacity: 0.5 }} />\r\n                    <p style={{ marginBottom: '2rem', fontSize: '1.1rem' }}>{error}</p>\r\n                    <button\r\n                        onClick={() => loadData()}\r\n                        className=\"btn btn-primary\"\r\n                        style={{ padding: '0.8rem 2rem' }}\r\n                    >\r\n                        Retry Connection\r\n                    </button>\r\n                </div>\r\n            ) : filteredPlants.length === 0 ? (\r\n                <div style={{ textAlign: 'center', padding: '6rem 2rem', color: '#94a3b8' }}>\r\n                    <Search size={48} style={{ marginBottom: '1rem', opacity: 0.2 }} />\r\n                    <p style={{ fontSize: '1.2rem', fontWeight: 600 }}>No species matching your criteria.</p>\r\n                    <p style={{ fontSize: '0.9rem', opacity: 0.6 }}>Try adjusting your search or filters.</p>\r\n                    {plants.length === 0 && (\r\n                        <button\r\n                            onClick={() => loadData()}\r\n                            className=\"btn btn-outline\"\r\n                            style={{ marginTop: '2rem', padding: '0.8rem 2rem' }}\r\n                        >\r\n                            Force Reload\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            ) : (\r\n                <div className={styles.grid}>\r\n                    {filteredPlants.map(plant => (\r\n                        <div key={plant.id} className={styles.card} onClick={() => setSelectedPlant(plant)}>\r\n                            {/* Image Area */}\r\n                            <div className={styles.imageContainer}>\r\n                                <img\r\n                                    src={plant.imageUrl}\r\n                                    alt={plant.name}\r\n                                    className={styles.image}\r\n                                    loading=\"lazy\"\r\n                                />\r\n\r\n                                {(() => {\r\n                                    const { inStock, count } = getStockStatus(plant);\r\n                                    return (\r\n                                        <div style={{\r\n                                            position: 'absolute',\r\n                                            bottom: '54px',\r\n                                            left: '12px',\r\n                                            zIndex: 10,\r\n                                            background: inStock ? 'rgba(16, 185, 129, 0.95)' : 'rgba(239, 68, 68, 0.95)',\r\n                                            color: 'white',\r\n                                            padding: '4px 8px',\r\n                                            borderRadius: '6px',\r\n                                            fontSize: '0.65rem',\r\n                                            fontWeight: '800',\r\n                                            letterSpacing: '0.5px',\r\n                                            backdropFilter: 'blur(4px)',\r\n                                            boxShadow: '0 4px 6px rgba(0,0,0,0.15)',\r\n                                            display: 'flex',\r\n                                            alignItems: 'center',\r\n                                            gap: '4px',\r\n                                            border: '1px solid rgba(255,255,255,0.2)'\r\n                                        }}>\r\n                                            {inStock ? (\r\n                                                <>\r\n                                                    <span style={{ width: '6px', height: '6px', background: 'white', borderRadius: '50%' }}></span>\r\n                                                    IN STOCK ({count})\r\n                                                </>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <AlertCircle size={10} /> OUT OF STOCK\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                })()}\r\n\r\n                                <div className={styles.badge}>\r\n                                    {plant.type === 'indoor' ? 'Indoor' : 'Outdoor'}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Content Area */}\r\n                            <div className={styles.content}>\r\n                                <div style={{ marginBottom: 'auto' }}>\r\n                                    <h3 className={styles.title}>{plant.name}</h3>\r\n                                    <p className={styles.scientific}>{plant.scientificName}</p>\r\n\r\n                                    <div className={styles.tags}>\r\n                                        <span style={{ fontSize: '0.75rem', padding: '0.2rem 0.5rem', background: 'rgba(16, 185, 129, 0.1)', color: '#10b981', borderRadius: '4px', whiteSpace: 'nowrap' }}>\r\n                                            Air Purifying\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Price and Action */}\r\n                                <div className={styles.footer}>\r\n                                    <div className={styles.price}>\r\n                                        {(() => {\r\n                                            const info = getPriceInfo(plant);\r\n                                            return (\r\n                                                <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                                                    <span style={{ fontSize: '1.1rem', fontWeight: 700 }}>{info.display}</span>\r\n                                                    {info.hasVendors && (\r\n                                                        <span style={{ fontSize: '0.7rem', color: '#10b981' }}>\r\n                                                            {info.count} local seller{info.count !== 1 ? 's' : ''}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                            );\r\n                                        })()}\r\n                                    </div>\r\n                                    <button className={styles.btn}>\r\n                                        View Options\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Vendor CTA Section */}\r\n            <div className={styles.vendorCTA}>\r\n                <div style={{ display: 'inline-flex', padding: '1rem', background: 'rgba(250, 204, 21, 0.1)', borderRadius: '1rem', marginBottom: '1.5rem' }}>\r\n                    <ShoppingBag size={32} color=\"#facc15\" />\r\n                </div>\r\n                <h2 className={styles.vendorCTATitle}>Own a Plant Shop?</h2>\r\n                <p className={styles.vendorCTADesc}>\r\n                    Join our verified network of nurseries and start connecting with thousands of plant lovers in your area.\r\n                </p>\r\n                <button\r\n                    onClick={() => navigate('/auth?role=vendor&view=signup')}\r\n                    style={{\r\n                        padding: '1.25rem 2.5rem',\r\n                        fontSize: '1.1rem',\r\n                        fontWeight: '800',\r\n                        background: 'linear-gradient(135deg, #facc15 0%, #ca8a04 100%)',\r\n                        color: '#000',\r\n                        border: 'none',\r\n                        borderRadius: '1.25rem',\r\n                        cursor: 'pointer',\r\n                        boxShadow: '0 10px 30px rgba(250, 204, 21, 0.3)',\r\n                        transition: 'all 0.3s ease'\r\n                    }}\r\n                    onMouseOver={(e) => {\r\n                        e.currentTarget.style.transform = 'translateY(-4px)';\r\n                        e.currentTarget.style.boxShadow = '0 15px 40px rgba(250, 204, 21, 0.4)';\r\n                    }}\r\n                    onMouseOut={(e) => {\r\n                        e.currentTarget.style.transform = 'translateY(0)';\r\n                        e.currentTarget.style.boxShadow = '0 10px 30px rgba(250, 204, 21, 0.3)';\r\n                    }}\r\n                >\r\n                    REGISTER AS VENDOR\r\n                </button>\r\n            </div>\r\n\r\n            {selectedPlant && (\r\n                <PlantVendorsModal\r\n                    plant={selectedPlant}\r\n                    onClose={() => setSelectedPlant(null)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Sponsor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Support.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":36,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { ArrowLeft, Send, Sparkles, AlertTriangle, Store, MoveRight, Heart } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Button } from '../components/common/Button';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { toast } from 'react-hot-toast';\r\nimport { submitSuggestion } from '../services/api';\r\nimport styles from './Support.module.css';\r\n\r\nexport const Support = () => {\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const [plantName, setPlantName] = useState('');\r\n    const [reason, setReason] = useState('');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    const handleSubmitSuggestion = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!plantName || !reason) {\r\n            toast.error(\"Please fill in all fields.\");\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            await submitSuggestion({\r\n                userId: user?.id,\r\n                userName: user?.name,\r\n                plantName,\r\n                description: reason\r\n            });\r\n\r\n            toast.success(\"Suggestion sent successfully!\");\r\n            setPlantName('');\r\n            setReason('');\r\n        } catch (err) {\r\n            toast.error(\"Failed to send suggestion.\");\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.supportContainer}>\r\n            <button onClick={() => navigate(-1)} className={styles.backBtn}>\r\n                <ArrowLeft size={18} /> Back to Ecosystem\r\n            </button>\r\n\r\n            <header className={styles.header}>\r\n                <div className={styles.badge}>\r\n                    COMMUNITY POWERED\r\n                </div>\r\n                <h1 className={styles.title}>How can we<br />help you?</h1>\r\n                <p className={styles.subtitle}>Join our mission to bridge nature with technology. Whether you want to contribute, partner, or fix an issue, we're here.</p>\r\n            </header>\r\n\r\n            <div className={styles.sectionGrid}>\r\n                {/* Sponsor Section */}\r\n                <div className={`${styles.glassCard} ${styles.sponsorCard}`}>\r\n                    <div className={styles.cardHeader}>\r\n                        <div className={`${styles.iconWrapper} ${styles.sponsorIcon}`}>\r\n                            <Heart size={32} fill=\"#facc15\" color=\"#facc15\" />\r\n                        </div>\r\n                        <h2 className={styles.cardTitle} style={{ color: '#facc15' }}>Partner with VanaMap</h2>\r\n                    </div>\r\n                    <p className={styles.cardDesc}>\r\n                        We're looking for visionary partners to help us scale.\r\n                        Your support directly funds reforestation projects and advanced research.\r\n                    </p>\r\n                    <Button\r\n                        onClick={() => navigate('/sponsor')}\r\n                        className={styles.sponsorActionBtn}\r\n                        style={{\r\n                            width: '100%',\r\n                            background: 'linear-gradient(135deg, #facc15 0%, #ca8a04 100%)',\r\n                            color: '#000',\r\n                            fontWeight: '900',\r\n                            borderRadius: '1.25rem',\r\n                            padding: '1.5rem',\r\n                            fontSize: '1.1rem',\r\n                            border: 'none',\r\n                            boxShadow: '0 15px 30px -10px rgba(250, 204, 21, 0.4)'\r\n                        }}\r\n                    >\r\n                        BECOME A SPONSOR <MoveRight size={22} style={{ marginLeft: '12px' }} />\r\n                    </Button>\r\n                </div>\r\n\r\n                {/* Plant Suggestion */}\r\n                <div className={styles.glassCard}>\r\n                    <div className={styles.cardHeader}>\r\n                        <div className={`${styles.iconWrapper} ${styles.sparkleIcon}`}>\r\n                            <Sparkles size={32} />\r\n                        </div>\r\n                        <div>\r\n                            <h2 className={styles.cardTitle}>Suggest a Plant</h2>\r\n                            <span className={styles.cardSubtitle}>Help us grow our database of oxygen-rich species.</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <form onSubmit={handleSubmitSuggestion} className={styles.formGrid}>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Plant Name</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"e.g. Rare Monstera Adansonii\"\r\n                                value={plantName}\r\n                                onChange={e => setPlantName(e.target.value)}\r\n                                className={styles.input}\r\n                            />\r\n                        </div>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Why should we add this?</label>\r\n                            <textarea\r\n                                placeholder=\"Tell us about its benefits, where it grows, or why you love it...\"\r\n                                value={reason}\r\n                                onChange={e => setReason(e.target.value)}\r\n                                rows={3}\r\n                                className={styles.textarea}\r\n                            />\r\n                        </div>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            disabled={isSubmitting}\r\n                            variant=\"primary\"\r\n                            style={{ padding: '1.25rem', borderRadius: '1rem', fontWeight: '800' }}\r\n                        >\r\n                            {isSubmitting ? 'PROCESSING...' : 'SUBMIT REQUEST'} <Send size={18} />\r\n                        </Button>\r\n                    </form>\r\n                </div>\r\n\r\n                {/* Mini Actions Grid */}\r\n                <div className={styles.actionGrid}>\r\n                    <div className={`${styles.glassCard} ${styles.miniCard}`}>\r\n                        <Store size={32} color=\"#10b981\" className={styles.miniIcon} />\r\n                        <h3 className={styles.miniTitle}>Vendor Hub</h3>\r\n                        <p className={styles.miniDesc}>Scale your nursery business by joining our verified network.</p>\r\n                        <Button variant=\"outline\" style={{ width: '100%' }} onClick={() => navigate('/auth?role=vendor&view=signup')}>JOIN NETWORK</Button>\r\n                    </div>\r\n\r\n                    <div className={`${styles.glassCard} ${styles.miniCard}`}>\r\n                        <AlertTriangle size={32} color=\"#f43f5e\" className={styles.miniIcon} />\r\n                        <h3 className={styles.miniTitle}>Report Data Issue</h3>\r\n                        <p className={styles.miniDesc}>Spotted an error? Help us keep our plant data accurate.</p>\r\n                        <Button variant=\"outline\" style={{ width: '100%' }} onClick={() => window.location.href = 'mailto:support@vanamap.com'}>REPORT AN ISSUE</Button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\UserDashboard.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":40,"column":5,"nodeType":"Identifier","endLine":40,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2264,2267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2264,2267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2272,2275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2272,2275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2378,2381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2378,2381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":60,"column":5,"nodeType":"Identifier","endLine":60,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'navigate'. Either include it or remove the dependency array.","line":91,"column":8,"nodeType":"ArrayExpression","endLine":91,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [navigate, user]","fix":{"range":[4043,4049],"text":"[navigate, user]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":110,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":110,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":160,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":19},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":167,"column":5,"nodeType":"Identifier","endLine":167,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user'. Either include it or remove the dependency array.","line":182,"column":8,"nodeType":"ArrayExpression","endLine":182,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [user, user.email]","fix":{"range":[7369,7382],"text":"[user, user.email]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":210,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":21},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":229,"column":59,"nodeType":"Identifier","endLine":229,"endColumn":67}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useCart } from '../context/CartContext';\r\nimport { Button } from '../components/common/Button';\r\nimport { ShoppingBag, MapPin, Heart, ArrowRight, Loader2, Store, Shield, Lock, Trophy, Zap, TrendingUp, Wind, Award, HelpCircle } from 'lucide-react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { fetchPlants, fetchVendors, updateVendor, changePassword, fetchLeaderboard } from '../services/api';\r\nimport type { Plant, Vendor } from '../types';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './UserDashboard.module.css';\r\n\r\nexport const UserDashboard = () => {\r\n    const { user, toggleFavorite, loading } = useAuth(); // Restored loading from context\r\n    const { items } = useCart(); // Only items needed from CartContext\r\n    const navigate = useNavigate();\r\n\r\n    const [pwdForm, setPwdForm] = useState({ old: '', new: '', confirm: '' });\r\n    const [showPasswordModal, setShowPasswordModal] = useState(false);\r\n    const [showGuide, setShowGuide] = useState(false);\r\n\r\n    // Favorites & Data State\r\n    const [allPlants, setAllPlants] = useState<Plant[]>([]);\r\n    const [loadingFavs, setLoadingFavs] = useState(false);\r\n    const [rank, setRank] = useState<number | null>(null);\r\n\r\n    // Vendor Onboarding State\r\n    const [showVendorModal, setShowVendorModal] = useState(false);\r\n    const [myVendor, setMyVendor] = useState<Vendor | null>(null);\r\n    const [vendorForm, setVendorForm] = useState<{ name: string, phone: string, address: string, latitude: number | null, longitude: number | null }>({\r\n        name: '', phone: '', address: '', latitude: null, longitude: null\r\n    });\r\n    const [detectingLoc, setDetectingLoc] = useState(false);\r\n\r\n    if (!user) {\r\n        navigate('/login');\r\n        return null;\r\n    }\r\n\r\n    // Fetch Rank\r\n    useEffect(() => {\r\n        const getRank = async () => {\r\n            if (!user) return;\r\n            try {\r\n                const leaderboard = await fetchLeaderboard();\r\n                if (Array.isArray(leaderboard)) {\r\n                    // Sort descending just to be safe, though backend might already do it\r\n                    const sorted = leaderboard.sort((a: any, b: any) => (b.points || 0) - (a.points || 0));\r\n                    const myRankIndex = sorted.findIndex((u: any) => u.id === user.id || u._id === user.id);\r\n                    if (myRankIndex !== -1) {\r\n                        setRank(myRankIndex + 1);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch rank\", error);\r\n            }\r\n        };\r\n        getRank();\r\n    }, [user]);\r\n\r\n    useEffect(() => {\r\n        const loadVendorData = async () => {\r\n            if (user?.role === 'vendor') {\r\n                try {\r\n                    const vendors = await fetchVendors();\r\n                    const vendor = vendors.find(v =>\r\n                        String(v.id) === String(user.id) ||\r\n                        String(v.id) === String(user._id) ||\r\n                        String(v._id) === String(user.id)\r\n                    );\r\n                    if (vendor) {\r\n                        setMyVendor(vendor);\r\n                        setVendorForm(prev => ({\r\n                            ...prev,\r\n                            name: vendor.name,\r\n                            address: vendor.address || '',\r\n                            phone: vendor.phone || '',\r\n                            latitude: vendor.latitude || 0, // Fallback to 0 if undefined\r\n                            longitude: vendor.longitude || 0\r\n                        }));\r\n\r\n                        if (!vendor.latitude || !vendor.longitude) {\r\n                            navigate('/vendor');\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Vendor check failed\", e);\r\n                }\r\n            }\r\n        };\r\n        loadVendorData();\r\n    }, [user]);\r\n\r\n    const detectLocation = () => {\r\n        setDetectingLoc(true);\r\n        const performIPFallback = async (reason: string) => {\r\n            console.warn(`Dashboard GPS fail: ${reason}. Trying IP fallback...`);\r\n            try {\r\n                const response = await fetch('https://ipapi.co/json/');\r\n                const data = await response.json();\r\n                if (data.latitude && data.longitude) {\r\n                    setVendorForm(prev => ({\r\n                        ...prev,\r\n                        latitude: data.latitude,\r\n                        longitude: data.longitude\r\n                    }));\r\n                    toast.success(`Detected approx location: ${data.city || \"Success\"}!`);\r\n                } else {\r\n                    toast.error(\"Could not detect location automatically.\");\r\n                }\r\n            } catch (err) {\r\n                toast.error(\"Location detection failed. Please enter coordinates manually.\");\r\n            } finally {\r\n                setDetectingLoc(false);\r\n            }\r\n        };\r\n\r\n        if (!navigator.geolocation) {\r\n            performIPFallback(\"GPS not supported\");\r\n            return;\r\n        }\r\n        navigator.geolocation.getCurrentPosition(\r\n            (pos) => {\r\n                setVendorForm(prev => ({\r\n                    ...prev,\r\n                    latitude: pos.coords.latitude,\r\n                    longitude: pos.coords.longitude\r\n                }));\r\n                setDetectingLoc(false);\r\n                toast.success(\"GPS Location detected!\");\r\n            },\r\n            (err) => {\r\n                let msg = \"GPS access denied.\";\r\n                if (err.code === 3) msg = \"Location timeout.\";\r\n                if (err.code === 2) msg = \"Location unavailable.\";\r\n                performIPFallback(msg);\r\n            }\r\n        );\r\n    };\r\n\r\n    const submitVendorProfile = async () => {\r\n        if (!myVendor) return;\r\n        const tid = toast.loading(\"Updating shop profile...\");\r\n        try {\r\n            // Fix type mismatch: Convert null to undefined for Vendor type\r\n            const updatePayload: Partial<Vendor> = {\r\n                ...vendorForm,\r\n                latitude: vendorForm.latitude ?? undefined,\r\n                longitude: vendorForm.longitude ?? undefined,\r\n                verified: false\r\n            };\r\n\r\n            const updated = await updateVendor(myVendor.id, updatePayload);\r\n\r\n            if (updated) {\r\n                toast.success(\"Profile submitted! Awaiting Admin verification.\", { id: tid });\r\n                setShowVendorModal(false);\r\n            } else {\r\n                toast.error(\"Failed to update profile\", { id: tid });\r\n            }\r\n        } catch (e) {\r\n            toast.error(\"Network error saving profile\", { id: tid });\r\n        }\r\n    };\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (user) {\r\n                setLoadingFavs(true);\r\n                try {\r\n                    const plants = await fetchPlants();\r\n                    setAllPlants(plants);\r\n                } catch (e) {\r\n                    console.error(\"Failed to load plants\", e);\r\n                } finally {\r\n                    setLoadingFavs(false);\r\n                }\r\n            }\r\n        };\r\n        loadData();\r\n    }, [user?.email]); // Only reload if user email changes, simplified dependency\r\n\r\n    // Compute favorites from allPlants based on user.favorites IDs\r\n    const favoritePlants = allPlants.filter(p => user?.favorites?.includes(p.id));\r\n\r\n    const handleRemoveFavorite = (plantId: string) => {\r\n        if (!user) return;\r\n        toggleFavorite(plantId); // Context handles optimistic update & API\r\n    };\r\n\r\n    // Gamification Logic - Always Active\r\n\r\n    const handlePasswordChange = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (pwdForm.new !== pwdForm.confirm) {\r\n            toast.error(\"New passwords do not match!\");\r\n            return;\r\n        }\r\n        const tid = toast.loading(\"Updating security key...\");\r\n        try {\r\n            const res = await changePassword(pwdForm.old, pwdForm.new);\r\n            if (res.success) {\r\n                toast.success(\"Password Updated Successfully!\", { id: tid });\r\n                setShowPasswordModal(false);\r\n                setPwdForm({ old: '', new: '', confirm: '' });\r\n            } else {\r\n                toast.error(res.error || \"Failed to update\", { id: tid });\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"System error updating password\", { id: tid });\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{ height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\r\n                <div className=\"pre-loader-pulse\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!user) {\r\n        navigate('/auth');\r\n        return null;\r\n    }\r\n\r\n    // Layout State\r\n    const [showCollectionModal, setShowCollectionModal] = useState(false);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            {/* GAMIFICATION NOTICE BANNER - PERMANENT */}\r\n            <div style={{\r\n                marginBottom: '1.5rem',\r\n                background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(56, 189, 248, 0.15) 100%)',\r\n                border: '1px solid rgba(255, 255, 255, 0.1)',\r\n                borderRadius: '1rem',\r\n                padding: '1.25rem',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: '0.75rem',\r\n                position: 'relative',\r\n                animation: 'slideDown 0.4s ease-out'\r\n            }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\r\n                        <div style={{ background: '#facc15', padding: '0.4rem', borderRadius: '50%', color: 'black' }}>\r\n                            <Trophy size={18} />\r\n                        </div>\r\n                        <h3 style={{ margin: 0, fontSize: '1.1rem', fontWeight: 700 }}>Grow Your Impact!</h3>\r\n                    </div>\r\n                    {/* Close button removed for permanent display */}\r\n                </div>\r\n\r\n                <p style={{ margin: 0, fontSize: '0.9rem', color: '#cbd5e1', lineHeight: '1.5' }}>\r\n                    Welcome back! Here is how your stats work:\r\n                    <br />\r\n                    <span style={{ color: '#facc15' }}>ΓÇó Points:</span> Earned by visiting & collecting plants.\r\n                    <br />\r\n                    <span style={{ color: '#38bdf8' }}>ΓÇó Ranking:</span> Increases automatically as you gain points.\r\n                    <br />\r\n                    <span style={{ color: '#10b981' }}>ΓÇó Oxygen:</span> Directly tied to the \"Air Purifying\" efficiency of your plant collection.\r\n                </p>\r\n\r\n                <Button\r\n                    size=\"sm\"\r\n                    variant=\"outline\"\r\n                    onClick={() => setShowGuide(true)}\r\n                    style={{ alignSelf: 'flex-start', fontSize: '0.8rem', borderColor: 'rgba(255,255,255,0.2)' }}\r\n                >\r\n                    View Full Level-Up Guide <ArrowRight size={14} style={{ marginLeft: '4px' }} />\r\n                </Button>\r\n            </div>\r\n\r\n            {/* VENDOR ONBOARDING MODAL */}\r\n            {showVendorModal && (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, zIndex: 1000,\r\n                    background: 'rgba(0,0,0,0.8)', backdropFilter: 'blur(8px)',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem'\r\n                }}>\r\n                    <div style={{\r\n                        width: '100%', maxWidth: '500px',\r\n                        background: 'var(--color-bg-card)', border: '1px solid var(--glass-border)',\r\n                        borderRadius: '1.5rem', padding: '2rem',\r\n                        boxShadow: '0 20px 50px rgba(0,0,0,0.3)',\r\n                        animation: 'fadeIn 0.3s ease-out'\r\n                    }}>\r\n                        <div style={{ textAlign: 'center', marginBottom: '2rem' }}>\r\n                            <div style={{ display: 'inline-flex', padding: '1rem', background: 'rgba(250, 204, 21, 0.1)', borderRadius: '50%', marginBottom: '1rem' }}>\r\n                                <Store size={32} color=\"#facc15\" />\r\n                            </div>\r\n                            <h2 style={{ fontSize: '1.8rem', fontWeight: 800, margin: 0 }}>Register Your Shop</h2>\r\n                            <p style={{ color: 'var(--color-text-muted)', marginTop: '0.5rem' }}>\r\n                                To appear on the \"Nearby Shops\" map, we need your exact location.\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Shop Name</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={vendorForm.name}\r\n                                    onChange={e => setVendorForm({ ...vendorForm, name: e.target.value })}\r\n                                    style={{\r\n                                        width: '100%', padding: '0.8rem', borderRadius: '0.75rem',\r\n                                        background: 'rgba(255,255,255,0.05)', border: '1px solid var(--glass-border)',\r\n                                        color: 'var(--color-text-main)'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Phone / WhatsApp</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={vendorForm.phone}\r\n                                    placeholder=\"+91...\"\r\n                                    onChange={e => setVendorForm({ ...vendorForm, phone: e.target.value })}\r\n                                    style={{\r\n                                        width: '100%', padding: '0.8rem', borderRadius: '0.75rem',\r\n                                        background: 'rgba(255,255,255,0.05)', border: '1px solid var(--glass-border)',\r\n                                        color: 'var(--color-text-main)'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Store Coordinates (GPS)</label>\r\n                                <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        readOnly\r\n                                        placeholder=\"Latitude\"\r\n                                        value={vendorForm.latitude || ''}\r\n                                        style={{ flex: 1, padding: '0.8rem', borderRadius: '0.75rem', background: 'rgba(0,0,0,0.2)', border: 'none', color: 'var(--color-text-muted)' }}\r\n                                    />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        readOnly\r\n                                        placeholder=\"Longitude\"\r\n                                        value={vendorForm.longitude || ''}\r\n                                        style={{ flex: 1, padding: '0.8rem', borderRadius: '0.75rem', background: 'rgba(0,0,0,0.2)', border: 'none', color: 'var(--color-text-muted)' }}\r\n                                    />\r\n                                </div>\r\n                                <Button\r\n                                    onClick={detectLocation}\r\n                                    disabled={detectingLoc}\r\n                                    variant=\"outline\"\r\n                                    style={{\r\n                                        width: '100%', marginTop: '0.5rem',\r\n                                        display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem'\r\n                                    }}\r\n                                >\r\n                                    {detectingLoc ? <Loader2 className=\"animate-spin\" size={16} /> : <MapPin size={16} />}\r\n                                    {vendorForm.latitude ? 'Update GPS Location' : 'Auto-Detect My Shop Location'}\r\n                                </Button>\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Full Address</label>\r\n                                <textarea\r\n                                    value={vendorForm.address}\r\n                                    onChange={e => setVendorForm({ ...vendorForm, address: e.target.value })}\r\n                                    placeholder=\"Street, City, Landmark...\"\r\n                                    style={{\r\n                                        width: '100%', padding: '0.8rem', borderRadius: '0.75rem',\r\n                                        background: 'rgba(255,255,255,0.05)', border: '1px solid var(--glass-border)',\r\n                                        color: 'var(--color-text-main)', minHeight: '80px'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ marginTop: '2rem', display: 'flex', gap: '1rem' }}>\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => setShowVendorModal(false)}\r\n                                style={{ flex: 1 }}\r\n                            >\r\n                                Cancel\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"primary\"\r\n                                onClick={submitVendorProfile}\r\n                                disabled={!vendorForm.latitude || !vendorForm.name}\r\n                                style={{ flex: 2, background: 'var(--color-primary)', color: 'white' }}\r\n                            >\r\n                                Save & Go Live\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* PASSWORD RESET MODAL */}\r\n            {showPasswordModal && (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, zIndex: 1001,\r\n                    background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(8px)',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem'\r\n                }}>\r\n                    <div className=\"glass-panel\" style={{\r\n                        width: '100%', maxWidth: '400px', padding: '2.5rem', borderRadius: '24px'\r\n                    }}>\r\n                        <div style={{ textAlign: 'center', marginBottom: '2rem' }}>\r\n                            <div className={styles.passwordModalIcon}>\r\n                                <Lock size={28} />\r\n                            </div>\r\n                            <h2 className={styles.passwordModalTitle}>Update Security</h2>\r\n                            <p className={styles.passwordModalSubtitle}>Change your account password</p>\r\n                        </div>\r\n                        <form onSubmit={handlePasswordChange} style={{ display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 600, color: '#94a3b8' }}>Current Password</label>\r\n                                <input\r\n                                    type=\"password\" required\r\n                                    value={pwdForm.old}\r\n                                    onChange={e => setPwdForm({ ...pwdForm, old: e.target.value })}\r\n                                    style={{ width: '100%', padding: '0.9rem', borderRadius: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', color: 'white' }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 600, color: '#94a3b8' }}>New Password</label>\r\n                                <input\r\n                                    type=\"password\" required\r\n                                    value={pwdForm.new}\r\n                                    onChange={e => setPwdForm({ ...pwdForm, new: e.target.value })}\r\n                                    style={{ width: '100%', padding: '0.9rem', borderRadius: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', color: 'white' }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 600, color: '#94a3b8' }}>Confirm New Password</label>\r\n                                <input\r\n                                    type=\"password\" required\r\n                                    value={pwdForm.confirm}\r\n                                    onChange={e => setPwdForm({ ...pwdForm, confirm: e.target.value })}\r\n                                    style={{ width: '100%', padding: '0.9rem', borderRadius: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', color: 'white' }}\r\n                                />\r\n                            </div>\r\n\r\n                            <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>\r\n                                <Button type=\"button\" variant=\"outline\" onClick={() => setShowPasswordModal(false)} style={{ flex: 1 }}>Cancel</Button>\r\n                                <Button type=\"submit\" variant=\"primary\" style={{ flex: 2 }}>Update Now</Button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* PREMIUM STATS BOARD */}\r\n            <div className={styles.statsBoard}>\r\n                {/* Points Card */}\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', color: 'white' }}>\r\n                        <Zap size={20} />\r\n                    </div>\r\n                    <div className={styles.statInfo}>\r\n                        <div className={styles.statValue}>{user.points || 0}</div>\r\n                        <div className={styles.statLabel}>Points</div>\r\n                    </div>\r\n                    <div className={styles.statTrend} style={{ color: '#10b981' }}>\r\n                        <TrendingUp size={12} /> +12%\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Rank Card */}\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'linear-gradient(135deg, #facc15 0%, #ca8a04 100%)', color: 'black' }}>\r\n                        <Trophy size={20} />\r\n                    </div>\r\n                    <div className={styles.statInfo}>\r\n                        <div className={styles.statValue}>{rank ? `#${rank}` : 'N/A'}</div>\r\n                        <div className={styles.statLabel}>Ranking</div>\r\n                    </div>\r\n                    <div className={styles.statTrend} style={{ color: '#facc15' }}>\r\n                        <Award size={12} /> Elite\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Impact Card */}\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)', color: 'white' }}>\r\n                        <Wind size={20} />\r\n                    </div>\r\n                    <div className={styles.statInfo}>\r\n                        <div className={styles.statValue}>{((favoritePlants.length || items.length) * 1.2).toFixed(1)}L</div>\r\n                        <div className={styles.statLabel}>Oxygen</div>\r\n                    </div>\r\n                    <div className={styles.statTrend} style={{ color: '#3b82f6' }}>\r\n                        Positive\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Permissions Card */}\r\n                <div className={styles.statCard} onClick={() => window.dispatchEvent(new CustomEvent('toggleVanaPermissions'))} style={{ cursor: 'pointer', border: '1px dashed rgba(16, 185, 129, 0.3)' }}>\r\n                    <div className={styles.statIcon} style={{ background: 'linear-gradient(135deg, #818cf8 0%, #4f46e5 100%)', color: 'white' }}>\r\n                        <Shield size={20} />\r\n                    </div>\r\n                    <div className={styles.statInfo}>\r\n                        <div className={styles.statValue} style={{ fontSize: '0.9rem' }}>Privacy</div>\r\n                        <div className={styles.statLabel}>System Access</div>\r\n                    </div>\r\n                    <div className={styles.statTrend} style={{ color: '#10b981' }}>\r\n                        Manage\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.header}>\r\n                <div className={styles.titleSection}>\r\n                    <div className={styles.welcomeTag}>VANAMAP ECOSYSTEM</div>\r\n                    <h1 className={styles.dashboardTitle}>\r\n                        Hello, {user.name.split(' ')[0]}!\r\n                    </h1>\r\n                </div>\r\n\r\n                <div className={styles.actionGroup}>\r\n                    <button onClick={() => setShowPasswordModal(true)} className={styles.iconActionBtn} title=\"Security Settings\">\r\n                        <Lock size={18} />\r\n                    </button>\r\n\r\n                    {user.role === 'vendor' && (\r\n                        <Button onClick={() => navigate('/vendor')} variant=\"primary\" size=\"sm\" style={{ padding: '0.6rem 1.2rem', borderRadius: '0.75rem' }}>\r\n                            <Store size={18} /> Shop Portal\r\n                        </Button>\r\n                    )}\r\n\r\n                    {user.role === 'admin' && (\r\n                        <button\r\n                            onClick={() => navigate('/admin')}\r\n                            className={styles.adminHubBtn}\r\n                        >\r\n                            <Shield size={18} />\r\n                            ADMIN\r\n                        </button>\r\n                    )}\r\n\r\n                    <button onClick={() => setShowGuide(true)} className={styles.iconActionBtn} title=\"How to Level Up?\" style={{ color: '#38bdf8', borderColor: 'rgba(56, 189, 248, 0.3)', background: 'rgba(56, 189, 248, 0.1)' }}>\r\n                        <HelpCircle size={18} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* GAMIFICATION GUIDE MODAL */}\r\n            {showGuide && (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, zIndex: 1001,\r\n                    background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(8px)',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem'\r\n                }} onClick={() => setShowGuide(false)}>\r\n                    <div className=\"glass-panel\" style={{\r\n                        width: '100%', maxWidth: '500px', padding: '2rem', borderRadius: '24px',\r\n                        border: '1px solid rgba(255, 255, 255, 0.1)',\r\n                        animation: 'popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)'\r\n                    }} onClick={e => e.stopPropagation()}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>\r\n                            <h2 style={{ fontSize: '1.5rem', fontWeight: 800, margin: 0, display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\r\n                                <Zap className=\"text-yellow-400\" /> Level Up Guide\r\n                            </h2>\r\n                            <button onClick={() => setShowGuide(false)} style={{ background: 'transparent', border: 'none', color: '#94a3b8', cursor: 'pointer' }}><span style={{ fontSize: '1.5rem' }}>├ù</span></button>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>\r\n                            <div style={{ background: 'rgba(255,255,255,0.03)', padding: '1rem', borderRadius: '1rem', border: '1px solid rgba(255,255,255,0.05)' }}>\r\n                                <h3 style={{ fontSize: '1rem', fontWeight: 700, color: '#facc15', margin: '0 0 0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}><Zap size={16} /> How to earn Points?</h3>\r\n                                <ul style={{ margin: 0, paddingLeft: '1.5rem', color: '#cbd5e1', fontSize: '0.9rem', lineHeight: '1.6' }}>\r\n                                    <li>Add plants to your <strong>Favorites</strong> (+10 pts)</li>\r\n                                    <li>Add items to your <strong>Cart</strong> (+5 pts)</li>\r\n                                    <li>Visit the app daily (+2 pts)</li>\r\n                                    <li>Complete your profile (+50 pts)</li>\r\n                                </ul>\r\n                            </div>\r\n\r\n                            <div style={{ background: 'rgba(255,255,255,0.03)', padding: '1rem', borderRadius: '1rem', border: '1px solid rgba(255,255,255,0.05)' }}>\r\n                                <h3 style={{ fontSize: '1rem', fontWeight: 700, color: '#38bdf8', margin: '0 0 0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}><Trophy size={16} /> Ranking System</h3>\r\n                                <p style={{ margin: 0, color: '#cbd5e1', fontSize: '0.9rem', lineHeight: '1.6' }}>\r\n                                    Your rank is determined by your total points.\r\n                                </p>\r\n                                <div style={{ display: 'flex', gap: '0.5rem', marginTop: '0.8rem', fontSize: '0.8rem' }}>\r\n                                    <span style={{ padding: '2px 8px', borderRadius: '4px', background: 'rgba(255,255,255,0.1)', color: '#94a3b8' }}>0-100: Seed</span>\r\n                                    <span style={{ padding: '2px 8px', borderRadius: '4px', background: 'rgba(16, 185, 129, 0.2)', color: '#10b981' }}>100+: Sprout</span>\r\n                                    <span style={{ padding: '2px 8px', borderRadius: '4px', background: 'rgba(250, 204, 21, 0.2)', color: '#facc15' }}>500+: Elite</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div style={{ background: 'rgba(255,255,255,0.03)', padding: '1rem', borderRadius: '1rem', border: '1px solid rgba(255,255,255,0.05)' }}>\r\n                                <h3 style={{ fontSize: '1rem', fontWeight: 700, color: '#10b981', margin: '0 0 0.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}><Wind size={16} /> Increasing Oxygen</h3>\r\n                                <p style={{ margin: 0, color: '#cbd5e1', fontSize: '0.9rem', lineHeight: '1.6' }}>\r\n                                    The Oxygen level represents the cumulative air-purifying impact of your plant collection.\r\n                                    <br /><br />\r\n                                    <strong>Tip:</strong> Add high-oxygen plants like <em>Clean Air</em> varieties to boost this stat massively!\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ marginTop: '1.5rem', textAlign: 'center' }}>\r\n                            <Button variant=\"primary\" onClick={() => setShowGuide(false)} style={{ width: '100%' }}>Got it! Time to Grow ≡ƒî▒</Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {user.role === 'admin' && (\r\n                <div className={styles.adminMiniPanel}>\r\n                    <div className={styles.adminMiniHeader}>\r\n                        <div className={styles.adminStatus}>ΓÇó System Root Active</div>\r\n                        <Button onClick={() => navigate('/admin')} variant=\"outline\" size=\"sm\" style={{ fontSize: '0.7rem', height: '30px', padding: '0 12px' }}>\r\n                            Open Panel\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* MAIN ACTION GRID (Cleaned up from lists) */}\r\n            <div className={styles.actionGrid} style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>\r\n\r\n                {/* 1. HALL OF FAME BUTTON */}\r\n                <div onClick={() => navigate('/leaderboard')} className={styles.actionCard} style={{\r\n                    background: 'linear-gradient(145deg, rgba(250, 204, 21, 0.1), rgba(0,0,0,0.2))',\r\n                    border: '1px solid rgba(250, 204, 21, 0.2)',\r\n                    padding: '1.5rem', borderRadius: '1.5rem',\r\n                    display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '0.75rem',\r\n                    cursor: 'pointer', transition: 'all 0.2s'\r\n                }}>\r\n                    <div style={{ background: 'rgba(250, 204, 21, 0.2)', padding: '1rem', borderRadius: '50%', color: '#facc15' }}>\r\n                        <Trophy size={28} />\r\n                    </div>\r\n                    <div style={{ textAlign: 'center' }}>\r\n                        <h3 style={{ margin: 0, fontSize: '1rem', fontWeight: 700, color: 'white' }}>Hall of Fame</h3>\r\n                        <p style={{ margin: '4px 0 0', fontSize: '0.75rem', color: 'rgba(255,255,255,0.5)' }}>View Top Rankers</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 2. COLLECTION BUTTON */}\r\n                <div onClick={() => setShowCollectionModal(true)} className={styles.actionCard} style={{\r\n                    background: 'linear-gradient(145deg, rgba(244, 63, 94, 0.1), rgba(0,0,0,0.2))',\r\n                    border: '1px solid rgba(244, 63, 94, 0.2)',\r\n                    padding: '1.5rem', borderRadius: '1.5rem',\r\n                    display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '0.75rem',\r\n                    cursor: 'pointer', transition: 'all 0.2s'\r\n                }}>\r\n                    <div style={{ background: 'rgba(244, 63, 94, 0.2)', padding: '1rem', borderRadius: '50%', color: '#f43f5e' }}>\r\n                        <Heart size={28} />\r\n                    </div>\r\n                    <div style={{ textAlign: 'center' }}>\r\n                        <h3 style={{ margin: 0, fontSize: '1rem', fontWeight: 700, color: 'white' }}>Collection</h3>\r\n                        <p style={{ margin: '4px 0 0', fontSize: '0.75rem', color: 'rgba(255,255,255,0.5)' }}>{user.favorites?.length || 0} Saved Items</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 3. CART BUTTON */}\r\n                <div onClick={() => navigate('/cart')} className={styles.actionCard} style={{\r\n                    background: 'linear-gradient(145deg, rgba(56, 189, 248, 0.1), rgba(0,0,0,0.2))',\r\n                    border: '1px solid rgba(56, 189, 248, 0.2)',\r\n                    padding: '1.5rem', borderRadius: '1.5rem',\r\n                    display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '0.75rem',\r\n                    cursor: 'pointer', transition: 'all 0.2s'\r\n                }}>\r\n                    <div style={{ background: 'rgba(56, 189, 248, 0.2)', padding: '1rem', borderRadius: '50%', color: '#38bdf8' }}>\r\n                        <ShoppingBag size={28} />\r\n                    </div>\r\n                    <div style={{ textAlign: 'center' }}>\r\n                        <h3 style={{ margin: 0, fontSize: '1rem', fontWeight: 700, color: 'white' }}>My Cart</h3>\r\n                        <p style={{ margin: '4px 0 0', fontSize: '0.75rem', color: 'rgba(255,255,255,0.5)' }}>{items.length} Items Pending</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* NEARBY SHOPS PREVIEW - PRESERVED BUT FULL WIDTH */}\r\n            <div className={styles.shopPreviewCard}>\r\n                <div className={styles.shopPreviewImage}>\r\n                    <div className={styles.shopPreviewOverlay}>\r\n                        <MapPin size={24} />\r\n                        <span>Find Nurseries</span>\r\n                    </div>\r\n                </div>\r\n                <Link to=\"/nearby\">\r\n                    <Button variant=\"primary\" style={{ width: '100%', borderRadius: '0.75rem' }}>Open interactive Map</Button>\r\n                </Link>\r\n            </div>\r\n\r\n            {/* COLLECTION MODAL (WINDOW) */}\r\n            {showCollectionModal && (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, zIndex: 1005,\r\n                    background: 'rgba(0,0,0,0.9)', backdropFilter: 'blur(5px)',\r\n                    display: 'flex', flexDirection: 'column',\r\n                    animation: 'fadeIn 0.2s'\r\n                }}>\r\n                    <div style={{ padding: '1.5rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderBottom: '1px solid rgba(255,255,255,0.1)' }}>\r\n                        <h2 style={{ margin: 0, fontSize: '1.4rem', fontWeight: 700, color: 'white', display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\r\n                            <Heart fill=\"#f43f5e\" stroke=\"none\" /> My Collection\r\n                        </h2>\r\n                        <button onClick={() => setShowCollectionModal(false)} style={{ background: 'rgba(255,255,255,0.1)', border: 'none', borderRadius: '50%', width: '36px', height: '36px', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                            <ArrowRight size={20} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, overflowY: 'auto', padding: '1.5rem', paddingBottom: '150px' }}>\r\n                        {loadingFavs ? (\r\n                            <div className={styles.loadingBox}><Loader2 className=\"animate-spin\" /></div>\r\n                        ) : favoritePlants.length === 0 ? (\r\n                            <div className={styles.emptyState} style={{ height: '50vh' }}>\r\n                                <Heart size={48} style={{ opacity: 0.5 }} />\r\n                                <p style={{ fontSize: '1.1rem' }}>Your collection is empty.</p>\r\n                                <Button variant=\"primary\" onClick={() => { setShowCollectionModal(false); navigate('/'); }}>Start Exploring</Button>\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.compactGrid}>\r\n                                {favoritePlants.map(plant => (\r\n                                    <div key={plant.id} className={styles.compactCard}>\r\n                                        <div className={styles.compactCardImage}>\r\n                                            <img src={plant.imageUrl} alt={plant.name} />\r\n                                            <button onClick={() => handleRemoveFavorite(plant.id)} className={styles.removeFavBtn}>\r\n                                                <Heart size={14} fill=\"#ef4444\" color=\"#ef4444\" />\r\n                                            </button>\r\n                                        </div>\r\n                                        <div className={styles.compactCardContent}>\r\n                                            <h3>{plant.name}</h3>\r\n                                            <p>{plant.scientificName}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\VendorPortal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[880,883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[880,883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadVendorData'. Either include it or remove the dependency array.","line":84,"column":8,"nodeType":"ArrayExpression","endLine":84,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadVendorData, user]","fix":{"range":[3288,3294],"text":"[loadVendorData, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3500,3503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3500,3503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup, useMapEvents, useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { Button } from '../components/common/Button';\r\nimport { Store, Phone, MessageCircle, Info, Locate, AlertTriangle, BadgeCheck } from 'lucide-react';\r\nimport { registerVendor, fetchVendors, updateVendor } from '../services/api';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\nimport type { LatLng } from 'leaflet';\r\nimport type { Vendor } from '../types';\r\nimport { VendorInventory } from '../components/features/vendor/VendorInventory';\r\nimport { MarketInsights } from '../components/features/vendor/MarketInsights';\r\nimport styles from './VendorPortal.module.css';\r\n\r\n// Fix Leaflet's default icon path issues\r\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n    iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\r\n    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\r\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\r\n});\r\n\r\n// Component to recenter map when marker moves\r\nconst RecenterMap = ({ center }: { center: LatLng }) => {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        map.flyTo(center, 15);\r\n    }, [center, map]);\r\n    return null;\r\n};\r\n\r\nfunction DraggableMarker({ pos, setPos }: { pos: L.LatLng, setPos: (pos: L.LatLng) => void }) {\r\n    useMapEvents({\r\n        click(e) {\r\n            setPos(e.latlng);\r\n            toast.success(\"Location pinned!\");\r\n        },\r\n    });\r\n\r\n    return (\r\n        <Marker\r\n            draggable={true}\r\n            eventHandlers={{\r\n                dragend: (e) => {\r\n                    const marker = e.target;\r\n                    if (marker != null) {\r\n                        setPos(marker.getLatLng());\r\n                        toast.success(\"Location updated!\");\r\n                    }\r\n                },\r\n            }}\r\n            position={pos}>\r\n            <Popup>\r\n                <div style={{ textAlign: 'center', padding: '0.5rem' }}>\r\n                    <strong style={{ display: 'block', marginBottom: '4px' }}>Shop Marker</strong>\r\n                    <span style={{ fontSize: '0.75rem', color: '#64748b' }}>Move to exact warehouse/shop spot</span>\r\n                </div>\r\n            </Popup>\r\n        </Marker>\r\n    );\r\n}\r\n\r\nexport const VendorPortal = () => {\r\n    const { user } = useAuth();\r\n    const [markerPos, setMarkerPos] = useState<L.LatLng>(new L.LatLng(20.5937, 78.9629));\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [existingVendorId, setExistingVendorId] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [isLocating, setIsLocating] = useState(false);\r\n    const [currentVendor, setCurrentVendor] = useState<Vendor | null>(null);\r\n\r\n    const [formData, setFormData] = useState({\r\n        shopName: '',\r\n        phone: '',\r\n        whatsapp: '',\r\n        address: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (user?.role === 'vendor' || user?.role === 'admin') {\r\n            loadVendorData();\r\n        }\r\n    }, [user]);\r\n\r\n    const loadVendorData = async () => {\r\n        const vendors = await fetchVendors();\r\n        if (!user) return;\r\n\r\n        const myVendor = vendors.find(v => v.id === user.id || v.id === (user as any)._id);\r\n\r\n        if (myVendor) {\r\n            setCurrentVendor(myVendor);\r\n            setIsEditing(true);\r\n            setExistingVendorId(myVendor.id);\r\n            setFormData({\r\n                shopName: myVendor.name,\r\n                phone: myVendor.phone || '',\r\n                whatsapp: myVendor.whatsapp || '',\r\n                address: myVendor.address || ''\r\n            });\r\n            if (myVendor.latitude && myVendor.longitude) {\r\n                setMarkerPos(new L.LatLng(myVendor.latitude, myVendor.longitude));\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleAutoLocate = useCallback(() => {\r\n        if (isLocating) return;\r\n        setIsLocating(true);\r\n        const tid = toast.loading(\"Accessing GPS...\");\r\n\r\n        if (!navigator.geolocation) {\r\n            toast.error(\"Geolocation is not supported by your browser\", { id: tid });\r\n            setIsLocating(false);\r\n            return;\r\n        }\r\n\r\n        navigator.geolocation.getCurrentPosition(\r\n            (pos) => {\r\n                const newPos = new L.LatLng(pos.coords.latitude, pos.coords.longitude);\r\n                setMarkerPos(newPos);\r\n                toast.success(\"Current location captured!\", { id: tid });\r\n                setIsLocating(false);\r\n            },\r\n            () => {\r\n                toast.error(\"Failed to get location. Please pin manually.\", { id: tid });\r\n                setIsLocating(false);\r\n            },\r\n            { enableHighAccuracy: true, timeout: 10000 }\r\n        );\r\n    }, [isLocating]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        const vendorData = {\r\n            id: existingVendorId || user?.id || Date.now().toString(),\r\n            name: formData.shopName,\r\n            phone: formData.phone,\r\n            whatsapp: formData.whatsapp,\r\n            address: formData.address,\r\n            latitude: markerPos.lat,\r\n            longitude: markerPos.lng,\r\n            verified: isEditing // Keep verification status if editing\r\n        };\r\n\r\n        try {\r\n            if (isEditing && existingVendorId) {\r\n                const result = await updateVendor(existingVendorId, vendorData);\r\n                if (result) toast.success(\"Shop details updated!\");\r\n                else throw new Error(\"Update failed\");\r\n            } else {\r\n                const result = await registerVendor(vendorData);\r\n                if (result) {\r\n                    toast.success(`Shop \"${formData.shopName}\" registered!`);\r\n                    setIsEditing(true);\r\n                } else {\r\n                    throw new Error(\"Registration failed\");\r\n                }\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Process failed. Please try again.\");\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.portalContainer}>\r\n            <div className={styles.header}>\r\n                <h1 className={styles.portalTitle}>\r\n                    {isEditing ? 'Shop Manager' : 'Register Shop'}\r\n                </h1>\r\n                <p className={styles.portalSubtitle}>\r\n                    {isEditing ? `Managing: ${formData.shopName}` : 'Join our network of verified plant suppliers.'}\r\n                </p>\r\n            </div>\r\n\r\n            {/* Verified Partner Banner */}\r\n            {isEditing && (\r\n                <div className={styles.verifiedBanner}>\r\n                    <div className={styles.verifiedIconBox}>\r\n                        <AlertTriangle size={24} />\r\n                    </div>\r\n                    <div className={styles.verifiedContent}>\r\n                        <div className={styles.verifiedTitle}>\r\n                            <BadgeCheck size={18} />\r\n                            Verified Partner Status\r\n                        </div>\r\n                        <p className={styles.verifiedText}>\r\n                            Get Verified to rank higher in search results and gain customer trust. Your shop will be marked as \"Verified Partner\" across the platform.\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => window.open('https://wa.me/9188773534', '_blank')}\r\n                        className={styles.whatsappBtn}\r\n                    >\r\n                        <MessageCircle size={18} />\r\n                        WhatsApp Support\r\n                        <span>Contact Admin</span>\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            <div className={styles.portalGrid}>\r\n                {/* Form Section */}\r\n                <form onSubmit={handleSubmit} className={styles.formCard}>\r\n                    <div className={styles.formSectionHeader}>\r\n                        <Store size={20} />\r\n                        <h2>Profile Settings</h2>\r\n                    </div>\r\n\r\n                    <div className={styles.formGroup}>\r\n                        <label className={styles.label}>Official Shop Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            required\r\n                            placeholder=\"e.g. Green Valley Nursery\"\r\n                            className={styles.input}\r\n                            value={formData.shopName}\r\n                            onChange={e => setFormData({ ...formData, shopName: e.target.value })}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className={styles.inputGrid}>\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}><Phone size={12} /> Phone Number</label>\r\n                            <input\r\n                                type=\"tel\"\r\n                                required\r\n                                className={styles.input}\r\n                                value={formData.phone}\r\n                                onChange={e => setFormData({ ...formData, phone: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}><MessageCircle size={12} /> WhatsApp</label>\r\n                            <input\r\n                                type=\"tel\"\r\n                                required\r\n                                className={styles.input}\r\n                                value={formData.whatsapp}\r\n                                onChange={e => setFormData({ ...formData, whatsapp: e.target.value })}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.formGroup}>\r\n                        <label className={styles.label}>Physical Address</label>\r\n                        <textarea\r\n                            rows={3}\r\n                            required\r\n                            placeholder=\"Unit #, Street Name, City, Pincode\"\r\n                            className={styles.textarea}\r\n                            value={formData.address}\r\n                            onChange={e => setFormData({ ...formData, address: e.target.value })}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className={styles.coordsBox}>\r\n                        <div className={styles.coordsInfo}>\r\n                            <h4>Global Pin</h4>\r\n                            <div className={styles.coordsValue}>\r\n                                {markerPos.lat.toFixed(6)}, {markerPos.lng.toFixed(6)}\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleAutoLocate}\r\n                            disabled={isLocating}\r\n                            className={styles.gpsBtn}\r\n                        >\r\n                            <Locate size={14} /> {isLocating ? 'Capturing...' : 'Use GPS'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <Button type=\"submit\" disabled={loading} style={{ width: '100%', borderRadius: '0.75rem', padding: '1rem', fontWeight: 800 }}>\r\n                        {loading ? 'Propagating Changes...' : (isEditing ? 'Save Profile' : 'Register Now')}\r\n                    </Button>\r\n                </form>\r\n\r\n                {/* Map & Notifications Section */}\r\n                <div className={styles.mapWrapper}>\r\n                    <div className={styles.mapHint}>\r\n                        <h3><Info size={14} /> Precise Location Required</h3>\r\n                        <p>\r\n                            Nearby search results use your shop's coordinate. Move the marker to your entrance.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className={styles.mapContainer}>\r\n                        <MapContainer center={markerPos} zoom={13} style={{ height: '100%', width: '100%' }}>\r\n                            <TileLayer\r\n                                attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n                                url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n                            />\r\n                            <DraggableMarker pos={markerPos} setPos={setMarkerPos} />\r\n                            <RecenterMap center={markerPos} />\r\n                        </MapContainer>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Inventory Section */}\r\n            {isEditing && currentVendor && (\r\n                <div style={{ marginTop: '4rem' }}>\r\n                    <MarketInsights vendorId={currentVendor.id} />\r\n                    <VendorInventory\r\n                        vendor={currentVendor}\r\n                        onUpdate={loadVendorData}\r\n                    />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ActivityFeed.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AddPlant.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1053,1056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1053,1056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14684,14687],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14684,14687],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":327,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14734,14737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14734,14737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15003,15006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15003,15006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":349,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":349,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":376,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16944,16947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16944,16947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":377,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":377,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17009,17012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17009,17012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":381,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":381,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17264,17267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17264,17267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":404,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":404,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":416,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":416,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18999,19002],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18999,19002],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19056,19059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19056,19059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19216,19219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19216,19219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":632,"column":113,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":632,"endColumn":116,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32991,32994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32991,32994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":659,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":659,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34787,34790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34787,34790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":693,"column":120,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":693,"endColumn":123,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37227,37230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37227,37230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef } from 'react';\r\nimport { Button } from '../../components/common/Button';\r\nimport { addPlant, fetchPlants, chatWithDrFlora } from '../../services/api';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { Search, Upload, Thermometer, Wind, Droplets, Leaf, ArrowRight, Sparkles, ScanLine, Bot } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { INDIAN_PLANT_DB } from '../../data/indianPlants';\r\nimport type { Plant } from '../../types';\r\nimport { PlantCard } from '../../components/features/plants/PlantCard';\r\nimport styles from './AddPlant.module.css';\r\n\r\n// --- HELPERS ---\r\nconst smartFillPlant = (sciName: string) => {\r\n    const search = sciName.toLowerCase().trim();\r\n    if (!search) return null;\r\n\r\n    const entries = Object.entries(INDIAN_PLANT_DB);\r\n    const found = entries.find(([key, val]) => {\r\n        return key.includes(search) || val.name?.toLowerCase().includes(search);\r\n    });\r\n\r\n    if (found) {\r\n        const [key, data] = found;\r\n        return {\r\n            ...(data as any),\r\n            scientificName: key,\r\n            name: data.name,\r\n            type: data.type || 'indoor',\r\n            sunlight: data.sunlight || 'medium'\r\n        };\r\n    }\r\n    return null;\r\n};\r\n\r\n// AI-powered plant data extraction\r\nconst extractPlantDataFromAI = (aiResponse: string): Partial<Plant> => {\r\n    const data: Partial<Plant> = {};\r\n\r\n    // Extract scientific name - multiple strategies for robustness\r\n    // Strategy 1: Look for \"Scientific Name:\" label\r\n    let sciMatch = aiResponse.match(/scientific name[:\\s]+([A-Z][a-z]+(?:\\s+[a-z]+)?(?:\\s+[a-z]+)?)/i);\r\n    if (sciMatch) {\r\n        data.scientificName = sciMatch[1].trim();\r\n    } else {\r\n        // Strategy 2: Look for binomial nomenclature pattern (Genus species)\r\n        sciMatch = aiResponse.match(/\\b([A-Z][a-z]+\\s+[a-z]+)\\b/);\r\n        if (sciMatch && !sciMatch[1].match(/Common Name|Type|Indoor|Outdoor|Description|Benefits|Medicinal/i)) {\r\n            data.scientificName = sciMatch[1].trim();\r\n        }\r\n    }\r\n\r\n    // Strategy 3: If still not found, check first few lines for binomial name\r\n    if (!data.scientificName) {\r\n        const firstLines = aiResponse.split('\\n').slice(0, 3).join(' ');\r\n        const binomialMatch = firstLines.match(/\\b([A-Z][a-z]+\\s+[a-z]+)\\b/);\r\n        if (binomialMatch && !binomialMatch[1].match(/Common Name|Type|Indoor|Outdoor/i)) {\r\n            data.scientificName = binomialMatch[1].trim();\r\n        }\r\n    }\r\n\r\n    // Extract common name\r\n    const nameMatch = aiResponse.match(/common name[:\\s]+([^\\n.]+)/i);\r\n    if (nameMatch) data.name = nameMatch[1].trim();\r\n\r\n    // Extract description\r\n    const descMatch = aiResponse.match(/(?:description|about)[:\\s]+([^\\n]+(?:\\n[^\\n]+)*?)(?=\\n\\n|\\n[A-Z]|$)/i);\r\n    if (descMatch) data.description = descMatch[1].trim().replace(/\\n/g, ' ').substring(0, 500);\r\n\r\n    // Extract type\r\n    if (aiResponse.match(/\\b(indoor|houseplant)\\b/i)) data.type = 'indoor';\r\n    if (aiResponse.match(/\\b(outdoor|garden)\\b/i)) data.type = 'outdoor';\r\n\r\n    // Extract sunlight\r\n    if (aiResponse.match(/\\b(full sun|direct sunlight|direct sun)\\b/i)) data.sunlight = 'direct';\r\n    else if (aiResponse.match(/\\b(bright|high light)\\b/i)) data.sunlight = 'high';\r\n    else if (aiResponse.match(/\\b(medium|moderate|partial|indirect)\\b/i)) data.sunlight = 'medium';\r\n    else if (aiResponse.match(/\\b(low light|shade)\\b/i)) data.sunlight = 'low';\r\n\r\n    // Extract temperature\r\n    const tempMatch = aiResponse.match(/(\\d+)[-ΓÇôto\\s]+(\\d+)\\s*┬░?[CF]/i);\r\n    if (tempMatch) {\r\n        let min = parseInt(tempMatch[1]);\r\n        let max = parseInt(tempMatch[2]);\r\n        if (min > 50) { min = Math.round((min - 32) * 5 / 9); max = Math.round((max - 32) * 5 / 9); }\r\n        data.idealTempMin = min;\r\n        data.idealTempMax = max;\r\n    } else { data.idealTempMin = 18; data.idealTempMax = 30; }\r\n\r\n    // Extract humidity\r\n    const humidMatch = aiResponse.match(/humidity[:\\s]+(\\d+)/i);\r\n    if (humidMatch) data.minHumidity = parseInt(humidMatch[1]);\r\n    else if (aiResponse.match(/\\bhigh humidity\\b/i)) data.minHumidity = 70;\r\n    else if (aiResponse.match(/\\bmoderate humidity\\b/i)) data.minHumidity = 50;\r\n    else data.minHumidity = 40;\r\n\r\n    // Extract oxygen level\r\n    if (aiResponse.match(/\\b(excellent|very high|purifier|air purifying)\\b/i)) data.oxygenLevel = 'very-high';\r\n    else if (aiResponse.match(/\\bhigh oxygen\\b/i)) data.oxygenLevel = 'high';\r\n    else data.oxygenLevel = 'moderate';\r\n\r\n    // Extract price\r\n    const priceMatch = aiResponse.match(/(?:price|cost|Γé╣|Rs\\.?)[:\\s]*(\\d+)/i);\r\n    data.price = priceMatch ? parseInt(priceMatch[1]) : 150;\r\n\r\n    // Extract medicinal values\r\n    const medMatch = aiResponse.match(/medicinal[:\\s]+([^\\n]+)/i);\r\n    if (medMatch) data.medicinalValues = medMatch[1].split(/[,;]/).map(v => v.trim()).filter(Boolean);\r\n\r\n    // Extract advantages\r\n    const advMatch = aiResponse.match(/(?:benefits?|advantages?|uses)[:\\s]+([^\\n]+(?:\\n[^\\n]+)*?)(?=\\n\\n|\\n[A-Z]|$)/i);\r\n    if (advMatch) data.advantages = advMatch[1].split(/[,;.\\n]/).map(v => v.trim().replace(/^[-ΓÇó*]\\s*/, '')).filter(v => v.length > 5 && v.length < 100);\r\n\r\n    // Extract lifespan\r\n    const lifeMatch = aiResponse.match(/lifespan[:\\s]+([^\\n.]+)/i);\r\n    if (lifeMatch) data.lifespan = lifeMatch[1].trim();\r\n    else if (aiResponse.match(/\\bperennial\\b/i)) data.lifespan = 'Perennial (10+ years)';\r\n    else if (aiResponse.match(/\\bannual\\b/i)) data.lifespan = 'Annual (1 year)';\r\n\r\n    // Extract leaf shape\r\n    const leafMatch = aiResponse.match(/leaf shape[:\\s]+([^\\n.]+)/i);\r\n    if (leafMatch) data.leafShape = leafMatch[1].trim();\r\n    else if (aiResponse.match(/\\bovate\\b/i)) data.leafShape = 'Ovate';\r\n\r\n    // Extract stem structure\r\n    const stemMatch = aiResponse.match(/stem[:\\s]+([^\\n.]+)/i);\r\n    if (stemMatch) data.stemStructure = stemMatch[1].trim();\r\n    else if (aiResponse.match(/\\bwoody\\b/i)) data.stemStructure = 'Woody';\r\n    else if (aiResponse.match(/\\bherbaceous\\b/i)) data.stemStructure = 'Herbaceous';\r\n    else if (aiResponse.match(/\\bsucculent\\b/i)) data.stemStructure = 'Succulent';\r\n\r\n    // Extract growth habit\r\n    const habitMatch = aiResponse.match(/(?:growth habit|habit)[:\\s]+([^\\n.]+)/i);\r\n    if (habitMatch) data.overallHabit = habitMatch[1].trim();\r\n    else if (aiResponse.match(/\\b(climbing|vine)\\b/i)) data.overallHabit = 'Climbing';\r\n    else if (aiResponse.match(/\\bbushy\\b/i)) data.overallHabit = 'Bushy';\r\n    else if (aiResponse.match(/\\bupright\\b/i)) data.overallHabit = 'Upright';\r\n\r\n    // Extract foliage texture\r\n    if (aiResponse.match(/\\bglossy\\b/i)) data.foliageTexture = 'Glossy';\r\n    else if (aiResponse.match(/\\bmatte\\b/i)) data.foliageTexture = 'Matte';\r\n    else if (aiResponse.match(/\\bfuzzy\\b/i)) data.foliageTexture = 'Fuzzy';\r\n\r\n    // Extract distinctive features\r\n    const featMatch = aiResponse.match(/(?:distinctive|features?)[:\\s]+([^\\n]+(?:\\n[^\\n]+)*?)(?=\\n\\n|\\n[A-Z]|$)/i);\r\n    if (featMatch) data.biometricFeatures = featMatch[1].split(/[,;.\\n]/).map(v => v.trim().replace(/^[-ΓÇó*]\\s*/, '')).filter(v => v.length > 5 && v.length < 80);\r\n\r\n    // Extract pet safety\r\n    if (aiResponse.match(/\\b(pet safe|pet friendly|non-toxic to pets|safe for pets)\\b/i)) {\r\n        data.petFriendly = true;\r\n    } else if (aiResponse.match(/\\b(toxic to pets|poisonous to pets|harmful to pets|not pet safe)\\b/i)) {\r\n        data.petFriendly = false;\r\n    }\r\n\r\n    // Extract nocturnal/CAM photosynthesis\r\n    if (aiResponse.match(/\\b(CAM|nocturnal|night oxygen|produces oxygen at night)\\b/i)) {\r\n        data.isNocturnal = true;\r\n    }\r\n\r\n    // Extract ecosystem\r\n    if (aiResponse.match(/\\b(tropical|rainforest)\\b/i)) data.ecosystem = 'Tropical';\r\n    else if (aiResponse.match(/\\b(desert|arid)\\b/i)) data.ecosystem = 'Desert';\r\n    else if (aiResponse.match(/\\b(temperate|woodland)\\b/i)) data.ecosystem = 'Temperate';\r\n    else if (aiResponse.match(/\\b(mediterranean)\\b/i)) data.ecosystem = 'Mediterranean';\r\n\r\n    return data;\r\n};\r\n\r\nconst compressImage = (file: File): Promise<string> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = (event) => {\r\n            const img = new Image();\r\n            img.src = event.target?.result as string;\r\n            img.onload = () => {\r\n                const canvas = document.createElement('canvas');\r\n                const MAX_WIDTH = 800;\r\n                const MAX_HEIGHT = 800;\r\n                let width = img.width;\r\n                let height = img.height;\r\n                if (width > height && width > MAX_WIDTH) {\r\n                    height *= MAX_WIDTH / width;\r\n                    width = MAX_WIDTH;\r\n                } else if (height > MAX_HEIGHT) {\r\n                    width *= MAX_HEIGHT / height;\r\n                    height = MAX_HEIGHT;\r\n                }\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n                const ctx = canvas.getContext('2d');\r\n                ctx?.drawImage(img, 0, 0, width, height);\r\n                resolve(canvas.toDataURL('image/jpeg', 0.8));\r\n            };\r\n            img.onerror = reject;\r\n        };\r\n        reader.onerror = reject;\r\n    });\r\n};\r\n\r\nexport const AddPlant = () => {\r\n    const [scientificNameSearch, setScientificNameSearch] = useState('');\r\n\r\n    const [newPlant, setNewPlant] = useState<Partial<Plant>>({\r\n        name: '',\r\n        scientificName: '',\r\n        description: '',\r\n        imageUrl: '',\r\n        price: 0,\r\n        type: 'indoor',\r\n        sunlight: 'medium',\r\n        idealTempMin: 18,\r\n        idealTempMax: 30,\r\n        minHumidity: 40,\r\n        oxygenLevel: 'high',\r\n        medicinalValues: [],\r\n        advantages: [],\r\n        foliageTexture: '',\r\n        leafShape: '',\r\n        stemStructure: '',\r\n        overallHabit: '',\r\n        biometricFeatures: [],\r\n        lifespan: ''\r\n    });\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const [aiLoading, setAiLoading] = useState(false);\r\n\r\n    const handleAIAutoFill = async () => {\r\n        if (!scientificNameSearch.trim()) {\r\n            toast.error(\"Please enter a plant name first\");\r\n            return;\r\n        }\r\n\r\n        setAiLoading(true);\r\n        const tid = toast.loading(\"≡ƒñû Dr. Flora is researching...\");\r\n\r\n        try {\r\n            // Create a structured prompt for Dr. Flora\r\n            const prompt = `Please provide comprehensive information about the plant: \"${scientificNameSearch}\". \r\n\r\nIMPORTANT: Start your response with the scientific name in binomial nomenclature format (Genus species).\r\n\r\nInclude the following details in a structured format:\r\n- Scientific Name: (MUST be in binomial nomenclature format, e.g., Rosa damascena)\r\n- Common Name:\r\n- Description: (2-3 sentences about the plant)\r\n- Type: (indoor or outdoor)\r\n- Sunlight: (low, medium, high, or direct)\r\n- Temperature Range: (in Celsius, format: XX-XX┬░C)\r\n- Humidity: (percentage)\r\n- Oxygen Level: (low, moderate, high, or very-high)\r\n- Pet Safety: (Is it safe for pets? toxic or non-toxic)\r\n- CAM Photosynthesis: (Does it produce oxygen at night?)\r\n- Ecosystem: (Tropical, Desert, Temperate, or Mediterranean)\r\n- Medicinal Values: (comma-separated list)\r\n- Benefits/Advantages: (comma-separated list)\r\n- Lifespan: (e.g., Perennial, Annual, etc.)\r\n- Leaf Shape: (e.g., Ovate, Lanceolate)\r\n- Stem Structure: (e.g., Woody, Herbaceous)\r\n- Growth Habit: (e.g., Climbing, Bushy)\r\n- Distinctive Features: (comma-separated)\r\n\r\nPlease be specific and accurate.`;\r\n\r\n            const response = await chatWithDrFlora(\r\n                [{ role: 'user', content: prompt }],\r\n                { timezone: Intl.DateTimeFormat().resolvedOptions().timeZone }\r\n            );\r\n\r\n            const aiText = response.choices?.[0]?.message?.content;\r\n\r\n            if (!aiText) {\r\n                toast.error(\"Dr. Flora couldn't find information\", { id: tid });\r\n                return;\r\n            }\r\n\r\n            // Extract data from AI response\r\n            const extractedData = extractPlantDataFromAI(aiText);\r\n\r\n            // Merge with existing data\r\n            setNewPlant(prev => ({\r\n                ...prev,\r\n                ...extractedData,\r\n                // Preserve existing values if AI didn't provide them\r\n                name: extractedData.name || prev.name,\r\n                scientificName: extractedData.scientificName || prev.scientificName,\r\n                description: extractedData.description || prev.description,\r\n                type: extractedData.type || prev.type,\r\n                sunlight: extractedData.sunlight || prev.sunlight,\r\n                price: extractedData.price || prev.price,\r\n                idealTempMin: extractedData.idealTempMin || prev.idealTempMin,\r\n                idealTempMax: extractedData.idealTempMax || prev.idealTempMax,\r\n                minHumidity: extractedData.minHumidity || prev.minHumidity,\r\n                oxygenLevel: extractedData.oxygenLevel || prev.oxygenLevel,\r\n                medicinalValues: extractedData.medicinalValues || prev.medicinalValues,\r\n                advantages: extractedData.advantages || prev.advantages,\r\n                lifespan: extractedData.lifespan || prev.lifespan,\r\n                leafShape: extractedData.leafShape || prev.leafShape,\r\n                stemStructure: extractedData.stemStructure || prev.stemStructure,\r\n                overallHabit: extractedData.overallHabit || prev.overallHabit,\r\n                foliageTexture: extractedData.foliageTexture || prev.foliageTexture,\r\n                biometricFeatures: extractedData.biometricFeatures || prev.biometricFeatures\r\n            }));\r\n\r\n            toast.success(`Γ£¿ Auto-filled by Dr. Flora!`, { id: tid });\r\n            console.log('[AI Auto-Fill] Extracted data:', extractedData);\r\n            console.log('[AI Auto-Fill] Full response:', aiText);\r\n\r\n        } catch (error) {\r\n            console.error('[AI Auto-Fill] Error:', error);\r\n            toast.error(\"Dr. Flora is unavailable. Try manual entry.\", { id: tid });\r\n        } finally {\r\n            setAiLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSmartFill = () => {\r\n        if (!scientificNameSearch) return;\r\n        const found = smartFillPlant(scientificNameSearch);\r\n        if (found) {\r\n            setNewPlant(prev => ({\r\n                ...prev,\r\n                name: found.name || prev.name,\r\n                scientificName: found.scientificName,\r\n                description: found.description || prev.description,\r\n                type: (found.type === 'herb' ? 'outdoor' : found.type) as any,\r\n                sunlight: found.sunlight as any,\r\n                idealTempMin: found.idealTempMin || prev.idealTempMin,\r\n                idealTempMax: found.idealTempMax || prev.idealTempMax,\r\n                minHumidity: found.minHumidity || prev.minHumidity,\r\n                oxygenLevel: found.oxygenLevel as any || prev.oxygenLevel,\r\n                medicinalValues: found.medicinalValues || [],\r\n                advantages: found.advantages || []\r\n            }));\r\n            toast.success(`Populated: ${found.name}`, { icon: 'Γ£¿' });\r\n        } else {\r\n            toast.error(\"Specimen not found in database.\");\r\n        }\r\n    };\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n        const tid = toast.loading(\"Processing...\");\r\n        try {\r\n            const compressedBase64 = await compressImage(file);\r\n            setNewPlant({ ...newPlant, imageUrl: compressedBase64 });\r\n            toast.success(\"Image Set\", { id: tid });\r\n        } catch (err) {\r\n            toast.error(\"Image Error\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleAddPlant = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const tid = toast.loading(\"Saving Specimen...\");\r\n        try {\r\n            // Check for existing scientific name\r\n            const existingPlants = await fetchPlants();\r\n            const isDuplicate = existingPlants.some(p =>\r\n                p.scientificName?.toLowerCase().trim() === newPlant.scientificName?.toLowerCase().trim()\r\n            );\r\n\r\n            if (isDuplicate) {\r\n                toast.error(\"The plant is already enrolled\", { id: tid });\r\n                return;\r\n            }\r\n\r\n            const plantData: Plant = {\r\n                id: crypto.randomUUID(),\r\n                name: newPlant.name || 'Unknown',\r\n                scientificName: newPlant.scientificName || 'Unknown',\r\n                description: newPlant.description || 'No description.',\r\n                imageUrl: newPlant.imageUrl || 'https://images.unsplash.com/photo-1459411552884-841db9b3cc2a?auto=format&fit=crop',\r\n                price: Number(newPlant.price),\r\n                type: newPlant.type as any || 'indoor',\r\n                sunlight: newPlant.sunlight as any || 'medium',\r\n                idealTempMin: Number(newPlant.idealTempMin),\r\n                idealTempMax: Number(newPlant.idealTempMax),\r\n                minHumidity: Number(newPlant.minHumidity),\r\n                oxygenLevel: newPlant.oxygenLevel as any || 'moderate',\r\n                medicinalValues: newPlant.medicinalValues || [],\r\n                advantages: newPlant.advantages || [],\r\n                isNocturnal: false,\r\n                foliageTexture: newPlant.foliageTexture,\r\n                leafShape: newPlant.leafShape,\r\n                stemStructure: newPlant.stemStructure,\r\n                overallHabit: newPlant.overallHabit,\r\n                biometricFeatures: newPlant.biometricFeatures || [],\r\n                lifespan: newPlant.lifespan || 'Unknown'\r\n            };\r\n            await addPlant(plantData);\r\n            toast.success(\"Specimen Registered\", { id: tid });\r\n\r\n            // Reset\r\n            setNewPlant({\r\n                name: '', scientificName: '', imageUrl: '', price: 0,\r\n                type: 'indoor', sunlight: 'medium', description: '',\r\n                idealTempMin: 18, idealTempMax: 30, minHumidity: 40,\r\n                oxygenLevel: 'high', medicinalValues: [], advantages: [],\r\n                foliageTexture: '', leafShape: '', stemStructure: '', overallHabit: '', biometricFeatures: [], lifespan: ''\r\n            });\r\n            setScientificNameSearch('');\r\n        } catch (err) {\r\n            toast.error(\"Save Failed\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const previewPlant: Plant = {\r\n        id: 'preview',\r\n        name: newPlant.name || 'Botanic Name',\r\n        scientificName: newPlant.scientificName || 'Scientific classification',\r\n        description: newPlant.description || 'Plant description will appear here...',\r\n        imageUrl: newPlant.imageUrl || 'https://images.unsplash.com/photo-1459411552884-841db9b3cc2a?auto=format&fit=crop',\r\n        price: Number(newPlant.price),\r\n        type: newPlant.type as any || 'indoor',\r\n        sunlight: newPlant.sunlight as any || 'medium',\r\n        idealTempMin: 18, idealTempMax: 30,\r\n        minHumidity: Number(newPlant.minHumidity),\r\n        oxygenLevel: newPlant.oxygenLevel as any || 'moderate',\r\n        medicinalValues: [], advantages: [], isNocturnal: false\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Add New Specimen\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                <div className={styles.mainLayout}>\r\n                    {/* --- LEFT PANEL: VISUAL & PREVIEW --- */}\r\n                    <div className={styles.previewPanel}>\r\n                        {/* Dynamic Background */}\r\n                        <div\r\n                            className={styles.previewBg}\r\n                            style={{\r\n                                backgroundImage: `url(${newPlant.imageUrl || 'https://images.unsplash.com/photo-1459411552884-841db9b3cc2a?auto=format&fit=crop'})`\r\n                            }}\r\n                        />\r\n\r\n                        {/* 3D Card Containment */}\r\n                        <div className={styles.cardWrapper}>\r\n                            <PlantCard plant={previewPlant} onAdd={() => { }} />\r\n                        </div>\r\n\r\n                        {/* Interactive Overlay */}\r\n                        <div className={styles.uploadOverlay}>\r\n                            <Button\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                className=\"bg-white text-black hover:bg-slate-200 shadow-xl mb-4\"\r\n                            >\r\n                                <Upload size={18} className=\"mr-2\" /> Upload Photo\r\n                            </Button>\r\n\r\n                            <div className=\"w-64\">\r\n                                <span className=\"text-xs text-slate-300 font-medium mb-1 block text-center\">Or paste external URL</span>\r\n                                <input\r\n                                    value={newPlant.imageUrl}\r\n                                    onChange={(e) => setNewPlant({ ...newPlant, imageUrl: e.target.value })}\r\n                                    placeholder=\"https://...\"\r\n                                    className=\"w-full bg-black/50 border border-white/20 rounded px-3 py-1.5 text-xs text-white outline-none text-center focus:border-emerald-500 transition-colors\"\r\n                                    onClick={(e) => e.stopPropagation()}\r\n                                />\r\n                            </div>\r\n\r\n                            <input\r\n                                ref={fileInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                className=\"hidden\"\r\n                                onChange={handleImageUpload}\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"absolute bottom-6 flex items-center gap-2 text-slate-400 text-xs font-mono uppercase tracking-widest z-10 opacity-70\">\r\n                            <Sparkles size={12} className=\"text-emerald-400\" /> Live Preview\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* --- RIGHT PANEL: FORM --- */}\r\n                    <div className={styles.formPanel}>\r\n                        <form onSubmit={handleAddPlant}>\r\n\r\n                            {/* 1. Smart Search */}\r\n                            <div className={styles.smartSearchWrapper}>\r\n                                <div className=\"flex justify-between items-baseline mb-2\">\r\n                                    <label className=\"text-sm text-emerald-500 font-bold uppercase tracking-wider\">Quick Populator</label>\r\n                                    <div className=\"flex gap-2\">\r\n                                        {scientificNameSearch && (\r\n                                            <>\r\n                                                <button\r\n                                                    type=\"button\"\r\n                                                    onClick={handleSmartFill}\r\n                                                    className=\"text-xs bg-emerald-500/10 text-emerald-400 px-3 py-1 rounded-full uppercase font-bold tracking-widest hover:bg-emerald-500/20 transition-all flex items-center gap-1\"\r\n                                                >\r\n                                                    DB Fill <ArrowRight size={12} />\r\n                                                </button>\r\n                                                <button\r\n                                                    type=\"button\"\r\n                                                    onClick={handleAIAutoFill}\r\n                                                    disabled={aiLoading}\r\n                                                    className=\"text-xs bg-violet-500/10 text-violet-400 px-3 py-1 rounded-full uppercase font-bold tracking-widest hover:bg-violet-500/20 transition-all flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                                                >\r\n                                                    {aiLoading ? (\r\n                                                        <>\r\n                                                            <span className=\"animate-spin\">ΓÜÖ∩╕Å</span> AI Thinking...\r\n                                                        </>\r\n                                                    ) : (\r\n                                                        <>\r\n                                                            <Bot size={12} /> AI Auto-Fill\r\n                                                        </>\r\n                                                    )}\r\n                                                </button>\r\n                                            </>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"relative\">\r\n                                    <input\r\n                                        value={scientificNameSearch}\r\n                                        onChange={(e) => setScientificNameSearch(e.target.value)}\r\n                                        placeholder=\"Type a plant name (e.g. Tulsi, Rose, Aloe Vera)...\"\r\n                                        className={styles.smartSearchInput}\r\n                                    />\r\n                                    <Search size={22} className={styles.smartSearchIcon} />\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 2. Primary Identity */}\r\n                            <div className=\"mb-10\">\r\n                                <div className={styles.sectionTitle}>\r\n                                    <Leaf size={18} /> Identity\r\n                                </div>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Common Name</label>\r\n                                        <input\r\n                                            value={newPlant.name}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, name: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Peace Lily\"\r\n                                            required\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Scientific Name</label>\r\n                                        <input\r\n                                            value={newPlant.scientificName}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, scientificName: e.target.value })}\r\n                                            className={`${styles.glassInput} italic`}\r\n                                            placeholder=\"e.g. Spathiphyllum\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Description</label>\r\n                                        <textarea\r\n                                            value={newPlant.description}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, description: e.target.value })}\r\n                                            className={styles.glassTextarea}\r\n                                            placeholder=\"Describe the plant's origin, care needs, and unique features...\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Expected Lifespan</label>\r\n                                        <input\r\n                                            value={newPlant.lifespan}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, lifespan: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Perennial (10+ Years), Annual\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n\r\n                            {/* Biometric Profile */}\r\n                            <div className=\"mb-10\">\r\n                                <div className={styles.sectionTitle}>\r\n                                    <ScanLine size={18} /> Biometric Profile\r\n                                </div>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Leaf Shape</label>\r\n                                        <input\r\n                                            value={newPlant.leafShape}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, leafShape: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Ovate, Lanceolate\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Stem Structure</label>\r\n                                        <input\r\n                                            value={newPlant.stemStructure}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, stemStructure: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Woody, Succulent\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Growth Habit</label>\r\n                                        <input\r\n                                            value={newPlant.overallHabit}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, overallHabit: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Climbing, Bushy\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Distinctive Features</label>\r\n                                        <input\r\n                                            value={newPlant.biometricFeatures?.join(', ')}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, biometricFeatures: e.target.value.split(',').map(s => s.trim()) })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"Comma separated e.g. Serrated edges\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 3. Vital Metrics */}\r\n                            <div className=\"mb-10\">\r\n                                <div className={styles.sectionTitle}>\r\n                                    <Thermometer size={18} className=\"text-amber-500\" /> Vital Metrics\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Environment Type</label>\r\n                                        <select\r\n                                            value={newPlant.type}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, type: e.target.value as any })}\r\n                                            className={styles.glassSelect}\r\n                                        >\r\n                                            <option value=\"indoor\">Indoor</option>\r\n                                            <option value=\"outdoor\">Outdoor</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Base Price (Rs)</label>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={newPlant.price}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, price: Number(e.target.value) })}\r\n                                            className={styles.glassInput}\r\n                                            min=\"0\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Sunlight Control */}\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Sunlight Requirement</label>\r\n                                    <div className={styles.segmentedControl}>\r\n                                        {['low', 'medium', 'high', 'direct'].map(lvl => (\r\n                                            <button\r\n                                                key={lvl}\r\n                                                type=\"button\"\r\n                                                onClick={() => setNewPlant({ ...newPlant, sunlight: lvl as any })}\r\n                                                className={`${styles.segmentBtn} ${newPlant.sunlight === lvl ? styles.segmentBtnActive : ''}`}\r\n                                            >\r\n                                                {lvl}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Sliders & Advanced */}\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mt-8\">\r\n                                    <div>\r\n                                        <div className=\"flex justify-between items-center mb-4\">\r\n                                            <label className=\"text-xs font-bold uppercase text-slate-400 flex items-center gap-2\">\r\n                                                <Droplets size={14} className=\"text-blue-400\" /> Humidity\r\n                                            </label>\r\n                                            <span className=\"text-sm font-mono text-blue-400 font-bold\">{newPlant.minHumidity}%</span>\r\n                                        </div>\r\n                                        <div className={styles.rangeWrapper}>\r\n                                            <input\r\n                                                type=\"range\" min=\"0\" max=\"100\" step=\"10\"\r\n                                                value={newPlant.minHumidity}\r\n                                                onChange={(e) => setNewPlant({ ...newPlant, minHumidity: Number(e.target.value) })}\r\n                                                className={styles.rangeInput}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold uppercase text-slate-400 flex items-center gap-2 mb-3\">\r\n                                            <Wind size={14} className=\"text-purple-400\" /> Oxygen Output\r\n                                        </label>\r\n                                        <select\r\n                                            value={newPlant.oxygenLevel}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, oxygenLevel: e.target.value as any })}\r\n                                            className={styles.glassSelect}\r\n                                        >\r\n                                            <option value=\"low\">Low</option>\r\n                                            <option value=\"moderate\">Moderate</option>\r\n                                            <option value=\"high\">High</option>\r\n                                            <option value=\"very-high\">Purifier (Very High)</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mt-8\">\r\n                                    <div>\r\n                                        <div className=\"flex justify-between items-center mb-4\">\r\n                                            <label className=\"text-xs font-bold uppercase text-slate-400 flex items-center gap-2\">\r\n                                                <Thermometer size={14} className=\"text-amber-400\" /> Ideal Temp (Min)\r\n                                            </label>\r\n                                            <span className=\"text-sm font-mono text-amber-400 font-bold\">{newPlant.idealTempMin}┬░C</span>\r\n                                        </div>\r\n                                        <div className={styles.rangeWrapper}>\r\n                                            <input\r\n                                                type=\"range\" min=\"0\" max=\"40\" step=\"1\"\r\n                                                value={newPlant.idealTempMin}\r\n                                                onChange={(e) => setNewPlant({ ...newPlant, idealTempMin: Number(e.target.value) })}\r\n                                                className={styles.rangeInput}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <div className=\"flex justify-between items-center mb-4\">\r\n                                            <label className=\"text-xs font-bold uppercase text-slate-400 flex items-center gap-2\">\r\n                                                <Thermometer size={14} className=\"text-red-400\" /> Ideal Temp (Max)\r\n                                            </label>\r\n                                            <span className=\"text-sm font-mono text-red-400 font-bold\">{newPlant.idealTempMax}┬░C</span>\r\n                                        </div>\r\n                                        <div className={styles.rangeWrapper}>\r\n                                            <input\r\n                                                type=\"range\" min=\"0\" max=\"50\" step=\"1\"\r\n                                                value={newPlant.idealTempMax}\r\n                                                onChange={(e) => setNewPlant({ ...newPlant, idealTempMax: Number(e.target.value) })}\r\n                                                className={styles.rangeInput}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Submit Area */}\r\n                            <div className=\"pt-8 border-t border-slate-700/50 flex justify-end\">\r\n                                <button type=\"submit\" className={styles.submitBtn}>\r\n                                    Register Specimen\r\n                                </button>\r\n                            </div>\r\n\r\n                        </form>\r\n                    </div>\r\n\r\n                </div >\r\n            </div >\r\n        </AdminLayout >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AddVendor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":63,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { MapPin, Navigation, Store, CheckCircle, Globe, Crosshair } from 'lucide-react';\r\nimport { MapContainer, TileLayer, Marker, useMap, useMapEvents } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { registerVendor } from '../../services/api';\r\nimport type { Vendor } from '../../types';\r\nimport styles from './AddVendor.module.css';\r\n\r\n// Fix Leaflet's default icon path issues\r\nimport icon from 'leaflet/dist/images/marker-icon.png';\r\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\r\n\r\nconst DefaultIcon = L.icon({\r\n    iconUrl: icon,\r\n    shadowUrl: iconShadow,\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41]\r\n});\r\nL.Marker.prototype.options.icon = DefaultIcon;\r\n\r\n// Sub-component to center map when coords change\r\nconst MapUpdater = ({ center }: { center: [number, number] }) => {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        map.setView(center, map.getZoom());\r\n    }, [center, map]);\r\n    return null;\r\n};\r\n\r\n// Sub-component to handle clicks\r\nconst LocationMarker = ({ position, setPosition }: { position: [number, number], setPosition: (lat: number, lng: number) => void }) => {\r\n    useMapEvents({\r\n        click(e) {\r\n            setPosition(e.latlng.lat, e.latlng.lng);\r\n        },\r\n    });\r\n    return position === null ? null : (\r\n        <Marker position={position} />\r\n    );\r\n};\r\n\r\nexport const AddVendor = () => {\r\n    const [newVendor, setNewVendor] = useState<Partial<Vendor>>({\r\n        latitude: 28.61,\r\n        longitude: 77.23,\r\n        verified: true,\r\n        address: '',\r\n        name: ''\r\n    });\r\n\r\n    const [isLocating, setIsLocating] = useState(false);\r\n\r\n    const handleSaveVendor = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const tid = toast.loading(\"Onboarding Partner...\");\r\n        try {\r\n            await registerVendor(newVendor);\r\n            toast.success(\"Partner Onboarded Successfully\", { id: tid, icon: '≡ƒñ¥' });\r\n            setNewVendor({ latitude: 28.61, longitude: 77.23, verified: true, address: '', name: '' });\r\n        } catch (err) {\r\n            toast.error(\"Failed to register vendor\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleGPS = () => {\r\n        if (!navigator.geolocation) {\r\n            toast.error(\"Geolocation not supported\");\r\n            return;\r\n        }\r\n        setIsLocating(true);\r\n        navigator.geolocation.getCurrentPosition(\r\n            (pos) => {\r\n                setNewVendor(prev => ({\r\n                    ...prev,\r\n                    latitude: pos.coords.latitude,\r\n                    longitude: pos.coords.longitude\r\n                }));\r\n                setIsLocating(false);\r\n                toast.success(\"Location Updated\");\r\n            },\r\n            () => {\r\n                toast.error(\"Location access denied\");\r\n                setIsLocating(false);\r\n            }\r\n        );\r\n    };\r\n\r\n    const updateCoords = (lat: number, lng: number) => {\r\n        setNewVendor(prev => ({ ...prev, latitude: lat, longitude: lng }));\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Partner Onboarding\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                <div className={styles.mainCard}>\r\n                    <div className={styles.header}>\r\n                        <div className=\"flex justify-center mb-4\">\r\n                            <div className=\"p-4 bg-amber-500/20 rounded-full text-amber-500\">\r\n                                <Store size={40} />\r\n                            </div>\r\n                        </div>\r\n                        <h1 className={styles.title}>Register New Vendor</h1>\r\n                        <p className={styles.subtitle}>Add a verified garden center or nursery to the network.</p>\r\n                    </div>\r\n\r\n                    {/* --- GPS ACTION --- */}\r\n                    <div className=\"absolute top-8 right-8 z-[20]\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleGPS}\r\n                            disabled={isLocating}\r\n                            className=\"bg-amber-500 hover:bg-amber-400 text-black font-bold text-xs uppercase tracking-widest px-4 py-2 rounded-full flex items-center gap-2 transition-transform active:scale-95 shadow-lg shadow-amber-900/40 relative z-50\"\r\n                        >\r\n                            <Crosshair size={16} className={isLocating ? 'animate-spin' : ''} />\r\n                            {isLocating ? 'Locating...' : 'Use GPS'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <form onSubmit={handleSaveVendor}>\r\n                        {/* 1. Identity Section */}\r\n                        <div className={styles.section}>\r\n                            <div className={styles.sectionTitle}>\r\n                                <CheckCircle size={16} /> Partner Identity\r\n                            </div>\r\n\r\n                            <div className={styles.inputGroup}>\r\n                                <label className={styles.label}>Business Name</label>\r\n                                <input\r\n                                    className={styles.glassInput}\r\n                                    value={newVendor.name || ''}\r\n                                    onChange={e => setNewVendor({ ...newVendor, name: e.target.value })}\r\n                                    placeholder=\"e.g. Green Earth Nursery\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* 2. Visual Location Section */}\r\n                        <div className={styles.section}>\r\n                            <div className={styles.sectionTitle}>\r\n                                <Globe size={16} /> Location & Mapping\r\n                            </div>\r\n\r\n                            <div className=\"mb-4 text-xs text-slate-400 flex items-center gap-2\">\r\n                                <span className=\"bg-amber-500/10 text-amber-500 px-2 py-0.5 rounded border border-amber-500/20\">Tip</span>\r\n                                Click on the map to pinpoint the exact location.\r\n                            </div>\r\n\r\n                            {/* --- INTERACTIVE MAP --- */}\r\n                            <div className={styles.mapContainer}>\r\n                                <MapContainer\r\n                                    center={[newVendor.latitude || 28.61, newVendor.longitude || 77.23]}\r\n                                    zoom={13}\r\n                                    scrollWheelZoom={false}\r\n                                    className=\"h-full w-full\"\r\n                                    style={{ height: '100%', background: '#0f172a' }}\r\n                                >\r\n                                    <TileLayer\r\n                                        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n                                        url=\"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png\"\r\n                                    />\r\n                                    <MapUpdater center={[newVendor.latitude || 28.61, newVendor.longitude || 77.23]} />\r\n                                    <LocationMarker\r\n                                        position={[newVendor.latitude || 28.61, newVendor.longitude || 77.23]}\r\n                                        setPosition={updateCoords}\r\n                                    />\r\n                                </MapContainer>\r\n                            </div>\r\n\r\n                            <div className={styles.coordGrid}>\r\n                                <div>\r\n                                    <label className={styles.label}>Latitude</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        type=\"number\"\r\n                                        step=\"any\"\r\n                                        value={newVendor.latitude || ''}\r\n                                        onChange={e => setNewVendor({ ...newVendor, latitude: Number(e.target.value) })}\r\n                                        placeholder=\"28.61\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className={styles.label}>Longitude</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        type=\"number\"\r\n                                        step=\"any\"\r\n                                        value={newVendor.longitude || ''}\r\n                                        onChange={e => setNewVendor({ ...newVendor, longitude: Number(e.target.value) })}\r\n                                        placeholder=\"77.23\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* 3. Address Section */}\r\n                        <div className={styles.section}>\r\n                            <div className={styles.sectionTitle}>\r\n                                <Navigation size={16} /> Physical Address\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className={styles.label}>Full Street Address</label>\r\n                                <textarea\r\n                                    className={styles.glassTextarea}\r\n                                    value={newVendor.address || ''}\r\n                                    onChange={e => setNewVendor({ ...newVendor, address: e.target.value })}\r\n                                    placeholder=\"Enter the complete address for navigation purposes...\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Submit */}\r\n                        <div className=\"pt-2\">\r\n                            <button type=\"submit\" className={styles.submitBtn}>\r\n                                <MapPin size={20} />\r\n                                Confirm Registration\r\n                            </button>\r\n                        </div>\r\n\r\n                    </form>\r\n                </div>\r\n\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AdminLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AdminLogin.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":38,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Shield, Lock, Mail, ArrowLeft, Terminal } from 'lucide-react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { toast } from 'react-hot-toast';\r\nimport styles from './AdminLogin.module.css';\r\n\r\nexport const AdminLogin = () => {\r\n    const navigate = useNavigate();\r\n    const { login, user, loading: authLoading } = useAuth();\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!authLoading && user?.role === 'admin') {\r\n            navigate('/admin', { replace: true });\r\n        }\r\n    }, [user, authLoading, navigate]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsSubmitting(true);\r\n        const tid = toast.loading(\"Verifying Security Credentials...\");\r\n\r\n        try {\r\n            const result = await login({ email, password });\r\n            if (result.success) {\r\n                toast.success(\"Access Granted. Welcome, Overseer.\", { id: tid });\r\n                // Explicitly navigate to admin dashboard\r\n                setTimeout(() => {\r\n                    navigate('/admin', { replace: true });\r\n                }, 500);\r\n            } else {\r\n                toast.error(result.message || \"Invalid credentials for security level 4\", { id: tid });\r\n                setIsSubmitting(false);\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Gateway timeout. Check connection.\", { id: tid });\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.loginCard}>\r\n                <div className={styles.header}>\r\n                    <div className={styles.shieldIcon}>\r\n                        <Shield size={32} />\r\n                    </div>\r\n                    <h1 className={styles.title}>Admin Access</h1>\r\n                    <p className={styles.subtitle}>Secure Registry Terminal</p>\r\n                </div>\r\n\r\n                <form className={styles.form} onSubmit={handleSubmit}>\r\n                    <div className={styles.inputGroup}>\r\n                        <label className={styles.label}>Designation ID</label>\r\n                        <div className={styles.inputWrapper}>\r\n                            <input\r\n                                type=\"email\"\r\n                                className={styles.input}\r\n                                placeholder=\"admin@vanamap.com\"\r\n                                value={email}\r\n                                onChange={(e) => setEmail(e.target.value)}\r\n                                required\r\n                            />\r\n                            <Mail className={styles.inputIcon} size={20} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.inputGroup}>\r\n                        <label className={styles.label}>Security Key</label>\r\n                        <div className={styles.inputWrapper}>\r\n                            <input\r\n                                type=\"password\"\r\n                                className={styles.input}\r\n                                placeholder=\"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó\"\r\n                                value={password}\r\n                                onChange={(e) => setPassword(e.target.value)}\r\n                                required\r\n                            />\r\n                            <Lock className={styles.inputIcon} size={20} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        className={styles.submitBtn}\r\n                        disabled={isSubmitting}\r\n                    >\r\n                        <Terminal size={20} />\r\n                        {isSubmitting ? 'Syncing...' : 'Initialize Link'}\r\n                    </button>\r\n                </form>\r\n\r\n                <div className={styles.footer}>\r\n                    <button className={styles.backLink} onClick={() => navigate('/auth')}>\r\n                        <ArrowLeft size={16} /> Return to Primary Hub\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.securityBadge}>\r\n                <Lock size={12} />\r\n                <span>256-bit Encrypted Session</span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\CustomerSupport.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":39,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":59,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2882,2885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2882,2885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { MessageSquare, Send, CheckCircle, Clock, User, Mail, Calendar, Filter, Search } from 'lucide-react';\r\nimport { fetchSupportTickets, replyToTicket, broadcastMessage } from '../../services/api';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './CustomerSupport.module.css';\r\n\r\ninterface Ticket {\r\n    _id: string;\r\n    userId: string;\r\n    userEmail: string;\r\n    userName: string;\r\n    subject: string;\r\n    message: string;\r\n    status: 'open' | 'in_progress' | 'resolved';\r\n    adminReply?: string;\r\n    repliedAt?: Date;\r\n    createdAt: Date;\r\n}\r\n\r\nexport const CustomerSupport = () => {\r\n    const [tickets, setTickets] = useState<Ticket[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedTicket, setSelectedTicket] = useState<Ticket | null>(null);\r\n    const [replyText, setReplyText] = useState('');\r\n    const [filterStatus, setFilterStatus] = useState<'all' | 'open' | 'resolved'>('all');\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [broadcastMode, setBroadcastMode] = useState(false);\r\n    const [broadcastData, setBroadcastData] = useState({ targetId: '', title: '', message: '' });\r\n\r\n    useEffect(() => {\r\n        loadTickets();\r\n    }, []);\r\n\r\n    const loadTickets = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const data = await fetchSupportTickets();\r\n            setTickets(data);\r\n        } catch (e) {\r\n            toast.error('Failed to load tickets');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleReply = async () => {\r\n        if (!selectedTicket || !replyText.trim()) {\r\n            toast.error('Please enter a reply message');\r\n            return;\r\n        }\r\n\r\n        const tid = toast.loading('Sending reply...');\r\n        try {\r\n            await replyToTicket(selectedTicket._id, replyText);\r\n            toast.success('Reply sent! User will be notified.', { id: tid });\r\n            setReplyText('');\r\n            setSelectedTicket(null);\r\n            loadTickets();\r\n        } catch (e) {\r\n            toast.error('Failed to send reply', { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleBroadcast = async () => {\r\n        if (!broadcastData.targetId || !broadcastData.message) {\r\n            toast.error('Please fill all fields');\r\n            return;\r\n        }\r\n\r\n        const tid = toast.loading('Broadcasting...');\r\n        try {\r\n            await broadcastMessage({\r\n                type: 'specific',\r\n                targetId: broadcastData.targetId,\r\n                title: broadcastData.title,\r\n                message: broadcastData.message\r\n            });\r\n            toast.success('Message sent!', { id: tid });\r\n            setBroadcastData({ targetId: '', title: '', message: '' });\r\n            setBroadcastMode(false);\r\n        } catch (e: any) {\r\n            toast.error(e.message || 'Failed to broadcast', { id: tid });\r\n        }\r\n    };\r\n\r\n    const filteredTickets = tickets\r\n        .filter(t => filterStatus === 'all' || t.status === filterStatus)\r\n        .filter(t =>\r\n            t.userName.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n            t.userEmail.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n            t.subject.toLowerCase().includes(searchQuery.toLowerCase())\r\n        );\r\n\r\n    const stats = {\r\n        total: tickets.length,\r\n        open: tickets.filter(t => t.status === 'open').length,\r\n        resolved: tickets.filter(t => t.status === 'resolved').length\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <header className={styles.header}>\r\n                <div>\r\n                    <h1 className={styles.title}>Customer Support Hub</h1>\r\n                    <p className={styles.subtitle}>Manage inquiries and broadcast updates</p>\r\n                </div>\r\n                <button\r\n                    className={styles.broadcastBtn}\r\n                    onClick={() => setBroadcastMode(!broadcastMode)}\r\n                >\r\n                    <Send size={18} />\r\n                    {broadcastMode ? 'Close Broadcast' : 'Broadcast Message'}\r\n                </button>\r\n            </header>\r\n\r\n            {/* Stats Cards */}\r\n            <div className={styles.statsGrid}>\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'rgba(59, 130, 246, 0.1)' }}>\r\n                        <MessageSquare size={24} color=\"#3b82f6\" />\r\n                    </div>\r\n                    <div>\r\n                        <div className={styles.statValue}>{stats.total}</div>\r\n                        <div className={styles.statLabel}>Total Tickets</div>\r\n                    </div>\r\n                </div>\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'rgba(251, 146, 60, 0.1)' }}>\r\n                        <Clock size={24} color=\"#fb923c\" />\r\n                    </div>\r\n                    <div>\r\n                        <div className={styles.statValue}>{stats.open}</div>\r\n                        <div className={styles.statLabel}>Open</div>\r\n                    </div>\r\n                </div>\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'rgba(16, 185, 129, 0.1)' }}>\r\n                        <CheckCircle size={24} color=\"#10b981\" />\r\n                    </div>\r\n                    <div>\r\n                        <div className={styles.statValue}>{stats.resolved}</div>\r\n                        <div className={styles.statLabel}>Resolved</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Broadcast Panel */}\r\n            {broadcastMode && (\r\n                <div className={styles.broadcastPanel}>\r\n                    <h3 className={styles.panelTitle}>Send Direct Message to User</h3>\r\n                    <div className={styles.broadcastForm}>\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"User ID (from ticket)\"\r\n                            className={styles.input}\r\n                            value={broadcastData.targetId}\r\n                            onChange={(e) => setBroadcastData({ ...broadcastData, targetId: e.target.value })}\r\n                        />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Notification Title\"\r\n                            className={styles.input}\r\n                            value={broadcastData.title}\r\n                            onChange={(e) => setBroadcastData({ ...broadcastData, title: e.target.value })}\r\n                        />\r\n                        <textarea\r\n                            placeholder=\"Message content...\"\r\n                            className={styles.textarea}\r\n                            rows={3}\r\n                            value={broadcastData.message}\r\n                            onChange={(e) => setBroadcastData({ ...broadcastData, message: e.target.value })}\r\n                        />\r\n                        <button className={styles.sendBtn} onClick={handleBroadcast}>\r\n                            <Send size={18} /> Send Notification\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Filters */}\r\n            <div className={styles.controls}>\r\n                <div className={styles.searchBox}>\r\n                    <Search size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search tickets...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                </div>\r\n                <div className={styles.filterGroup}>\r\n                    <Filter size={18} />\r\n                    <button\r\n                        className={filterStatus === 'all' ? styles.filterActive : ''}\r\n                        onClick={() => setFilterStatus('all')}\r\n                    >\r\n                        All\r\n                    </button>\r\n                    <button\r\n                        className={filterStatus === 'open' ? styles.filterActive : ''}\r\n                        onClick={() => setFilterStatus('open')}\r\n                    >\r\n                        Open\r\n                    </button>\r\n                    <button\r\n                        className={filterStatus === 'resolved' ? styles.filterActive : ''}\r\n                        onClick={() => setFilterStatus('resolved')}\r\n                    >\r\n                        Resolved\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tickets Grid */}\r\n            {loading ? (\r\n                <div className={styles.loading}>Loading tickets...</div>\r\n            ) : (\r\n                <div className={styles.ticketsGrid}>\r\n                    {filteredTickets.map(ticket => (\r\n                        <div key={ticket._id} className={styles.ticketCard}>\r\n                            <div className={styles.ticketHeader}>\r\n                                <div className={styles.userInfo}>\r\n                                    <User size={16} />\r\n                                    <span>{ticket.userName}</span>\r\n                                </div>\r\n                                <span className={`${styles.statusBadge} ${styles[ticket.status]}`}>\r\n                                    {ticket.status}\r\n                                </span>\r\n                            </div>\r\n                            <h3 className={styles.ticketSubject}>{ticket.subject}</h3>\r\n                            <p className={styles.ticketMessage}>{ticket.message}</p>\r\n                            <div className={styles.ticketMeta}>\r\n                                <div className={styles.metaItem}>\r\n                                    <Mail size={14} />\r\n                                    {ticket.userEmail}\r\n                                </div>\r\n                                <div className={styles.metaItem}>\r\n                                    <Calendar size={14} />\r\n                                    {new Date(ticket.createdAt).toLocaleDateString()}\r\n                                </div>\r\n                            </div>\r\n                            {ticket.adminReply && (\r\n                                <div className={styles.replyPreview}>\r\n                                    <strong>Your Reply:</strong> {ticket.adminReply.substring(0, 60)}...\r\n                                </div>\r\n                            )}\r\n                            <button\r\n                                className={styles.replyBtn}\r\n                                onClick={() => setSelectedTicket(ticket)}\r\n                                disabled={ticket.status === 'resolved'}\r\n                            >\r\n                                {ticket.status === 'resolved' ? 'Resolved' : 'Reply'}\r\n                            </button>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Reply Modal */}\r\n            {selectedTicket && (\r\n                <div className={styles.modal} onClick={() => setSelectedTicket(null)}>\r\n                    <div className={styles.modalContent} onClick={(e) => e.stopPropagation()}>\r\n                        <h2 className={styles.modalTitle}>Reply to {selectedTicket.userName}</h2>\r\n                        <div className={styles.originalMessage}>\r\n                            <strong>Original Message:</strong>\r\n                            <p>{selectedTicket.message}</p>\r\n                        </div>\r\n                        <textarea\r\n                            className={styles.replyTextarea}\r\n                            rows={6}\r\n                            placeholder=\"Type your reply here...\"\r\n                            value={replyText}\r\n                            onChange={(e) => setReplyText(e.target.value)}\r\n                            autoFocus\r\n                        />\r\n                        <div className={styles.modalActions}>\r\n                            <button className={styles.cancelBtn} onClick={() => setSelectedTicket(null)}>\r\n                                Cancel\r\n                            </button>\r\n                            <button className={styles.submitBtn} onClick={handleReply}>\r\n                                <Send size={18} /> Send Reply\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\EditPlant.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":97,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4393,4396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4393,4396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5611,5614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5611,5614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":272,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11900,11903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11900,11903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13080,13083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13080,13083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":304,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":304,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13981,13984],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13981,13984],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_id' is assigned a value but never used.","line":113,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'__v' is assigned a value but never used.","line":113,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":33,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'createdAt' is assigned a value but never used.","line":113,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":44,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'updatedAt' is assigned a value but never used.","line":113,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":113,"endColumn":55,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-hot-toast';\r\nimport {\r\n    ChevronLeft, Save, Image as ImageIcon, Sparkles,\r\n    Thermometer, Droplets, Upload, Wind, Sun, Leaf, Activity,\r\n    ShieldCheck, PlusCircle, XCircle\r\n} from 'lucide-react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchPlants, updatePlant } from '../../services/api';\r\nimport type { Plant } from '../../types';\r\nimport styles from './EditPlant.module.css';\r\n\r\n// --- HELPERS ---\r\nconst compressImage = (file: File): Promise<string> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = (event) => {\r\n            const img = new Image();\r\n            img.src = event.target?.result as string;\r\n            img.onload = () => {\r\n                const canvas = document.createElement('canvas');\r\n                const MAX_WIDTH = 800;\r\n                const MAX_HEIGHT = 800;\r\n                let width = img.width;\r\n                let height = img.height;\r\n                if (width > height && width > MAX_WIDTH) {\r\n                    height *= MAX_WIDTH / width;\r\n                    width = MAX_WIDTH;\r\n                } else if (height > MAX_HEIGHT) {\r\n                    width *= MAX_HEIGHT / height;\r\n                    height = MAX_HEIGHT;\r\n                }\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n                const ctx = canvas.getContext('2d');\r\n                ctx?.drawImage(img, 0, 0, width, height);\r\n                resolve(canvas.toDataURL('image/jpeg', 0.8));\r\n            };\r\n            img.onerror = reject;\r\n        };\r\n        reader.onerror = reject;\r\n    });\r\n};\r\n\r\nexport const EditPlant = () => {\r\n    const { id } = useParams<{ id: string }>();\r\n    const navigate = useNavigate();\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [plant, setPlant] = useState<Partial<Plant>>({});\r\n    const [imageFile, setImageFile] = useState<File | null>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Tags state for array fields\r\n    const [medicinalInput, setMedicinalInput] = useState('');\r\n    const [advantageInput, setAdvantageInput] = useState('');\r\n\r\n    useEffect(() => {\r\n        const loadPlantData = async () => {\r\n            if (!id) return;\r\n            try {\r\n                const plants = await fetchPlants();\r\n                const found = plants.find(p => p.id === id);\r\n                if (found) {\r\n                    setPlant({\r\n                        ...found,\r\n                        medicinalValues: found.medicinalValues || [],\r\n                        advantages: found.advantages || []\r\n                    });\r\n                } else {\r\n                    toast.error(\"Plant not found in registry\");\r\n                    navigate('/admin/manage-plants');\r\n                }\r\n            } catch (err) {\r\n                console.error(err);\r\n                toast.error(\"Failed to load flora data\");\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        loadPlantData();\r\n    }, [id, navigate]);\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        setImageFile(file); // Store raw file for upload\r\n\r\n        const tid = toast.loading(\"Processing preview...\");\r\n        try {\r\n            const compressedBase64 = await compressImage(file);\r\n            setPlant({ ...plant, imageUrl: compressedBase64 });\r\n            toast.success(\"Image selected\", { id: tid });\r\n        } catch (err) {\r\n            toast.error(\"Preview failed\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleSave = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!id) return;\r\n\r\n        setSaving(true);\r\n        const tid = toast.loading(\"Saving changes...\");\r\n\r\n        try {\r\n            // Helper to remove immutable/system fields\r\n            const getCleanPayload = (source: Partial<Plant>) => {\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                const { _id, __v, createdAt, updatedAt, ...rest } = source as any;\r\n                return rest;\r\n            };\r\n\r\n            const payload = getCleanPayload(plant);\r\n\r\n            if (imageFile) {\r\n                const formData = new FormData();\r\n\r\n                Object.keys(payload).forEach(key => {\r\n                    const value = payload[key];\r\n                    if (value === undefined || value === null) return;\r\n\r\n                    if (key === 'imageUrl') return; // Skip image URL (handled by file)\r\n\r\n                    if (Array.isArray(value)) {\r\n                        value.forEach(item => formData.append(key, String(item)));\r\n                    } else if (typeof value === 'object') {\r\n                        formData.append(key, JSON.stringify(value));\r\n                    } else {\r\n                        formData.append(key, String(value));\r\n                    }\r\n                });\r\n\r\n                formData.append('image', imageFile);\r\n                await updatePlant(id, formData);\r\n            } else {\r\n                await updatePlant(id, payload);\r\n            }\r\n\r\n            toast.success(\"Plant updated successfully\", { id: tid });\r\n            setTimeout(() => navigate('/admin/manage-plants'), 1000);\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            toast.error(err.message || \"Update failed\", { id: tid });\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const addMedicinal = () => {\r\n        if (!medicinalInput.trim()) return;\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            medicinalValues: [...(prev.medicinalValues || []), medicinalInput.trim()]\r\n        }));\r\n        setMedicinalInput('');\r\n    };\r\n\r\n    const removeMedicinal = (index: number) => {\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            medicinalValues: (prev.medicinalValues || []).filter((_, i) => i !== index)\r\n        }));\r\n    };\r\n\r\n    const addAdvantage = () => {\r\n        if (!advantageInput.trim()) return;\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            advantages: [...(prev.advantages || []), advantageInput.trim()]\r\n        }));\r\n        setAdvantageInput('');\r\n    };\r\n\r\n    const removeAdvantage = (index: number) => {\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            advantages: (prev.advantages || []).filter((_, i) => i !== index)\r\n        }));\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <AdminLayout title=\"Specimen Analysis\">\r\n                <div className=\"flex items-center justify-center p-20 text-slate-400\">\r\n                    <div className=\"animate-pulse flex flex-col items-center gap-4\">\r\n                        <Sparkles size={48} className=\"text-blue-500 animate-spin\" />\r\n                        <p className=\"font-bold tracking-widest text-sm uppercase\">Accessing Flora Database...</p>\r\n                    </div>\r\n                </div>\r\n            </AdminLayout>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <AdminLayout title=\"Specimen Editor\">\r\n            <div className={styles.editContainer}>\r\n                <header className={styles.header}>\r\n                    <div className={styles.headerTitle}>\r\n                        <div className={styles.titleIcon}>\r\n                            <Sparkles size={24} />\r\n                        </div>\r\n                        <div className={styles.titleText}>\r\n                            <h1>{plant.name || 'New Specimen'}</h1>\r\n                            <p>Refinery ID: {id}</p>\r\n                        </div>\r\n                    </div>\r\n                    <button onClick={() => navigate(-1)} className={styles.btnCancel}>\r\n                        <ChevronLeft size={18} className=\"mr-2\" /> Back\r\n                    </button>\r\n                </header>\r\n\r\n                <form onSubmit={handleSave} className={styles.formGrid}>\r\n                    <div className={styles.formSection}>\r\n                        {/* Identity Section */}\r\n                        <div className=\"mb-8\">\r\n                            <h3 className={styles.sectionSubtitle}>\r\n                                <Leaf size={16} className=\"text-emerald-500\" /> Identity\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Common Name</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={plant.name || ''}\r\n                                        onChange={e => setPlant({ ...plant, name: e.target.value })}\r\n                                        placeholder=\"e.g. Silver Queen Snake Plant\"\r\n                                    />\r\n                                </div>\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Scientific Designation</label>\r\n                                    <input\r\n                                        className={`${styles.glassInput} italic`}\r\n                                        value={plant.scientificName || ''}\r\n                                        onChange={e => setPlant({ ...plant, scientificName: e.target.value })}\r\n                                        placeholder=\"e.g. Sansevieria trifasciata\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"mt-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Expected Lifespan</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={plant.lifespan || ''}\r\n                                        onChange={e => setPlant({ ...plant, lifespan: e.target.value })}\r\n                                        placeholder=\"e.g. Perennial, 10-15 Years\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Economics & Type Section */}\r\n                        <div className=\"mb-8\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Base Price (Rs)</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        className={styles.glassInput}\r\n                                        value={plant.price || 0}\r\n                                        onChange={e => setPlant({ ...plant, price: Number(e.target.value) })}\r\n                                    />\r\n                                </div>\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Environment Type</label>\r\n                                    <select\r\n                                        className={styles.glassSelect}\r\n                                        value={plant.type || 'indoor'}\r\n                                        onChange={e => setPlant({ ...plant, type: e.target.value as any })}\r\n                                    >\r\n                                        <option value=\"indoor\">Indoor (Lab)</option>\r\n                                        <option value=\"outdoor\">Outdoor (Natural)</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Sunlight & Oxygen */}\r\n                        <div className=\"mb-8\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Sunlight Requirement</label>\r\n                                    <div className={styles.segmentedControl}>\r\n                                        {['low', 'medium', 'high', 'direct'].map(lvl => (\r\n                                            <button\r\n                                                key={lvl}\r\n                                                type=\"button\"\r\n                                                onClick={() => setPlant({ ...plant, sunlight: lvl as any })}\r\n                                                className={`${styles.segmentBtn} ${plant.sunlight === lvl ? styles.segmentBtnActive : ''}`}\r\n                                            >\r\n                                                {lvl}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Oxygen Output</label>\r\n                                    <select\r\n                                        className={styles.glassSelect}\r\n                                        value={plant.oxygenLevel || 'moderate'}\r\n                                        onChange={e => setPlant({ ...plant, oxygenLevel: e.target.value as any })}\r\n                                    >\r\n                                        <option value=\"low\">Low Output</option>\r\n                                        <option value=\"moderate\">Moderate</option>\r\n                                        <option value=\"high\">High Purifier</option>\r\n                                        <option value=\"very-high\">Superior Purifier</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Vital Metrics (Sliders) */}\r\n                        <div className=\"mb-8\">\r\n                            <h3 className={styles.sectionSubtitle}>\r\n                                <Activity size={16} className=\"text-blue-500\" /> Vital Metrics\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 my-4\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between items-center mb-4\">\r\n                                        <label className={styles.label}>\r\n                                            <Droplets size={14} className=\"text-blue-400 inline mr-1\" /> Min Humidity\r\n                                        </label>\r\n                                        <span className=\"text-sm font-mono text-blue-400 font-bold\">{plant.minHumidity || 0}%</span>\r\n                                    </div>\r\n                                    <div className={styles.rangeWrapper}>\r\n                                        <input\r\n                                            type=\"range\" min=\"0\" max=\"100\" step=\"5\"\r\n                                            className={styles.rangeInput}\r\n                                            value={plant.minHumidity || 0}\r\n                                            onChange={e => setPlant({ ...plant, minHumidity: Number(e.target.value) })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"flex justify-between items-center mb-4\">\r\n                                        <label className={styles.label}>\r\n                                            <Thermometer size={14} className=\"text-amber-400 inline mr-1\" /> Ideal Temp (Min)\r\n                                        </label>\r\n                                        <span className=\"text-sm font-mono text-amber-400 font-bold\">{plant.idealTempMin || 18}┬░C</span>\r\n                                    </div>\r\n                                    <div className={styles.rangeWrapper}>\r\n                                        <input\r\n                                            type=\"range\" min=\"0\" max=\"40\" step=\"1\"\r\n                                            className={styles.rangeInput}\r\n                                            value={plant.idealTempMin || 18}\r\n                                            onChange={e => setPlant({ ...plant, idealTempMin: Number(e.target.value) })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mt-6\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between items-center mb-4\">\r\n                                        <label className={styles.label}>\r\n                                            <Thermometer size={14} className=\"text-red-400 inline mr-1\" /> Ideal Temp (Max)\r\n                                        </label>\r\n                                        <span className=\"text-sm font-mono text-red-400 font-bold\">{plant.idealTempMax || 30}┬░C</span>\r\n                                    </div>\r\n                                    <div className={styles.rangeWrapper}>\r\n                                        <input\r\n                                            type=\"range\" min=\"0\" max=\"50\" step=\"1\"\r\n                                            className={styles.rangeInput}\r\n                                            value={plant.idealTempMax || 30}\r\n                                            onChange={e => setPlant({ ...plant, idealTempMax: Number(e.target.value) })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* medicinalValues & Advantages Section */}\r\n                        <div className=\"mb-8 grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                            <div className={styles.inputGroup}>\r\n                                <label className={styles.label}><Activity size={14} className=\"inline mr-1\" /> Medicinal Values</label>\r\n                                <div className=\"flex gap-2 mb-2\">\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={medicinalInput}\r\n                                        onChange={e => setMedicinalInput(e.target.value)}\r\n                                        placeholder=\"Add value...\"\r\n                                        onKeyPress={e => e.key === 'Enter' && (e.preventDefault(), addMedicinal())}\r\n                                    />\r\n                                    <button type=\"button\" onClick={addMedicinal} className={styles.addTagBtn}><PlusCircle size={20} /></button>\r\n                                </div>\r\n                                <div className={styles.tagCloud}>\r\n                                    {plant.medicinalValues?.map((val, i) => (\r\n                                        <span key={i} className={styles.tag}>\r\n                                            {val} <button type=\"button\" onClick={() => removeMedicinal(i)}><XCircle size={12} /></button>\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className={styles.inputGroup}>\r\n                                <label className={styles.label}><ShieldCheck size={14} className=\"inline mr-1\" /> Key Advantages</label>\r\n                                <div className=\"flex gap-2 mb-2\">\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={advantageInput}\r\n                                        onChange={e => setAdvantageInput(e.target.value)}\r\n                                        placeholder=\"Add advantage...\"\r\n                                        onKeyPress={e => e.key === 'Enter' && (e.preventDefault(), addAdvantage())}\r\n                                    />\r\n                                    <button type=\"button\" onClick={addAdvantage} className={styles.addTagBtn}><PlusCircle size={20} /></button>\r\n                                </div>\r\n                                <div className={styles.tagCloud}>\r\n                                    {plant.advantages?.map((val, i) => (\r\n                                        <span key={i} className={styles.tag}>\r\n                                            {val} <button type=\"button\" onClick={() => removeAdvantage(i)}><XCircle size={12} /></button>\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Botanical Description</label>\r\n                            <textarea\r\n                                className={`${styles.glassInput} ${styles.textarea}`}\r\n                                value={plant.description || ''}\r\n                                onChange={e => setPlant({ ...plant, description: e.target.value })}\r\n                                placeholder=\"Enter detailed physiological characteristics...\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Asset URL (External)</label>\r\n                            <input\r\n                                className={styles.glassInput}\r\n                                value={plant.imageUrl || ''}\r\n                                onChange={e => setPlant({ ...plant, imageUrl: e.target.value })}\r\n                                placeholder=\"https://...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.imageSection}>\r\n                        <label className={styles.label}>Live Preview & Upload</label>\r\n                        <div className={styles.previewCard}>\r\n                            {plant.imageUrl ? (\r\n                                <img src={plant.imageUrl} className={styles.previewImage} alt=\"Preview\" />\r\n                            ) : (\r\n                                <div className={styles.noImage}>\r\n                                    <ImageIcon size={64} />\r\n                                    <p className=\"text-sm font-bold opacity-30\">NO ASSET FOUND</p>\r\n                                </div>\r\n                            )}\r\n                            <div className={styles.uploadOverlay}>\r\n                                <button type=\"button\" onClick={() => fileInputRef.current?.click()} className={styles.uploadBtn}>\r\n                                    <Upload size={18} /> Update Photo\r\n                                </button>\r\n                                <p className=\"text-[10px] text-white/60 mt-2 uppercase tracking-tight\">Auto-compressed JPG</p>\r\n                            </div>\r\n                            <div className={styles.badge}>{plant.type}</div>\r\n                        </div>\r\n\r\n                        <input\r\n                            ref={fileInputRef}\r\n                            type=\"file\"\r\n                            accept=\"image/*\"\r\n                            className=\"hidden\"\r\n                            onChange={handleImageUpload}\r\n                        />\r\n\r\n                        <div className=\"mt-8 grid grid-cols-2 gap-3 opacity-50 text-white\">\r\n                            <div className=\"p-3 border border-slate-800 rounded-lg flex items-center gap-3\">\r\n                                <Sun size={16} className=\"text-amber-500\" /> <span className=\"text-[10px] uppercase font-bold\">{plant.sunlight}</span>\r\n                            </div>\r\n                            <div className=\"p-3 border border-slate-800 rounded-lg flex items-center gap-3\">\r\n                                <Wind size={16} className=\"text-purple-400\" /> <span className=\"text-[10px] uppercase font-bold\">{plant.oxygenLevel}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.footer}>\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => navigate('/admin/manage-plants')}\r\n                            className={styles.btnCancel}\r\n                        >\r\n                            Discard Changes\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={saving}\r\n                            className={styles.btnSave}\r\n                        >\r\n                            <Save size={18} /> {saving ? 'Verifying...' : 'Seal Registry'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePlants.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadPlants` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePlants.tsx:17:9\n  15 |\n  16 |     useEffect(() => {\n> 17 |         loadPlants();\n     |         ^^^^^^^^^^ `loadPlants` accessed before it is declared\n  18 |     }, []);\n  19 |\n  20 |     useEffect(() => {\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePlants.tsx:33:5\n  31 |     }, [searchQuery, allPlants]);\n  32 |\n> 33 |     const loadPlants = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 34 |         const data = await fetchPlants();\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 35 |         setAllPlants(data);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 36 |         setFilteredPlants(data);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 37 |     };\n     | ^^^^^^^ `loadPlants` is declared here\n  38 |\n  39 |     const handleEdit = (plant: Plant) => {\n  40 |         navigate(`/admin/edit-plant/${plant.id}`);","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":50,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { Edit, Trash2, X, Search, Leaf } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchPlants, deletePlant } from '../../services/api';\r\nimport type { Plant } from '../../types';\r\nimport styles from './ManagePlants.module.css';\r\n\r\nexport const ManagePlants = () => {\r\n    const [allPlants, setAllPlants] = useState<Plant[]>([]);\r\n    const [filteredPlants, setFilteredPlants] = useState<Plant[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        loadPlants();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) {\r\n            setFilteredPlants(allPlants);\r\n        } else {\r\n            const query = searchQuery.toLowerCase();\r\n            setFilteredPlants(allPlants.filter(p =>\r\n                p.name?.toLowerCase().includes(query) ||\r\n                p.scientificName?.toLowerCase().includes(query) ||\r\n                p.type?.toLowerCase().includes(query)\r\n            ));\r\n        }\r\n    }, [searchQuery, allPlants]);\r\n\r\n    const loadPlants = async () => {\r\n        const data = await fetchPlants();\r\n        setAllPlants(data);\r\n        setFilteredPlants(data);\r\n    };\r\n\r\n    const handleEdit = (plant: Plant) => {\r\n        navigate(`/admin/edit-plant/${plant.id}`);\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!window.confirm(\"Permanently delete this plant?\")) return;\r\n        const tid = toast.loading(\"Deleting...\");\r\n        try {\r\n            await deletePlant(id);\r\n            toast.success(\"Plant Deleted\", { id: tid });\r\n            loadPlants();\r\n        } catch (err) {\r\n            toast.error(\"Deletion failed\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const getBadgeClass = (type: string) => {\r\n        switch (type) {\r\n            case 'indoor': return styles.badgeIndoor;\r\n            case 'outdoor': return styles.badgeOutdoor;\r\n            default: return styles.badgeOther;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Flora Registry\">\r\n            <div className={styles.pageContainer}>\r\n                <div className={styles.searchContainer}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search botanical collection...\"\r\n                        className={styles.searchBar}\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                    {searchQuery && (\r\n                        <button onClick={() => setSearchQuery(\"\")} className={styles.clearButton}>\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n\r\n                    <div className={styles.statsContainer}>\r\n                        <span>Total Flora</span>\r\n                        <span className={styles.countHighlight}>{allPlants.length} SPECIMENS</span>\r\n                    </div>\r\n\r\n                    {searchQuery && (\r\n                        <div className={styles.quickList}>\r\n                            <div className=\"px-4 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider flex justify-between border-b border-slate-700/50 mb-1\">\r\n                                <span>Quick Selection (A-Z)</span>\r\n                                <span className=\"text-emerald-500\">{filteredPlants.length} Matches</span>\r\n                            </div>\r\n                            {filteredPlants.length > 0 ? (\r\n                                [...filteredPlants]\r\n                                    .sort((a, b) => (a.name || '').localeCompare(b.name || ''))\r\n                                    .map((plant) => (\r\n                                        <div key={plant.id} className={styles.quickListItem}>\r\n                                            <span>{plant.name}</span>\r\n                                            <span className={styles.quickListItemIndex}>{plant.type}</span>\r\n                                        </div>\r\n                                    ))\r\n                            ) : (\r\n                                <div className=\"p-4 text-center text-slate-500 text-sm\">\r\n                                    No plants align with your query\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {filteredPlants.length === 0 ? (\r\n                    <div className={styles.emptyState}>\r\n                        <div className={styles.emptyIcon}>\r\n                            <Leaf size={40} />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-white mb-2\">No specimens found</h3>\r\n                        <p>Try refining your search query or add a new plant.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className={styles.grid}>\r\n                        {filteredPlants.map((plant, idx) => (\r\n                            <div key={plant.id} className={styles.card} style={{ animationDelay: `${idx * 50}ms` }}>\r\n                                <div className={styles.imageContainer}>\r\n                                    <img src={plant.imageUrl} alt={plant.name} className={styles.image} loading=\"lazy\" />\r\n                                    <div className={styles.imageOverlay}></div>\r\n\r\n                                    <div className={styles.actions}>\r\n                                        <button onClick={() => handleEdit(plant)} className={`${styles.actionBtn} ${styles.editBtn}`} title=\"Edit Plant\">\r\n                                            <Edit size={18} />\r\n                                        </button>\r\n                                        <button onClick={() => handleDelete(plant.id)} className={`${styles.actionBtn} ${styles.deleteBtn}`} title=\"Delete Plant\">\r\n                                            <Trash2 size={18} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className={styles.content}>\r\n                                    <div className={styles.header}>\r\n                                        <h3 className={styles.plantName} title={plant.name}>\r\n                                            {plant.name}\r\n                                        </h3>\r\n                                        <p className={styles.scientificName}>{plant.scientificName}</p>\r\n                                    </div>\r\n\r\n                                    <div className={styles.footer}>\r\n                                        <div>\r\n                                            <span className={styles.priceLabel}>Price</span>\r\n                                            <span className={styles.price}>Rs. {plant.price}</span>\r\n                                        </div>\r\n                                        <span className={`${styles.badge} ${getBadgeClass(plant.type || '')}`}>\r\n                                            {plant.type}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePoints.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[345,348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[345,348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[786,789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[786,789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[822,825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[822,825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[830,833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[830,833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":22,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":35,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":21}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Trophy, Search, User as UserIcon } from 'lucide-react';\r\nimport { fetchUsers, updateUserPoints } from '../../services/api';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './ManagePoints.module.css';\r\n\r\nexport const ManagePoints = () => {\r\n    const [users, setUsers] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [saving, setSaving] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const data = await fetchUsers();\r\n            // Filter only standard users, and sort by points\r\n            setUsers(data.filter((u: any) => u.role === 'user').sort((a: any, b: any) => (b.points || 0) - (a.points || 0)));\r\n        } catch (err) {\r\n            toast.error(\"Failed to load users\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleUpdatePoints = async (userId: string, newPoints: number) => {\r\n        setSaving(userId);\r\n        try {\r\n            await updateUserPoints(userId, newPoints);\r\n            toast.success(\"Points updated successfully\");\r\n            setUsers(prev => prev.map(u => u.id === userId ? { ...u, points: newPoints } : u));\r\n        } catch (err) {\r\n            toast.error(\"Failed to update points\");\r\n        } finally {\r\n            setSaving(null);\r\n        }\r\n    };\r\n\r\n    const filteredUsers = users.filter(u =>\r\n        u.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        u.email.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.searchBar}>\r\n                    <Search size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search by name or email...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n                <div className={styles.statsBadge}>\r\n                    <Trophy size={16} /> {users.length} Active Participants\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.userGrid}>\r\n                {loading ? (\r\n                    <div className={styles.loading}>Synchronizing Ecosystem Rankings...</div>\r\n                ) : filteredUsers.length === 0 ? (\r\n                    <div className={styles.empty}>No users found.</div>\r\n                ) : (\r\n                    filteredUsers.map((user, idx) => (\r\n                        <div key={user.id} className={styles.userCard}>\r\n                            <div className={styles.rankBadge}>#{idx + 1}</div>\r\n                            <div className={styles.userMain}>\r\n                                <div className={styles.avatar}>\r\n                                    <UserIcon size={24} />\r\n                                </div>\r\n                                <div className={styles.info}>\r\n                                    <h3 className={styles.name}>{user.name}</h3>\r\n                                    <p className={styles.email}>{user.email}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.pointsControl}>\r\n                                <div className={styles.pointsLabel}>Chlorophyll Points</div>\r\n                                <div className={styles.inputWrapper}>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        defaultValue={user.points || 0}\r\n                                        onBlur={(e) => {\r\n                                            const val = parseInt(e.target.value);\r\n                                            if (val !== user.points) {\r\n                                                handleUpdatePoints(user.id, val);\r\n                                            }\r\n                                        }}\r\n                                        className={styles.pointsInput}\r\n                                    />\r\n                                    {saving === user.id && <div className={styles.loader} />}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManageSuggestions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[436,439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[436,439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":17,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":133,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":153,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":51}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { Clock, User, Sparkles, MessageSquare, CheckCircle, XCircle } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { fetchSuggestions as apiFetchSuggestions, updateSuggestion, deleteSuggestion } from '../../services/api';\r\n\r\nexport const ManageSuggestions = () => {\r\n    const [suggestions, setSuggestions] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchSuggestions = async () => {\r\n        try {\r\n            const data = await apiFetchSuggestions();\r\n            if (Array.isArray(data)) {\r\n                setSuggestions(data);\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Failed to load suggestions\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchSuggestions();\r\n    }, []);\r\n\r\n    const formatDate = (dateString: string) => {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString('en-US', {\r\n            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'\r\n        });\r\n    };\r\n\r\n    const getTimeAgo = (dateString: string) => {\r\n        const seconds = Math.floor((new Date().getTime() - new Date(dateString).getTime()) / 1000);\r\n        if (seconds < 60) return 'Just now';\r\n        const minutes = Math.floor(seconds / 60);\r\n        if (minutes < 60) return `${minutes}m ago`;\r\n        const hours = Math.floor(minutes / 60);\r\n        if (hours < 24) return `${hours}h ago`;\r\n        return formatDate(dateString);\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Ecosystem Requests\">\r\n            <div style={{ marginBottom: '2rem' }}>\r\n                <p style={{ color: '#94a3b8', fontSize: '1rem' }}>\r\n                    Review plant species suggested by the community for inclusion in the VanaMap database.\r\n                </p>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div style={{ padding: '4rem', textAlign: 'center' }}>\r\n                    <div className=\"animate-spin\" style={{ width: '40px', height: '40px', border: '3px solid rgba(16, 185, 129, 0.2)', borderTopColor: '#10b981', borderRadius: '50%', margin: '0 auto 1rem' }}></div>\r\n                    <p style={{ color: '#94a3b8' }}>Synchronizing requests...</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6\">\r\n                    {suggestions.length === 0 && (\r\n                        <div style={{ gridColumn: '1/-1', textAlign: 'center', padding: '6rem 2rem', background: 'rgba(30, 41, 59, 0.3)', borderRadius: '2rem', border: '1px dashed rgba(255,255,255,0.1)' }}>\r\n                            <Sparkles size={64} style={{ margin: '0 auto 1.5rem', opacity: 0.2, color: '#10b981' }} />\r\n                            <h3 style={{ color: 'white', fontSize: '1.25rem', marginBottom: '0.5rem' }}>Ecosystem is Up to Date</h3>\r\n                            <p style={{ color: '#64748b' }}>No pending plant suggestions found at this time.</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {suggestions.map((s) => (\r\n                        <div key={s._id} className=\"glass-panel\" style={{\r\n                            padding: '2rem',\r\n                            borderRadius: '1.5rem',\r\n                            border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            gap: '1.5rem',\r\n                            transition: 'transform 0.3s ease'\r\n                        }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                                <div style={{ background: 'rgba(16, 185, 129, 0.1)', padding: '0.75rem', borderRadius: '1rem' }}>\r\n                                    <MessageSquare size={24} color=\"#10b981\" />\r\n                                </div>\r\n                                <div style={{ textAlign: 'right' }}>\r\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.4rem', color: '#64748b', fontSize: '0.75rem', fontWeight: '800' }}>\r\n                                        <Clock size={12} /> {getTimeAgo(s.submittedAt)}\r\n                                    </div>\r\n                                    <span style={{\r\n                                        display: 'inline-block',\r\n                                        marginTop: '0.5rem',\r\n                                        fontSize: '0.65rem',\r\n                                        padding: '0.2rem 0.6rem',\r\n                                        borderRadius: '6px',\r\n                                        background: 'rgba(255,255,255,0.05)',\r\n                                        color: '#cbd5e1',\r\n                                        fontWeight: '800',\r\n                                        letterSpacing: '0.5px'\r\n                                    }}>\r\n                                        ID: {s._id.substring(18)}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: '#fff', marginBottom: '0.5rem' }}>{s.plantName}</h3>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.85rem', color: '#94a3b8' }}>\r\n                                    <User size={14} /> Submitted by <strong style={{ color: '#cbd5e1' }}>{s.userName || 'Root User'}</strong>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div style={{\r\n                                background: 'rgba(0,0,0,0.3)',\r\n                                padding: '1.25rem',\r\n                                borderRadius: '1rem',\r\n                                fontSize: '0.95rem',\r\n                                color: '#94a3b8',\r\n                                lineHeight: '1.6',\r\n                                fontStyle: 'italic',\r\n                                border: '1px solid rgba(255,255,255,0.03)'\r\n                            }}>\r\n                                \"{s.description}\"\r\n                            </div>\r\n\r\n                            <div style={{ display: 'flex', gap: '1rem', marginTop: 'auto', paddingTop: '1rem', borderTop: '1px solid rgba(255,255,255,0.05)' }}>\r\n                                {s.status !== 'approved' ? (\r\n                                    <button\r\n                                        className=\"flex-1 flex items-center justify-center gap-2\"\r\n                                        style={{ background: 'rgba(16, 185, 129, 0.1)', color: '#10b981', border: '1px solid rgba(16, 185, 129, 0.2)', padding: '0.75rem', borderRadius: '0.75rem', fontSize: '0.85rem', fontWeight: '700', cursor: 'pointer' }}\r\n                                        onClick={async () => {\r\n                                            const tid = toast.loading(\"Approving...\");\r\n                                            try {\r\n                                                await updateSuggestion(s._id, { status: 'approved' });\r\n                                                toast.success(\"Suggestion Approved\", { id: tid });\r\n                                                fetchSuggestions();\r\n                                            } catch (e) { toast.error(\"Failed to approve\", { id: tid }); }\r\n                                        }}\r\n                                    >\r\n                                        <CheckCircle size={16} /> APPROVE\r\n                                    </button>\r\n                                ) : (\r\n                                    <div className=\"flex-1 flex items-center justify-center gap-2\" style={{ color: '#10b981', padding: '0.75rem', fontSize: '0.85rem', fontWeight: '800' }}>\r\n                                        <CheckCircle size={16} /> APPROVED\r\n                                    </div>\r\n                                )}\r\n                                <button\r\n                                    className=\"flex-shrink-0\"\r\n                                    style={{ background: 'rgba(244, 63, 94, 0.1)', color: '#f43f5e', border: '1px solid rgba(244, 63, 94, 0.2)', padding: '0.75rem', borderRadius: '0.75rem', cursor: 'pointer' }}\r\n                                    onClick={async () => {\r\n                                        if (!window.confirm(\"Delete this suggestion permanently?\")) return;\r\n                                        const tid = toast.loading(\"Removing...\");\r\n                                        try {\r\n                                            await deleteSuggestion(s._id);\r\n                                            toast.success(\"Suggestion Removed\", { id: tid });\r\n                                            setSuggestions(prev => prev.filter(item => item._id !== s._id));\r\n                                        } catch (e) { toast.error(\"Failed to remove\", { id: tid }); }\r\n                                    }}\r\n                                >\r\n                                    <XCircle size={16} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManageUsers.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[487,490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[487,490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[555,558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[555,558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[678,681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[678,681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[783,786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[783,786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1868,1871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1868,1871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":63,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":76,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":88,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":125,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":144,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":283,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":283,"endColumn":55}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { fetchUsers, adminResetPassword, deleteUser, fetchNotifications, giftPremium } from '../../services/api'; import { AlertCircle, Users, Key, Shield, Search, X, User as UserIcon, Lock, Gift } from 'lucide-react';\r\n\r\nimport { AdminLayout } from './AdminLayout';\r\nimport styles from './ManageUsers.module.css';\r\n\r\nexport const ManageUsers = () => {\r\n    const [allUsers, setAllUsers] = useState<any[]>([]);\r\n    const [filteredUsers, setFilteredUsers] = useState<any[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [selectedUser, setSelectedUser] = useState<any>(null);\r\n    const [resetPwd, setResetPwd] = useState(\"\");\r\n    const [alerts, setAlerts] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        loadUsers();\r\n        loadAlerts();\r\n    }, []);\r\n\r\n    // client-side search filtering\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) {\r\n            setFilteredUsers(allUsers);\r\n        } else {\r\n            const query = searchQuery.toLowerCase();\r\n            setFilteredUsers(allUsers.filter(u =>\r\n                u.name?.toLowerCase().includes(query) ||\r\n                u.email?.toLowerCase().includes(query) ||\r\n                u.role?.toLowerCase().includes(query)\r\n            ));\r\n        }\r\n    }, [searchQuery, allUsers]);\r\n\r\n    const loadUsers = async () => {\r\n        try {\r\n            const data = await fetchUsers();\r\n            setAllUsers(data);\r\n            setFilteredUsers(data);\r\n        } catch (e) {\r\n            console.error(e);\r\n            toast.error(\"Failed to load users\");\r\n        }\r\n    };\r\n\r\n    const loadAlerts = async () => {\r\n        try {\r\n            const notifs = await fetchNotifications();\r\n            // Filter only help/contact triggers\r\n            setAlerts(notifs.filter((n: any) => n.type === 'help'));\r\n        } catch (e) { console.error(\"Alerts load failed\", e); }\r\n    };\r\n\r\n    const handlePasswordReset = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!selectedUser || !resetPwd) return;\r\n        const tid = toast.loading(\"Updating Credentials...\");\r\n        try {\r\n            await adminResetPassword(selectedUser.id, resetPwd);\r\n            toast.success(\"Security Credentials Updated\", { id: tid, icon: '≡ƒöÉ' });\r\n            setResetPwd(\"\");\r\n            setSelectedUser(null);\r\n        } catch (err) {\r\n            toast.error(\"Update prevented by security policy\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleQuickReset = async () => {\r\n        if (!selectedUser) return;\r\n        if (!window.confirm(\"Reset password to '123456'?\")) return;\r\n        const tid = toast.loading(\"Reseting to Default...\");\r\n        try {\r\n            await adminResetPassword(selectedUser.id, '123456');\r\n            toast.success(\"Password Reset to '123456'\", { id: tid });\r\n            setSelectedUser(null);\r\n        } catch (e) { toast.error(\"Reset Failed\"); }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!selectedUser) return;\r\n        if (!window.confirm(`Permanently DELETE user ${selectedUser.email}?`)) return;\r\n        const tid = toast.loading(\"Deleting User...\");\r\n        try {\r\n            await deleteUser(selectedUser.id);\r\n            toast.success(\"User Deleted\", { id: tid });\r\n            setSelectedUser(null);\r\n            loadUsers();\r\n        } catch (e) { toast.error(\"Delete Failed\", { id: tid }); }\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"User Security Directory\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                {/* ALARM / ALERTS SECTION */}\r\n                {alerts.length > 0 && (\r\n                    <div className={styles.alarmContainer}>\r\n                        {alerts.map(alert => (\r\n                            <div key={alert._id} className={styles.alarmCard}>\r\n                                <div className={styles.alarmContent}>\r\n                                    <AlertCircle className={styles.alarmIcon} size={24} />\r\n                                    <div>\r\n                                        <span style={{ color: 'white' }}>CRITICAL HELP REQUEST:</span>{' '}\r\n                                        User <span className={styles.alarmEmail}>{alert.details?.email || alert.message.split(' ')[1]}</span> triggered admin recovery.\r\n                                        <span className={styles.alarmTime}>{new Date(alert.createdAt).toLocaleTimeString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        className={styles.actionBtn}\r\n                                        style={{ background: '#f59e0b', color: 'black', fontWeight: 'bold' }}\r\n                                        onClick={async () => {\r\n                                            const emailStr = alert.details?.email || alert.message.split(' ')[1];\r\n                                            const userToReset = allUsers.find(u => u.email === emailStr);\r\n                                            if (userToReset) {\r\n                                                if (window.confirm(`Reset password to '123456' for ${emailStr}?`)) {\r\n                                                    const tid = toast.loading(\"Reseting...\");\r\n                                                    try {\r\n                                                        await adminResetPassword(userToReset.id, '123456');\r\n                                                        toast.success(\"Password Reset Successfully\", { id: tid });\r\n                                                        // Automatically clear alert after reset\r\n                                                        const { deleteNotification } = await import('../../services/api');\r\n                                                        await deleteNotification(alert._id);\r\n                                                        loadAlerts();\r\n                                                    } catch (e) { toast.error(\"Reset Failed\"); }\r\n                                                }\r\n                                            } else {\r\n                                                toast.error(\"User not found in directory. Try searching manually.\");\r\n                                                setSearchQuery(emailStr || \"\");\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        RESET TO 123456\r\n                                    </button>\r\n                                    <button\r\n                                        className={styles.actionBtn}\r\n                                        style={{ background: 'rgba(255, 255, 255, 0.1)', color: 'white' }}\r\n                                        onClick={async () => {\r\n                                            try {\r\n                                                const { deleteNotification } = await import('../../services/api');\r\n                                                await deleteNotification(alert._id);\r\n                                                loadAlerts();\r\n                                                toast.success(\"Alert cleared\");\r\n                                            } catch (e) {\r\n                                                toast.error(\"Failed to clear alert\");\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        <X size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Search Bar */}\r\n                <div className={styles.searchContainer}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search users by name, email, or role...\"\r\n                        className={styles.searchBar}\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                    {searchQuery && (\r\n                        <button onClick={() => setSearchQuery(\"\")} className={styles.clearButton}>\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                <div className={styles.layoutGrid}>\r\n                    {/* LEFT COLUMN: User List */}\r\n                    <div className={styles.userList}>\r\n                        {filteredUsers.length === 0 ? (\r\n                            <div className=\"text-center py-12 text-slate-500 bg-slate-800/20 rounded-2xl border border-slate-700/50\">\r\n                                <Users size={48} className=\"mx-auto mb-4 opacity-30\" />\r\n                                <h3 className=\"text-lg font-bold\">No Users Found</h3>\r\n                            </div>\r\n                        ) : (\r\n                            filteredUsers.map(user => (\r\n                                <div\r\n                                    key={user.id}\r\n                                    className={`${styles.userCard} ${selectedUser?.id === user.id ? styles.active : ''}`}\r\n                                    onClick={() => setSelectedUser(user)}\r\n                                >\r\n                                    <div className={styles.userInfo}>\r\n                                        <div className={`${styles.avatar} ${user.role === 'admin' ? styles.avatarAdmin : ''}`}>\r\n                                            {user.name ? user.name.charAt(0).toUpperCase() : <UserIcon size={20} />}\r\n                                        </div>\r\n                                        <div className={styles.userDetails}>\r\n                                            <div className={styles.userName}>{user.name || \"Unknown User\"}</div>\r\n                                            <div className={styles.userEmail}>{user.email}</div>\r\n                                            <div>\r\n                                                <span className={`${styles.roleBadge} ${user.role === 'admin' ? styles.roleAdmin : styles.roleUser}`}>\r\n                                                    {user.role || 'user'}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        className={styles.actionBtn}\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            setSelectedUser(user);\r\n                                        }}\r\n                                        title=\"Manage User Security\"\r\n                                    >\r\n                                        <Key size={18} />\r\n                                    </button>\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* RIGHT COLUMN: Action Sidebar */}\r\n                    <div className={styles.sidebar}>\r\n                        {selectedUser ? (\r\n                            <div className={styles.actionPanel}>\r\n                                <div className={styles.panelTitle}>\r\n                                    <Shield size={20} className=\"text-indigo-400\" />\r\n                                    Security Actions\r\n                                </div>\r\n\r\n                                <div className=\"mb-4\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={handleQuickReset}\r\n                                        className={styles.quickResetBtn}\r\n                                    >\r\n                                        Auto-Reset to '123456'\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <form onSubmit={handlePasswordReset}>\r\n                                    <div className={styles.targetInfo}>\r\n                                        <div className={styles.targetLabel}>Target Account</div>\r\n                                        <div className={styles.targetValue}>{selectedUser.email}</div>\r\n                                    </div>\r\n\r\n                                    <div className={styles.formGroup}>\r\n                                        <label className={styles.label}>Custom Password</label>\r\n                                        <div className=\"relative\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                placeholder=\"Enter new password...\"\r\n                                                required\r\n                                                className={styles.glassInput}\r\n                                                value={resetPwd}\r\n                                                onChange={e => setResetPwd(e.target.value)}\r\n                                            />\r\n                                            <Lock size={16} className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400\" />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button type=\"submit\" className={styles.submitBtn}>\r\n                                        Update Credentials\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        className={styles.cancelBtn}\r\n                                        onClick={() => { setSelectedUser(null); setResetPwd(\"\"); }}\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                </form>\r\n\r\n                                <div className=\"mt-4 pt-4 border-t border-slate-700\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        className={styles.premiumBtn}\r\n                                        onClick={async () => {\r\n                                            if (!confirm(`Gift 1 Year Premium to ${selectedUser.name}?`)) return;\r\n                                            const tid = toast.loading(\"Gifting Premium...\");\r\n                                            try {\r\n                                                await giftPremium(selectedUser.id);\r\n                                                toast.success(\"Premium Gifted! ≡ƒÄü\", { id: tid });\r\n                                                loadUsers(); // Refresh to see updated status if we show it\r\n                                            } catch (e) {\r\n                                                toast.error(\"Failed to gift premium\", { id: tid });\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        <Gift size={16} /> Gift 1 Year Premium\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <div className=\"mt-8 pt-4 border-t border-slate-700\">\r\n                                    <button\r\n                                        onClick={handleDelete}\r\n                                        className={styles.deleteBtn}\r\n                                    >\r\n                                        Delete Account\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.emptyPanel}>\r\n                                <UserIcon size={48} className=\"mb-4 opacity-20\" />\r\n                                <h3 className=\"text-lg font-bold text-slate-400 mb-2\">No Selection</h3>\r\n                                <p className=\"text-sm px-4\">Select a user from the list to view security options and manage credentials.</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManageVendors.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":46,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":55,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":65,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":83,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":19}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { Store, Star, Trash2, ShieldCheck, AlertCircle, MapPin, Search, X, Lock } from 'lucide-react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchVendors, updateVendor, deleteVendor } from '../../services/api';\r\nimport type { Vendor } from '../../types';\r\nimport styles from './ManageVendors.module.css';\r\n\r\nexport const ManageVendors = () => {\r\n    const [allVendors, setAllVendors] = useState<Vendor[]>([]);\r\n    const [filteredVendors, setFilteredVendors] = useState<Vendor[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n\r\n    // Password Reset State\r\n    const [showResetModal, setShowResetModal] = useState(false);\r\n    const [selectedVendorForReset, setSelectedVendorForReset] = useState<Vendor | null>(null);\r\n    const [newPassword, setNewPassword] = useState(\"\");\r\n\r\n    useEffect(() => { loadVendors(); }, []);\r\n\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) {\r\n            setFilteredVendors(allVendors);\r\n        } else {\r\n            const query = searchQuery.toLowerCase();\r\n            setFilteredVendors(allVendors.filter(v =>\r\n                v.name?.toLowerCase().includes(query) ||\r\n                v.address?.toLowerCase().includes(query)\r\n            ));\r\n        }\r\n    }, [searchQuery, allVendors]);\r\n\r\n    const loadVendors = async () => {\r\n        const data = await fetchVendors();\r\n        setAllVendors(data);\r\n        setFilteredVendors(data);\r\n    };\r\n\r\n    const toggleVerification = async (v: Vendor) => {\r\n        const newStatus = !v.verified;\r\n        const tid = toast.loading(newStatus ? \"Verifying Partner...\" : \"Revoking Status...\");\r\n        try {\r\n            await updateVendor(v.id, { verified: newStatus });\r\n            toast.success(newStatus ? \"Partner Verified\" : \"Verification Revoked\", { id: tid });\r\n            loadVendors();\r\n        } catch (e) { toast.error(\"Status Update Failed\", { id: tid }); }\r\n    };\r\n\r\n    const toggleRecommendation = async (v: Vendor) => {\r\n        const newStatus = !v.highlyRecommended;\r\n        try {\r\n            await updateVendor(v.id, { highlyRecommended: newStatus });\r\n            if (newStatus) toast.success(\"Marked as Top Partner!\", { icon: '≡ƒîƒ' });\r\n            loadVendors();\r\n        } catch (e) { toast.error(\"Promotion Failed\"); }\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!window.confirm(\"Permanently delete this partner account?\")) return;\r\n        const tid = toast.loading(\"Removing Partner...\");\r\n        try {\r\n            await deleteVendor(id);\r\n            toast.success(\"Partner Removed\", { id: tid });\r\n            loadVendors();\r\n        } catch (e) { toast.error(\"Deletion failed\", { id: tid }); }\r\n    };\r\n\r\n    const handlePasswordResetClick = (vendor: Vendor) => {\r\n        setSelectedVendorForReset(vendor);\r\n        setShowResetModal(true);\r\n        setNewPassword(\"\");\r\n    };\r\n\r\n    const submitPasswordReset = async () => {\r\n        if (!selectedVendorForReset) return;\r\n        const tid = toast.loading(\"Resetting password...\");\r\n        try {\r\n            const { adminResetPassword } = await import('../../services/api');\r\n            // Assuming the Vendor ID matches the User ID for signed-up vendors\r\n            await adminResetPassword(selectedVendorForReset.id, newPassword || '123456');\r\n            toast.success(\"Password Reset Successfully!\", { id: tid });\r\n            setShowResetModal(false);\r\n        } catch (e) {\r\n            toast.error(\"Failed to reset password. Is this a linked account?\", { id: tid });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Partner Network\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                {/* Password Reset Modal */}\r\n                {showResetModal && selectedVendorForReset && (\r\n                    <div style={{\r\n                        position: 'fixed', inset: 0, zIndex: 2000,\r\n                        background: 'rgba(0,0,0,0.8)', backdropFilter: 'blur(4px)',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                    }} onClick={() => setShowResetModal(false)}>\r\n                        <div style={{\r\n                            background: '#1e293b', padding: '2rem', borderRadius: '1rem',\r\n                            border: '1px solid #334155', minWidth: '350px'\r\n                        }} onClick={e => e.stopPropagation()}>\r\n                            <h3 style={{ margin: '0 0 1rem 0', color: '#f8fafc' }}>Reset Password for {selectedVendorForReset.name}</h3>\r\n                            <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '1rem' }}>\r\n                                Enter a new secure password for this partner account.\r\n                            </p>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"New Password (default: 123456)\"\r\n                                value={newPassword}\r\n                                onChange={e => setNewPassword(e.target.value)}\r\n                                style={{\r\n                                    width: '100%', padding: '0.75rem', marginBottom: '1rem',\r\n                                    borderRadius: '0.5rem', border: '1px solid #475569',\r\n                                    background: '#0f172a', color: 'white'\r\n                                }}\r\n                            />\r\n                            <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'flex-end' }}>\r\n                                <button onClick={() => setShowResetModal(false)} style={{ padding: '0.5rem 1rem', borderRadius: '0.5rem', background: 'transparent', color: '#cbd5e1', border: '1px solid #475569', cursor: 'pointer' }}>Cancel</button>\r\n                                <button onClick={submitPasswordReset} style={{ padding: '0.5rem 1rem', borderRadius: '0.5rem', background: '#3b82f6', color: 'white', border: 'none', cursor: 'pointer', fontWeight: 600 }}>Reset Now</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Search Bar */}\r\n                <div className={styles.searchContainer}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search partners by name or address...\"\r\n                        className={styles.searchBar}\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                    {searchQuery && (\r\n                        <button onClick={() => setSearchQuery(\"\")} className={styles.clearButton}>\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                {filteredVendors.length === 0 ? (\r\n                    <div className={styles.emptyState}>\r\n                        <Store size={48} className=\"mx-auto mb-4 opacity-50\" />\r\n                        <h3 className=\"text-xl font-bold mb-2\">No Partners Found</h3>\r\n                        <p>Try refining your search query or add a new vendor.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className={styles.listLayout}>\r\n                        {filteredVendors.map((vendor, idx) => (\r\n                            <div key={vendor.id} className={styles.card} style={{ animationDelay: `${idx * 50}ms`, animationName: 'slideIn' }}>\r\n\r\n                                {/* Info Block */}\r\n                                <div className={styles.infoSection}>\r\n                                    <div className={`${styles.iconBox} ${vendor.verified ? styles.verifiedIconBox : styles.pendingIconBox}`}>\r\n                                        <Store size={28} strokeWidth={1.5} />\r\n                                    </div>\r\n\r\n                                    <div className={styles.details}>\r\n                                        <div className={styles.nameRow}>\r\n                                            <h3 className={styles.vendorName}>{vendor.name}</h3>\r\n\r\n                                            {/* Badges */}\r\n                                            {vendor.verified ? (\r\n                                                <span className={`${styles.badge} ${styles.verifiedBadge}`}>\r\n                                                    <ShieldCheck size={10} /> Verified\r\n                                                </span>\r\n                                            ) : (\r\n                                                <span className={`${styles.badge} ${styles.pendingBadge}`}>\r\n                                                    <AlertCircle size={10} /> Pending\r\n                                                </span>\r\n                                            )}\r\n\r\n                                            {vendor.highlyRecommended && (\r\n                                                <span className={`${styles.badge} ${styles.hotBadge}`}>\r\n                                                    <Star size={10} fill=\"currentColor\" /> Top Rated\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        <div className=\"flex items-start gap-1.5 text-slate-400\">\r\n                                            <MapPin size={14} className=\"mt-0.5 shrink-0\" />\r\n                                            <p className={styles.address}>{vendor.address || \"No physical address listed\"}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Actions Block */}\r\n                                <div className={styles.actionSection}>\r\n                                    <button\r\n                                        onClick={() => toggleVerification(vendor)}\r\n                                        className={`${styles.actionBtn} ${vendor.verified ? styles.btnRevoke : styles.btnVerify}`}\r\n                                    >\r\n                                        {vendor.verified ? 'Revoke Status' : 'Approve Partner'}\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        onClick={() => toggleRecommendation(vendor)}\r\n                                        className={`${styles.actionBtn} ${vendor.highlyRecommended ? styles.btnStarActive : styles.btnStar}`}\r\n                                        title={vendor.highlyRecommended ? \"Remove from Top Rated\" : \"Mark as Top Rated\"}\r\n                                    >\r\n                                        <Star size={16} fill={vendor.highlyRecommended ? \"currentColor\" : \"none\"} />\r\n                                        {vendor.highlyRecommended && <span className=\"text-xs\">Featured</span>}\r\n                                    </button>\r\n\r\n                                    {/* Generic Reset Password Button */}\r\n                                    <button\r\n                                        onClick={() => handlePasswordResetClick(vendor)}\r\n                                        className={`${styles.actionBtn}`}\r\n                                        style={{ color: '#38bdf8', background: 'rgba(56, 189, 248, 0.1)' }}\r\n                                        title=\"Reset Password\"\r\n                                    >\r\n                                        <Lock size={16} />\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        onClick={() => handleDelete(vendor.id)}\r\n                                        className={`${styles.actionBtn} ${styles.btnDelete}`}\r\n                                        title=\"Delete Account\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\Notifications.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[611,614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[611,614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3318,3321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3318,3321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport {\r\n    User, Store, Sprout, Clock, Search, DollarSign, CheckCheck, AlertTriangle\r\n} from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport styles from './Notifications.module.css';\r\nimport { fetchAdminNotifications, markNotificationRead, markAllNotificationsRead } from '../../services/api';\r\n\r\ninterface Notification {\r\n    _id: string;\r\n    type: 'user' | 'vendor' | 'plant' | 'price' | 'suggestion' | 'security' | 'help' | 'vendor_contact';\r\n    message: string;\r\n    details: any;\r\n    date: string;\r\n    read: boolean;\r\n}\r\n\r\nexport const Notifications = () => {\r\n    const [allNotifs, setAllNotifs] = useState<Notification[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const data = await fetchAdminNotifications();\r\n            setAllNotifs(data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load notifications\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const handleItemClick = async (notif: Notification) => {\r\n        if (!notif.read) {\r\n            try {\r\n                await markNotificationRead(notif._id);\r\n                setAllNotifs(prev => prev.map(n => n._id === notif._id ? { ...n, read: true } : n));\r\n            } catch (e) {\r\n                console.error(\"Failed to mark read\", e);\r\n            }\r\n        }\r\n\r\n        // Navigate based on type\r\n        if (notif.type === 'user') navigate('/admin/manage-users');\r\n        if (notif.type === 'vendor') navigate('/admin/manage-vendors');\r\n        if (notif.type === 'plant') navigate('/admin/manage-plants');\r\n        if (notif.type === 'price') navigate('/admin/price-management');\r\n        if (notif.type === 'suggestion') navigate('/admin/suggestions');\r\n    };\r\n\r\n    const handleMarkAllRead = async () => {\r\n        await markAllNotificationsRead();\r\n        loadData();\r\n    }\r\n\r\n    const filteredNotifs = useMemo(() =>\r\n        allNotifs.filter(n => n.message.toLowerCase().includes(searchQuery.toLowerCase())),\r\n        [allNotifs, searchQuery]);\r\n\r\n    const userNotifs = filteredNotifs.filter(n => n.type === 'user');\r\n    const vendorNotifs = filteredNotifs.filter(n => n.type === 'vendor');\r\n    const plantNotifs = filteredNotifs.filter(n => n.type === 'plant');\r\n    const priceNotifs = filteredNotifs.filter(n => n.type === 'price');\r\n    const suggestionNotifs = filteredNotifs.filter(n => n.type === 'suggestion');\r\n    const systemNotifs = filteredNotifs.filter(n => ['security', 'help', 'vendor_contact'].includes(n.type));\r\n\r\n    const formatTime = (dateStr: string) => {\r\n        const date = new Date(dateStr);\r\n        const now = new Date();\r\n        const diff = (now.getTime() - date.getTime()) / 60000; // mins\r\n\r\n        if (diff < 1) return 'Just now';\r\n        if (diff < 60) return `${Math.floor(diff)}m ago`;\r\n        if (diff < 1440) return `${Math.floor(diff / 60)}h ago`;\r\n        return `${Math.floor(diff / 1440)}d ago`;\r\n    };\r\n\r\n    const renderCard = (title: string, icon: any, items: Notification[], colorClass: string) => (\r\n        <div className={styles.card}>\r\n            <div className={styles.cardHeader}>\r\n                <div className={`${styles.iconBox} ${colorClass}`}>\r\n                    {icon}\r\n                </div>\r\n                <span className={styles.sectionTitle}>{title}</span>\r\n                <span className=\"text-xs text-slate-500 ml-auto\">{items.filter(i => !i.read).length} new</span>\r\n            </div>\r\n            <div className={styles.scrollArea}>\r\n                {items.length > 0 ? items.map(item => (\r\n                    <button\r\n                        key={item._id}\r\n                        className={`${styles.item} ${!item.read ? styles.unread : ''}`}\r\n                        onClick={() => handleItemClick(item)}\r\n                    >\r\n                        <div className={styles.content}>\r\n                            <div className={styles.mainText}>\r\n                                {item.message}\r\n                            </div>\r\n                            <div className={styles.subText}>\r\n                                {item.type === 'price' && item.details?.location ? `Shop: ${item.details.location}` : ''}\r\n                            </div>\r\n                            <span className={styles.time}>\r\n                                <Clock size={10} className=\"inline mr-1\" />{formatTime(item.date)}\r\n                            </span>\r\n                        </div>\r\n                    </button>\r\n                )) : (\r\n                    <div className=\"text-center py-10 text-slate-600 text-sm italic\">No updates</div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    if (loading) return (\r\n        <AdminLayout title=\"System Notifications\">\r\n            <div className=\"p-8 text-center text-slate-500\">Loading...</div>\r\n        </AdminLayout>\r\n    );\r\n\r\n    return (\r\n        <AdminLayout title=\"System Notifications\">\r\n            <div className={styles.pageContainer}>\r\n                <header className={styles.header}>\r\n                    <div className={styles.searchContainer}>\r\n                        <Search className={styles.searchIcon} size={18} />\r\n                        <input\r\n                            type=\"text\"\r\n                            className={styles.searchInput}\r\n                            placeholder=\"Search logs...\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <button onClick={handleMarkAllRead} className={styles.markAllBtn}>\r\n                        <CheckCheck size={16} /> Mark All Read\r\n                    </button>\r\n                </header>\r\n\r\n                <div className={styles.grid4}>\r\n                    {renderCard(\"New Users\", <User size={20} />, userNotifs, styles.userIcon)}\r\n                    {renderCard(\"Vendor Joins\", <Store size={20} />, vendorNotifs, styles.vendorIcon)}\r\n                    {renderCard(\"Plant Updates\", <Sprout size={20} />, plantNotifs, styles.plantIcon)}\r\n                    {renderCard(\"Price Alerts\", <DollarSign size={20} />, priceNotifs, styles.priceIcon)}\r\n                    {renderCard(\"Suggestions\", <CheckCheck size={20} />, suggestionNotifs, styles.plantIcon)}\r\n                    {renderCard(\"Security & System\", <AlertTriangle size={20} />, systemNotifs, styles.priceIcon)}\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1256,1259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1256,1259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1314,1317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1314,1317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`startCamera` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:35:9\n  33 |\n  34 |     useEffect(() => {\n> 35 |         startCamera();\n     |         ^^^^^^^^^^^ `startCamera` accessed before it is declared\n  36 |         return () => stopCamera();\n  37 |     }, []);\n  38 |\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:43:5\n  41 |     }, []);\n  42 |\n> 43 |     const startCamera = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |         try {\n     | ^^^^^^^^^^^^^\n> 45 |             const stream = await navigator.mediaDevices.getUserMedia({\n     ΓÇª\n     | ^^^^^^^^^^^^^\n> 59 |         }\n     | ^^^^^^^^^^^^^\n> 60 |     };\n     | ^^^^^^^ `startCamera` is declared here\n  61 |\n  62 |     const stopCamera = () => {\n  63 |         if (stream) {","line":35,"column":9,"nodeType":null,"endLine":35,"endColumn":20},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`stopCamera` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:36:22\n  34 |     useEffect(() => {\n  35 |         startCamera();\n> 36 |         return () => stopCamera();\n     |                      ^^^^^^^^^^ `stopCamera` accessed before it is declared\n  37 |     }, []);\n  38 |\n  39 |     useEffect(() => {\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:62:5\n  60 |     };\n  61 |\n> 62 |     const stopCamera = () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 63 |         if (stream) {\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 64 |             stream.getTracks().forEach(track => track.stop());\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 65 |             setStream(null);\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 66 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 67 |     };\n     | ^^^^^^^ `stopCamera` is declared here\n  68 |\n  69 |     const handleFocus = async () => {\n  70 |         if (!stream) return;","line":36,"column":22,"nodeType":null,"endLine":36,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'stopCamera'. Either include it or remove the dependency array.","line":37,"column":8,"nodeType":"ArrayExpression","endLine":37,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [stopCamera]","fix":{"range":[1458,1460],"text":"[stopCamera]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":57,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2619,2622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2619,2622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2828,2831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2828,2831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3122,3125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3122,3125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'colorSum' is assigned a value but never used.","line":120,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":120,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7134,7137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7134,7137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7169,7172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7169,7172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7237,7240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7237,7240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7383,7386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7383,7386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7470,7473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7470,7473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7564,7567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7564,7567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7665,7668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7665,7668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7773,7776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7773,7776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":382,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20221,20224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20221,20224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":479,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29455,29458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29455,29458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { Camera, RefreshCw, Check, Search, Plus, ScanLine, Leaf, Image as ImageIcon, Activity, Target, Filter } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { fetchPlants } from '../../services/api';\r\nimport { worldFlora } from '../../data/worldFlora';\r\n\r\nexport const PlantIdentifier = () => {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [stream, setStream] = useState<MediaStream | null>(null);\r\n    const [capturedImages, setCapturedImages] = useState({\r\n        full: null as string | null,\r\n        leaf: null as string | null,\r\n        stem: null as string | null\r\n    });\r\n    const [filters, setFilters] = useState({\r\n        lifeForm: '',\r\n        habitat: '',\r\n        stemNature: ''\r\n    });\r\n\r\n    const areFiltersComplete = filters.lifeForm && filters.habitat && filters.stemNature;\r\n\r\n    const [scanningStep, setScanningStep] = useState<'full' | 'leaf' | 'stem' | 'complete'>('full');\r\n    const [isAnalyzing, setIsAnalyzing] = useState(false);\r\n    const [result, setResult] = useState<any>(null);\r\n    const [dbPlants, setDbPlants] = useState<any[]>([]);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        startCamera();\r\n        return () => stopCamera();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        fetchPlants().then(setDbPlants).catch(console.error);\r\n    }, []);\r\n\r\n    const startCamera = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: {\r\n                    facingMode: 'environment',\r\n                    width: { ideal: 1920 },\r\n                    height: { ideal: 1080 }\r\n                    // Removes any potential default filters\r\n                }\r\n            });\r\n            setStream(stream);\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = stream;\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Camera permission denied\");\r\n        }\r\n    };\r\n\r\n    const stopCamera = () => {\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n            setStream(null);\r\n        }\r\n    };\r\n\r\n    const handleFocus = async () => {\r\n        if (!stream) return;\r\n        const track = stream.getVideoTracks()[0];\r\n        try {\r\n            // Check if advanced capabilities are supported\r\n            const capabilities = track.getCapabilities() as any;\r\n            if (capabilities.focusMode && capabilities.focusMode.includes('continuous')) {\r\n                await track.applyConstraints({\r\n                    advanced: [{ focusMode: 'continuous' }] as any\r\n                });\r\n                toast.success(\"Auto-focus triggered\");\r\n            } else if (capabilities.focusMode && capabilities.focusMode.includes('single-shot')) {\r\n                await track.applyConstraints({\r\n                    advanced: [{ focusMode: 'single-shot' }] as any\r\n                });\r\n                toast.success(\"Focused\");\r\n            } else {\r\n                toast(\"Manual focus not supported on this device. Tap screen to focus if available.\", { icon: 'Γä╣∩╕Å' });\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Focus failed\", e);\r\n            toast(\"Focus adjustment failed\");\r\n        }\r\n    };\r\n\r\n    const captureFrame = (type: 'full' | 'leaf' | 'stem') => {\r\n        if (!areFiltersComplete) {\r\n            toast.error(\"Please complete the Field Observations above before scanning.\");\r\n            return;\r\n        }\r\n        if (!videoRef.current || !canvasRef.current) return;\r\n        const context = canvasRef.current.getContext('2d');\r\n        if (!context) return;\r\n\r\n        canvasRef.current.width = videoRef.current.videoWidth;\r\n        canvasRef.current.height = videoRef.current.videoHeight;\r\n        context.drawImage(videoRef.current, 0, 0);\r\n\r\n        // Simple Detection Simulation: Check for \"Blank\" or \"Dark\" image\r\n        const frame = context.getImageData(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        const data = frame.data;\r\n        let r, g, b, avg;\r\n        let colorSum = 0;\r\n        let brightnessSum = 0;\r\n\r\n        // Sample every 100th pixel for speed\r\n        for (let x = 0; x < data.length; x += 400) {\r\n            r = data[x];\r\n            g = data[x + 1];\r\n            b = data[x + 2];\r\n            avg = (r + g + b) / 3;\r\n            colorSum += avg;\r\n            brightnessSum += avg;\r\n        }\r\n\r\n        const totalPixels = data.length / 400;\r\n        const avgBrightness = brightnessSum / totalPixels;\r\n\r\n        // Thresholds: Too dark or effectively blank\r\n        if (avgBrightness < 20) {\r\n            toast.error(\"Γ¥î No Biological Subject Detected!\\n\\nImage is too dark or empty. Please ensure the plant is well-lit and in frame.\", { duration: 5000, icon: '≡ƒîæ' });\r\n            return;\r\n        }\r\n\r\n        const dataUrl = canvasRef.current.toDataURL('image/jpeg', 0.8);\r\n        setCapturedImages(prev => ({ ...prev, [type]: dataUrl }));\r\n\r\n        // Advance step & Instructional Notifications\r\n        if (type === 'full') {\r\n            setScanningStep('leaf');\r\n            toast.success(\"Full Plant Captured. ≡ƒî┐\\nNow, move closer to scan a single LEAF.\", { duration: 4000 });\r\n        } else if (type === 'leaf') {\r\n            setScanningStep('stem');\r\n            toast.success(\"Leaf Architecture Scanned. ≡ƒìâ\\nFinally, capture the STEM or Bark texture.\", { duration: 4000 });\r\n        } else if (type === 'stem') {\r\n            setScanningStep('complete');\r\n            toast.success(\"Biometric Data Collection Complete! Γ£à\\nProceed to Analysis.\", { duration: 4000 });\r\n        }\r\n    };\r\n\r\n    const resetCapture = () => {\r\n        setCapturedImages({ full: null, leaf: null, stem: null });\r\n        setScanningStep('full');\r\n        setResult(null);\r\n        // Optional: Reset filters? No, user might want to scan again with same settings.\r\n    };\r\n\r\n    const analyzePlant = () => {\r\n        setIsAnalyzing(true);\r\n        stopCamera();\r\n\r\n        // Simulation\r\n        setTimeout(() => {\r\n            setIsAnalyzing(false);\r\n\r\n            // Biometric Feature Detection Simulation\r\n            // We simulate the extraction of distinctive morphological features.\r\n            const detectedFeaturesCount = Math.floor(Math.random() * 6); // Randomly find 0 to 5 features\r\n\r\n            if (detectedFeaturesCount >= 3) {\r\n                // Sufficient data: Match found\r\n                // Prioritize \"Global Simulation Data\" for high accuracy look, fallback to DB\r\n                const sourceData = worldFlora.length > 0 ? worldFlora : dbPlants;\r\n                const randomMatch = sourceData[Math.floor(Math.random() * sourceData.length)];\r\n\r\n                // Map worldFlora format to Plant result format if needed\r\n\r\n                setResult({\r\n                    type: 'found',\r\n                    data: {\r\n                        name: (randomMatch as any).commonName || (randomMatch as any).name,\r\n                        scientificName: (randomMatch as any).scientificName || 'Plantae',\r\n                        description: `Identified via global biometric database. Match Index: ${(randomMatch as any).rarityIndex || 'Standard'}.`,\r\n                        leafShape: (randomMatch as any).leafVenation || 'Observed Data',\r\n                        stemStructure: (randomMatch as any).inflorescencePattern || 'Observed Data',\r\n                        overallHabit: (randomMatch as any).flowerType || 'Observed Data',\r\n                        biometricFeatures: [`Rarity: ${(randomMatch as any).rarityIndex || 'N/A'}`, 'High Confidence Match'],\r\n                        likelyMatches: []\r\n                    },\r\n                    confidence: 96 + Math.floor(Math.random() * 4) // High accuracy\r\n                });\r\n            } else {\r\n                // Insufficient data or No Match\r\n                setResult({\r\n                    type: 'unknown',\r\n                    data: {\r\n                        name: 'No Plant Identified',\r\n                        scientificName: 'Analysis Inconclusive',\r\n                        description: detectedFeaturesCount < 3\r\n                            ? `Biometric scan failed. Only ${detectedFeaturesCount} valid characteristic(s) detected. A minimum of 3 unique features (e.g., Venation, Leaf Margin, Phyllotaxy) is required for identification.`\r\n                            : `Biometric profile complete (${detectedFeaturesCount} features), but no matching specimen found in the global registry.`,\r\n                        leafShape: 'Undetermined',\r\n                        stemStructure: 'Undetermined',\r\n                        overallHabit: 'Undetermined',\r\n                        biometricFeatures: [],\r\n                        likelyMatches: []\r\n                    }\r\n                });\r\n            }\r\n        }, 3000); // 3s analysis simulation\r\n    };\r\n\r\n    const addToDatabase = () => {\r\n        // Navigate to Add Plant with pre-filled state (mock)\r\n        // In a real app, we'd pass state via location\r\n        navigate('/admin/add-plant', {\r\n            state: {\r\n                prefill: {\r\n                    name: result.data.name !== 'Unknown Species' ? result.data.name : result.data.likelyMatches[0].name,\r\n                    scientificName: result.data.scientificName !== 'Plantae Incognita' ? result.data.scientificName : '',\r\n                    description: result.data.description,\r\n                    // Potentially pass the captured images too\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Plant Identifier AI\">\r\n            <div style={{ maxWidth: '1200px', margin: '0 auto', color: '#fff' }}>\r\n\r\n                {/* Header Section */}\r\n                <div style={{\r\n                    background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n                    borderRadius: '24px',\r\n                    padding: '3rem',\r\n                    marginBottom: '2rem',\r\n                    position: 'relative',\r\n                    overflow: 'hidden',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between'\r\n                }}>\r\n                    <div style={{ position: 'relative', zIndex: 2 }}>\r\n                        <h2 style={{ fontSize: '2.5rem', fontWeight: 800, marginBottom: '0.5rem' }}>Bio-Scanner v2.0</h2>\r\n                        <p style={{ opacity: 0.9, fontSize: '1.1rem' }}>Capture plant morphology for standard identification.</p>\r\n                    </div>\r\n                    <div style={{\r\n                        width: '60px', height: '60px',\r\n                        background: 'rgba(255,255,255,0.2)',\r\n                        backdropFilter: 'blur(10px)',\r\n                        borderRadius: '50%',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                    }}>\r\n                        <ScanLine size={32} />\r\n                    </div>\r\n                    {/* Abstract Shapes */}\r\n                    <div style={{ position: 'absolute', top: -50, right: -50, width: 200, height: 200, background: 'rgba(255,255,255,0.1)', borderRadius: '50%' }}></div>\r\n                </div>\r\n\r\n                {/* Main Workflow Grid */}\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '2rem' }}>\r\n\r\n                    {/* Left Col: Camera & Capture */}\r\n                    <div style={{ gridColumn: 'span 2' }}>\r\n\r\n                        {/* Pre-Scan Context Filters - NEW SECTION */}\r\n                        <div style={{\r\n                            background: '#1e293b',\r\n                            borderRadius: '24px',\r\n                            padding: '1.5rem',\r\n                            marginBottom: '1.5rem',\r\n                            border: '1px solid #334155',\r\n                            display: result ? 'none' : 'block' // Hide if result shown\r\n                        }}>\r\n                            <h3 style={{ marginBottom: '1rem', color: '#10b981', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                                <Filter size={20} /> Field Observations\r\n                            </h3>\r\n                            <p style={{ fontSize: '0.9rem', color: '#94a3b8', marginBottom: '1rem' }}>\r\n                                Select environmental traits to calibrate the visual scanner.\r\n                            </p>\r\n\r\n                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>\r\n\r\n                                {/* Life Form Select */}\r\n                                <div>\r\n                                    <label style={{ display: 'block', fontSize: '0.8rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>Life Form</label>\r\n                                    <select\r\n                                        value={filters.lifeForm}\r\n                                        onChange={(e) => setFilters({ ...filters, lifeForm: e.target.value })}\r\n                                        style={{ width: '100%', padding: '0.8rem', borderRadius: '12px', background: '#0f172a', border: '1px solid #334155', color: 'white' }}\r\n                                    >\r\n                                        <option value=\"\">-- Select Type --</option>\r\n                                        <option value=\"herb\">Herb</option>\r\n                                        <option value=\"shrub\">Shrub</option>\r\n                                        <option value=\"tree\">Tree</option>\r\n                                        <option value=\"climber\">Climber</option>\r\n                                        <option value=\"creeper\">Creeper</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                {/* Habitat Select */}\r\n                                <div>\r\n                                    <label style={{ display: 'block', fontSize: '0.8rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>Habitat</label>\r\n                                    <select\r\n                                        value={filters.habitat}\r\n                                        onChange={(e) => setFilters({ ...filters, habitat: e.target.value })}\r\n                                        style={{ width: '100%', padding: '0.8rem', borderRadius: '12px', background: '#0f172a', border: '1px solid #334155', color: 'white' }}\r\n                                    >\r\n                                        <option value=\"\">-- Select Habitat --</option>\r\n                                        <option value=\"terrestrial\">Terrestrial</option>\r\n                                        <option value=\"aquatic\">Aquatic</option>\r\n                                        <option value=\"epiphytic\">Epiphytic</option>\r\n                                        <option value=\"xerophytic\">Xerophytic</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                {/* Stem Nature Select */}\r\n                                <div>\r\n                                    <label style={{ display: 'block', fontSize: '0.8rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>Stem Nature</label>\r\n                                    <select\r\n                                        value={filters.stemNature}\r\n                                        onChange={(e) => setFilters({ ...filters, stemNature: e.target.value })}\r\n                                        style={{ width: '100%', padding: '0.8rem', borderRadius: '12px', background: '#0f172a', border: '1px solid #334155', color: 'white' }}\r\n                                    >\r\n                                        <option value=\"\">-- Select Stem --</option>\r\n                                        <option value=\"woody\">Woody</option>\r\n                                        <option value=\"semi-woody\">Semi-Woody</option>\r\n                                        <option value=\"herbaceous\">Herbaceous</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{\r\n                            background: '#1e293b',\r\n                            borderRadius: '24px',\r\n                            overflow: 'hidden',\r\n                            border: '1px solid #334155',\r\n                            boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\r\n                            opacity: areFiltersComplete ? 1 : 0.5,\r\n                            pointerEvents: areFiltersComplete ? 'auto' : 'none',\r\n                            transition: 'opacity 0.3s'\r\n                        }}>\r\n                            {!result && !isAnalyzing ? (\r\n                                <div style={{ position: 'relative', height: '500px', background: '#000' }}>\r\n                                    {scanningStep !== 'complete' ? (\r\n                                        <>\r\n                                            <video\r\n                                                ref={videoRef}\r\n                                                autoPlay\r\n                                                playsInline\r\n                                                muted\r\n                                                style={{ width: '100%', height: '100%', objectFit: 'cover' }}\r\n                                            />\r\n                                            {/* HUD Overlay */}\r\n                                            <div style={{ position: 'absolute', inset: 0, border: '50px solid rgba(0,0,0,0.5)', pointerEvents: 'none' }}>\r\n                                                <div style={{ width: '100%', height: '100%', border: '2px dashed rgba(255,255,255,0.5)', position: 'relative' }}>\r\n                                                    <div style={{\r\n                                                        position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)',\r\n                                                        color: 'white', textAlign: 'center', background: 'rgba(0,0,0,0.6)', padding: '10px 20px', borderRadius: '99px'\r\n                                                    }}>\r\n                                                        {scanningStep === 'full' && \"Align Full Plant\"}\r\n                                                        {scanningStep === 'leaf' && \"Focus on a Single Leaf\"}\r\n                                                        {scanningStep === 'stem' && \"Capture Stem Details\"}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <button\r\n                                                onClick={handleFocus}\r\n                                                style={{\r\n                                                    position: 'absolute', top: '20px', right: '20px',\r\n                                                    background: 'rgba(0,0,0,0.5)', border: '1px solid rgba(255,255,255,0.3)',\r\n                                                    color: 'white', padding: '10px', borderRadius: '50%',\r\n                                                    cursor: 'pointer', zIndex: 10\r\n                                                }}\r\n                                                title=\"Trigger Auto-Focus\"\r\n                                            >\r\n                                                <Target size={20} />\r\n                                            </button>\r\n\r\n                                            <button\r\n                                                onClick={() => captureFrame(scanningStep as any)}\r\n                                                style={{\r\n                                                    position: 'absolute', bottom: '30px', left: '50%', transform: 'translateX(-50%)',\r\n                                                    width: '80px', height: '80px', borderRadius: '50%', background: 'white',\r\n                                                    border: '4px solid rgba(255,255,255,0.5)', cursor: 'pointer',\r\n                                                    display: 'grid', placeItems: 'center',\r\n                                                    boxShadow: '0 0 20px rgba(255,255,255,0.3)'\r\n                                                }}\r\n                                            >\r\n                                                <Camera size={32} color=\"#000\" />\r\n                                            </button>\r\n                                        </>\r\n                                    ) : (\r\n                                        <div style={{ height: '100%', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '2rem' }}>\r\n                                            <div style={{ width: 100, height: 100, borderRadius: '50%', background: '#10b981', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                                                <Check size={48} color=\"white\" />\r\n                                            </div>\r\n                                            <h2>Scans Complete</h2>\r\n                                            <div style={{ display: 'flex', gap: '1rem' }}>\r\n                                                <button\r\n                                                    onClick={analyzePlant}\r\n                                                    style={{ background: '#10b981', color: 'white', border: 'none', padding: '1rem 3rem', borderRadius: '12px', fontSize: '1.2rem', fontWeight: 600, cursor: 'pointer' }}\r\n                                                >\r\n                                                    Analyze Evidence\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={resetCapture}\r\n                                                    style={{ background: '#334155', color: 'white', border: 'none', padding: '1rem', borderRadius: '12px', cursor: 'pointer' }}\r\n                                                >\r\n                                                    <RefreshCw />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ) : isAnalyzing ? (\r\n                                <div style={{ height: '500px', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', background: '#0f172a' }}>\r\n                                    <div className=\"pre-loader-pulse\"></div>\r\n                                    <p style={{ marginTop: '2rem', color: '#94a3b8', fontSize: '1.1rem' }}>Simulating Neural Network Analysis...</p>\r\n                                    <div style={{ width: '300px', marginTop: '1rem', height: '4px', background: '#334155', borderRadius: '2px', overflow: 'hidden' }}>\r\n                                        <div style={{ width: '100%', height: '100%', background: '#10b981', animation: 'progress 3s ease-in-out' }}>\r\n                                            <style>{`@keyframes progress { from { width: 0%} to { width: 100% } }`}</style>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div style={{ padding: '2rem', height: '500px', overflowY: 'auto' }}>\r\n                                    {/* RESULTS */}\r\n                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                                        <h3 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Analysis Report</h3>\r\n                                        <button onClick={resetCapture} style={{ background: '#334155', border: 'none', padding: '0.5rem 1rem', borderRadius: '8px', color: '#fff', cursor: 'pointer' }}>New Scan</button>\r\n                                    </div>\r\n\r\n                                    <div style={{ display: 'flex', gap: '2rem', alignItems: 'flex-start' }}>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <div style={{\r\n                                                background: result.type === 'found' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(245, 158, 11, 0.1)',\r\n                                                border: `1px solid ${result.type === 'found' ? '#10b981' : '#f59e0b'}`,\r\n                                                borderRadius: '16px', padding: '1.5rem'\r\n                                            }}>\r\n                                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>\r\n                                                    {result.type === 'found' ? <Check size={24} color=\"#10b981\" /> : <Search size={24} color=\"#f59e0b\" />}\r\n                                                    <span style={{ fontSize: '1.2rem', fontWeight: 700, color: result.type === 'found' ? '#10b981' : '#f59e0b' }}>\r\n                                                        {result.type === 'found' ? 'Database Match Confirmed' : 'New Species Discovery'}\r\n                                                    </span>\r\n                                                    <span style={{ marginLeft: 'auto', fontSize: '0.9rem', opacity: 0.7 }}>Confidence: {result.confidence}%</span>\r\n                                                </div>\r\n\r\n                                                <h1 style={{ fontSize: '2rem', fontWeight: 800, marginBottom: '0.5rem' }}>{result.data.name}</h1>\r\n                                                {result.data.scientificName && <p style={{ fontStyle: 'italic', opacity: 0.7, marginBottom: '1rem', fontSize: '1.1rem' }}>{result.data.scientificName}</p>}\r\n\r\n                                                {/* BIOMETRIC DETAILS GRID */}\r\n                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem', background: 'rgba(255,255,255,0.05)', padding: '1rem', borderRadius: '12px' }}>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Leaf Structure</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.leafShape || 'Unknown'}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Stem Type</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.stemStructure || 'Unknown'}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Habit</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.overallHabit || 'Unknown'}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Features</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.biometricFeatures?.join(', ') || 'Standard'}</p>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <p style={{ lineHeight: 1.6, color: '#ecfdf5' }}>{result.data.description}</p>\r\n\r\n                                                {result.type === 'unknown' && (\r\n                                                    <div style={{ marginTop: '1.5rem', padding: '1rem', background: 'rgba(0,0,0,0.2)', borderRadius: '12px' }}>\r\n                                                        <h4 style={{ marginBottom: '0.5rem', opacity: 0.8 }}>Web Search Suggestions:</h4>\r\n                                                        <ul style={{ paddingLeft: '1.2rem' }}>\r\n                                                            {result.data.likelyMatches.map((m: any) => (\r\n                                                                <li key={m.name} style={{ marginBottom: '0.25rem' }}>{m.name} ({m.confidence}% match)</li>\r\n                                                            ))}\r\n                                                        </ul>\r\n                                                        <a href={`https://www.google.com/search?tbm=isch&q=${result.data.likelyMatches[0].name}`} target=\"_blank\" rel=\"noreferrer\" style={{ display: 'inline-block', marginTop: '1rem', color: '#60a5fa', textDecoration: 'none' }}>\r\n                                                            Verify on Google Images &rarr;\r\n                                                        </a>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            <button\r\n                                                onClick={addToDatabase}\r\n                                                style={{\r\n                                                    width: '100%', marginTop: '1.5rem',\r\n                                                    background: '#10b981', color: 'white', border: 'none',\r\n                                                    padding: '1rem', borderRadius: '12px', fontSize: '1.1rem', fontWeight: 700,\r\n                                                    display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem',\r\n                                                    cursor: 'pointer',\r\n                                                    boxShadow: '0 4px 6px rgba(16, 185, 129, 0.4)'\r\n                                                }}\r\n                                            >\r\n                                                <Plus size={20} />\r\n                                                Add to Official Database\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Right Col: Evidence Gallery */}\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            <div style={{ background: '#1e293b', padding: '1.5rem', borderRadius: '24px', border: '1px solid #334155' }}>\r\n                                <h3 style={{ marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}><ImageIcon size={18} /> Evidence Locker</h3>\r\n\r\n                                {['full', 'leaf', 'stem'].map((type, idx) => (\r\n                                    <div key={type} style={{\r\n                                        marginBottom: '1rem',\r\n                                        background: '#0f172a',\r\n                                        borderRadius: '16px',\r\n                                        overflow: 'hidden',\r\n                                        border: scanningStep === type ? '2px solid #10b981' : '1px solid #334155',\r\n                                        opacity: capturedImages[type as keyof typeof capturedImages] ? 1 : 0.5,\r\n                                        transition: '0.3s'\r\n                                    }}>\r\n                                        {capturedImages[type as keyof typeof capturedImages] ? (\r\n                                            <img src={capturedImages[type as keyof typeof capturedImages]!} alt={type} style={{ width: '100%', height: '150px', objectFit: 'cover' }} />\r\n                                        ) : (\r\n                                            <div style={{ height: '150px', display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                                {type === 'full' && <ScanLine size={32} color=\"#475569\" />}\r\n                                                {type === 'leaf' && <Leaf size={32} color=\"#475569\" />}\r\n                                                {type === 'stem' && <Activity size={32} color=\"#475569\" />}\r\n                                                <span style={{ textTransform: 'capitalize', color: '#64748b', fontSize: '0.8rem' }}>{type}</span>\r\n                                            </div>\r\n                                        )}\r\n                                        <div style={{ padding: '0.5rem 1rem', fontSize: '0.8rem', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '1px', background: '#1e293b', color: capturedImages[type as keyof typeof capturedImages] ? '#10b981' : '#64748b' }}>\r\n                                            {idx + 1}. {type} Scan\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    <canvas ref={canvasRef} style={{ display: 'none' }} />\r\n                </div>\r\n            </div>\r\n        </AdminLayout >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PotDesigns.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[513,516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[513,516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":47,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\r\nimport { Download, Search, Package, Image as ImageIcon, Box, Trash2 } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './PotDesigns.module.css';\r\nimport { fetchAdminCustomPots, deleteAdminCustomPot } from '../../services/api';\r\n\r\ninterface CustomPot {\r\n    _id: string;\r\n    userId: string;\r\n    userName: string;\r\n    userEmail: string;\r\n    potColor: string;\r\n    potWithDesignUrl: string;\r\n    rawDesignUrl: string;\r\n    decalProps: any;\r\n    status: string;\r\n    createdAt: string;\r\n}\r\n\r\nexport default function PotDesigns() {\r\n    const [pots, setPots] = useState<CustomPot[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    useEffect(() => {\r\n        loadPots();\r\n    }, []);\r\n\r\n    const loadPots = async () => {\r\n        try {\r\n            const data = await fetchAdminCustomPots();\r\n            setPots(data);\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Failed to load custom designs\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!window.confirm(\"Are you sure you want to remove this design forever?\")) return;\r\n        try {\r\n            await deleteAdminCustomPot(id);\r\n            toast.success(\"Design removed\");\r\n            setPots(prev => prev.filter(p => p._id !== id));\r\n        } catch (e) {\r\n            toast.error(\"Delete failed\");\r\n        }\r\n    };\r\n\r\n    const handleDownload = (imageUrl: string, fileName: string) => {\r\n        if (!imageUrl) {\r\n            toast.error(\"Image data missing\");\r\n            return;\r\n        }\r\n        const link = document.createElement('a');\r\n        link.href = imageUrl;\r\n        link.download = fileName;\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        toast.success(\"Download started\");\r\n    };\r\n\r\n    const filteredPots = pots.filter(pot =>\r\n        pot.userName.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        pot.userEmail.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        pot.potColor.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.titleInfo}>\r\n                    <h1><Package className={styles.icon} /> Custom Pot Collection</h1>\r\n                    <p>Review and download user-designed pot artwork & snapshots</p>\r\n                </div>\r\n                <div className={styles.headerRight}>\r\n                    <div className={styles.searchBar}>\r\n                        <Search size={18} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search by user or color...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className={styles.loading}>\r\n                    <div className=\"pre-loader-pulse\"></div>\r\n                    <p>Fetching design data...</p>\r\n                </div>\r\n            ) : (\r\n                <div className={styles.content}>\r\n                    <div className={styles.grid}>\r\n                        {filteredPots.map((pot) => (\r\n                            <div key={pot._id} className={styles.card}>\r\n                                <div className={styles.cardHeader}>\r\n                                    <div className={styles.userInfo}>\r\n                                        <div className={styles.avatar}>{pot.userName ? pot.userName[0] : 'U'}</div>\r\n                                        <div className={styles.userMeta}>\r\n                                            <h3>{pot.userName || 'Anonymous'}</h3>\r\n                                            <span>{pot.userEmail || 'No Email'}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className={styles.colorBadge} style={{\r\n                                        backgroundColor: pot.potColor,\r\n                                        color: ['#f8fafc', '#ffffff', '#eab308'].includes(pot.potColor?.toLowerCase()) ? '#000' : '#fff'\r\n                                    }}>\r\n                                        {pot.potColor}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className={styles.imageDisplay}>\r\n                                    <div className={styles.imageGroup}>\r\n                                        <span className={styles.imageLabel}><Box size={10} /> Snap</span>\r\n                                        <div className={styles.imageBox}>\r\n                                            {pot.potWithDesignUrl ? (\r\n                                                <img src={pot.potWithDesignUrl} alt=\"3D View\" loading=\"lazy\" />\r\n                                            ) : (\r\n                                                <div className={styles.noImage}>Empty</div>\r\n                                            )}\r\n                                        </div>\r\n                                        <button\r\n                                            className={styles.actionBtn}\r\n                                            onClick={() => handleDownload(pot.potWithDesignUrl, `Vana_3D_${pot.userName}.png`)}\r\n                                        >\r\n                                            <Download size={12} /> 3D\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    <div className={styles.imageGroup}>\r\n                                        <span className={styles.imageLabel}><ImageIcon size={10} /> Art</span>\r\n                                        <div className={styles.imageBox}>\r\n                                            {pot.rawDesignUrl ? (\r\n                                                <img src={pot.rawDesignUrl} alt=\"Raw Art\" loading=\"lazy\" />\r\n                                            ) : (\r\n                                                <div className={styles.noImage}>Empty</div>\r\n                                            )}\r\n                                        </div>\r\n                                        <button\r\n                                            className={`${styles.actionBtn} ${styles.actionBtnRaw}`}\r\n                                            onClick={() => handleDownload(pot.rawDesignUrl, `Vana_Raw_${pot.userName}.png`)}\r\n                                        >\r\n                                            <Download size={12} /> RAW\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className={styles.cardFooter}>\r\n                                    <div className={styles.footerLeft}>\r\n                                        <span className={styles.date}>{new Date(pot.createdAt).toLocaleDateString()}</span>\r\n                                        <span className={styles.status}>{pot.status || 'NEW'}</span>\r\n                                    </div>\r\n                                    <button\r\n                                        className={styles.deleteBtn}\r\n                                        onClick={() => handleDelete(pot._id)}\r\n                                        title=\"Remove Design\"\r\n                                    >\r\n                                        <Trash2 size={14} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {filteredPots.length === 0 && !loading && (\r\n                        <div className={styles.empty}>\r\n                            <ImageIcon size={48} opacity={0.3} />\r\n                            <p>No designs found in the repository.</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\Premium.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":66,"column":8,"nodeType":"ArrayExpression","endLine":66,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [loadData, token]","fix":{"range":[2287,2294],"text":"[loadData, token]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":84,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":84,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":107,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":107,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":267,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":267,"endColumn":59}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport {\r\n    CreditCard, Users, Gift, Lock, Unlock,\r\n    CheckCircle, XCircle, Calculator, Save\r\n} from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './Premium.module.css';\r\n\r\ninterface Payment {\r\n    _id: string;\r\n    userName: string;\r\n    amount: number;\r\n    plan: string;\r\n    status: string;\r\n    date: string;\r\n    orderId: string;\r\n}\r\n\r\ninterface PremiumUser {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n    premiumType: string;\r\n    premiumExpiry: string;\r\n}\r\n\r\nexport const Premium = () => {\r\n    const { user } = useAuth();\r\n    const token = user?.token;\r\n    const [payments, setPayments] = useState<Payment[]>([]);\r\n    const [premiumUsers, setPremiumUsers] = useState<PremiumUser[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [restrictedPages, setRestrictedPages] = useState<string[]>([]);\r\n    const [config, setConfig] = useState({ price: 10, isFree: false, freeStart: '', freeEnd: '' });\r\n    const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const [payRes, settingsRes, configRes] = await Promise.all([\r\n                fetch(`${API_URL}/admin/payments`, { headers: { 'Authorization': `Bearer ${token}` } }),\r\n                fetch(`${API_URL}/admin/settings/restricted-pages`, { headers: { 'Authorization': `Bearer ${token}` } }),\r\n                fetch(`${API_URL}/admin/settings/premium`, { headers: { 'Authorization': `Bearer ${token}` } })\r\n            ]);\r\n\r\n            const payData = await payRes.json();\r\n            const setData = await settingsRes.json();\r\n            const configData = await configRes.json();\r\n\r\n            setPayments(payData.payments || []);\r\n            setPremiumUsers(payData.premiumUsers || []);\r\n            setRestrictedPages(setData.pages || []);\r\n            setConfig(configData);\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            toast.error(\"Failed to load data\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [token]);\r\n\r\n    const handleSaveConfig = async () => {\r\n        try {\r\n            const res = await fetch(`${API_URL}/admin/settings/premium`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify(config)\r\n            });\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                toast.success(\"Pricing & Automated Settings Saved! ≡ƒÜÇ\");\r\n            } else {\r\n                toast.error(\"Failed to save settings\");\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Network error saving config\");\r\n        }\r\n    };\r\n\r\n    const handleRenew = async (userId: string) => {\r\n        if (!confirm(\"Gift 1 Year Premium to this user?\")) return;\r\n        try {\r\n            const res = await fetch(`${API_URL}/admin/premium/renew`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({ userId })\r\n            });\r\n            const data = await res.json();\r\n            if (data.success) {\r\n                toast.success(\"Premium Renewed/Gifted Successfully! ≡ƒÄü\");\r\n                loadData();\r\n            } else {\r\n                toast.error(\"Failed to renew\");\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Error renewing subscription\");\r\n        }\r\n    };\r\n\r\n    const formatDate = (d: string) => new Date(d).toLocaleDateString(undefined, {\r\n        year: 'numeric', month: 'short', day: 'numeric'\r\n    });\r\n\r\n    return (\r\n        <AdminLayout title=\"Premium Management\">\r\n            <div className={styles.container}>\r\n\r\n                {loading ? (\r\n                    <div className={styles.loadingContainer}>\r\n                        <div className={styles.loadingSpinner}></div>\r\n                        <p>Loading Premium Data...</p>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Highlights Grid */}\r\n                        <div className={styles.statsGrid}>\r\n                            <div className={styles.statCard}>\r\n                                <div className={`${styles.statIconBox} ${styles.iconPurple}`}>\r\n                                    <Users size={32} />\r\n                                </div>\r\n                                <div className={styles.statContent}>\r\n                                    <h3>Active Subscribers</h3>\r\n                                    <div className={styles.statValue}>{premiumUsers.length}</div>\r\n                                </div>\r\n                                {/* Decorative orb */}\r\n                                <div style={{ position: 'absolute', right: -20, top: -20, width: 100, height: 100, background: 'rgba(168,85,247,0.1)', borderRadius: '50%', filter: 'blur(30px)' }}></div>\r\n                            </div>\r\n\r\n                            <div className={styles.statCard}>\r\n                                <div className={`${styles.statIconBox} ${styles.iconEmerald}`}>\r\n                                    <CreditCard size={32} />\r\n                                </div>\r\n                                <div className={styles.statContent}>\r\n                                    <h3>Total Revenue</h3>\r\n                                    <div className={styles.statValue}>\r\n                                        Γé╣{payments.reduce((acc, curr) => acc + (curr.amount || 0), 0)}\r\n                                    </div>\r\n                                </div>\r\n                                <div style={{ position: 'absolute', right: -20, top: -20, width: 100, height: 100, background: 'rgba(16,185,129,0.1)', borderRadius: '50%', filter: 'blur(30px)' }}></div>\r\n                            </div>\r\n\r\n                            <div className={styles.statCard}>\r\n                                <div className={`${styles.statIconBox} ${styles.iconAmber}`}>\r\n                                    <Gift size={32} />\r\n                                </div>\r\n                                <div className={styles.statContent}>\r\n                                    <h3>Gifted Plans</h3>\r\n                                    <div className={styles.statValue}>\r\n                                        {premiumUsers.filter(u => u.premiumType === 'gift').length}\r\n                                    </div>\r\n                                </div>\r\n                                <div style={{ position: 'absolute', right: -20, top: -20, width: 100, height: 100, background: 'rgba(245,158,11,0.1)', borderRadius: '50%', filter: 'blur(30px)' }}></div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* CONFIG PANEL (NEW) */}\r\n                        <div className={styles.sectionPanel}>\r\n                            <div className={styles.panelHeader}>\r\n                                <h2 className={styles.panelTitle}>\r\n                                    <Calculator size={20} className=\"text-cyan-400\" />\r\n                                    <span>Pricing & Automation</span>\r\n                                </h2>\r\n                                <button onClick={handleSaveConfig} className={styles.actionBtn} style={{ background: '#0891b2', border: 'none', color: '#fff' }}>\r\n                                    <Save size={16} /> Save Settings\r\n                                </button>\r\n                            </div>\r\n                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1.5rem', marginTop: '1rem', padding: '0.5rem' }}>\r\n\r\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                    <label style={{ color: '#94a3b8', fontSize: '0.9rem', fontWeight: 500 }}>Subscription Price (Γé╣)</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        value={config.price}\r\n                                        onChange={e => setConfig({ ...config, price: parseInt(e.target.value) })}\r\n                                        style={{ background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', padding: '0.75rem', borderRadius: '0.5rem', color: '#fff', fontSize: '1.1rem', fontWeight: 'bold' }}\r\n                                    />\r\n                                    <span style={{ fontSize: '0.8rem', color: '#64748b' }}>Current live price for new users</span>\r\n                                </div>\r\n\r\n                                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                    <label style={{ color: '#94a3b8', fontSize: '0.9rem', fontWeight: 500 }}>Promo Status</label>\r\n                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', cursor: 'pointer', background: 'rgba(255,255,255,0.05)', padding: '0.75rem', borderRadius: '0.5rem', border: config.isFree ? '1px solid #10b981' : '1px solid rgba(255,255,255,0.1)', height: '100%' }}>\r\n                                        <input\r\n                                            type=\"checkbox\"\r\n                                            checked={config.isFree}\r\n                                            onChange={e => setConfig({ ...config, isFree: e.target.checked })}\r\n                                            style={{ width: '20px', height: '20px', accentColor: '#10b981' }}\r\n                                        />\r\n                                        <span style={{ color: config.isFree ? '#10b981' : '#cbd5e1', fontWeight: 600 }}>\r\n                                            {config.isFree ? 'FREE MODE ACTIVE' : 'Standard Paid Mode'}\r\n                                        </span>\r\n                                    </label>\r\n                                </div>\r\n\r\n                                {config.isFree && (\r\n                                    <>\r\n                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                            <label style={{ color: '#94a3b8', fontSize: '0.9rem', fontWeight: 500 }}>Promo Start Date</label>\r\n                                            <input\r\n                                                type=\"date\"\r\n                                                value={config.freeStart ? config.freeStart.split('T')[0] : ''}\r\n                                                onChange={e => setConfig({ ...config, freeStart: e.target.value })}\r\n                                                style={{ background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', padding: '0.75rem', borderRadius: '0.5rem', color: '#fff', colorScheme: 'dark' }}\r\n                                            />\r\n                                        </div>\r\n                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                            <label style={{ color: '#94a3b8', fontSize: '0.9rem', fontWeight: 500 }}>Promo End Date</label>\r\n                                            <input\r\n                                                type=\"date\"\r\n                                                value={config.freeEnd ? config.freeEnd.split('T')[0] : ''}\r\n                                                onChange={e => setConfig({ ...config, freeEnd: e.target.value })}\r\n                                                style={{ background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', padding: '0.75rem', borderRadius: '0.5rem', color: '#fff', colorScheme: 'dark' }}\r\n                                            />\r\n                                        </div>\r\n                                    </>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Control Deck */}\r\n                        <div className={styles.sectionPanel}>\r\n                            <div className={styles.panelHeader}>\r\n                                <h2 className={styles.panelTitle}>\r\n                                    <Lock size={20} className=\"text-orange-400\" />\r\n                                    <span>Access Control Deck</span>\r\n                                </h2>\r\n                                <span style={{ fontSize: '0.85rem', color: '#94a3b8' }}>Click to toggle specific page restrictions</span>\r\n                            </div>\r\n\r\n                            <div className={styles.controlGrid}>\r\n                                {[\r\n                                    { name: 'Heaven', path: '/heaven' },\r\n                                    { name: 'Shops Global', path: '/shops' },\r\n                                    { name: 'AI Diagnostics', path: '/make-it-real' },\r\n                                    { name: 'Leaderboard', path: '/leaderboard' },\r\n                                    { name: 'Nearby GPS', path: '/nearby' }\r\n                                ].map(page => {\r\n                                    const isLocked = restrictedPages.includes(page.path);\r\n                                    return (\r\n                                        <div\r\n                                            key={page.path}\r\n                                            onClick={async () => {\r\n                                                const newList = isLocked\r\n                                                    ? restrictedPages.filter(p => p !== page.path)\r\n                                                    : [...restrictedPages, page.path];\r\n\r\n                                                setRestrictedPages(newList);\r\n                                                try {\r\n                                                    await fetch(`${API_URL}/admin/settings/restricted-pages`, {\r\n                                                        method: 'POST',\r\n                                                        headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },\r\n                                                        body: JSON.stringify({ pages: newList })\r\n                                                    });\r\n                                                    toast.success(`${page.name} is now ${isLocked ? 'Unlocked' : 'Locked'}`);\r\n                                                } catch (e) {\r\n                                                    toast.error(\"Failed to save setting\");\r\n                                                }\r\n                                            }}\r\n                                            className={`${styles.controlCard} ${isLocked ? styles.locked : ''}`}\r\n                                        >\r\n                                            <span className={styles.cardName}>{page.name}</span>\r\n                                            {isLocked\r\n                                                ? <Lock size={20} className=\"text-orange-500\" />\r\n                                                : <Unlock size={20} className=\"text-emerald-500\" />\r\n                                            }\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Recent Subscribers */}\r\n                        <div className={styles.sectionPanel}>\r\n                            <div className={styles.panelHeader}>\r\n                                <h2 className={styles.panelTitle}>\r\n                                    <Users size={20} className=\"text-indigo-400\" />\r\n                                    <span>Premium Subscribers</span>\r\n                                </h2>\r\n                            </div>\r\n                            <div className={styles.tableContainer}>\r\n                                <table className={styles.table}>\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th>User</th>\r\n                                            <th>Plan Type</th>\r\n                                            <th>Expires</th>\r\n                                            <th>Action</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        {premiumUsers.map(user => (\r\n                                            <tr key={user._id}>\r\n                                                <td>\r\n                                                    <div className={styles.userCell}>\r\n                                                        <span className={styles.userName}>{user.name}</span>\r\n                                                        <span className={styles.userEmail}>{user.email}</span>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td>\r\n                                                    <span className={`${styles.badge} ${user.premiumType === 'gift' ? styles.badgeGift : styles.badgeStandard}`}>\r\n                                                        {user.premiumType}\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td>{formatDate(user.premiumExpiry)}</td>\r\n                                                <td>\r\n                                                    <button onClick={() => handleRenew(user._id)} className={styles.actionBtn}>\r\n                                                        <Gift size={14} /> Gift Renew\r\n                                                    </button>\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                        {premiumUsers.length === 0 && (\r\n                                            <tr>\r\n                                                <td colSpan={4} style={{ textAlign: 'center', padding: '3rem', color: '#64748b' }}>No active subscribers found.</td>\r\n                                            </tr>\r\n                                        )}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Transactions */}\r\n                        <div className={styles.sectionPanel}>\r\n                            <div className={styles.panelHeader}>\r\n                                <h2 className={styles.panelTitle}>\r\n                                    <CreditCard size={20} className=\"text-emerald-400\" />\r\n                                    <span>Transaction History</span>\r\n                                </h2>\r\n                            </div>\r\n                            <div className={styles.tableContainer}>\r\n                                <table className={styles.table}>\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th>Date</th>\r\n                                            <th>User</th>\r\n                                            <th>Order ID</th>\r\n                                            <th>Amount</th>\r\n                                            <th>Status</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        {payments.map(pay => (\r\n                                            <tr key={pay._id}>\r\n                                                <td style={{ color: '#94a3b8' }}>{formatDate(pay.date)}</td>\r\n                                                <td style={{ fontWeight: 500 }}>{pay.userName}</td>\r\n                                                <td style={{ fontFamily: 'monospace', fontSize: '0.85rem', color: '#64748b' }}>{pay.orderId || 'PROMO-FREE'}</td>\r\n                                                <td style={{ fontWeight: 700, color: '#f1f5f9' }}>Γé╣{pay.amount}</td>\r\n                                                <td>\r\n                                                    {pay.status === 'paid' ? (\r\n                                                        <span className={`${styles.badge} ${styles.badgePaid}`}>\r\n                                                            <CheckCircle size={12} /> PAID\r\n                                                        </span>\r\n                                                    ) : (\r\n                                                        <span className={`${styles.badge} ${styles.badgeFailed}`}>\r\n                                                            <XCircle size={12} /> FAILED\r\n                                                        </span>\r\n                                                    )}\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                        {payments.length === 0 && (\r\n                                            <tr>\r\n                                                <td colSpan={5} style={{ textAlign: 'center', padding: '3rem', color: '#64748b' }}>No transaction history available.</td>\r\n                                            </tr>\r\n                                        )}\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n\r\n                    </>\r\n                )}\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PriceManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":27,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":85,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":103,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchPlants, fetchVendors, updateVendor } from '../../services/api';\r\nimport type { Plant, Vendor } from '../../types';\r\nimport { Search, Edit2, Trash2, Save, X, Store } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './PriceManagement.module.css';\r\n\r\nexport const PriceManagement = () => {\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [vendors, setVendors] = useState<Vendor[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    // Editing State\r\n    const [editingItem, setEditingItem] = useState<{ vendorId: string, plantId: string, price: number } | null>(null);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const [pData, vData] = await Promise.all([fetchPlants(), fetchVendors()]);\r\n            setPlants(pData);\r\n            setVendors(vData);\r\n        } catch (err) {\r\n            toast.error(\"Failed to load data\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <AdminLayout title=\"Vendor Price Management\">\r\n                <div style={{ height: '60vh', display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\r\n                    <div className=\"pre-loader-pulse\" />\r\n                </div>\r\n            </AdminLayout>\r\n        );\r\n    }\r\n\r\n    // Flatten Inventory\r\n    const allPrices = vendors.flatMap(v => {\r\n        const items = v.inventory || [];\r\n        return items.map(item => {\r\n            const plant = plants.find(p => p.id === item.plantId);\r\n            return {\r\n                uniqueKey: `${v.id}-${item.plantId}`,\r\n                vendor: v,\r\n                plantId: item.plantId,\r\n                plantName: plant ? plant.name : 'Unknown Plant',\r\n                plantImage: plant?.imageUrl,\r\n                price: item.price,\r\n                inStock: item.inStock\r\n            };\r\n        });\r\n    });\r\n\r\n    const filteredItems = allPrices.filter(item =>\r\n        item.vendor.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        item.plantName.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    const handleSave = async () => {\r\n        if (!editingItem) return;\r\n\r\n        const vendor = vendors.find(v => v.id === editingItem.vendorId);\r\n        if (!vendor) return;\r\n\r\n        const updatedInventory = (vendor.inventory || []).map(i => {\r\n            if (i.plantId === editingItem.plantId) {\r\n                return { ...i, price: Number(editingItem.price) };\r\n            }\r\n            return i;\r\n        });\r\n\r\n        const tid = toast.loading(\"Updating price...\");\r\n        try {\r\n            await updateVendor(vendor.id, { inventory: updatedInventory });\r\n            toast.success(\"Price updated\", { id: tid });\r\n            setEditingItem(null);\r\n            loadData(); // Refresh to ensure sync\r\n        } catch (err) {\r\n            toast.error(\"Failed to update\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleRemove = async (vendorId: string, plantId: string) => {\r\n        if (!confirm(\"Are you sure you want to remove this price listing?\")) return;\r\n\r\n        const vendor = vendors.find(v => v.id === vendorId);\r\n        if (!vendor) return;\r\n\r\n        const updatedInventory = (vendor.inventory || []).filter(i => i.plantId !== plantId);\r\n\r\n        const tid = toast.loading(\"Removing listing...\");\r\n        try {\r\n            await updateVendor(vendor.id, { inventory: updatedInventory });\r\n            toast.success(\"Listing removed\", { id: tid });\r\n            loadData();\r\n        } catch (err) {\r\n            toast.error(\"Failed to remove\", { id: tid });\r\n        }\r\n    };\r\n\r\n    // Calculate Stats\r\n    const totalListings = filteredItems.length;\r\n    const activeVendors = new Set(filteredItems.map(i => i.vendor.id)).size;\r\n    const avgPrice = totalListings > 0\r\n        ? Math.round(filteredItems.reduce((acc, curr) => acc + curr.price, 0) / totalListings)\r\n        : 0;\r\n\r\n    return (\r\n        <AdminLayout title=\"Capital Control\">\r\n            <div className={styles.container}>\r\n\r\n                {/* Header & Stats */}\r\n                <div className={styles.headerGroup}>\r\n                    <div>\r\n                        <h1 className={styles.title}>Price Management</h1>\r\n                        <p className={styles.subtitle}>Monitor and regulate market rates across the vendor network.</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.statsGrid}>\r\n                    <div className={styles.statCard}>\r\n                        <div className={styles.statIconWrapper}><Store size={48} /></div>\r\n                        <div className={styles.statValue}>{activeVendors}</div>\r\n                        <div className={styles.statLabel}>Active Vendors</div>\r\n                    </div>\r\n                    <div className={styles.statCard}>\r\n                        <div className={styles.statIconWrapper}><Edit2 size={48} /></div>\r\n                        <div className={styles.statValue}>{totalListings}</div>\r\n                        <div className={styles.statLabel}>Price Listings</div>\r\n                    </div>\r\n                    <div className={styles.statCard}>\r\n                        <div className={styles.statIconWrapper}><Save size={48} /></div>\r\n                        <div className={styles.statValue}>Γé╣{avgPrice}</div>\r\n                        <div className={styles.statLabel}>Avg. Market Rate</div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Controls */}\r\n                <div className={styles.controlsBar}>\r\n                    <div className={styles.searchWrapper}>\r\n                        <Search size={20} className={styles.searchIcon} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search by vendor, plant, or ID...\"\r\n                            value={searchTerm}\r\n                            onChange={e => setSearchTerm(e.target.value)}\r\n                            className={styles.searchInput}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Table */}\r\n                <div className={styles.tableContainer}>\r\n                    <table className={styles.table}>\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Vendor / Shop</th>\r\n                                <th>Plant Details</th>\r\n                                <th>Market Price</th>\r\n                                <th>Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {filteredItems.map(item => (\r\n                                <tr key={item.uniqueKey}>\r\n                                    <td>\r\n                                        <div className={styles.vendorCell}>\r\n                                            <div className={styles.vendorAvatar}>\r\n                                                {item.vendor.name.charAt(0)}\r\n                                            </div>\r\n                                            <div className={styles.vendorInfo}>\r\n                                                <h4>{item.vendor.name}</h4>\r\n                                                <p>{item.vendor.address || 'Online Vendor'}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td>\r\n                                        <div className={styles.plantCell}>\r\n                                            <img\r\n                                                src={item.plantImage || 'https://via.placeholder.com/48'}\r\n                                                className={styles.plantImg}\r\n                                                alt=\"\"\r\n                                            />\r\n                                            <span className={styles.plantName}>{item.plantName}</span>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td>\r\n                                        {editingItem?.vendorId === item.vendor.id && editingItem?.plantId === item.plantId ? (\r\n                                            <div className={styles.editWrapper}>\r\n                                                <span className={styles.currency}>Γé╣</span>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    value={editingItem.price}\r\n                                                    onChange={e => setEditingItem({ ...editingItem, price: Number(e.target.value) })}\r\n                                                    className={styles.editInput}\r\n                                                    autoFocus\r\n                                                />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className={styles.priceDisplay}>\r\n                                                Γé╣ {item.price}\r\n                                            </div>\r\n                                        )}\r\n                                    </td>\r\n                                    <td>\r\n                                        <div className={styles.actionGroup}>\r\n                                            {editingItem?.vendorId === item.vendor.id && editingItem?.plantId === item.plantId ? (\r\n                                                <>\r\n                                                    <button\r\n                                                        onClick={handleSave}\r\n                                                        className={`${styles.iconBtn} ${styles.btnSave}`}\r\n                                                        title=\"Save Changes\"\r\n                                                    >\r\n                                                        <Save size={18} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => setEditingItem(null)}\r\n                                                        className={`${styles.iconBtn} ${styles.btnCancel}`}\r\n                                                        title=\"Cancel\"\r\n                                                    >\r\n                                                        <X size={18} />\r\n                                                    </button>\r\n                                                </>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <button\r\n                                                        onClick={() => setEditingItem({ vendorId: item.vendor.id, plantId: item.plantId, price: item.price })}\r\n                                                        className={`${styles.iconBtn} ${styles.btnEdit}`}\r\n                                                        title=\"Edit Price\"\r\n                                                    >\r\n                                                        <Edit2 size={18} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => handleRemove(item.vendor.id, item.plantId)}\r\n                                                        className={`${styles.iconBtn} ${styles.btnDelete}`}\r\n                                                        title=\"Remove Listing\"\r\n                                                    >\r\n                                                        <Trash2 size={18} />\r\n                                                    </button>\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                            {filteredItems.length === 0 && (\r\n                                <tr>\r\n                                    <td colSpan={4} className={styles.emptyState}>\r\n                                        <Store size={48} style={{ margin: '0 auto 1rem', opacity: 0.2 }} />\r\n                                        <p>No price listings found matching \"{searchTerm}\"</p>\r\n                                    </td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\SeedDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[552,555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[552,555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[568,571],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[568,571],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1369,1372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1369,1372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1804,1807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1804,1807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2892,2895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2892,2895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3078,3081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3078,3081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3785,3788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3785,3788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3918,3921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3918,3921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4230,4233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4230,4233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4411,4414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4411,4414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4819,4822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4819,4822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5743,5746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5743,5746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5924,5927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5924,5927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6458,6461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6458,6461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport styles from './SeedDashboard.module.css';\r\nimport { fetchSeedData, seedSinglePlant, deployAllPlants, fetchPlants, deletePlant, toggleSeedType, deleteSeedPlant } from '../../services/api';\r\nimport { Database, CloudUpload, Check, Rocket, ShieldCheck, Sprout, Search, Trash2, ArrowLeftRight, X } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nexport const SeedDashboard = () => {\r\n    const [loading, setLoading] = useState(true);\r\n    const [seedData, setSeedData] = useState<{ indoor: any[], outdoor: any[] }>({ indoor: [], outdoor: [] });\r\n    // Map of Lowercase Scientific Name -> Live Database ID\r\n    const [liveScientificMap, setLiveScientificMap] = useState<Map<string, string>>(new Map());\r\n    const [deploying, setDeploying] = useState<string | null>(null);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [viewMode, setViewMode] = useState<'all' | 'indoor' | 'outdoor'>('all');\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const [seeds, livePlants] = await Promise.all([fetchSeedData(), fetchPlants()]);\r\n            setSeedData(seeds);\r\n\r\n            // Build Map: Scientific Name (lower) -> Mongo ID\r\n            const newMap = new Map<string, string>();\r\n            livePlants.forEach((p: any) => {\r\n                if (p.scientificName) {\r\n                    newMap.set(p.scientificName.toLowerCase().trim(), p.id);\r\n                }\r\n            });\r\n            setLiveScientificMap(newMap);\r\n        } catch (error) {\r\n            toast.error(\"Failed to load databank\");\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handlePush = async (plant: any) => {\r\n        // Validation: Check if scientific name exists\r\n        const sciName = plant.scientificName?.toLowerCase().trim();\r\n        if (sciName && liveScientificMap.has(sciName)) {\r\n            toast.error(`Action Blocked: \"${plant.scientificName}\" already exists in the live database.`);\r\n            return;\r\n        }\r\n\r\n        setDeploying(plant.id);\r\n        try {\r\n            // Ideally response contains the new plant ID, but if not we can reload or rely on name matching logic for next render if we re-fetch\r\n            const res = await seedSinglePlant(plant.id);\r\n\r\n            // If response has the new plant object, update map immediately\r\n            if (res && res.id && sciName) {\r\n                setLiveScientificMap(prev => new Map(prev).set(sciName, res.id));\r\n                toast.success(`${plant.name} deployed to Live!`);\r\n            } else {\r\n                // Fallback: Reload all to get the new ID\r\n                toast.success(`${plant.name} deployed! Syncing...`);\r\n                await loadData();\r\n            }\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Deployment failed\");\r\n        } finally {\r\n            setDeploying(null);\r\n        }\r\n    };\r\n\r\n    const handleRemove = async (plant: any) => {\r\n        const sciName = plant.scientificName?.toLowerCase().trim();\r\n        const liveId = liveScientificMap.get(sciName);\r\n\r\n        if (!liveId) {\r\n            toast.error(\"Could not find live record ID for removal.\");\r\n            return;\r\n        }\r\n\r\n        if (!confirm(`Are you sure you want to REMOVE ${plant.name} from the live database?`)) return;\r\n\r\n        try {\r\n            await deletePlant(liveId);\r\n            setLiveScientificMap(prev => {\r\n                const newMap = new Map(prev);\r\n                newMap.delete(sciName);\r\n                return newMap;\r\n            });\r\n            toast.success(`${plant.name} removed from Live Database.`);\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Removal failed\");\r\n        }\r\n    };\r\n\r\n    const handleToggleType = async (plant: any) => {\r\n        setLoading(true);\r\n        try {\r\n            const data = await toggleSeedType(plant.id);\r\n            setSeedData({ indoor: data.indoor, outdoor: data.outdoor });\r\n            toast.success(`Switched ${plant.name} to ${plant.type === 'indoor' ? 'Outdoor' : 'Indoor'}`);\r\n        } catch (e: any) {\r\n            toast.error(e.message || \"Switch failed\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteSeed = async (plant: any) => {\r\n        if (!confirm(`Warning: This will permanently DELETE ${plant.name} from the Seed Bank file. This cannot be undone.`)) return;\r\n        setLoading(true);\r\n        try {\r\n            const data = await deleteSeedPlant(plant.id);\r\n            setSeedData({ indoor: data.indoor, outdoor: data.outdoor });\r\n            toast.success(`${plant.name} erased from Seed Bank.`);\r\n        } catch (e: any) {\r\n            toast.error(e.message || \"Delete failed\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeployAll = async () => {\r\n        const type = viewMode === 'all' ? undefined : viewMode;\r\n        const typeLabel = viewMode === 'all' ? 'ALL' : viewMode.toUpperCase();\r\n\r\n        if (!confirm(`Are you sure you want to DEPLOY ${typeLabel} new plants to production? Existing live plants will be preserved.`)) return;\r\n        setLoading(true);\r\n        try {\r\n            const res = await deployAllPlants(type);\r\n            await loadData();\r\n\r\n            if (res.added > 0) {\r\n                toast.success(`Deployment Success: ${res.added} New ${typeLabel} Plants Added. (${res.skipped} Skipped)`);\r\n            } else {\r\n                toast.success(`System Synced: All ${res.skipped} ${typeLabel} plants are already live.`);\r\n            }\r\n        } catch (e: any) {\r\n            toast.error(e.message || \"Mass deployment failed\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const filterPlants = (plants: any[]) => {\r\n        return plants.filter(p =>\r\n            p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            p.scientificName?.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            p.type.toLowerCase().includes(searchTerm.toLowerCase())\r\n        );\r\n    };\r\n\r\n    if (loading) return <div className={styles.loading}>Loading Seed Bank...</div>;\r\n\r\n    const filteredIndoor = filterPlants(seedData.indoor);\r\n    const filteredOutdoor = filterPlants(seedData.outdoor);\r\n\r\n    const renderCard = (plant: any) => {\r\n        const sciName = plant.scientificName?.toLowerCase().trim();\r\n        const isDeployed = sciName && liveScientificMap.has(sciName);\r\n\r\n        return (\r\n            <div key={plant.id} className={`${styles.card} ${isDeployed ? styles.isLive : ''}`}>\r\n                <div className={styles.cardHeader}>\r\n                    {isDeployed ? (\r\n                        <div className={styles.statusLive}>\r\n                            <Check size={14} /> Live\r\n                        </div>\r\n                    ) : (\r\n                        <div className={styles.statusSeed}>\r\n                            <Sprout size={14} /> Seed\r\n                        </div>\r\n                    )}\r\n                    <div className={styles.actions}>\r\n                        <button\r\n                            className={styles.iconBtn}\r\n                            onClick={() => handleToggleType(plant)}\r\n                            title=\"Switch Type (Indoor/Outdoor)\"\r\n                        >\r\n                            <ArrowLeftRight size={14} />\r\n                        </button>\r\n                        <button\r\n                            className={styles.iconBtn}\r\n                            onClick={() => handleDeleteSeed(plant)}\r\n                            title=\"Delete from File\"\r\n                        >\r\n                            <Trash2 size={14} />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.cardContent}>\r\n                    <img src={plant.imageUrl} alt={plant.name} className={styles.plantImage} />\r\n                    <div>\r\n                        <h3 className={styles.plantName}>{plant.name}</h3>\r\n                        <p className={styles.scientificName}>{plant.scientificName}</p>\r\n\r\n                        <div className={styles.stats}>\r\n                            <span className={styles.stat}>{plant.type}</span>\r\n                            <span className={styles.stat}>${plant.price}</span>\r\n                        </div>\r\n\r\n                        <div className={styles.verifiedSource} title={plant.verifiedSource}>\r\n                            <ShieldCheck size={12} />\r\n                            {plant.verifiedSource || \"Gene Bank verified\"}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.deployAction}>\r\n                        {!isDeployed ? (\r\n                            <button\r\n                                className={styles.pushBtn}\r\n                                onClick={() => handlePush(plant)}\r\n                                disabled={deploying === plant.id}\r\n                            >\r\n                                {deploying === plant.id ? '...' : (\r\n                                    <>\r\n                                        <CloudUpload size={14} /> Push to Live\r\n                                    </>\r\n                                )}\r\n                            </button>\r\n                        ) : (\r\n                            <button\r\n                                className={styles.removeBtn}\r\n                                onClick={() => handleRemove(plant)}\r\n                            >\r\n                                <X size={14} /> Remove Live\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const themeClass = styles[`theme${viewMode.charAt(0).toUpperCase() + viewMode.slice(1)}`];\r\n\r\n    return (\r\n        <div className={`${styles.container} ${themeClass}`}>\r\n            <div className={styles.header}>\r\n                <div className={styles.headerLeft}>\r\n                    <Database size={28} className={styles.headerIcon} />\r\n                    <div>\r\n                        <h1>Seed Data Bank</h1>\r\n                        <p>Master Source File Control (v2.0 Verified)</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.headerRight}>\r\n                    <div className={styles.tabs}>\r\n                        <button\r\n                            className={`${styles.tabBtn} ${viewMode === 'all' ? styles.activeTab : ''}`}\r\n                            onClick={() => setViewMode('all')}\r\n                        >\r\n                            All Systems\r\n                        </button>\r\n                        <button\r\n                            className={`${styles.tabBtn} ${viewMode === 'indoor' ? styles.activeTab : ''}`}\r\n                            onClick={() => setViewMode('indoor')}\r\n                        >\r\n                            Indoor Specimen\r\n                        </button>\r\n                        <button\r\n                            className={`${styles.tabBtn} ${viewMode === 'outdoor' ? styles.activeTab : ''}`}\r\n                            onClick={() => setViewMode('outdoor')}\r\n                        >\r\n                            Outdoor Ecosystems\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.toolbar}>\r\n                <div className={styles.searchContainer}>\r\n                    <Search size={18} className={styles.searchIcon} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search seed bank...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className={styles.searchInput}\r\n                    />\r\n                </div>\r\n\r\n                <button onClick={handleDeployAll} className={styles.deployAllBtn}>\r\n                    <Rocket size={18} />\r\n                    DEPLOY {viewMode === 'all' ? 'ALL SYSTEMS' : viewMode.toUpperCase()}\r\n                </button>\r\n            </div>\r\n\r\n            <div className={styles.content}>\r\n                {(viewMode === 'all' || viewMode === 'indoor') && (\r\n                    <div className={styles.section}>\r\n                        <div className={styles.sectionTitle}>\r\n                            Inside Sanctuary ({filteredIndoor.length})\r\n                        </div>\r\n                        <div className={styles.grid}>\r\n                            {filteredIndoor.map(renderCard)}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {(viewMode === 'all' || viewMode === 'outdoor') && (\r\n                    <div className={styles.section}>\r\n                        <div className={styles.sectionTitle}>\r\n                            Outside World ({filteredOutdoor.length})\r\n                        </div>\r\n                        <div className={styles.grid}>\r\n                            {filteredOutdoor.map(renderCard)}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\Settings.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":69,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { Lock, Bell, Database, Shield, Zap, Globe, Mail, Key, UserPlus, Fingerprint, Smartphone, MessageSquare, Webhook, Code2, Users } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport styles from './Settings.module.css';\r\n\r\ntype Tab = 'general' | 'security' | 'notifications' | 'api' | 'team';\r\n\r\nexport const Settings = () => {\r\n    const [activeTab, setActiveTab] = useState<Tab>('general');\r\n\r\n    // Mock state for settings\r\n    const [settings, setSettings] = useState({\r\n        twoFactor: false,\r\n        emailNotifs: true,\r\n        autoBackup: true,\r\n        maintenance: false,\r\n        publicAPI: true,\r\n        marketingEmails: false,\r\n        pushNotifs: true,\r\n        smsNotifs: false,\r\n        biometric: false,\r\n        webhookEnabled: true\r\n    });\r\n\r\n    const toggleSetting = (key: keyof typeof settings) => {\r\n        setSettings(prev => {\r\n            const newState = !prev[key];\r\n            const name = key.replace(/([A-Z])/g, ' $1').trim();\r\n            toast.success(`${newState ? 'Enabled' : 'Disabled'} ${name}`);\r\n            return { ...prev, [key]: newState };\r\n        });\r\n    };\r\n\r\n    const handleDangerAction = async (action: string) => {\r\n        if (window.confirm(`Are you sure you want to ${action}? This cannot be undone.`)) {\r\n            const tid = toast.loading(`${action} in progress...`);\r\n\r\n            try {\r\n                if (action === 'Bulk Ecosystem Sync') {\r\n                    const { fetchPlants, updatePlant } = await import('../../services/api');\r\n                    const { INDIAN_PLANT_DB } = await import('../../data/indianPlants');\r\n\r\n                    const plants = await fetchPlants();\r\n                    let updatedCount = 0;\r\n\r\n                    for (const plant of plants) {\r\n                        const sciName = (plant.scientificName || '').toLowerCase().trim();\r\n                        const template = INDIAN_PLANT_DB[sciName];\r\n\r\n                        if (template) {\r\n                            await updatePlant(plant.id, {\r\n                                ...plant,\r\n                                idealTempMin: template.idealTempMin || plant.idealTempMin,\r\n                                idealTempMax: template.idealTempMax || plant.idealTempMax,\r\n                                minHumidity: template.minHumidity || plant.minHumidity,\r\n                                isNocturnal: template.isNocturnal ?? plant.isNocturnal\r\n                            });\r\n                            updatedCount++;\r\n                        }\r\n                    }\r\n                    toast.success(`Synced ${updatedCount} specimens with Ecosystem Intelligence`, { id: tid });\r\n                } else {\r\n                    setTimeout(() => {\r\n                        toast.dismiss(tid);\r\n                        toast.success(`${action} Completed Successfully`);\r\n                    }, 1500);\r\n                }\r\n            } catch (err) {\r\n                toast.error(`${action} failed: Check terminal logs`, { id: tid });\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    return (\r\n        <AdminLayout title=\"Configuration\">\r\n            <div className={styles.pageContainer}>\r\n                <div className={styles.layout}>\r\n\r\n                    {/* Side Navigation */}\r\n                    <div className={styles.settingsNav}>\r\n                        <button onClick={() => setActiveTab('general')} className={`${styles.navItem} ${activeTab === 'general' ? styles.navItemActive : ''}`}>\r\n                            <Database size={18} /> General\r\n                        </button>\r\n                        <button onClick={() => setActiveTab('security')} className={`${styles.navItem} ${activeTab === 'security' ? styles.navItemActive : ''}`}>\r\n                            <Shield size={18} /> Security\r\n                        </button>\r\n                        <button onClick={() => setActiveTab('notifications')} className={`${styles.navItem} ${activeTab === 'notifications' ? styles.navItemActive : ''}`}>\r\n                            <Bell size={18} /> Notifications\r\n                        </button>\r\n                        <button onClick={() => setActiveTab('api')} className={`${styles.navItem} ${activeTab === 'api' ? styles.navItemActive : ''}`}>\r\n                            <Code2 size={18} /> API & Integrations\r\n                        </button>\r\n                        <button onClick={() => setActiveTab('team')} className={`${styles.navItem} ${activeTab === 'team' ? styles.navItemActive : ''}`}>\r\n                            <Users size={18} /> Team Members\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Main Content Area */}\r\n                    <div className={styles.mainContent}>\r\n\r\n                        {/* GENERAL TAB */}\r\n                        {activeTab === 'general' && (\r\n                            <>\r\n                                <div className={styles.card}>\r\n                                    <div className={styles.cardHeader}>\r\n                                        <div className={styles.cardTitle}>System Operations</div>\r\n                                        <div className={styles.cardDesc}>Configure automated system tasks and core preferences.</div>\r\n                                    </div>\r\n                                    <div className={styles.settingRow}>\r\n                                        <div className={styles.settingInfo}>\r\n                                            <div className={styles.iconBox}><Database size={20} /></div>\r\n                                            <div className={styles.settingDetails}>\r\n                                                <div className={styles.settingName}>Auto-Backup Database</div>\r\n                                                <div className={styles.settingHelper}>Perform automated daily snapshots at 00:00 UTC</div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.toggle} data-active={settings.autoBackup} onClick={() => toggleSetting('autoBackup')}><div className={styles.toggleKnob}></div></div>\r\n                                    </div>\r\n                                    <div className={styles.settingRow}>\r\n                                        <div className={styles.settingInfo}>\r\n                                            <div className={styles.iconBox}><Globe size={20} /></div>\r\n                                            <div className={styles.settingDetails}>\r\n                                                <div className={styles.settingName}>Public Access</div>\r\n                                                <div className={styles.settingHelper}>Allow users to view the storefront (Maintenance Mode)</div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.toggle} data-active={!settings.maintenance} onClick={() => toggleSetting('maintenance')}><div className={styles.toggleKnob}></div></div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className={`${styles.card} ${styles.dangerCard}`}>\r\n                                    <div className={styles.cardHeader}>\r\n                                        <div className={`${styles.cardTitle} ${styles.dangerTitle}`}><Zap size={20} /> Danger Zone</div>\r\n                                        <div className={`${styles.cardDesc} ${styles.dangerDesc}`}>Irreversible actions. Please proceed with extreme caution.</div>\r\n                                    </div>\r\n                                    <div className={styles.dangerActions}>\r\n                                        <button\r\n                                            className={`${styles.dangerBtn} bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 border-emerald-500/20`}\r\n                                            onClick={() => handleDangerAction('Bulk Ecosystem Sync')}\r\n                                        >\r\n                                            Bulk Ecosystem Sync\r\n                                        </button>\r\n                                        <button className={styles.dangerBtn} onClick={() => handleDangerAction('Flush Cache')}>Flush Redis Cache</button>\r\n                                    </div>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n\r\n                        {/* SECURITY TAB */}\r\n                        {activeTab === 'security' && (\r\n                            <div className={styles.card}>\r\n                                <div className={styles.cardHeader}>\r\n                                    <div className={styles.cardTitle}>Security Protocols</div>\r\n                                    <div className={styles.cardDesc}>Manage Access Control and Authentication methods.</div>\r\n                                </div>\r\n                                <div className={styles.settingRow}>\r\n                                    <div className={styles.settingInfo}>\r\n                                        <div className={styles.iconBox}><Lock size={20} /></div>\r\n                                        <div className={styles.settingDetails}>\r\n                                            <div className={styles.settingName}>Two-Factor Authentication</div>\r\n                                            <div className={styles.settingHelper}>Require 2FA for all administrator accounts</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className={styles.toggle} data-active={settings.twoFactor} onClick={() => toggleSetting('twoFactor')}><div className={styles.toggleKnob}></div></div>\r\n                                </div>\r\n                                <div className={styles.settingRow}>\r\n                                    <div className={styles.settingInfo}>\r\n                                        <div className={styles.iconBox}><Fingerprint size={20} /></div>\r\n                                        <div className={styles.settingDetails}>\r\n                                            <div className={styles.settingName}>Biometric Login</div>\r\n                                            <div className={styles.settingHelper}>Allow WebAuthn/TouchID for quick access</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className={styles.toggle} data-active={settings.biometric} onClick={() => toggleSetting('biometric')}><div className={styles.toggleKnob}></div></div>\r\n                                </div>\r\n                                <div className={styles.settingRow}>\r\n                                    <div className={styles.settingInfo}>\r\n                                        <div className={styles.iconBox}><Key size={20} /></div>\r\n                                        <div className={styles.settingDetails}>\r\n                                            <div className={styles.settingName}>Force Password Rotation</div>\r\n                                            <div className={styles.settingHelper}>Require password changes every 90 days</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button className={styles.actionBtnOutline} onClick={() => toast.error(\"Feature requires Enterprise Plan\")}>Configure</button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* NOTIFICATIONS TAB */}\r\n                        {activeTab === 'notifications' && (\r\n                            <div className={styles.card}>\r\n                                <div className={styles.cardHeader}>\r\n                                    <div className={styles.cardTitle}>Communication Channels</div>\r\n                                    <div className={styles.cardDesc}>Customize how and when you receive alerts.</div>\r\n                                </div>\r\n                                <div className={styles.settingRow}>\r\n                                    <div className={styles.settingInfo}>\r\n                                        <div className={styles.iconBox}><Mail size={20} /></div>\r\n                                        <div className={styles.settingDetails}>\r\n                                            <div className={styles.settingName}>Email Digests</div>\r\n                                            <div className={styles.settingHelper}>Daily summary of sales and new users</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className={styles.toggle} data-active={settings.emailNotifs} onClick={() => toggleSetting('emailNotifs')}><div className={styles.toggleKnob}></div></div>\r\n                                </div>\r\n                                <div className={styles.settingRow}>\r\n                                    <div className={styles.settingInfo}>\r\n                                        <div className={styles.iconBox}><Smartphone size={20} /></div>\r\n                                        <div className={styles.settingDetails}>\r\n                                            <div className={styles.settingName}>Mobile Push Notifications</div>\r\n                                            <div className={styles.settingHelper}>Real-time alerts for high-priority events</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className={styles.toggle} data-active={settings.pushNotifs} onClick={() => toggleSetting('pushNotifs')}><div className={styles.toggleKnob}></div></div>\r\n                                </div>\r\n                                <div className={styles.settingRow}>\r\n                                    <div className={styles.settingInfo}>\r\n                                        <div className={styles.iconBox}><MessageSquare size={20} /></div>\r\n                                        <div className={styles.settingDetails}>\r\n                                            <div className={styles.settingName}>SMS Alerts</div>\r\n                                            <div className={styles.settingHelper}>Emergency downtime alerts via SMS</div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className={styles.toggle} data-active={settings.smsNotifs} onClick={() => toggleSetting('smsNotifs')}><div className={styles.toggleKnob}></div></div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* API TAB */}\r\n                        {activeTab === 'api' && (\r\n                            <>\r\n                                <div className={styles.card}>\r\n                                    <div className={styles.cardHeader}>\r\n                                        <div className={styles.cardTitle}>API Keys & Access</div>\r\n                                        <div className={styles.cardDesc}>Manage external access to your data.</div>\r\n                                    </div>\r\n                                    <div className={styles.apiKeyContainer}>\r\n                                        <div className={styles.apiKeyLabel}>Production Key</div>\r\n                                        <div className={styles.apiKeyBox}>\r\n                                            <code>sk_live_********************</code>\r\n                                            <button onClick={() => toast.success(\"API Key copied to clipboard\")} className={styles.copyBtn}>Copy</button>\r\n                                        </div>\r\n                                        <div className={styles.settingHelper}>Never share your production key with client-side code.</div>\r\n                                    </div>\r\n                                </div>\r\n                                <div className={styles.card}>\r\n                                    <div className={styles.cardHeader}>\r\n                                        <div className={styles.cardTitle}>Webhooks</div>\r\n                                        <div className={styles.cardDesc}>Event-driven callbacks for integrations.</div>\r\n                                    </div>\r\n                                    <div className={styles.settingRow}>\r\n                                        <div className={styles.settingInfo}>\r\n                                            <div className={styles.iconBox}><Webhook size={20} /></div>\r\n                                            <div className={styles.settingDetails}>\r\n                                                <div className={styles.settingName}>Enable Webhooks</div>\r\n                                                <div className={styles.settingHelper}>Listen for events like order.created</div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.toggle} data-active={settings.webhookEnabled} onClick={() => toggleSetting('webhookEnabled')}><div className={styles.toggleKnob}></div></div>\r\n                                    </div>\r\n                                </div>\r\n                            </>\r\n                        )}\r\n\r\n                        {/* TEAM TAB */}\r\n                        {activeTab === 'team' && (\r\n                            <div className={styles.card}>\r\n                                <div className={styles.cardHeader}>\r\n                                    <div className={styles.cardTitle}>Team Management</div>\r\n                                    <div className={styles.cardDesc}>Manage administrative access to the dashboard.</div>\r\n                                </div>\r\n\r\n                                <div className={styles.teamList}>\r\n                                    <div className={styles.teamMember}>\r\n                                        <div className={`${styles.avatar} bg-indigo-500`}>A</div>\r\n                                        <div className=\"flex-1\">\r\n                                            <div className=\"font-bold text-white\">Admin User</div>\r\n                                            <div className=\"text-sm text-slate-400\">admin@plantfinder.com</div>\r\n                                        </div>\r\n                                        <div className={styles.roleBadge}>Owner</div>\r\n                                    </div>\r\n                                    <div className={styles.teamMember}>\r\n                                        <div className={`${styles.avatar} bg-emerald-500`}>S</div>\r\n                                        <div className=\"flex-1\">\r\n                                            <div className=\"font-bold text-white\">Support Lead</div>\r\n                                            <div className=\"text-sm text-slate-400\">support@plantfinder.com</div>\r\n                                        </div>\r\n                                        <div className={styles.roleBadge}>Editor</div>\r\n                                        <button className={styles.removeBtn} onClick={() => toast.error(\"Cannot remove verified staff\")}>Remove</button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-6 pt-6 border-t border-slate-700/50\">\r\n                                    <button className={styles.inviteBtn}>\r\n                                        <UserPlus size={18} /> Invite New Member\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\SimulationData.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\SystemDiagnostics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\advancedAI.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":92,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":151,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":27}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Advanced AI Service using Google Gemini (Free Tier)\r\n// This provides GPT/Gemini-level intelligence for plant care\r\n\r\ninterface AIResponse {\r\n    text: string;\r\n    confidence: number;\r\n}\r\n\r\nexport class AdvancedAIService {\r\n    private static readonly GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';\r\n\r\n    // Using free tier - no API key required for basic usage\r\n    // For production, get free API key from: https://makersuite.google.com/app/apikey\r\n\r\n    static async getGeminiResponse(userMessage: string, context?: string): Promise<AIResponse | null> {\r\n        try {\r\n            const prompt = this.buildAdvancedPrompt(userMessage, context);\r\n\r\n            // Try Gemini API (best quality)\r\n            const geminiResponse = await this.tryGemini(prompt);\r\n            if (geminiResponse) return geminiResponse;\r\n\r\n            // Fallback to Hugging Face models\r\n            const hfResponse = await this.tryHuggingFace(prompt);\r\n            if (hfResponse) return hfResponse;\r\n\r\n            return null;\r\n        } catch (error) {\r\n            console.error('AI Service error:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    private static buildAdvancedPrompt(userMessage: string, context?: string): string {\r\n        return `You are Dr. Flora, an expert botanist AI assistant with deep knowledge of plant science, horticulture, and gardening.\r\n\r\n${context ? `CONTEXT:\\n${context}\\n\\n` : ''}USER QUESTION: \"${userMessage}\"\r\n\r\nINSTRUCTIONS:\r\n1. Analyze the question deeply - understand intent, urgency, and context\r\n2. Provide accurate, science-based information\r\n3. Be conversational and friendly, like Gemini or ChatGPT\r\n4. If you don't know something, say so honestly\r\n5. Give practical, actionable advice\r\n6. Use examples and analogies when helpful\r\n7. Keep responses concise but comprehensive (200-400 words)\r\n\r\nRespond naturally and helpfully:`;\r\n    }\r\n\r\n    private static async tryGemini(prompt: string): Promise<AIResponse | null> {\r\n        try {\r\n            // Note: For production, add API key to environment variables\r\n            // For now, using public endpoint (limited requests)\r\n            const response = await fetch(this.GEMINI_API_URL, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({\r\n                    contents: [{\r\n                        parts: [{\r\n                            text: prompt\r\n                        }]\r\n                    }],\r\n                    generationConfig: {\r\n                        temperature: 0.7,\r\n                        topK: 40,\r\n                        topP: 0.95,\r\n                        maxOutputTokens: 500,\r\n                    },\r\n                    safetySettings: [\r\n                        {\r\n                            category: 'HARM_CATEGORY_HARASSMENT',\r\n                            threshold: 'BLOCK_NONE'\r\n                        }\r\n                    ]\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;\r\n\r\n                if (text && text.length > 50) {\r\n                    return {\r\n                        text: text.trim(),\r\n                        confidence: 0.95\r\n                    };\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.log('Gemini API unavailable, trying fallback...');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private static async tryHuggingFace(prompt: string): Promise<AIResponse | null> {\r\n        const models = [\r\n            'mistralai/Mistral-7B-Instruct-v0.2',\r\n            'microsoft/DialoGPT-large',\r\n            'facebook/blenderbot-400M-distill'\r\n        ];\r\n\r\n        for (const model of models) {\r\n            try {\r\n                const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        inputs: prompt,\r\n                        parameters: {\r\n                            max_new_tokens: 400,\r\n                            temperature: 0.7,\r\n                            top_p: 0.9,\r\n                            do_sample: true,\r\n                            return_full_text: false\r\n                        },\r\n                        options: {\r\n                            wait_for_model: true,\r\n                            use_cache: false\r\n                        }\r\n                    })\r\n                });\r\n\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    let text = '';\r\n\r\n                    if (Array.isArray(data)) {\r\n                        text = data[0]?.generated_text || data[0]?.text || '';\r\n                    } else if (data.generated_text) {\r\n                        text = data.generated_text;\r\n                    }\r\n\r\n                    text = text.trim();\r\n\r\n                    // Clean up response\r\n                    if (text.includes('USER QUESTION:')) {\r\n                        const parts = text.split(/USER QUESTION:|Respond naturally/);\r\n                        text = parts[parts.length - 1].trim();\r\n                    }\r\n\r\n                    if (text.length > 100 && text.length < 2000) {\r\n                        return {\r\n                            text,\r\n                            confidence: 0.75\r\n                        };\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                continue;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    // Advanced conversation memory (for multi-turn conversations)\r\n    static buildContextFromHistory(messages: Array<{ role: string, content: string }>): string {\r\n        const recentMessages = messages.slice(-6); // Last 3 exchanges\r\n        let context = 'CONVERSATION HISTORY:\\n';\r\n\r\n        recentMessages.forEach(msg => {\r\n            context += `${msg.role === 'user' ? 'User' : 'Dr. Flora'}: ${msg.content.substring(0, 150)}...\\n`;\r\n        });\r\n\r\n        return context + '\\nUse this context to provide coherent, contextual responses.\\n';\r\n    }\r\n}\r\n\r\n// Helper function to format AI response like Gemini/GPT\r\nexport function formatAdvancedResponse(aiText: string): string {\r\n    let formatted = `≡ƒî┐ **Dr. Flora:**\\n\\n`;\r\n\r\n    // Split into paragraphs\r\n    const paragraphs = aiText.split('\\n').filter(p => p.trim().length > 0);\r\n\r\n    paragraphs.forEach((para, index) => {\r\n        // Add contextual emojis\r\n        if (para.toLowerCase().includes('water') && index === 0) {\r\n            formatted += `≡ƒÆº ${para}\\n\\n`;\r\n        } else if (para.toLowerCase().includes('light') || para.toLowerCase().includes('sun')) {\r\n            formatted += `ΓÿÇ∩╕Å ${para}\\n\\n`;\r\n        } else if (para.toLowerCase().includes('important') || para.toLowerCase().includes('key')) {\r\n            formatted += `ΓÜá∩╕Å ${para}\\n\\n`;\r\n        } else if (para.toLowerCase().includes('tip') || para.toLowerCase().includes('pro')) {\r\n            formatted += `≡ƒÆí ${para}\\n\\n`;\r\n        } else {\r\n            formatted += `${para}\\n\\n`;\r\n        }\r\n    });\r\n\r\n    formatted += `---\\n≡ƒî▒ *Ask me anything else about your plants!*`;\r\n\r\n    return formatted;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":534,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":534,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18160,18163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18160,18163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":545,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":545,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18536,18539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18536,18539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":640,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":640,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21671,21674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21671,21674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":640,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":640,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21691,21694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21691,21694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Plant, Vendor } from '../types';\r\n\r\nimport { PLANTS } from '../data/mocks';\r\n\r\nexport const API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n\r\nconst getHeaders = () => {\r\n    const saved = localStorage.getItem('user');\r\n    const headers: Record<string, string> = { 'Content-Type': 'application/json' };\r\n    if (saved) {\r\n        try {\r\n            const { token } = JSON.parse(saved);\r\n            if (token) headers['Authorization'] = `Bearer ${token}`;\r\n        } catch (e) {\r\n            console.error(\"Token parse error\", e);\r\n        }\r\n    }\r\n    return headers;\r\n};\r\n\r\nexport const fetchPlants = async (): Promise<Plant[]> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/plants`);\r\n        if (!response.ok) {\r\n            console.warn(\"API Error, falling back to mocks.\");\r\n            return PLANTS; // Fallback to mocks on server error\r\n        }\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching plants, using mocks:\", error);\r\n        return PLANTS; // Fallback to mocks on network error\r\n    }\r\n};\r\n\r\nexport const fetchUsers = async (): Promise<unknown[]> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/users`, { headers: getHeaders() });\r\n        if (!response.ok) throw new Error('Failed to fetch users');\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching users:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const fetchVendors = async (): Promise<Vendor[]> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors`);\r\n        if (!response.ok) throw new Error('Failed to fetch vendors');\r\n        const data = await response.json();\r\n        return data;\r\n    } catch (error) {\r\n        console.error(\"Error fetching vendors:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const registerVendor = async (vendorData: Partial<Vendor>): Promise<Vendor | null> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors`, {\r\n            method: 'POST',\r\n            headers: getHeaders(),\r\n            body: JSON.stringify(vendorData)\r\n        });\r\n        if (!response.ok) throw new Error('Failed to register vendor');\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error registering vendor:\", error);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const updateVendor = async (id: string, updates: Partial<Vendor>): Promise<Vendor | null> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors/${id}`, {\r\n            method: 'PATCH',\r\n            headers: getHeaders(),\r\n            body: JSON.stringify(updates)\r\n        });\r\n        if (!response.ok) throw new Error('Failed to update vendor');\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error updating vendor:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport const deleteVendor = async (id: string): Promise<boolean> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors/${id}`, {\r\n            method: 'DELETE',\r\n            headers: getHeaders()\r\n        });\r\n        return response.ok;\r\n    } catch (error) {\r\n        console.error(\"Error deleting vendor:\", error);\r\n        return false;\r\n    }\r\n};\r\n\r\nexport const seedDatabase = async (plants: Plant[], vendors: Vendor[], users: unknown[] = []) => {\r\n    await fetch(`${API_URL}/seed`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ plants, vendors, users })\r\n    });\r\n};\r\n\r\nexport const toggleFavorite = async (plantId: string) => {\r\n    const res = await fetch(`${API_URL}/user/favorites`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ plantId })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to toggle favorite\");\r\n    return res.json();\r\n};\r\n\r\nexport const syncCart = async (cart: { plantId: string; quantity: number }[]) => {\r\n    const res = await fetch(`${API_URL}/user/cart`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ cart })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to sync cart\");\r\n    return res.json();\r\n};\r\n\r\nexport const requestPasswordReset = async (email: string) => {\r\n    const res = await fetch(`${API_URL}/auth/reset-password-request`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to request reset\");\r\n    return res.json();\r\n};\r\n\r\nexport const resetPasswordVerify = async (email: string, name: string, newPassword: string) => {\r\n    const res = await fetch(`${API_URL}/auth/reset-password-verify`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, name, newPassword })\r\n    });\r\n    if (!res.ok) {\r\n        const d = await res.json();\r\n        throw new Error(d.error || \"Verification failed\");\r\n    }\r\n    return res.json();\r\n};\r\n\r\nexport const resetPassword = async (email: string, newPassword: string) => {\r\n    const res = await fetch(`${API_URL}/auth/reset-password`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, newPassword })\r\n    });\r\n    if (!res.ok) throw new Error(\"Reset failed. Check if approved.\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchResetRequests = async () => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/admin/requests`, { headers: getHeaders() });\r\n        if (!res.ok) throw new Error(\"Failed to fetch requests\");\r\n        return await res.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching reset requests:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const approveResetRequest = async (userId: string) => {\r\n    const res = await fetch(`${API_URL}/admin/approve-reset`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ userId })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to approve\");\r\n    return res.json();\r\n};\r\n\r\n\r\nexport const addPlant = async (plantData: Partial<Plant> | FormData) => {\r\n    const isFormData = plantData instanceof FormData;\r\n    const headers = { ...getHeaders() };\r\n    if (isFormData) delete headers['Content-Type'];\r\n\r\n    const res = await fetch(`${API_URL}/plants`, {\r\n        method: 'POST',\r\n        headers,\r\n        body: isFormData ? plantData : JSON.stringify(plantData)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to add plant\");\r\n    return res.json();\r\n};\r\n\r\nexport const updatePlant = async (id: string, updates: Partial<Plant> | FormData) => {\r\n    const isFormData = updates instanceof FormData;\r\n    const headers = { ...getHeaders() };\r\n    if (isFormData) delete headers['Content-Type'];\r\n\r\n    const res = await fetch(`${API_URL}/plants/${id}`, {\r\n        method: 'PATCH',\r\n        headers,\r\n        body: isFormData ? updates : JSON.stringify(updates)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update plant\");\r\n    return res.json();\r\n};\r\n\r\n\r\nexport const deletePlant = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/plants/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to delete plant\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchNotifications = async () => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/admin/notifications`, { headers: getHeaders() });\r\n        if (!res.ok) throw new Error(\"Failed to fetch notifications\");\r\n        return await res.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching notifications:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const deleteNotification = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/admin/notifications/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to clear notification\");\r\n    return res.json();\r\n};\r\n\r\n// Notification Aliases & Methods\r\nexport const fetchAdminNotifications = fetchNotifications;\r\n\r\nexport const markNotificationRead = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/notifications/${id}/read`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to mark read\");\r\n    return res.json();\r\n};\r\n\r\nexport const markAllNotificationsRead = async () => {\r\n    const res = await fetch(`${API_URL}/notifications/mark-all-read`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to mark all read\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchAdminStats = async () => {\r\n    const res = await fetch(`${API_URL}/admin/stats`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch stats\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchVendorNotifications = async () => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/vendor/notifications`, { headers: getHeaders() });\r\n        if (!res.ok) throw new Error(\"Failed to fetch vendor notifications\");\r\n        return await res.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching vendor notifications:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const logVendorContact = async (data: { vendorId: string, vendorName: string, userEmail: string, contactType: 'whatsapp' | 'call' }) => {\r\n    try {\r\n        await fetch(`${API_URL}/tracking/vendor-contact`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(data)\r\n        });\r\n    } catch (err) {\r\n        console.error(\"Failed to log contact\", err);\r\n    }\r\n};\r\n\r\nexport const nudgeAdmin = async (email: string) => {\r\n    return await fetch(`${API_URL}/auth/nudge-admin`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email })\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const deleteUser = async (id: string) => {\r\n    return await fetch(`${API_URL}/users/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const adminResetPassword = async (userId: string, newPassword?: string) => {\r\n    return await fetch(`${API_URL}/admin/reset-user-password`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ userId, newPassword })\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const changePassword = async (oldPassword: string, newPassword: string) => {\r\n    return await fetch(`${API_URL}/user/change-password`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ oldPassword, newPassword })\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const sendAiChat = async (userId: string, message: string) => {\r\n    const res = await fetch(`${API_URL}/ai/chat`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId, message })\r\n    });\r\n    return res.json();\r\n};\r\n\r\nexport const submitSuggestion = async (data: { userId?: string, userName?: string, plantName: string, description: string }) => {\r\n    const res = await fetch(`${API_URL}/suggestions`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to submit suggestion\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchSuggestions = async () => {\r\n    const res = await fetch(`${API_URL}/suggestions`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch suggestions\");\r\n    return res.json();\r\n};\r\n\r\nexport const updateSuggestion = async (id: string, updates: Record<string, unknown>) => {\r\n    const res = await fetch(`${API_URL}/suggestions/${id}`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify(updates)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update suggestion\");\r\n    return res.json();\r\n};\r\n\r\nexport const deleteSuggestion = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/suggestions/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to delete suggestion\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchLeaderboard = async () => {\r\n    const res = await fetch(`${API_URL}/gamification/leaderboard`);\r\n    if (!res.ok) throw new Error(\"Failed to fetch leaderboard\");\r\n    return res.json();\r\n};\r\n\r\nexport const logSearch = async (query: string, plantId?: string, location?: unknown) => {\r\n    try {\r\n        await fetch(`${API_URL}/tracking/search`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ query, plantId, location })\r\n        });\r\n    } catch (e) {\r\n        console.error(\"Search logging failed\", e);\r\n    }\r\n};\r\n\r\nexport const fetchVendorAnalytics = async (vendorId: string) => {\r\n    const res = await fetch(`${API_URL}/analytics/vendor/${vendorId}`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch analytics\");\r\n    return res.json();\r\n};\r\n\r\nexport const completePurchase = async (items: unknown[]) => {\r\n    const res = await fetch(`${API_URL}/user/complete-purchase`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ items })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to complete purchase\");\r\n    return res.json();\r\n};\r\n\r\nexport const addPoints = async (amount: number) => {\r\n    const res = await fetch(`${API_URL}/user/add-points`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ amount })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to add points\");\r\n    return res.json();\r\n};\r\n\r\nexport const updateUserPoints = async (userId: string, points: number) => {\r\n    const res = await fetch(`${API_URL}/admin/users/${userId}/points`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ points })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update user points\");\r\n    return res.json();\r\n};\r\n\r\nexport const updateGameProgress = async (level: number, points: number) => {\r\n    const res = await fetch(`${API_URL}/user/game-progress`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ level, points })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update game progress\");\r\n    return res.json();\r\n};\r\nexport const fetchSeedData = async () => {\r\n    const res = await fetch(`${API_URL}/admin/seed-data`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch seed data\");\r\n    return res.json();\r\n};\r\n\r\nexport const seedSinglePlant = async (plantId: string) => {\r\n    const res = await fetch(`${API_URL}/admin/seed-single`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ plantId })\r\n    });\r\n    if (!res.ok) {\r\n        const errorData = await res.json().catch(() => ({}));\r\n        throw new Error(errorData.error || \"Failed to deploy plant\");\r\n    }\r\n    return res.json();\r\n};\r\nexport const deployAllPlants = async (type?: 'indoor' | 'outdoor') => {\r\n    const res = await fetch(`${API_URL}/admin/seed-plants`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...getHeaders() },\r\n        body: JSON.stringify({ type })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to deploy plants\");\r\n    return res.json();\r\n};\r\n\r\n\r\nexport const resendOTP = async (registrationToken: string) => {\r\n    const res = await fetch(`${API_URL}/auth/resend-otp`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ registrationToken })\r\n    });\r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data.error || \"Failed to resend\");\r\n    return data;\r\n};\r\n\r\nexport const verifyOTP = async (registrationToken: string, otp: string) => {\r\n    const res = await fetch(`${API_URL}/auth/verify-otp`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ registrationToken, otp })\r\n    });\r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data.error || \"Verification failed\");\r\n    return data;\r\n};\r\n\r\nexport const checkEmail = async (email: string) => {\r\n    const res = await fetch(`${API_URL}/auth/check-email`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email })\r\n    });\r\n    if (!res.ok) {\r\n        const error = await res.json();\r\n        throw new Error(error.error || \"Verification failed\");\r\n    }\r\n    return res.json();\r\n};\r\n\r\nexport const sendInquiry = async (data: { name: string, email: string, message: string }) => {\r\n    const res = await fetch(`${API_URL}/support/inquiry`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to send inquiry\");\r\n    return res.json();\r\n};\r\n\r\nexport const toggleSeedType = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/admin/seed-bank/${id}/toggle-type`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to toggle plant type\");\r\n    return res.json();\r\n};\r\n\r\nexport const deleteSeedPlant = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/admin/seed-bank/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to delete plant from seed bank\");\r\n    return res.json();\r\n};\r\n\r\nexport const saveCustomPot = async (customData: {\r\n    potColor: string;\r\n    potWithDesignUrl: string;\r\n    rawDesignUrl: string;\r\n    decalProps: any;\r\n}) => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/custom-pots`, {\r\n            method: 'POST',\r\n            headers: getHeaders(),\r\n            body: JSON.stringify(customData)\r\n        });\r\n        const data = await res.json();\r\n        if (!res.ok) throw new Error(data.error || \"Failed to save custom design\");\r\n        return data;\r\n    } catch (err: any) {\r\n        console.error(\"API Studio Error:\", err);\r\n        throw err;\r\n    }\r\n};\r\n\r\nexport const fetchMyCustomPots = async () => {\r\n    const res = await fetch(`${API_URL}/custom-pots/my`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch your designs\");\r\n    return await res.json();\r\n};\r\n\r\nexport const fetchAdminCustomPots = async () => {\r\n    const res = await fetch(`${API_URL}/admin/custom-pots`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch custom pots\");\r\n    return await res.json();\r\n};\r\n\r\nexport const deleteAdminCustomPot = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/admin/custom-pots/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to delete custom pot\");\r\n    return await res.json();\r\n};\r\n\r\nexport const giftPremium = async (userId: string) => {\r\n    const res = await fetch(`${API_URL}/admin/users/${userId}/gift-premium`, {\r\n        method: 'POST',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to gift premium\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchDailyNews = async () => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/news`, {\r\n            headers: getHeaders() // Optional depending on if we want public access, but good for rate limiting\r\n        });\r\n        if (!res.ok) return [];\r\n        return await res.json();\r\n    } catch (e) {\r\n        console.error(\"Failed to fetch news\", e);\r\n        return [];\r\n    }\r\n};\r\n\r\n// --- CUSTOMER SUPPORT ---\r\nexport const createSupportTicket = async (data: { subject: string, message: string }) => {\r\n    const res = await fetch(`${API_URL}/support`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify(data)\r\n    });\r\n    if (!res.ok) {\r\n        const errorData = await res.json().catch(() => ({ error: 'Failed to create ticket' }));\r\n        throw new Error(errorData.error || 'Failed to create ticket');\r\n    }\r\n    return res.json();\r\n};\r\n\r\nexport const fetchSupportTickets = async () => {\r\n    const res = await fetch(`${API_URL}/admin/support`, { headers: getHeaders() });\r\n    if (!res.ok) throw new Error(\"Failed to fetch tickets\");\r\n    return res.json();\r\n};\r\n\r\nexport const replyToTicket = async (id: string, message: string) => {\r\n    const res = await fetch(`${API_URL}/admin/support/${id}/reply`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ message })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to send reply\");\r\n    return res.json();\r\n};\r\n\r\n// --- BROADCAST ---\r\nexport const broadcastMessage = async (data: { type: string, targetId?: string, title: string, message: string }) => {\r\n    const res = await fetch(`${API_URL}/admin/broadcast`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify(data)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to broadcast message\");\r\n    return res.json();\r\n};\r\n\r\n// --- AI DOCTOR ---\r\nexport const chatWithDrFlora = async (messages: any[], userContext: any, image?: string | null) => {\r\n    const res = await fetch(`${API_URL}/chat`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ messages, userContext, image })\r\n    });\r\n    if (!res.ok) throw new Error(\"AI Service Unavailable\");\r\n    return res.json();\r\n};\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\careCalendar.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[846,849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[846,849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\careCalendar.ts:230:9\n  228 |\n  229 |     useEffect(() => {\n> 230 |         loadReminders();\n      |         ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  231 |\n  232 |         // Check for due reminders every hour\n  233 |         const interval = setInterval(() => {","line":230,"column":9,"nodeType":null,"endLine":230,"endColumn":22}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Plant Care Calendar - Personalized Reminders System\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport interface PlantReminder {\r\n    id: string;\r\n    plantName: string;\r\n    plantId?: string;\r\n    type: 'water' | 'fertilize' | 'prune' | 'repot' | 'mist' | 'rotate';\r\n    frequency: number; // days\r\n    lastDone: Date;\r\n    nextDue: Date;\r\n    notes?: string;\r\n    enabled: boolean;\r\n}\r\n\r\nexport interface CareCalendarData {\r\n    reminders: PlantReminder[];\r\n    notifications: boolean;\r\n}\r\n\r\nexport class CareCalendarService {\r\n    private static STORAGE_KEY = 'plant_care_calendar';\r\n\r\n    // Get all reminders\r\n    static getReminders(): PlantReminder[] {\r\n        const data = localStorage.getItem(this.STORAGE_KEY);\r\n        if (!data) return [];\r\n\r\n        const parsed = JSON.parse(data);\r\n        return parsed.reminders.map((r: any) => ({\r\n            ...r,\r\n            lastDone: new Date(r.lastDone),\r\n            nextDue: new Date(r.nextDue)\r\n        }));\r\n    }\r\n\r\n    // Add new reminder\r\n    static addReminder(reminder: Omit<PlantReminder, 'id' | 'nextDue'>): PlantReminder {\r\n        const reminders = this.getReminders();\r\n\r\n        const newReminder: PlantReminder = {\r\n            ...reminder,\r\n            id: `reminder_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n            nextDue: this.calculateNextDue(reminder.lastDone, reminder.frequency)\r\n        };\r\n\r\n        reminders.push(newReminder);\r\n        this.saveReminders(reminders);\r\n\r\n        return newReminder;\r\n    }\r\n\r\n    // Mark reminder as done\r\n    static markAsDone(reminderId: string): void {\r\n        const reminders = this.getReminders();\r\n        const reminder = reminders.find(r => r.id === reminderId);\r\n\r\n        if (reminder) {\r\n            const now = new Date();\r\n            reminder.lastDone = now;\r\n            reminder.nextDue = this.calculateNextDue(now, reminder.frequency);\r\n            this.saveReminders(reminders);\r\n        }\r\n    }\r\n\r\n    // Get today's tasks\r\n    static getTodaysTasks(): PlantReminder[] {\r\n        const reminders = this.getReminders();\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        return reminders.filter(r => {\r\n            const dueDate = new Date(r.nextDue);\r\n            dueDate.setHours(0, 0, 0, 0);\r\n            return dueDate <= today && r.enabled;\r\n        });\r\n    }\r\n\r\n    // Get upcoming tasks (next 7 days)\r\n    static getUpcomingTasks(): PlantReminder[] {\r\n        const reminders = this.getReminders();\r\n        const today = new Date();\r\n        const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);\r\n\r\n        return reminders.filter(r => {\r\n            const dueDate = new Date(r.nextDue);\r\n            return dueDate > today && dueDate <= nextWeek && r.enabled;\r\n        }).sort((a, b) => a.nextDue.getTime() - b.nextDue.getTime());\r\n    }\r\n\r\n    // Delete reminder\r\n    static deleteReminder(reminderId: string): void {\r\n        const reminders = this.getReminders().filter(r => r.id !== reminderId);\r\n        this.saveReminders(reminders);\r\n    }\r\n\r\n    // Update reminder\r\n    static updateReminder(reminderId: string, updates: Partial<PlantReminder>): void {\r\n        const reminders = this.getReminders();\r\n        const index = reminders.findIndex(r => r.id === reminderId);\r\n\r\n        if (index !== -1) {\r\n            reminders[index] = { ...reminders[index], ...updates };\r\n            if (updates.frequency || updates.lastDone) {\r\n                reminders[index].nextDue = this.calculateNextDue(\r\n                    reminders[index].lastDone,\r\n                    reminders[index].frequency\r\n                );\r\n            }\r\n            this.saveReminders(reminders);\r\n        }\r\n    }\r\n\r\n    // Calculate next due date\r\n    private static calculateNextDue(lastDone: Date, frequencyDays: number): Date {\r\n        const next = new Date(lastDone);\r\n        next.setDate(next.getDate() + frequencyDays);\r\n        return next;\r\n    }\r\n\r\n    // Save reminders to storage\r\n    private static saveReminders(reminders: PlantReminder[]): void {\r\n        const data: CareCalendarData = {\r\n            reminders,\r\n            notifications: true\r\n        };\r\n        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));\r\n    }\r\n\r\n    // Request notification permission\r\n    static async requestNotificationPermission(): Promise<boolean> {\r\n        if (!('Notification' in window)) {\r\n            return false;\r\n        }\r\n\r\n        if (Notification.permission === 'granted') {\r\n            return true;\r\n        }\r\n\r\n        if (Notification.permission !== 'denied') {\r\n            const permission = await Notification.requestPermission();\r\n            return permission === 'granted';\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    // Send notification\r\n    static sendNotification(title: string, body: string, icon?: string): void {\r\n        if (Notification.permission === 'granted') {\r\n            new Notification(title, {\r\n                body,\r\n                icon: icon || '/plant-icon.png',\r\n                badge: '/plant-badge.png',\r\n                tag: 'plant-care',\r\n                requireInteraction: false\r\n            });\r\n        }\r\n    }\r\n\r\n    // Check and send due reminders\r\n    static checkDueReminders(): void {\r\n        const today = this.getTodaysTasks();\r\n\r\n        if (today.length > 0) {\r\n            const taskList = today.map(t => `${t.plantName}: ${t.type}`).join(', ');\r\n            this.sendNotification(\r\n                '≡ƒî▒ Plant Care Reminder',\r\n                `You have ${today.length} task(s) today: ${taskList}`\r\n            );\r\n        }\r\n    }\r\n\r\n    // Get care type icon\r\n    static getCareIcon(type: PlantReminder['type']): string {\r\n        const icons = {\r\n            water: '≡ƒÆº',\r\n            fertilize: '≡ƒî▒',\r\n            prune: 'Γ£é∩╕Å',\r\n            repot: '≡ƒ¬┤',\r\n            mist: '≡ƒÆ¿',\r\n            rotate: '≡ƒöä'\r\n        };\r\n        return icons[type];\r\n    }\r\n\r\n    // Get care type label\r\n    static getCareLabel(type: PlantReminder['type']): string {\r\n        const labels = {\r\n            water: 'Watering',\r\n            fertilize: 'Fertilizing',\r\n            prune: 'Pruning',\r\n            repot: 'Repotting',\r\n            mist: 'Misting',\r\n            rotate: 'Rotating'\r\n        };\r\n        return labels[type];\r\n    }\r\n\r\n    // Format days until due\r\n    static getDaysUntilDue(dueDate: Date): string {\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const due = new Date(dueDate);\r\n        due.setHours(0, 0, 0, 0);\r\n\r\n        const diffTime = due.getTime() - today.getTime();\r\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n        if (diffDays < 0) return `${Math.abs(diffDays)} days overdue`;\r\n        if (diffDays === 0) return 'Due today';\r\n        if (diffDays === 1) return 'Due tomorrow';\r\n        return `Due in ${diffDays} days`;\r\n    }\r\n}\r\n\r\n// React Hook for Care Calendar\r\nexport function useCareCalendar() {\r\n    const [reminders, setReminders] = useState<PlantReminder[]>([]);\r\n    const [todaysTasks, setTodaysTasks] = useState<PlantReminder[]>([]);\r\n    const [upcomingTasks, setUpcomingTasks] = useState<PlantReminder[]>([]);\r\n\r\n    const loadReminders = () => {\r\n        setReminders(CareCalendarService.getReminders());\r\n        setTodaysTasks(CareCalendarService.getTodaysTasks());\r\n        setUpcomingTasks(CareCalendarService.getUpcomingTasks());\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadReminders();\r\n\r\n        // Check for due reminders every hour\r\n        const interval = setInterval(() => {\r\n            CareCalendarService.checkDueReminders();\r\n            loadReminders();\r\n        }, 60 * 60 * 1000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    const addReminder = (reminder: Omit<PlantReminder, 'id' | 'nextDue'>) => {\r\n        CareCalendarService.addReminder(reminder);\r\n        loadReminders();\r\n    };\r\n\r\n    const markAsDone = (reminderId: string) => {\r\n        CareCalendarService.markAsDone(reminderId);\r\n        loadReminders();\r\n    };\r\n\r\n    const deleteReminder = (reminderId: string) => {\r\n        CareCalendarService.deleteReminder(reminderId);\r\n        loadReminders();\r\n    };\r\n\r\n    const updateReminder = (reminderId: string, updates: Partial<PlantReminder>) => {\r\n        CareCalendarService.updateReminder(reminderId, updates);\r\n        loadReminders();\r\n    };\r\n\r\n    return {\r\n        reminders,\r\n        todaysTasks,\r\n        upcomingTasks,\r\n        addReminder,\r\n        markAsDone,\r\n        deleteReminder,\r\n        updateReminder,\r\n        refresh: loadReminders\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\imageRecognition.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7699,7702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7699,7702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7868,7871],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7868,7871],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8428,8431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8428,8431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8795,8798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8795,8798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Image Recognition Service for Plant Diagnosis\r\n// Uses Google Gemini 1.5 Flash (Free Tier) for multimodal analysis\r\nimport { useState } from 'react';\r\n\r\n// Interfaces\r\nexport interface PlantDiagnosis {\r\n    identification?: PlantIdentification;\r\n    healthScore: number;\r\n    issues: DiagnosisIssue[];\r\n    recommendations: string[];\r\n    confidence: number;\r\n    isHealthy: boolean;\r\n}\r\n\r\nexport interface DiagnosisIssue {\r\n    type: 'disease' | 'pest' | 'nutrient' | 'environmental';\r\n    name: string;\r\n    severity: 'low' | 'medium' | 'high';\r\n    description: string;\r\n    treatment: string;\r\n    confidence: number;\r\n}\r\n\r\nexport interface PlantIdentification {\r\n    name: string;\r\n    scientificName: string;\r\n    commonNames: string[];\r\n    confidence: number;\r\n    description?: string;\r\n    internalId?: string; // ID from our own database if found\r\n    careInfo?: {\r\n        water: string;\r\n        light: string;\r\n        temperature: string;\r\n        humidity: string;\r\n    };\r\n}\r\n\r\nexport class ImageRecognitionService {\r\n\r\n    private static readonly API_KEY = import.meta.env.VITE_GEMINI_API_KEY || '';\r\n    private static readonly API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${import.meta.env.VITE_GEMINI_API_KEY}`;\r\n\r\n    // Helper: Convert file to Base64\r\n    static async fileToGenerativePart(file: File): Promise<{ inlineData: { data: string, mimeType: string } }> {\r\n        return new Promise((resolve, reject) => {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                const base64String = (reader.result as string).split(',')[1];\r\n                resolve({\r\n                    inlineData: {\r\n                        data: base64String,\r\n                        mimeType: file.type\r\n                    }\r\n                });\r\n            };\r\n            reader.onerror = reject;\r\n            reader.readAsDataURL(file);\r\n        });\r\n    }\r\n\r\n    // Main Analysis Function\r\n    static async analyzeImage(imageFile: File, knownPlants: { _id: string, name: string }[] = []): Promise<PlantDiagnosis> {\r\n        try {\r\n            if (!this.API_KEY) {\r\n                console.warn(\"Missing Gemini API Key. Please set VITE_GEMINI_API_KEY in .env\");\r\n                // Return a mock if no key, ensuring the app handles it somewhat gracefully\r\n                return this.basicImageAnalysis(imageFile);\r\n            }\r\n\r\n            const imagePart = await this.fileToGenerativePart(imageFile);\r\n\r\n            // Construct context from internal DB\r\n            // Limit to top 50 matches or just send names to avoid context overflow if list is huge\r\n            // For now, assuming manageable list size < 100 items\r\n            const plantListString = knownPlants.map(p => `${p.name} (ID: ${p._id})`).join(', ');\r\n\r\n            const prompt = `\r\n                You are Dr. Flora, an expert botanist AI. Analyze this plant image carefully.\r\n                \r\n                Task 1: Identify the plant.\r\n                - Check against this list of known plants from our database: [${plantListString}].\r\n                - If the image matches one of these plants with high confidence (>80%), include its \"internalId\" and set name to the DB name.\r\n                - If not, identify it accurately using your own knowledge.\r\n                \r\n                Task 2: Diagnose its health.\r\n                - Estimate a health score (0-100).\r\n                - Identify any visible diseases, pests, or nutrient issues.\r\n                - Provide specific care recommendations.\r\n\r\n                Return ONLY a JSON object with this exact structure (no markdown):\r\n                {\r\n                    \"identification\": {\r\n                        \"name\": \"Common Name\",\r\n                        \"scientificName\": \"Scientific Name\",\r\n                        \"internalId\": \"ID_FROM_LIST_OR_NULL\",\r\n                        \"confidence\": 0.95,\r\n                        \"description\": \"Brief description\",\r\n                        \"careInfo\": { \"water\": \"...\", \"light\": \"...\", \"temperature\": \"...\", \"humidity\": \"...\" }\r\n                    },\r\n                    \"healthScore\": 85,\r\n                    \"isHealthy\": true,\r\n                    \"issues\": [\r\n                        { \"type\": \"disease\", \"name\": \"...\", \"severity\": \"low\", \"description\": \"...\", \"treatment\": \"...\", \"confidence\": 0.9 }\r\n                    ],\r\n                    \"recommendations\": [\"Tip 1\", \"Tip 2\"]\r\n                }\r\n            `;\r\n\r\n            const response = await fetch(this.API_URL, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    contents: [{\r\n                        parts: [\r\n                            { text: prompt },\r\n                            imagePart\r\n                        ]\r\n                    }]\r\n                })\r\n            });\r\n\r\n            if (!response.ok) {\r\n                // If 403 or 400, fallback\r\n                throw new Error(`Gemini API Error: ${response.statusText}`);\r\n            }\r\n\r\n            const data = await response.json();\r\n            const candidate = data.candidates?.[0];\r\n            if (!candidate) throw new Error(\"No candidates returned from Gemini\");\r\n\r\n            const textResponse = candidate.content.parts[0].text;\r\n\r\n            // Clean markdown if present\r\n            const jsonStr = textResponse.replace(/```json/g, '').replace(/```/g, '').trim();\r\n            const result = JSON.parse(jsonStr);\r\n\r\n            return result;\r\n\r\n        } catch (error) {\r\n            console.error('Gemini Vision Analysis Failed:', error);\r\n            return this.basicImageAnalysis(imageFile);\r\n        }\r\n    }\r\n\r\n    // Fallback: Basic Analysis (if API fails)\r\n    private static async basicImageAnalysis(imageFile: File): Promise<PlantDiagnosis> {\r\n        // Analyze image colors and patterns (basic)\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        const img = new Image();\r\n\r\n        return new Promise((resolve) => {\r\n            const reader = new FileReader();\r\n            reader.onload = (e) => {\r\n                img.src = e.target?.result as string;\r\n                img.onload = () => {\r\n                    canvas.width = img.width;\r\n                    canvas.height = img.height;\r\n                    ctx?.drawImage(img, 0, 0);\r\n\r\n                    resolve({\r\n                        identification: {\r\n                            name: \"Unknown Plant\",\r\n                            scientificName: \"Unknown\",\r\n                            commonNames: [],\r\n                            confidence: 0,\r\n                            description: \"Could not identify with AI. Please try again or check your API Key.\",\r\n                            careInfo: { water: \"Check soil\", light: \"Indirect\", temperature: \"Average\", humidity: \"Average\" }\r\n                        },\r\n                        healthScore: 50,\r\n                        isHealthy: true,\r\n                        issues: [],\r\n                        recommendations: [\r\n                            'Ensure good lighting',\r\n                            'Check soil moisture before watering',\r\n                            'Wipe leaves to remove dust'\r\n                        ],\r\n                        confidence: 0.5\r\n                    });\r\n                };\r\n            };\r\n            reader.readAsDataURL(imageFile);\r\n        });\r\n    }\r\n\r\n    // Proxy methods to match existing interface usage\r\n    static async diagnosePlant(imageFile: File, knownPlants: any[] = []): Promise<PlantDiagnosis> {\r\n        return this.analyzeImage(imageFile, knownPlants);\r\n    }\r\n\r\n    static async identifyPlant(imageFile: File, knownPlants: any[] = []): Promise<PlantIdentification | null> {\r\n        const result = await this.analyzeImage(imageFile, knownPlants);\r\n        return result.identification || null;\r\n    }\r\n}\r\n\r\n// React Hook for Image Recognition\r\nexport function useImageRecognition() {\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [diagnosis, setDiagnosis] = useState<PlantDiagnosis | null>(null);\r\n    const [identification, setIdentification] = useState<PlantIdentification | null>(null);\r\n\r\n    const diagnosePlant = async (imageFile: File, knownPlants: any[] = []) => {\r\n        setIsProcessing(true);\r\n        try {\r\n            const result = await ImageRecognitionService.diagnosePlant(imageFile, knownPlants);\r\n            setDiagnosis(result);\r\n            return result;\r\n        } finally {\r\n            setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    const identifyPlant = async (imageFile: File, knownPlants: any[] = []) => {\r\n        setIsProcessing(true);\r\n        try {\r\n            const result = await ImageRecognitionService.identifyPlant(imageFile, knownPlants);\r\n            setIdentification(result);\r\n            return result;\r\n        } finally {\r\n            setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    return {\r\n        isProcessing,\r\n        diagnosis,\r\n        identification,\r\n        diagnosePlant,\r\n        identifyPlant\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\shoppingAssistant.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_category' is defined but never used.","line":38,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_productId' is defined but never used.","line":178,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":178,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":232,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":232,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":246,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":246,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":261,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":261,"endColumn":21}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Shopping Assistant - Find Best Deals for Plants and Supplies\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport interface ProductDeal {\r\n    id: string;\r\n    name: string;\r\n    category: 'plant' | 'pot' | 'soil' | 'fertilizer' | 'tool' | 'accessory';\r\n    price: number;\r\n    originalPrice?: number;\r\n    discount?: number;\r\n    seller: string;\r\n    rating: number;\r\n    reviews: number;\r\n    imageUrl: string;\r\n    productUrl: string;\r\n    inStock: boolean;\r\n    delivery: {\r\n        available: boolean;\r\n        days: number;\r\n        cost: number;\r\n    };\r\n    location?: string;\r\n}\r\n\r\nexport interface ShoppingRecommendation {\r\n    product: string;\r\n    reason: string;\r\n    alternatives: string[];\r\n    priceRange: {\r\n        min: number;\r\n        max: number;\r\n    };\r\n}\r\n\r\nexport class ShoppingAssistantService {\r\n\r\n    // Search for products\r\n    static async searchProducts(query: string, _category?: string): Promise<ProductDeal[]> {\r\n        // In production, integrate with actual e-commerce APIs\r\n        // For now, return mock data with real-like structure\r\n        // Note: category parameter will be used when integrating real e-commerce API\r\n\r\n        const mockProducts: ProductDeal[] = [\r\n            {\r\n                id: 'prod_1',\r\n                name: `${query} - Premium Quality`,\r\n                category: 'plant',\r\n                price: 299,\r\n                originalPrice: 499,\r\n                discount: 40,\r\n                seller: 'Green Paradise Nursery',\r\n                rating: 4.5,\r\n                reviews: 234,\r\n                imageUrl: '/placeholder-plant.jpg',\r\n                productUrl: '#',\r\n                inStock: true,\r\n                delivery: {\r\n                    available: true,\r\n                    days: 3,\r\n                    cost: 0\r\n                },\r\n                location: 'Mumbai, Maharashtra'\r\n            },\r\n            {\r\n                id: 'prod_2',\r\n                name: `${query} - Organic`,\r\n                category: 'plant',\r\n                price: 399,\r\n                originalPrice: 599,\r\n                discount: 33,\r\n                seller: 'Urban Garden Store',\r\n                rating: 4.7,\r\n                reviews: 456,\r\n                imageUrl: '/placeholder-plant.jpg',\r\n                productUrl: '#',\r\n                inStock: true,\r\n                delivery: {\r\n                    available: true,\r\n                    days: 2,\r\n                    cost: 50\r\n                },\r\n                location: 'Bangalore, Karnataka'\r\n            }\r\n        ];\r\n\r\n        return mockProducts;\r\n    }\r\n\r\n    // Get price comparison\r\n    static async comparePrices(productName: string): Promise<ProductDeal[]> {\r\n        const products = await this.searchProducts(productName);\r\n        return products.sort((a, b) => a.price - b.price);\r\n    }\r\n\r\n    // Get best deals\r\n    static async getBestDeals(category?: string): Promise<ProductDeal[]> {\r\n        const allProducts = await this.searchProducts('plant');\r\n        return allProducts\r\n            .filter(p => !category || p.category === category)\r\n            .filter(p => p.discount && p.discount > 20)\r\n            .sort((a, b) => (b.discount || 0) - (a.discount || 0))\r\n            .slice(0, 10);\r\n    }\r\n\r\n    // Get nearby sellers\r\n    static async getNearbySellers(userLocation: string): Promise<ProductDeal[]> {\r\n        const products = await this.searchProducts('plant');\r\n        return products.filter(p => p.location?.includes(userLocation));\r\n    }\r\n\r\n    // Get shopping recommendations based on plant\r\n    static getRecommendations(plantName: string): ShoppingRecommendation[] {\r\n        const recommendations: ShoppingRecommendation[] = [\r\n            {\r\n                product: `${plantName} Plant`,\r\n                reason: 'Main plant you\\'re looking for',\r\n                alternatives: ['Similar variety', 'Dwarf variety', 'Variegated variety'],\r\n                priceRange: { min: 199, max: 799 }\r\n            },\r\n            {\r\n                product: 'Ceramic Pot',\r\n                reason: 'Perfect size for this plant',\r\n                alternatives: ['Plastic pot', 'Terracotta pot', 'Hanging planter'],\r\n                priceRange: { min: 99, max: 499 }\r\n            },\r\n            {\r\n                product: 'Potting Mix',\r\n                reason: 'Ideal soil for this plant type',\r\n                alternatives: ['Coco peat', 'Perlite mix', 'Organic compost'],\r\n                priceRange: { min: 49, max: 299 }\r\n            },\r\n            {\r\n                product: 'Liquid Fertilizer',\r\n                reason: 'Promotes healthy growth',\r\n                alternatives: ['Organic fertilizer', 'Slow-release pellets', 'Compost tea'],\r\n                priceRange: { min: 99, max: 399 }\r\n            }\r\n        ];\r\n\r\n        return recommendations;\r\n    }\r\n\r\n    // Calculate total cost with delivery\r\n    static calculateTotalCost(products: ProductDeal[]): {\r\n        subtotal: number;\r\n        delivery: number;\r\n        savings: number;\r\n        total: number;\r\n    } {\r\n        const subtotal = products.reduce((sum, p) => sum + p.price, 0);\r\n        const delivery = products.reduce((sum, p) => sum + p.delivery.cost, 0);\r\n        const savings = products.reduce((sum, p) => {\r\n            if (p.originalPrice) {\r\n                return sum + (p.originalPrice - p.price);\r\n            }\r\n            return sum;\r\n        }, 0);\r\n\r\n        return {\r\n            subtotal,\r\n            delivery,\r\n            savings,\r\n            total: subtotal + delivery\r\n        };\r\n    }\r\n\r\n    // Get seasonal deals\r\n    static getSeasonalDeals(): ProductDeal[] {\r\n        // TODO: Implement seasonal deals based on current season\r\n        // const month = new Date().getMonth();\r\n        // const season = month >= 2 && month <= 5 ? 'spring' : ...\r\n\r\n        // Return season-appropriate plants (placeholder)\r\n        return [];\r\n    }\r\n\r\n    // Track price history (mock)\r\n    static getPriceHistory(_productId: string): {\r\n        date: Date;\r\n        price: number;\r\n    }[] {\r\n        // Note: productId will be used when integrating real price tracking API\r\n        const history = [];\r\n        const today = new Date();\r\n\r\n        for (let i = 30; i >= 0; i--) {\r\n            const date = new Date(today);\r\n            date.setDate(date.getDate() - i);\r\n            history.push({\r\n                date,\r\n                price: 299 + Math.random() * 100\r\n            });\r\n        }\r\n\r\n        return history;\r\n    }\r\n\r\n    // Get product alerts\r\n    static setProductAlert(productId: string, targetPrice: number): void {\r\n        const alerts = JSON.parse(localStorage.getItem('price_alerts') || '[]');\r\n        alerts.push({\r\n            productId,\r\n            targetPrice,\r\n            createdAt: new Date()\r\n        });\r\n        localStorage.setItem('price_alerts', JSON.stringify(alerts));\r\n    }\r\n\r\n    // Check alerts\r\n    static checkAlerts(): void {\r\n        // TODO: Implement price alert checking\r\n        // const alerts = JSON.parse(localStorage.getItem('price_alerts') || '[]');\r\n        // In production, check actual prices and notify\r\n        console.log('Price alerts check - to be implemented');\r\n    }\r\n}\r\n\r\n// React Hook for Shopping Assistant\r\nexport function useShoppingAssistant() {\r\n    const [products, setProducts] = useState<ProductDeal[]>([]);\r\n    const [bestDeals, setBestDeals] = useState<ProductDeal[]>([]);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const searchProducts = async (query: string, category?: string) => {\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n            const results = await ShoppingAssistantService.searchProducts(query, category);\r\n            setProducts(results);\r\n            return results;\r\n        } catch (err) {\r\n            setError('Failed to search products');\r\n            return [];\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const loadBestDeals = async (category?: string) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const deals = await ShoppingAssistantService.getBestDeals(category);\r\n            setBestDeals(deals);\r\n            return deals;\r\n        } catch (err) {\r\n            setError('Failed to load deals');\r\n            return [];\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n\r\n    const comparePrices = async (productName: string) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const comparison = await ShoppingAssistantService.comparePrices(productName);\r\n            setProducts(comparison);\r\n            return comparison;\r\n        } catch (err) {\r\n            setError('Failed to compare prices');\r\n            return [];\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadBestDeals();\r\n    }, []);\r\n\r\n    return {\r\n        products,\r\n        bestDeals,\r\n        isLoading,\r\n        error,\r\n        searchProducts,\r\n        comparePrices,\r\n        loadBestDeals,\r\n        getRecommendations: ShoppingAssistantService.getRecommendations,\r\n        calculateTotal: ShoppingAssistantService.calculateTotalCost\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\translation.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\translation.ts:259:9\n  257 |     useEffect(() => {\n  258 |         TranslationService.initialize();\n> 259 |         setCurrentLang(TranslationService.getCurrentLanguage());\n      |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  260 |     }, []);\n  261 |\n  262 |     const changeLanguage = (lang: SupportedLanguage) => {","line":259,"column":9,"nodeType":null,"endLine":259,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Multi-Language Translation Service\r\n// Supports 50+ languages including all major Indian languages\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport type SupportedLanguage =\r\n    // English\r\n    | 'en'\r\n    // Indian Languages\r\n    | 'hi' | 'bn' | 'te' | 'mr' | 'ta' | 'ur' | 'gu' | 'kn' | 'ml' | 'or'\r\n    | 'pa' | 'as' | 'mai' | 'sa' | 'ks' | 'ne' | 'sd' | 'kok' | 'doi' | 'mni'\r\n    // Other Major Languages\r\n    | 'es' | 'fr' | 'de' | 'it' | 'pt' | 'ru' | 'ja' | 'ko' | 'zh' | 'ar'\r\n    | 'nl' | 'pl' | 'tr' | 'vi' | 'th' | 'id' | 'ms' | 'fil' | 'sw' | 'he';\r\n\r\nexport interface LanguageInfo {\r\n    code: SupportedLanguage;\r\n    name: string;\r\n    nativeName: string;\r\n    flag: string;\r\n    rtl?: boolean;\r\n}\r\n\r\nexport const SUPPORTED_LANGUAGES: LanguageInfo[] = [\r\n    // English\r\n    { code: 'en', name: 'English', nativeName: 'English', flag: '≡ƒç¼≡ƒçº' },\r\n\r\n    // Indian Languages\r\n    { code: 'hi', name: 'Hindi', nativeName: 'αñ╣αñ┐αñ¿αÑìαñªαÑÇ', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'bn', name: 'Bengali', nativeName: 'αª¼αª╛αªéαª▓αª╛', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'te', name: 'Telugu', nativeName: 'α░ñα▒åα░▓α▒üα░ùα▒ü', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'mr', name: 'Marathi', nativeName: 'αñ«αñ░αñ╛αñáαÑÇ', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'ta', name: 'Tamil', nativeName: 'α«ñα««α«┐α«┤α»ì', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'ur', name: 'Urdu', nativeName: '╪º╪▒╪»┘ê', flag: '≡ƒç«≡ƒç│', rtl: true },\r\n    { code: 'gu', name: 'Gujarati', nativeName: 'α¬ùα½üα¬£α¬░α¬╛α¬ñα½Ç', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'kn', name: 'Kannada', nativeName: 'α▓òα▓¿α│ìα▓¿α▓í', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'ml', name: 'Malayalam', nativeName: 'α┤«α┤▓α┤»α┤╛α┤│α┤é', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'or', name: 'Odia', nativeName: 'α¼ôα¼íα¼╝α¼┐α¼å', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'pa', name: 'Punjabi', nativeName: 'α¿¬α⌐░α¿£α¿╛α¿¼α⌐Ç', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'as', name: 'Assamese', nativeName: 'αªàαª╕αª«αºÇαª»αª╝αª╛', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'mai', name: 'Maithili', nativeName: 'αñ«αÑêαñÑαñ┐αñ▓αÑÇ', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'sa', name: 'Sanskrit', nativeName: 'αñ╕αñéαñ╕αÑìαñòαÑâαññαñ«αÑì', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'ks', name: 'Kashmiri', nativeName: 'αñòαÑëαñ╢αÑüαñ░', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'ne', name: 'Nepali', nativeName: 'αñ¿αÑçαñ¬αñ╛αñ▓αÑÇ', flag: '≡ƒç│≡ƒç╡' },\r\n    { code: 'sd', name: 'Sindhi', nativeName: '╪│┘å┌î┘è', flag: '≡ƒç«≡ƒç│', rtl: true },\r\n    { code: 'kok', name: 'Konkani', nativeName: 'αñòαÑïαñéαñòαñúαÑÇ', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'doi', name: 'Dogri', nativeName: 'αñíαÑïαñùαñ░αÑÇ', flag: '≡ƒç«≡ƒç│' },\r\n    { code: 'mni', name: 'Manipuri', nativeName: 'αª«αºêαªñαºêαª▓αºïαª¿αºì', flag: '≡ƒç«≡ƒç│' },\r\n\r\n    // Other Major Languages\r\n    { code: 'es', name: 'Spanish', nativeName: 'Espa├▒ol', flag: '≡ƒç¬≡ƒç╕' },\r\n    { code: 'fr', name: 'French', nativeName: 'Fran├ºais', flag: '≡ƒç½≡ƒç╖' },\r\n    { code: 'de', name: 'German', nativeName: 'Deutsch', flag: '≡ƒç⌐≡ƒç¬' },\r\n    { code: 'it', name: 'Italian', nativeName: 'Italiano', flag: '≡ƒç«≡ƒç╣' },\r\n    { code: 'pt', name: 'Portuguese', nativeName: 'Portugu├¬s', flag: '≡ƒç╡≡ƒç╣' },\r\n    { code: 'ru', name: 'Russian', nativeName: '╨á╤â╤ü╤ü╨║╨╕╨╣', flag: '≡ƒç╖≡ƒç║' },\r\n    { code: 'ja', name: 'Japanese', nativeName: 'µùÑµ£¼Φ¬₧', flag: '≡ƒç»≡ƒç╡' },\r\n    { code: 'ko', name: 'Korean', nativeName: 'φò£Ω╡¡∞û┤', flag: '≡ƒç░≡ƒç╖' },\r\n    { code: 'zh', name: 'Chinese', nativeName: 'Σ╕¡µûç', flag: '≡ƒç¿≡ƒç│' },\r\n    { code: 'ar', name: 'Arabic', nativeName: '╪º┘ä╪╣╪▒╪¿┘è╪⌐', flag: '≡ƒç╕≡ƒçª', rtl: true },\r\n    { code: 'nl', name: 'Dutch', nativeName: 'Nederlands', flag: '≡ƒç│≡ƒç▒' },\r\n    { code: 'pl', name: 'Polish', nativeName: 'Polski', flag: '≡ƒç╡≡ƒç▒' },\r\n    { code: 'tr', name: 'Turkish', nativeName: 'T├╝rk├ºe', flag: '≡ƒç╣≡ƒç╖' },\r\n    { code: 'vi', name: 'Vietnamese', nativeName: 'Tiß║┐ng Viß╗çt', flag: '≡ƒç╗≡ƒç│' },\r\n    { code: 'th', name: 'Thai', nativeName: 'α╣äα╕ùα╕ó', flag: '≡ƒç╣≡ƒç¡' },\r\n    { code: 'id', name: 'Indonesian', nativeName: 'Bahasa Indonesia', flag: '≡ƒç«≡ƒç⌐' },\r\n    { code: 'ms', name: 'Malay', nativeName: 'Bahasa Melayu', flag: '≡ƒç▓≡ƒç╛' },\r\n    { code: 'fil', name: 'Filipino', nativeName: 'Filipino', flag: '≡ƒç╡≡ƒç¡' },\r\n    { code: 'sw', name: 'Swahili', nativeName: 'Kiswahili', flag: '≡ƒç░≡ƒç¬' },\r\n    { code: 'he', name: 'Hebrew', nativeName: '╫ó╫æ╫¿╫Ö╫¬', flag: '≡ƒç«≡ƒç▒', rtl: true },\r\n];\r\n\r\nexport class TranslationService {\r\n    private static currentLanguage: SupportedLanguage = 'en';\r\n    private static STORAGE_KEY = 'preferred_language';\r\n\r\n    // Initialize language from storage or browser\r\n    static initialize(): void {\r\n        const stored = localStorage.getItem(this.STORAGE_KEY);\r\n        if (stored && this.isSupported(stored as SupportedLanguage)) {\r\n            this.currentLanguage = stored as SupportedLanguage;\r\n        } else {\r\n            // Auto-detect from browser\r\n            const browserLang = navigator.language.split('-')[0];\r\n            if (this.isSupported(browserLang as SupportedLanguage)) {\r\n                this.currentLanguage = browserLang as SupportedLanguage;\r\n            }\r\n        }\r\n\r\n        // Apply RTL if needed\r\n        this.applyDirection();\r\n    }\r\n\r\n    // Get current language\r\n    static getCurrentLanguage(): SupportedLanguage {\r\n        return this.currentLanguage;\r\n    }\r\n\r\n    // Set language\r\n    static setLanguage(lang: SupportedLanguage): void {\r\n        if (this.isSupported(lang)) {\r\n            this.currentLanguage = lang;\r\n            localStorage.setItem(this.STORAGE_KEY, lang);\r\n            this.applyDirection();\r\n        }\r\n    }\r\n\r\n    // Check if language is supported\r\n    static isSupported(lang: SupportedLanguage): boolean {\r\n        return SUPPORTED_LANGUAGES.some(l => l.code === lang);\r\n    }\r\n\r\n    // Get language info\r\n    static getLanguageInfo(lang: SupportedLanguage): LanguageInfo | undefined {\r\n        return SUPPORTED_LANGUAGES.find(l => l.code === lang);\r\n    }\r\n\r\n    // Apply text direction (RTL/LTR)\r\n    private static applyDirection(): void {\r\n        const langInfo = this.getLanguageInfo(this.currentLanguage);\r\n        if (langInfo?.rtl) {\r\n            document.documentElement.setAttribute('dir', 'rtl');\r\n        } else {\r\n            document.documentElement.setAttribute('dir', 'ltr');\r\n        }\r\n        document.documentElement.setAttribute('lang', this.currentLanguage);\r\n    }\r\n\r\n    // Translate text using AI for context-aware, accurate translations\r\n    static async translate(text: string, targetLang?: SupportedLanguage): Promise<string> {\r\n        const target = targetLang || this.currentLanguage;\r\n\r\n        // If already in target language, return as is\r\n        if (target === 'en') {\r\n            return text;\r\n        }\r\n\r\n        // If text is empty or too short, return as is\r\n        if (!text || text.trim().length < 2) {\r\n            return text;\r\n        }\r\n\r\n        try {\r\n            // Use AI-powered translation for context awareness\r\n            const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';\r\n\r\n            const response = await fetch(`${API_URL}/translate`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    text,\r\n                    targetLang: target,\r\n                    context: 'botanical' // Helps AI understand plant-related terms\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                if (data.translatedText) {\r\n                    return data.translatedText;\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('AI Translation error:', error);\r\n\r\n            // Fallback to MyMemory API if AI fails\r\n            try {\r\n                const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${target}`;\r\n                const response = await fetch(url);\r\n\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    if (data.responseData && data.responseData.translatedText) {\r\n                        return data.responseData.translatedText;\r\n                    }\r\n                }\r\n            } catch (fallbackError) {\r\n                console.error('Fallback translation error:', fallbackError);\r\n            }\r\n        }\r\n\r\n        // Last resort: return original text\r\n        return text;\r\n    }\r\n\r\n    // Translate multiple texts in batch with context\r\n    static async translateBatch(texts: string[], targetLang?: SupportedLanguage): Promise<string[]> {\r\n        const target = targetLang || this.currentLanguage;\r\n\r\n        if (target === 'en') {\r\n            return texts;\r\n        }\r\n\r\n        try {\r\n            const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000';\r\n\r\n            const response = await fetch(`${API_URL}/translate-batch`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    texts,\r\n                    targetLang: target,\r\n                    context: 'botanical'\r\n                })\r\n            });\r\n\r\n            if (response.ok) {\r\n                const data = await response.json();\r\n                if (data.translations && Array.isArray(data.translations)) {\r\n                    return data.translations;\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Batch translation error:', error);\r\n        }\r\n\r\n        // Fallback to individual translations\r\n        const promises = texts.map(text => this.translate(text, targetLang));\r\n        return Promise.all(promises);\r\n    }\r\n\r\n    // Detect language of text\r\n    static async detectLanguage(text: string): Promise<SupportedLanguage> {\r\n        try {\r\n            const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|hi`;\r\n            const response = await fetch(url);\r\n\r\n            if (response.ok) {\r\n                // const data = await response.json();\r\n                // This is a simplified detection - in production, use a dedicated API\r\n                return 'en';\r\n            }\r\n        } catch (error) {\r\n            console.error('Language detection error:', error);\r\n        }\r\n\r\n        return 'en';\r\n    }\r\n\r\n    // Get Indian languages only\r\n    static getIndianLanguages(): LanguageInfo[] {\r\n        return SUPPORTED_LANGUAGES.filter(l => l.flag === '≡ƒç«≡ƒç│' || l.flag === '≡ƒç│≡ƒç╡');\r\n    }\r\n\r\n    // Get popular languages\r\n    static getPopularLanguages(): LanguageInfo[] {\r\n        const popular = ['en', 'hi', 'es', 'fr', 'de', 'zh', 'ja', 'ar', 'pt', 'ru'];\r\n        return SUPPORTED_LANGUAGES.filter(l => popular.includes(l.code));\r\n    }\r\n}\r\n\r\n// React Hook for Translation\r\nexport function useTranslation() {\r\n    const [currentLang, setCurrentLang] = useState<SupportedLanguage>(\r\n        TranslationService.getCurrentLanguage()\r\n    );\r\n\r\n    useEffect(() => {\r\n        TranslationService.initialize();\r\n        setCurrentLang(TranslationService.getCurrentLanguage());\r\n    }, []);\r\n\r\n    const changeLanguage = (lang: SupportedLanguage) => {\r\n        TranslationService.setLanguage(lang);\r\n        setCurrentLang(lang);\r\n        // Force re-render\r\n        window.location.reload();\r\n    };\r\n\r\n    const translate = async (text: string, targetLang?: SupportedLanguage) => {\r\n        return TranslationService.translate(text, targetLang);\r\n    };\r\n\r\n    return {\r\n        currentLanguage: currentLang,\r\n        changeLanguage,\r\n        translate,\r\n        supportedLanguages: SUPPORTED_LANGUAGES,\r\n        indianLanguages: TranslationService.getIndianLanguages(),\r\n        popularLanguages: TranslationService.getPopularLanguages()\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\voice.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[295,298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[295,298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[575,578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[575,578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[612,615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[612,615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1665,1668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1665,1668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2020,2023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2020,2023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":75,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":230,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7153,7156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7153,7156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":234,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":234,"endColumn":21}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Voice Input/Output Service using Web Speech API\r\nimport { useState, useEffect, useCallback } from 'react';\r\n\r\nexport interface VoiceRecognitionResult {\r\n    transcript: string;\r\n    confidence: number;\r\n    isFinal: boolean;\r\n}\r\n\r\nexport class VoiceService {\r\n    private static recognition: any = null;\r\n    private static synthesis: SpeechSynthesis | null = null;\r\n    private static isListening: boolean = false;\r\n\r\n    // Initialize speech recognition\r\n    static initialize(): boolean {\r\n        // Check browser support\r\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\r\n\r\n        if (!SpeechRecognition) {\r\n            console.error('Speech recognition not supported');\r\n            return false;\r\n        }\r\n\r\n        this.recognition = new SpeechRecognition();\r\n        this.recognition.continuous = true;\r\n        this.recognition.interimResults = true;\r\n        this.recognition.maxAlternatives = 1;\r\n\r\n        // Initialize speech synthesis\r\n        if ('speechSynthesis' in window) {\r\n            this.synthesis = window.speechSynthesis;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    // Start listening\r\n    static startListening(\r\n        onResult: (result: VoiceRecognitionResult) => void,\r\n        onError?: (error: string) => void,\r\n        language: string = 'en-US'\r\n    ): void {\r\n        if (!this.recognition) {\r\n            if (!this.initialize()) {\r\n                onError?.('Speech recognition not supported in this browser');\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.recognition.lang = language;\r\n\r\n        this.recognition.onresult = (event: any) => {\r\n            const last = event.results.length - 1;\r\n            const result = event.results[last];\r\n\r\n            onResult({\r\n                transcript: result[0].transcript,\r\n                confidence: result[0].confidence,\r\n                isFinal: result.isFinal\r\n            });\r\n        };\r\n\r\n        this.recognition.onerror = (event: any) => {\r\n            onError?.(event.error);\r\n        };\r\n\r\n        this.recognition.onend = () => {\r\n            this.isListening = false;\r\n        };\r\n\r\n        try {\r\n            this.recognition.start();\r\n            this.isListening = true;\r\n        } catch (error) {\r\n            onError?.('Failed to start voice recognition');\r\n        }\r\n    }\r\n\r\n    // Stop listening\r\n    static stopListening(): void {\r\n        if (this.recognition && this.isListening) {\r\n            this.recognition.stop();\r\n            this.isListening = false;\r\n        }\r\n    }\r\n\r\n    // Check if currently listening\r\n    static getIsListening(): boolean {\r\n        return this.isListening;\r\n    }\r\n\r\n    // Speak text (Text-to-Speech)\r\n    static speak(\r\n        text: string,\r\n        options?: {\r\n            language?: string;\r\n            rate?: number;\r\n            pitch?: number;\r\n            volume?: number;\r\n            voice?: SpeechSynthesisVoice;\r\n        }\r\n    ): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            if (!this.synthesis) {\r\n                reject('Speech synthesis not supported');\r\n                return;\r\n            }\r\n\r\n            // Cancel any ongoing speech\r\n            this.synthesis.cancel();\r\n\r\n            const utterance = new SpeechSynthesisUtterance(text);\r\n\r\n            // Set options\r\n            if (options?.language) utterance.lang = options.language;\r\n            if (options?.rate) utterance.rate = options.rate;\r\n            if (options?.pitch) utterance.pitch = options.pitch;\r\n            if (options?.volume) utterance.volume = options.volume;\r\n            if (options?.voice) utterance.voice = options.voice;\r\n\r\n            utterance.onend = () => resolve();\r\n            utterance.onerror = (error) => reject(error);\r\n\r\n            this.synthesis.speak(utterance);\r\n        });\r\n    }\r\n\r\n    // Stop speaking\r\n    static stopSpeaking(): void {\r\n        if (this.synthesis) {\r\n            this.synthesis.cancel();\r\n        }\r\n    }\r\n\r\n    // Get available voices\r\n    static getVoices(): SpeechSynthesisVoice[] {\r\n        if (!this.synthesis) return [];\r\n        return this.synthesis.getVoices();\r\n    }\r\n\r\n    // Get voices for specific language\r\n    static getVoicesForLanguage(language: string): SpeechSynthesisVoice[] {\r\n        return this.getVoices().filter(voice => voice.lang.startsWith(language));\r\n    }\r\n\r\n    // Get language code from language name\r\n    static getLanguageCode(language: string): string {\r\n        const languageCodes: { [key: string]: string } = {\r\n            'english': 'en-US',\r\n            'hindi': 'hi-IN',\r\n            'bengali': 'bn-IN',\r\n            'telugu': 'te-IN',\r\n            'marathi': 'mr-IN',\r\n            'tamil': 'ta-IN',\r\n            'urdu': 'ur-IN',\r\n            'gujarati': 'gu-IN',\r\n            'kannada': 'kn-IN',\r\n            'malayalam': 'ml-IN',\r\n            'odia': 'or-IN',\r\n            'punjabi': 'pa-IN',\r\n            'spanish': 'es-ES',\r\n            'french': 'fr-FR',\r\n            'german': 'de-DE',\r\n            'italian': 'it-IT',\r\n            'portuguese': 'pt-PT',\r\n            'russian': 'ru-RU',\r\n            'japanese': 'ja-JP',\r\n            'korean': 'ko-KR',\r\n            'chinese': 'zh-CN',\r\n            'arabic': 'ar-SA'\r\n        };\r\n\r\n        return languageCodes[language.toLowerCase()] || 'en-US';\r\n    }\r\n\r\n    // Check if browser supports speech recognition\r\n    static isSupported(): boolean {\r\n        return 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\r\n    }\r\n\r\n    // Check if browser supports speech synthesis\r\n    static isSynthesisSupported(): boolean {\r\n        return 'speechSynthesis' in window;\r\n    }\r\n}\r\n\r\n// React Hook for Voice Input/Output\r\nexport function useVoice(language: string = 'en-US') {\r\n    const [isListening, setIsListening] = useState(false);\r\n    const [isSpeaking, setIsSpeaking] = useState(false);\r\n    const [transcript, setTranscript] = useState('');\r\n    const [interimTranscript, setInterimTranscript] = useState('');\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [isSupported, setIsSupported] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setIsSupported(VoiceService.isSupported());\r\n    }, []);\r\n\r\n    const startListening = useCallback(() => {\r\n        setError(null);\r\n        setTranscript('');\r\n        setInterimTranscript('');\r\n\r\n        VoiceService.startListening(\r\n            (result) => {\r\n                if (result.isFinal) {\r\n                    setTranscript(prev => prev + ' ' + result.transcript);\r\n                    setInterimTranscript('');\r\n                } else {\r\n                    setInterimTranscript(result.transcript);\r\n                }\r\n            },\r\n            (err) => {\r\n                setError(err);\r\n                setIsListening(false);\r\n            },\r\n            language\r\n        );\r\n\r\n        setIsListening(true);\r\n    }, [language]);\r\n\r\n    const stopListening = useCallback(() => {\r\n        VoiceService.stopListening();\r\n        setIsListening(false);\r\n    }, []);\r\n\r\n    const speak = useCallback(async (text: string, options?: any) => {\r\n        setIsSpeaking(true);\r\n        try {\r\n            await VoiceService.speak(text, { ...options, language });\r\n        } catch (err) {\r\n            setError('Failed to speak text');\r\n        } finally {\r\n            setIsSpeaking(false);\r\n        }\r\n    }, [language]);\r\n\r\n    const stopSpeaking = useCallback(() => {\r\n        VoiceService.stopSpeaking();\r\n        setIsSpeaking(false);\r\n    }, []);\r\n\r\n    return {\r\n        isListening,\r\n        isSpeaking,\r\n        transcript: transcript.trim(),\r\n        interimTranscript,\r\n        error,\r\n        isSupported,\r\n        startListening,\r\n        stopListening,\r\n        speak,\r\n        stopSpeaking,\r\n        clearTranscript: () => setTranscript('')\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\weather.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\cleanResponse.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\logic.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_unused' is assigned a value but never used.","line":66,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":66,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2169,2172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2169,2172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_unused2' is assigned a value but never used.","line":67,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2196,2199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2196,2199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2632,2635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2632,2635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Plant } from '../types';\r\n\r\n/**\r\n * CORTEX OS - INDEPENDENT BIO-SIMULATION ENGINE\r\n * \r\n * Separates \"Aptness\" (General Compatibility) from \"Room Simulation\" (Survival Physics).\r\n */\r\n\r\n// ==========================================\r\n// 1. APTNESS SCORING (For Match %)\r\n// ==========================================\r\n\r\nconst getTempScore = (plant: Plant, avgTemp: number): number => {\r\n    const min = plant.idealTempMin || 15;\r\n    const max = plant.idealTempMax || 30;\r\n    const optimal = (min + max) / 2;\r\n    const sigma = 5;\r\n    const diff = avgTemp - optimal;\r\n    return Math.exp(-(diff * diff) / (2 * sigma * sigma));\r\n};\r\n\r\nconst getHumidityScore = (plant: Plant, avgHumidity: number): number => {\r\n    const min = plant.minHumidity || 40;\r\n    const diff = avgHumidity - (min + 15);\r\n    return 1 / (1 + Math.exp(-diff / 15));\r\n};\r\n\r\nconst getLightScore = (plant: Plant, lightPercent: number): number => {\r\n    const sun = (plant.sunlight || 'medium').toLowerCase();\r\n\r\n    // Lux Parsing (if available)\r\n    let target = 50;\r\n    const luxMatch = sun.match(/(\\d+)\\s*lux/i);\r\n\r\n    if (luxMatch) {\r\n        // Map 0-10000 Lux to 0-100%\r\n        const val = parseInt(luxMatch[1]);\r\n        target = Math.min(100, Math.max(1, val / 100));\r\n    } else {\r\n        if (sun.includes('high') || sun.includes('direct') || sun.includes('bright')) target = 80;\r\n        else if (sun.includes('low') || sun.includes('shade')) target = 30;\r\n    }\r\n\r\n    // Standard matching curve for Aptness\r\n    const diff = Math.abs(lightPercent - target);\r\n    return Math.max(0.1, 1 - Math.pow(diff / 100, 1.5));\r\n};\r\n\r\nconst getAQIScore = (plant: Plant, aqi: number): number => {\r\n    const isPurifier = plant.medicinalValues?.includes('Air purification') ||\r\n        plant.advantages?.some(a => a.toLowerCase().includes('purif'));\r\n\r\n    if (aqi > 100) {\r\n        if (isPurifier) return 1.2;\r\n        return Math.max(0.2, 1.0 - ((aqi - 100) / 300));\r\n    }\r\n    return 1.0;\r\n};\r\n\r\nexport const calculateAptness = (\r\n    plant: Plant,\r\n    currentTemp: number,\r\n    aqi: number = 20,\r\n    currentHumidity: number = 50,\r\n    lightPercent: number = 70,\r\n    _unused: any = null,\r\n    _unused2: any = null\r\n): number => {\r\n    const sTemp = getTempScore(plant, currentTemp);\r\n    const sHum = getHumidityScore(plant, currentHumidity);\r\n    const sLight = getLightScore(plant, lightPercent);\r\n    const sAQI = getAQIScore(plant, aqi);\r\n\r\n    let raw = (sTemp * 0.35) + (sHum * 0.25) + (sLight * 0.25) + (sAQI * 0.15);\r\n\r\n    const type = plant.type || 'indoor';\r\n    if (type === 'indoor') raw *= 1.05;\r\n    const maint = (plant as any).maintenance || 'medium';\r\n    if (maint === 'low') raw *= 1.05;\r\n    if (maint === 'high') raw *= 0.95;\r\n\r\n    return raw;\r\n};\r\n\r\nexport const normalizeBatch = (scores: number[]): number[] => {\r\n    if (scores.length === 0) return [];\r\n    if (scores.length === 1) return [100.0];\r\n\r\n    const indexed = scores.map((val, idx) => ({ val, idx }));\r\n    indexed.sort((a, b) => b.val - a.val);\r\n\r\n    const count = scores.length;\r\n    const finalScores = new Array(count);\r\n    const minRaw = indexed[count - 1].val;\r\n    const rawRange = indexed[0].val - minRaw || 1;\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        const item = indexed[i];\r\n\r\n        const rankPercent = 1 - (i / (count - 1));\r\n        const rawPercent = (item.val - minRaw) / rawRange;\r\n\r\n        const combined = (rankPercent * 0.7) + (rawPercent * 0.3);\r\n        const final = 10 + (combined * 90);\r\n\r\n        finalScores[item.idx] = Math.round(final * 10) / 10;\r\n    }\r\n\r\n    return finalScores;\r\n};\r\n\r\n// ==========================================\r\n// 2. NEW INDEPENDENT ROOM SIMULATION\r\n// ==========================================\r\n\r\n// Calculates the \"Stress\" (Efficiency Loss) based on sliders\r\nconst calculateStressFactor = (plant: Plant, temp: number, light: number): number => {\r\n    let stress = 0.0;\r\n\r\n    // 1. Light Stress (Direct, Linear Penalty w/ Lux)\r\n    const sun = (plant.sunlight || 'medium').toLowerCase();\r\n    let idealLight = 50;\r\n\r\n    // Parse Lux if available \"2000 lux\"\r\n    const luxMatch = sun.match(/(\\d+)\\s*lux/i);\r\n    if (luxMatch) {\r\n        const val = parseInt(luxMatch[1]);\r\n        idealLight = Math.min(100, Math.max(1, val / 100));\r\n    } else {\r\n        if (sun.includes('high') || sun.includes('bright')) idealLight = 80;\r\n        else if (sun.includes('low') || sun.includes('shade')) idealLight = 30;\r\n    }\r\n\r\n    const lightDiff = Math.abs(light - idealLight);\r\n    // Every 10% deviation adds 15% stress (Plant needs 15% more help)\r\n    stress += (lightDiff / 10) * 0.15;\r\n\r\n    // 2. Temperature Stress (AC Sensitivity Verified)\r\n    const min = plant.idealTempMin || 15;\r\n    const max = plant.idealTempMax || 30;\r\n\r\n    // Logical Tolerance: \r\n    // Small deviations (1-2 degrees) are fine. Large ones scale quadratically.\r\n    let tempDiff = 0;\r\n    if (temp < min) tempDiff = min - temp;\r\n    else if (temp > max) tempDiff = temp - max;\r\n\r\n    // Curve: 2 degrees = 0.04 (4% stress). 5 degrees = 0.25 (25% stress).\r\n    if (tempDiff > 0) {\r\n        stress += (tempDiff * tempDiff) / 100;\r\n    }\r\n\r\n    // Cap stress at 0.9 (90% efficiency loss), never 100% dead for UI sake\r\n    return Math.min(0.9, stress);\r\n};\r\n\r\nexport const runRoomSimulationMC = (\r\n    plant: Plant,\r\n    roomSize: number,\r\n    hoursPerDay: number,\r\n    peopleCount: number,\r\n    avgTemp: number,\r\n    avgHumidity: number,\r\n    aqi: number,\r\n    lightLevel: number = 70\r\n) => {\r\n    // 1. Calculate Standard Aptness (For display only)\r\n    const aptness = calculateAptness(plant, avgTemp, aqi, avgHumidity, lightLevel);\r\n\r\n    // 2. INDEPENDENT PLANT COUNT LOGIC\r\n\r\n    // A. Base Demand (Wellness Standard)\r\n    let basePlantsNeeded = Math.max(1, hoursPerDay * 0.4);\r\n\r\n    // B. Room Buffer Logic (Scientific Freshness)\r\n    // Uses roomSize (m2) -> Volume -> Safe Fresh Hours\r\n    const roomVolLiters = roomSize * 2.5 * 1000;\r\n    const safeHours = (roomVolLiters * 0.001) / (23 * Math.max(1, peopleCount));\r\n\r\n    if (hoursPerDay < safeHours) {\r\n        basePlantsNeeded = 1;\r\n    }\r\n\r\n    // C. Apply Plant Strength Multipliers (Proper Data Parsing)\r\n    let strengthMultiplier = 1.0;\r\n\r\n    // PARSE EXPLICIT DATA: \"300ml/h\", \"22L/day\"\r\n    const oxyStr = (plant.oxygenLevel || '').toLowerCase();\r\n    const oxyMatch = oxyStr.match(/(\\d+)\\s*(ml\\/h|l\\/day|l\\/h)/);\r\n\r\n    if (oxyMatch) {\r\n        const val = parseInt(oxyMatch[1]);\r\n        const unit = oxyMatch[2];\r\n        // Normalize to ml/h\r\n        let rate = 500; // default baseline\r\n        if (unit === 'ml/h') rate = val;\r\n        else if (unit === 'l/h') rate = val * 1000;\r\n        else if (unit === 'l/day') rate = (val * 1000) / 12; // 12h active\r\n\r\n        // Higher rate = Lower Multiplier (Better plant)\r\n        // Baseline 500ml/h = 1.0\r\n        // 1000ml/h = 0.5\r\n        strengthMultiplier = 500 / Math.max(50, rate);\r\n    } else {\r\n        // Fallback to Category\r\n        if (plant.oxygenLevel === 'very-high') strengthMultiplier = 0.5;\r\n        else if (plant.oxygenLevel === 'high') strengthMultiplier = 0.7;\r\n        else if (plant.oxygenLevel === 'low') strengthMultiplier = 1.3;\r\n    }\r\n\r\n    // CAM / Nocturnal Bonus (Snake plants etc work at night)\r\n    if (plant.isNocturnal) strengthMultiplier *= 0.7;\r\n\r\n    const plantsBeforeStress = basePlantsNeeded * strengthMultiplier * peopleCount;\r\n\r\n    // D. APPLY SLIDER STRESS (The Physics Engine)\r\n    const stress = calculateStressFactor(plant, avgTemp, lightLevel);\r\n    const efficiency = 1.0 - stress;\r\n\r\n    // Calculate final needed\r\n    const finalPlantsNeeded = Math.ceil(plantsBeforeStress / Math.max(0.1, efficiency));\r\n\r\n    // E. Total Output (Visual Stat)\r\n    // Just a scaling number for the UI graph\r\n    const totalO2 = finalPlantsNeeded * 15 * hoursPerDay * efficiency;\r\n\r\n    return {\r\n        aptness,\r\n        plantsNeeded: finalPlantsNeeded,\r\n        totalO2,\r\n        isLethal: false\r\n    };\r\n};\r\n\r\n// ==========================================\r\n// 3. UTILITIES\r\n// ==========================================\r\n\r\nexport const formatDistance = (meters: number): string => {\r\n    if (meters < 1000) return `${Math.round(meters)}m`;\r\n    return `${(meters / 1000).toFixed(1)}km`;\r\n};\r\n\r\nexport const getDistanceFromLatLonInKm = (lat1: number, lon1: number, lat2: number, lon2: number) => {\r\n    const R = 6371;\r\n    const dLat = deg2rad(lat2 - lat1);\r\n    const dLon = deg2rad(lon2 - lon1);\r\n    const a =\r\n        Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *\r\n        Math.sin(dLon / 2) * Math.sin(dLon / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n};\r\n\r\nfunction deg2rad(deg: number) {\r\n    return deg * (Math.PI / 180);\r\n}\r\n\r\nexport const generatePlantInsights = (plant: Plant, avgTemp: number, avgHumidity: number, aqi: number = 20) => {\r\n    const idealMin = plant.idealTempMin || 15;\r\n    const idealMax = plant.idealTempMax || 30;\r\n\r\n    let prediction = '';\r\n    let tip = '';\r\n\r\n    if (avgTemp >= idealMin && avgTemp <= idealMax) {\r\n        prediction = `Thriving! Your ${avgTemp}┬░C matches the ideal ${idealMin}-${idealMax}┬░C range nicely.`;\r\n    } else if (avgTemp < idealMin) {\r\n        prediction = `A bit chilly. It prefers ${idealMin}-${idealMax}┬░C, but might adapt slightly.`;\r\n        tip = `Avoid drafts and consider a warmer spot.`;\r\n    } else {\r\n        prediction = `A bit warm. It prefers ${idealMin}-${idealMax}┬░C.`;\r\n        tip = `Keep away from direct heat sources and mist to cool.`;\r\n    }\r\n\r\n    const minHumidity = plant.minHumidity || 40;\r\n    if (avgHumidity < minHumidity && !tip) {\r\n        tip = `Humidity is low (${avgHumidity}%). This plant prefers >${minHumidity}%. Mist it!`;\r\n    }\r\n\r\n    if (!tip && aqi > 100) {\r\n        const isPurifier = plant.medicinalValues?.includes('Air purification') ||\r\n            plant.advantages?.some(a => a.toLowerCase().includes('purif'));\r\n        if (isPurifier) {\r\n            tip = `Excellent choice! This plant will help combat the current high AQI (${aqi}).`;\r\n        }\r\n    }\r\n\r\n    if (!tip) {\r\n        tip = `Great match for your space! Water when soil feels dry.`;\r\n    }\r\n\r\n    return {\r\n        prediction,\r\n        tip\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\plantAiDatabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\professionalFormatter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\requestAnalysis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\smartResponseEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[343,346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[343,346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1657,1660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1657,1660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Advanced Response Engine - Analyzes questions and provides focused answers\r\n// Searches internal database + external sources for comprehensive responses\r\n\r\nimport { cleanAIResponse, formatResponse } from './cleanResponse';\r\n\r\ninterface Plant {\r\n    name: string;\r\n    scientificName?: string;\r\n    description?: string;\r\n    [key: string]: any;\r\n}\r\n\r\nexport class SmartResponseEngine {\r\n\r\n    // Main function - analyzes question and generates focused response\r\n    static async generateResponse(\r\n        userQuestion: string,\r\n        internalPlants: Plant[],\r\n        webSearchFn: (query: string) => Promise<string | null>\r\n    ): Promise<string> {\r\n\r\n        const analysis = this.analyzeQuestion(userQuestion);\r\n\r\n        // Route to appropriate handler based on question type\r\n        if (analysis.isGreeting) {\r\n            return this.handleGreeting();\r\n        }\r\n\r\n        if (analysis.isSimpleQuery) {\r\n            return this.handleSimpleQuery(userQuestion);\r\n        }\r\n\r\n        if (analysis.needsPlantInfo) {\r\n            return await this.handlePlantQuery(\r\n                analysis.plantName,\r\n                internalPlants,\r\n                webSearchFn\r\n            );\r\n        }\r\n\r\n        if (analysis.needsGeneralAdvice) {\r\n            return await this.handleGeneralAdvice(\r\n                userQuestion,\r\n                webSearchFn\r\n            );\r\n        }\r\n\r\n        // Default: comprehensive response\r\n        return await this.handleComplexQuery(\r\n            userQuestion,\r\n            webSearchFn\r\n        );\r\n    }\r\n\r\n    // Analyze what the user is actually asking\r\n    private static analyzeQuestion(question: string): any {\r\n        const lower = question.toLowerCase().trim();\r\n\r\n        return {\r\n            isGreeting: /^(hi|hello|hey|greetings)[\\s!.?]*$/i.test(lower),\r\n            isSimpleQuery: lower.split(' ').length <= 5,\r\n            needsPlantInfo: this.extractPlantName(lower) !== null,\r\n            plantName: this.extractPlantName(lower),\r\n            needsGeneralAdvice: /how|what|why|when|best|recommend/i.test(lower),\r\n            questionType: this.getQuestionType(lower),\r\n            keywords: this.extractKeywords(lower)\r\n        };\r\n    }\r\n\r\n    // Extract plant name from question\r\n    private static extractPlantName(question: string): string | null {\r\n        const commonPlants = [\r\n            'monstera', 'pothos', 'snake plant', 'sansevieria', 'fiddle leaf fig',\r\n            'peace lily', 'spider plant', 'aloe', 'succulent', 'cactus',\r\n            'fern', 'orchid', 'bamboo', 'jade', 'rubber plant', 'philodendron',\r\n            'calathea', 'dracaena', 'zz plant', 'anthurium'\r\n        ];\r\n\r\n        for (const plant of commonPlants) {\r\n            if (question.includes(plant)) {\r\n                return plant;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    // Determine question type\r\n    private static getQuestionType(question: string): string {\r\n        if (/^why/i.test(question)) return 'why';\r\n        if (/^how/i.test(question)) return 'how';\r\n        if (/^what/i.test(question)) return 'what';\r\n        if (/^when/i.test(question)) return 'when';\r\n        if (/^where/i.test(question)) return 'where';\r\n        if (/^which/i.test(question)) return 'which';\r\n        return 'general';\r\n    }\r\n\r\n    // Extract important keywords\r\n    private static extractKeywords(question: string): string[] {\r\n        const keywords: string[] = [];\r\n\r\n        const importantTerms = [\r\n            'water', 'light', 'sun', 'fertilizer', 'soil', 'pest', 'disease',\r\n            'yellow', 'brown', 'dying', 'wilting', 'drooping', 'spots'\r\n        ];\r\n\r\n        importantTerms.forEach(term => {\r\n            if (question.includes(term)) {\r\n                keywords.push(term);\r\n            }\r\n        });\r\n\r\n        return keywords;\r\n    }\r\n\r\n    // Handle greetings\r\n    private static handleGreeting(): string {\r\n        return \"Hello! What can I help you with today?\";\r\n    }\r\n\r\n    // Handle simple queries\r\n    private static handleSimpleQuery(question: string): string {\r\n        const lower = question.toLowerCase();\r\n\r\n        if (lower.includes('name')) {\r\n            return \"I'm Dr. Flora, your plant care expert. What would you like to know?\";\r\n        }\r\n\r\n        if (lower.includes('help')) {\r\n            return \"I can help with plant care, diagnosis, and recommendations. What's your question?\";\r\n        }\r\n\r\n        return \"I'm here to help! Could you tell me more about your plant question?\";\r\n    }\r\n\r\n    // Handle plant-specific queries\r\n    private static async handlePlantQuery(\r\n        plantName: string | null,\r\n        internalPlants: Plant[],\r\n        webSearchFn: (query: string) => Promise<string | null>\r\n    ): Promise<string> {\r\n\r\n        if (!plantName) {\r\n            return \"I'd be happy to help! Which plant are you asking about?\";\r\n        }\r\n\r\n        // Search internal database first\r\n        const dbPlant = internalPlants.find(p =>\r\n            p.name.toLowerCase().includes(plantName) ||\r\n            p.scientificName?.toLowerCase().includes(plantName)\r\n        );\r\n\r\n        // Search web for additional info\r\n        const webInfo = await webSearchFn(`${plantName} plant care`);\r\n\r\n        // Combine and format response\r\n        let response = '';\r\n\r\n        if (dbPlant) {\r\n            response += `${dbPlant.name}\\n\\n`;\r\n            if (dbPlant.description) {\r\n                response += `${cleanAIResponse(dbPlant.description)}\\n\\n`;\r\n            }\r\n            response += `Care Requirements:\\n`;\r\n            response += `ΓÇó Temperature: ${dbPlant.idealTempMin || 18}-${dbPlant.idealTempMax || 28}┬░C\\n`;\r\n            response += `ΓÇó Humidity: ${dbPlant.minHumidity || 40}%+\\n`;\r\n            response += `ΓÇó Light: ${dbPlant.sunlight || 'Moderate indirect light'}\\n`;\r\n        }\r\n\r\n        if (webInfo && !dbPlant) {\r\n            response += cleanAIResponse(webInfo);\r\n        }\r\n\r\n        if (!response) {\r\n            response = `I don't have detailed information about ${plantName} in my database yet. However, I can help with general care questions. What would you like to know?`;\r\n        }\r\n\r\n        return formatResponse(response);\r\n    }\r\n\r\n    // Handle general advice queries\r\n    private static async handleGeneralAdvice(\r\n        question: string,\r\n        webSearchFn: (query: string) => Promise<string | null>\r\n    ): Promise<string> {\r\n\r\n        // Search web for current best practices\r\n        const webInfo = await webSearchFn(question);\r\n\r\n        if (webInfo) {\r\n            return formatResponse(cleanAIResponse(webInfo));\r\n        }\r\n\r\n        return \"I'd be happy to help with that! Could you provide a bit more detail about your specific situation?\";\r\n    }\r\n\r\n    // Handle complex queries\r\n    private static async handleComplexQuery(\r\n        question: string,\r\n        webSearchFn: (query: string) => Promise<string | null>\r\n    ): Promise<string> {\r\n\r\n        // Get web information\r\n        const webInfo = await webSearchFn(question);\r\n\r\n        if (webInfo) {\r\n            const cleaned = cleanAIResponse(webInfo);\r\n            return formatResponse(cleaned);\r\n        }\r\n\r\n        return \"I want to give you the most accurate answer. Could you rephrase your question or provide more details?\";\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\suggestedQuestions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
