[{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\public\\sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\Button.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'size' is assigned a value but never used.","line":11,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":9}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ButtonHTMLAttributes, ReactNode } from 'react';\r\n\r\ninterface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\r\n    variant?: 'primary' | 'outline' | 'ghost';\r\n    size?: 'sm' | 'md' | 'lg';\r\n    children: ReactNode;\r\n}\r\n\r\nexport const Button = ({\r\n    variant = 'primary',\r\n    size = 'md',\r\n    children,\r\n    className,\r\n    ...props\r\n}: ButtonProps) => {\r\n    return (\r\n        <button\r\n            className={`btn ${variant === 'primary' ? 'btn-primary' : 'btn-outline'} ${className || ''}`}\r\n            {...props}\r\n        >\r\n            {children}\r\n        </button>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\Card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\InstallPrompt.tsx","messages":[{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":10,"column":19,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":10,"endColumn":20,"suggestions":[{"messageId":"removeEscape","fix":{"range":[710,711],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[710,710],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":54,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3096,3099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3096,3099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3206,3209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3206,3209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\InstallPrompt.tsx:78:13\n  76 |\n  77 |         if (isIosDevice && !isInStandaloneMode) {\n> 78 |             setIsIOS(true);\n     |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  79 |             setTimeout(() => setIsVisible(true), 5000);\n  80 |         }\n  81 |","line":78,"column":13,"nodeType":null,"endLine":78,"endColumn":21}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Smartphone, X, Download, Share, PlusSquare } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n// ... (Keep existing helper functions if needed, or re-implement if they were just for push - strictly speaking push logic was mixed in here, I should preserve the push subscription logic if it was relevant, but the file name implies InstallPrompt. The previous code had `subscribeUser` mixed in. I will keep the subscription logic but clean up the UI.)\r\n\r\nconst urlBase64ToUint8Array = (base64String: string) => {\r\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\r\n    const base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    const rawData = window.atob(base64);\r\n    const outputArray = new Uint8Array(rawData.length);\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n};\r\n\r\nconst getVapidKey = async () => {\r\n    try {\r\n        const API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n        const res = await fetch(`${API_URL}/notifications/vapid-key`);\r\n        const data = await res.json();\r\n        return data.publicKey;\r\n    } catch (e) {\r\n        console.error(\"Failed to fetch VAPID key\", e);\r\n        return null;\r\n    }\r\n};\r\n\r\nconst subscribeUser = async () => {\r\n    if (!('serviceWorker' in navigator) || !('PushManager' in window)) return;\r\n    try {\r\n        const registration = await navigator.serviceWorker.ready;\r\n        const publicKey = await getVapidKey();\r\n        if (!publicKey) return;\r\n\r\n        const existingSub = await registration.pushManager.getSubscription();\r\n        if (existingSub) return;\r\n\r\n        const subscription = await registration.pushManager.subscribe({\r\n            userVisibleOnly: true,\r\n            applicationServerKey: urlBase64ToUint8Array(publicKey)\r\n        });\r\n\r\n        const API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n        await fetch(`${API_URL}/notifications/subscribe`, {\r\n            method: 'POST',\r\n            body: JSON.stringify(subscription),\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n        toast.success(\"Notifications enabled! ðŸŒ¿\");\r\n    } catch (e) {\r\n        // Silent fail\r\n    }\r\n};\r\n\r\ninterface BeforeInstallPromptEvent extends Event {\r\n    prompt: () => Promise<void>;\r\n    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\r\n}\r\n\r\nexport const InstallPrompt = () => {\r\n    const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\r\n    const [isVisible, setIsVisible] = useState(false);\r\n    const [isIOS, setIsIOS] = useState(false);\r\n    const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\r\n\r\n    useEffect(() => {\r\n        const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n        window.addEventListener('resize', handleResize);\r\n\r\n        const isIosDevice = /iPad|iPhone|iPod/.test(navigator.userAgent) && !(window as any).MSStream;\r\n        const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator as any).standalone;\r\n\r\n        if (isIosDevice && !isInStandaloneMode) {\r\n            setIsIOS(true);\r\n            setTimeout(() => setIsVisible(true), 5000);\r\n        }\r\n\r\n        if (isInStandaloneMode || window.matchMedia('(display-mode: standalone)').matches) {\r\n            // Already installed - ask for perms silently/toast\r\n            setTimeout(() => {\r\n                if (Notification.permission === 'default') Notification.requestPermission();\r\n                subscribeUser();\r\n            }, 3000);\r\n        } else {\r\n            // Android/Desktop PWA\r\n            const handler = (e: Event) => {\r\n                e.preventDefault();\r\n                setDeferredPrompt(e as BeforeInstallPromptEvent);\r\n                setTimeout(() => setIsVisible(true), 5000);\r\n            };\r\n            window.addEventListener('beforeinstallprompt', handler);\r\n            return () => {\r\n                window.removeEventListener('beforeinstallprompt', handler);\r\n                window.removeEventListener('resize', handleResize);\r\n            };\r\n        }\r\n    }, []);\r\n\r\n    const handleInstallClick = async () => {\r\n        if (!deferredPrompt) {\r\n            if (isIOS) return; // iOS handles viewing instructions\r\n            return;\r\n        }\r\n\r\n        deferredPrompt.prompt();\r\n        const { outcome } = await deferredPrompt.userChoice;\r\n        if (outcome === 'accepted') {\r\n            setIsVisible(false);\r\n            subscribeUser();\r\n        }\r\n        setDeferredPrompt(null);\r\n    };\r\n\r\n    if (!isVisible) return null;\r\n\r\n    return (\r\n        <div style={{\r\n            position: 'fixed',\r\n            bottom: isMobile ? '90px' : '40px', // Sit above the 75px MobileTabBar\r\n            left: isMobile ? '50%' : 'auto',\r\n            right: isMobile ? 'auto' : '40px',\r\n            transform: isMobile ? 'translateX(-50%)' : 'none',\r\n            zIndex: 10000,\r\n            width: isMobile ? 'calc(100% - 32px)' : '420px',\r\n            maxWidth: '450px',\r\n            perspective: '1000px',\r\n            animation: 'slideUpFade 0.6s cubic-bezier(0.16, 1, 0.3, 1)'\r\n        }}>\r\n            <style>{`\r\n                @keyframes slideUpFade {\r\n                    from { opacity: 0; transform: ${isMobile ? 'translate(-50%, 50px)' : 'translateY(50px)'}; }\r\n                    to { opacity: 1; transform: ${isMobile ? 'translate(-50%, 0)' : 'translateY(0)'}; }\r\n                }\r\n                .glass-panel {\r\n                    background: rgba(15, 23, 42, 0.85); /* Slate 900 with opacity */\r\n                    backdrop-filter: blur(20px);\r\n                    -webkit-backdrop-filter: blur(20px);\r\n                    border: 1px solid rgba(255, 255, 255, 0.08);\r\n                    box-shadow: \r\n                        0 20px 40px -5px rgba(0, 0, 0, 0.4),\r\n                        0 10px 20px -5px rgba(0, 0, 0, 0.3),\r\n                        inset 0 1px 0 rgba(255, 255, 255, 0.1);\r\n                }\r\n            `}</style>\r\n\r\n            <div className=\"glass-panel\" style={{\r\n                borderRadius: '24px',\r\n                padding: '24px',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: '20px',\r\n                color: 'white',\r\n                position: 'relative',\r\n                overflow: 'hidden'\r\n            }}>\r\n                {/* Background Glow Effect */}\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    top: '-50%',\r\n                    left: '-20%',\r\n                    width: '150%',\r\n                    height: '200%',\r\n                    background: 'radial-gradient(circle at 50% 50%, rgba(56, 189, 248, 0.08), transparent 60%)',\r\n                    pointerEvents: 'none',\r\n                    zIndex: 0\r\n                }} />\r\n\r\n                <div style={{ display: 'flex', alignItems: 'flex-start', justifyContent: 'space-between', zIndex: 1, gap: '16px' }}>\r\n                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>\r\n                        <div style={{\r\n                            width: '56px',\r\n                            height: '56px',\r\n                            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n                            borderRadius: '16px',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            boxShadow: '0 8px 16px -4px rgba(16, 185, 129, 0.3), inset 0 2px 4px rgba(255,255,255,0.2)'\r\n                        }}>\r\n                            <Smartphone size={28} color=\"white\" strokeWidth={2} />\r\n                        </div>\r\n                        <div>\r\n                            <h3 style={{ margin: 0, fontSize: '1.25rem', fontWeight: 700, letterSpacing: '-0.02em', lineHeight: 1.2 }}>\r\n                                Get the VanaMap App\r\n                            </h3>\r\n                            <p style={{ margin: '4px 0 0', fontSize: '0.9rem', color: '#94a3b8', lineHeight: 1.4 }}>\r\n                                Browse 2x faster with the native experience.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={() => setIsVisible(false)}\r\n                        style={{\r\n                            background: 'rgba(255,255,255,0.05)',\r\n                            border: 'none',\r\n                            color: '#94a3b8',\r\n                            cursor: 'pointer',\r\n                            borderRadius: '50%',\r\n                            width: '32px',\r\n                            height: '32px',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            transition: 'all 0.2s'\r\n                        }}\r\n                    >\r\n                        <X size={18} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content Body */}\r\n                <div style={{ zIndex: 1 }}>\r\n                    {!isIOS ? (\r\n                        <button\r\n                            onClick={handleInstallClick}\r\n                            style={{\r\n                                width: '100%',\r\n                                background: 'linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)',\r\n                                color: 'white',\r\n                                border: 'none',\r\n                                borderRadius: '16px',\r\n                                padding: '16px',\r\n                                fontSize: '1rem',\r\n                                fontWeight: 700,\r\n                                cursor: 'pointer',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                gap: '10px',\r\n                                boxShadow: '0 8px 20px -4px rgba(14, 165, 233, 0.4), inset 0 1px 2px rgba(255,255,255,0.2)',\r\n                                transition: 'transform 0.2s active'\r\n                            }}\r\n                        >\r\n                            <Download size={20} className=\"animate-bounce\" /> Install Now\r\n                        </button>\r\n                    ) : (\r\n                        <div style={{\r\n                            background: 'rgba(255,255,255,0.03)',\r\n                            borderRadius: '16px',\r\n                            padding: '16px',\r\n                            border: '1px solid rgba(255,255,255,0.05)'\r\n                        }}>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px', fontSize: '0.95rem', color: '#cbd5e1' }}>\r\n                                <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: '8px', padding: '6px' }}><Share size={16} /></div>\r\n                                <span>1. Tap simple <strong style={{ color: '#38bdf8' }}>Share</strong> button below</span>\r\n                            </div>\r\n                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', fontSize: '0.95rem', color: '#cbd5e1' }}>\r\n                                <div style={{ background: 'rgba(255,255,255,0.1)', borderRadius: '8px', padding: '6px' }}><PlusSquare size={16} /></div>\r\n                                <span>2. Select <strong style={{ color: '#38bdf8' }}>Add to Home Screen</strong></span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\NetworkIndicator.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":23,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":23,"endColumn":52,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[816,855],"text":"// @ts-expect-error - Network Information API"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":42,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":42,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1603,1616],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { WifiOff, AlertTriangle, Wifi } from 'lucide-react';\r\nimport styles from './NetworkIndicator.module.css';\r\n\r\nexport const NetworkIndicator: React.FC = () => {\r\n    const [isVisible, setIsVisible] = useState(false);\r\n    const [statusType, setStatusType] = useState<'offline' | 'slow' | 'back-online'>('offline');\r\n\r\n    useEffect(() => {\r\n        const handleOnline = () => {\r\n            setStatusType('back-online');\r\n            setIsVisible(true);\r\n            // Hide \"back online\" after 3 seconds\r\n            setTimeout(() => setIsVisible(false), 3000);\r\n        };\r\n\r\n        const handleOffline = () => {\r\n            setStatusType('offline');\r\n            setIsVisible(true);\r\n        };\r\n\r\n        const updateConnection = () => {\r\n            // @ts-ignore - Network Information API\r\n            const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\r\n            if (conn) {\r\n                const isSlowConn = conn.effectiveType === '2g' || conn.effectiveType === 'slow-2g';\r\n                if (isSlowConn && navigator.onLine) {\r\n                    setStatusType('slow');\r\n                    setIsVisible(true);\r\n                } else {\r\n                    if (navigator.onLine && statusType === 'slow') {\r\n                        setIsVisible(false);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        window.addEventListener('online', handleOnline);\r\n        window.addEventListener('offline', handleOffline);\r\n\r\n        // Slow connection check\r\n        // @ts-ignore\r\n        const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\r\n        if (conn) {\r\n            conn.addEventListener('change', updateConnection);\r\n            updateConnection();\r\n        }\r\n\r\n        // Initial state for offline\r\n        if (!navigator.onLine) handleOffline();\r\n\r\n        return () => {\r\n            window.removeEventListener('online', handleOnline);\r\n            window.removeEventListener('offline', handleOffline);\r\n            if (conn) conn.removeEventListener('change', updateConnection);\r\n        };\r\n    }, [statusType]);\r\n\r\n    if (!isVisible) return null;\r\n\r\n    const renderContent = () => {\r\n        switch (statusType) {\r\n            case 'offline':\r\n                return (\r\n                    <>\r\n                        <div className={styles.iconWrapper}><WifiOff size={20} /></div>\r\n                        <div className={styles.textWrapper}>\r\n                            <span className={styles.title}>You are offline</span>\r\n                            <span className={styles.desc}>Check your internet connection.</span>\r\n                        </div>\r\n                    </>\r\n                );\r\n            case 'slow':\r\n                return (\r\n                    <>\r\n                        <div className={styles.iconWrapper}><AlertTriangle size={20} /></div>\r\n                        <div className={styles.textWrapper}>\r\n                            <span className={styles.title}>Slow connection</span>\r\n                            <span className={styles.desc}>Optimizing experience for low bandwidth.</span>\r\n                        </div>\r\n                    </>\r\n                );\r\n            case 'back-online':\r\n                return (\r\n                    <>\r\n                        <div className={styles.iconWrapper} style={{ backgroundColor: '#10b981' }}><Wifi size={20} /></div>\r\n                        <div className={styles.textWrapper}>\r\n                            <span className={styles.title} style={{ color: '#10b981' }}>Back Online</span>\r\n                            <span className={styles.desc}>Connection restored successfully.</span>\r\n                        </div>\r\n                    </>\r\n                );\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={`${styles.container} ${styles[statusType]}`}>\r\n            <div className={styles.content}>\r\n                {renderContent()}\r\n            </div>\r\n            {statusType !== 'back-online' && (\r\n                <div className={styles.reconnecting}>\r\n                    <div className={styles.dot} />\r\n                    <span>Monitoring...</span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\common\\SystemGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\ai\\DoctorAI.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\games\\PotMaker.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1199,1202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1199,1202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useLoader\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":61,"column":34,"nodeType":"Identifier","endLine":61,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4668,4671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4668,4671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6887,6890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6887,6890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6911,6914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6911,6914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":243,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":243,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":267,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":267,"endColumn":19}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useCallback, useEffect } from 'react';\r\nimport { Upload, Camera, Save, ShoppingCart, Layers, RotateCcw, X, Check, Move, Maximize, RotateCw } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport Cropper from 'react-easy-crop';\r\nimport { Canvas, useLoader, useThree } from '@react-three/fiber';\r\nimport { Stage, PresentationControls } from '@react-three/drei';\r\nimport * as THREE from 'three';\r\nimport styles from './PotMaker.module.css';\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\r\n\r\ninterface PotMakerProps {\r\n    onBack: () => void;\r\n}\r\n\r\ntype PotShape = 'classic' | 'modern' | 'wide';\r\ntype PotSize = 'small' | 'medium' | 'large';\r\n\r\n// --- UTILS FOR CROPPING ---\r\nconst createImage = (url: string): Promise<HTMLImageElement> =>\r\n    new Promise((resolve, reject) => {\r\n        const image = new Image();\r\n        image.addEventListener('load', () => resolve(image));\r\n        image.addEventListener('error', (error) => reject(error));\r\n        if (!url.startsWith('data:')) image.setAttribute('crossOrigin', 'anonymous');\r\n        image.src = url;\r\n    });\r\n\r\nconst getCroppedImg = async (imageSrc: string, pixelCrop: any) => {\r\n    const image = await createImage(imageSrc);\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return null;\r\n    canvas.width = pixelCrop.width;\r\n    canvas.height = pixelCrop.height;\r\n    ctx.drawImage(image, pixelCrop.x, pixelCrop.y, pixelCrop.width, pixelCrop.height, 0, 0, pixelCrop.width, pixelCrop.height);\r\n    return canvas.toDataURL('image/jpeg');\r\n};\r\n\r\n\r\n// --- 3D POT COMPONENT ---\r\nconst PotModel = ({\r\n    textureUrl,\r\n    shape,\r\n    size,\r\n    scaleX,\r\n    scaleY,\r\n    offsetX,\r\n    offsetY,\r\n    rotation\r\n}: {\r\n    textureUrl: string | null,\r\n    shape: PotShape,\r\n    size: PotSize,\r\n    scaleX: number,\r\n    scaleY: number,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    rotation: number\r\n}) => {\r\n    const texture = textureUrl ? useLoader(THREE.TextureLoader, textureUrl) : null;\r\n\r\n    // Apply texture transformations\r\n    if (texture) {\r\n        // We want the image to behave like a \"sticker\" or decal, not a repeating pattern.\r\n        texture.wrapS = THREE.ClampToEdgeWrapping;\r\n        texture.wrapT = THREE.ClampToEdgeWrapping;\r\n\r\n        // Quality improvements for \"High End\" look\r\n        texture.anisotropy = 16;\r\n        texture.minFilter = THREE.LinearMipmapLinearFilter;\r\n        texture.magFilter = THREE.LinearFilter;\r\n        texture.generateMipmaps = true;\r\n\r\n        // Inverse logic: Higher \"Scale\" slider value usually means \"Zoom In\", \r\n        // which for repeats means SMALLER repeat count.\r\n        // So we invert the slider value: 1 / scale\r\n        texture.repeat.set(1 / scaleX, 1 / scaleY);\r\n\r\n        texture.offset.set(offsetX, offsetY);\r\n\r\n        texture.center.set(0.5, 0.5);\r\n        texture.rotation = rotation * (Math.PI / 180);\r\n\r\n        texture.needsUpdate = true;\r\n    }\r\n\r\n    // Size multiplier\r\n    const scale = size === 'small' ? 0.8 : size === 'medium' ? 1 : 1.2;\r\n\r\n    // Geometry args based on shape\r\n    let geometryArgs: [number, number, number, number] = [1.2, 1, 2.2, 64]; // Classic (Tapered)\r\n\r\n    if (shape === 'modern') geometryArgs = [1.1, 1.1, 2.2, 64]; // Straight Cylinder\r\n    if (shape === 'wide') geometryArgs = [1.4, 1.2, 1.8, 64]; // Short & Wide\r\n\r\n    return (\r\n        <group dispose={null} scale={[scale, scale, scale]}>\r\n            <mesh castShadow receiveShadow position={[0, 0.5, 0]}>\r\n                <cylinderGeometry args={geometryArgs} />\r\n\r\n                {/* Material 0: Side - Texture */}\r\n                <meshStandardMaterial\r\n                    attach=\"material-0\"\r\n                    color=\"#ffffff\"\r\n                    roughness={0.4}\r\n                    metalness={0.05}\r\n                    map={texture}\r\n                />\r\n                {/* Material 1: Top - White */}\r\n                <meshStandardMaterial attach=\"material-1\" color=\"#ffffff\" roughness={0.5} />\r\n                {/* Material 2: Bottom - White */}\r\n                <meshStandardMaterial attach=\"material-2\" color=\"#ffffff\" roughness={0.5} />\r\n            </mesh>\r\n\r\n            {/* Soil */}\r\n            <mesh position={[0, shape === 'wide' ? 1.3 : 1.59, 0]} rotation={[-Math.PI / 2, 0, 0]}>\r\n                <circleGeometry args={[shape === 'wide' ? 1.3 : 1.1, 32]} />\r\n                <meshStandardMaterial color=\"#2d1e18\" roughness={1} />\r\n            </mesh>\r\n        </group>\r\n    );\r\n};\r\n\r\n\r\n// --- CAPTURE HELPER ---\r\nconst CaptureRelay = ({ captureRef }: { captureRef: React.MutableRefObject<any> }) => {\r\n    const { gl, scene, camera } = useThree();\r\n\r\n    useEffect(() => {\r\n        captureRef.current = () => {\r\n            // Force a high-quality render for the snapshot\r\n            const originalRatio = gl.getPixelRatio();\r\n            gl.setPixelRatio(2); // High resolution snapshot\r\n            gl.render(scene, camera);\r\n            const dataUrl = gl.domElement.toDataURL('image/png', 1.0);\r\n            gl.setPixelRatio(originalRatio); // Restore\r\n            return dataUrl;\r\n        };\r\n    }, [gl, scene, camera, captureRef]);\r\n\r\n    return null;\r\n};\r\n\r\nexport const PotMaker = ({ onBack }: PotMakerProps) => {\r\n    const [step, setStep] = useState<'select' | 'upload' | 'crop' | 'preview' | 'result'>('select');\r\n\r\n    // Selection State\r\n    const [selectedShape, setSelectedShape] = useState<PotShape>('classic');\r\n    const [selectedSize, setSelectedSize] = useState<PotSize>('medium');\r\n\r\n    const [imageSrc, setImageSrc] = useState<string | null>(null);\r\n    const [croppedImage, setCroppedImage] = useState<string | null>(null);\r\n    const [finalImage, setFinalImage] = useState<string | null>(null); // The 3D render snapshot\r\n\r\n    const [crop, setCrop] = useState({ x: 0, y: 0 });\r\n    const [zoom, setZoom] = useState(1);\r\n    const [croppedAreaPixels, setCroppedAreaPixels] = useState(null);\r\n    const [saving, setSaving] = useState(false);\r\n    const [autoSaveOn, setAutoSaveOn] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const fetchSettings = async () => {\r\n            try {\r\n                const res = await fetch(`${API_URL}/settings/pot_save_on_buy`);\r\n                const data = await res.json();\r\n                if (data.key) setAutoSaveOn(data.value);\r\n            } catch (e) { console.error(e); }\r\n        };\r\n        fetchSettings();\r\n    }, []);\r\n\r\n    // 3D Texture Transforms\r\n    const [texScale, setTexScale] = useState(1);\r\n    const [texOffsetX, setTexOffsetX] = useState(0);\r\n    const [texOffsetY, setTexOffsetY] = useState(0);\r\n    const [texRotation, setTexRotation] = useState(0);\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const captureRef = useRef<() => string>(null);\r\n\r\n    const onCropComplete = useCallback((_area: any, croppedAreaPixels: any) => {\r\n        setCroppedAreaPixels(croppedAreaPixels);\r\n    }, []);\r\n\r\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files?.length) {\r\n            const reader = new FileReader();\r\n            reader.onload = () => { currentImageToCrop(reader.result as string); };\r\n            reader.readAsDataURL(e.target.files[0]);\r\n        }\r\n    };\r\n\r\n    const currentImageToCrop = (src: string) => {\r\n        setImageSrc(src);\r\n        setStep('crop');\r\n    };\r\n\r\n    const handleCropSave = async () => {\r\n        if (imageSrc && croppedAreaPixels) {\r\n            const cropped = await getCroppedImg(imageSrc, croppedAreaPixels);\r\n            setCroppedImage(cropped);\r\n            setStep('preview');\r\n        }\r\n    };\r\n\r\n    const handleFinalize = () => {\r\n        if (captureRef.current) {\r\n            const snapshot = captureRef.current();\r\n            setFinalImage(snapshot);\r\n            setStep('result');\r\n            toast.success(\"3D View Captured!\");\r\n        }\r\n    };\r\n\r\n    const handleDownload = () => {\r\n        if (!finalImage) return;\r\n        const link = document.createElement('a');\r\n        link.href = finalImage;\r\n        link.download = `VanaMap_MyPot_${Date.now()}.png`;\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        toast.success(\"Design downloading...\");\r\n    };\r\n\r\n    const handleBuy = async () => {\r\n        if (!finalImage) return;\r\n\r\n        if (autoSaveOn) {\r\n            setSaving(true);\r\n            try {\r\n                const token = localStorage.getItem('token');\r\n                await fetch(`${API_URL}/user/designs`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\r\n                    body: JSON.stringify({\r\n                        imageUrl: finalImage,\r\n                        shape: selectedShape,\r\n                        size: selectedSize\r\n                    })\r\n                });\r\n            } catch (e) { console.error(\"Auto-save failed during buy\"); }\r\n            setSaving(false);\r\n        }\r\n\r\n        toast.success(\"Order placed (Simulated)!\");\r\n    };\r\n\r\n    const handleSaveDesign = async () => {\r\n        handleDownload(); // Always download as requested\r\n\r\n        // Also save to database silently\r\n        setSaving(true);\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n            await fetch(`${API_URL}/user/designs`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },\r\n                body: JSON.stringify({\r\n                    imageUrl: finalImage,\r\n                    shape: selectedShape,\r\n                    size: selectedSize\r\n                })\r\n            });\r\n            toast.success(\"Saved to Profile!\");\r\n        } catch (e) { toast.error(\"Error saving to profile\"); }\r\n        setSaving(false);\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <button onClick={onBack} className={styles.backBtnWrapper}>&larr; Back to Menu</button>\r\n                <h2 className={styles.title}><Layers color=\"#10b981\" /> 3D Pot Studio</h2>\r\n                <p className={styles.subtitle}>\r\n                    {step === 'select' && \"Step 1: Choose your base\"}\r\n                    {step === 'upload' && \"Step 2: Upload your art\"}\r\n                    {step === 'crop' && \"Step 3: Crop\"}\r\n                    {step === 'preview' && \"Step 4: Customize\"}\r\n                    {step === 'result' && \"Final Step: Review & Save\"}\r\n                </p>\r\n            </div>\r\n\r\n            <div className={styles.workspace}>\r\n                {/* STEP 1: SELECTION */}\r\n                {step === 'select' && (\r\n                    <div className={styles.selectionContainer}>\r\n                        {/* Live Preview of Base Pot */}\r\n                        <div className={styles.miniPreview}>\r\n                            <Canvas shadows camera={{ position: [0, 1, 4], fov: 45 }}>\r\n                                <ambientLight intensity={0.5} />\r\n                                <spotLight position={[10, 10, 10]} angle={0.15} penumbra={1} />\r\n                                <PresentationControls speed={2} global zoom={0.8} polar={[-0.1, Math.PI / 4]}>\r\n                                    <Stage environment={null} intensity={1} castShadow={false}>\r\n                                        <PotModel\r\n                                            textureUrl={null} shape={selectedShape} size={selectedSize}\r\n                                            scaleX={1} scaleY={1} offsetX={0} offsetY={0} rotation={0}\r\n                                        />\r\n                                    </Stage>\r\n                                </PresentationControls>\r\n                            </Canvas>\r\n                            <div className={styles.rotateHint}><RotateCcw size={12} /> Spin Me</div>\r\n                        </div>\r\n\r\n                        <div className={styles.optionsGrid}>\r\n                            <div className={styles.optionGroup}>\r\n                                <h3>Shape</h3>\r\n                                <div className={styles.visualOptions}>\r\n                                    <div\r\n                                        className={`${styles.visualOption} ${selectedShape === 'classic' ? styles.visualActive : ''}`}\r\n                                        onClick={() => setSelectedShape('classic')}\r\n                                    >\r\n                                        <img src=\"/pot-classic.png\" alt=\"Classic Pot\" />\r\n                                        <span>Classic</span>\r\n                                    </div>\r\n                                    <div\r\n                                        className={`${styles.visualOption} ${selectedShape === 'modern' ? styles.visualActive : ''}`}\r\n                                        onClick={() => setSelectedShape('modern')}\r\n                                    >\r\n                                        <img src=\"/pot-modern.png\" alt=\"Modern Pot\" />\r\n                                        <span>Modern</span>\r\n                                    </div>\r\n                                    <div\r\n                                        className={`${styles.visualOption} ${selectedShape === 'wide' ? styles.visualActive : ''}`}\r\n                                        onClick={() => setSelectedShape('wide')}\r\n                                    >\r\n                                        <img src=\"/pot-wide.png\" alt=\"Wide Pot\" />\r\n                                        <span>Wide</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.optionGroup}>\r\n                                <h3>Size</h3>\r\n                                <div className={styles.optionRow}>\r\n                                    <button className={`${styles.optBtn} ${selectedSize === 'small' ? styles.optActive : ''}`} onClick={() => setSelectedSize('small')}>S</button>\r\n                                    <button className={`${styles.optBtn} ${selectedSize === 'medium' ? styles.optActive : ''}`} onClick={() => setSelectedSize('medium')}>M</button>\r\n                                    <button className={`${styles.optBtn} ${selectedSize === 'large' ? styles.optActive : ''}`} onClick={() => setSelectedSize('large')}>L</button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <button className={styles.nextBtn} onClick={() => setStep('upload')}>\r\n                                Next: Add Design &rarr;\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 2: UPLOAD */}\r\n                {step === 'upload' && (\r\n                    <div className={styles.uploadBox} onClick={() => fileInputRef.current?.click()}>\r\n                        <Upload size={48} color=\"#94a3b8\" />\r\n                        <h3>Upload Your Art</h3>\r\n                        <p>Click to browse images</p>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 3: CROP (Flexible Aspect) */}\r\n                {step === 'crop' && (\r\n                    <div className={styles.cropContainer}>\r\n                        <div className={styles.cropperWrapper}>\r\n                            <Cropper\r\n                                image={imageSrc || ''}\r\n                                crop={crop}\r\n                                zoom={zoom}\r\n                                aspect={1}\r\n                                minZoom={0.5}\r\n                                onCropChange={setCrop}\r\n                                onCropComplete={onCropComplete}\r\n                                onZoomChange={setZoom}\r\n                            />\r\n                        </div>\r\n                        <p style={{ fontSize: '0.8rem', color: '#94a3b8', textAlign: 'center' }}>\r\n                            Crop the part of the image you want. You can resize it on the pot in the next step.\r\n                        </p>\r\n                        <div className={styles.cropButtons}>\r\n                            <button onClick={() => setStep('upload')} className={styles.cancelBtn}><X size={18} /></button>\r\n                            <button onClick={handleCropSave} className={styles.applyBtn}><Check size={18} /> Apply</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 4: PREVIEW & CUSTOMIZE */}\r\n                {step === 'preview' && (\r\n                    <div className={styles.previewContainer}>\r\n                        <div className={styles.canvasWrapper}>\r\n                            <Canvas\r\n                                shadows\r\n                                gl={{ preserveDrawingBuffer: true }} // Allow screenshot\r\n                                camera={{ position: [0, 2, 5], fov: 45 }}\r\n                            >\r\n                                <CaptureRelay captureRef={captureRef} />\r\n                                <ambientLight intensity={0.5} />\r\n                                <spotLight position={[10, 10, 10]} angle={0.15} penumbra={1} />\r\n                                <PresentationControls speed={1.5} global zoom={0.7} polar={[-0.1, Math.PI / 4]}>\r\n                                    <Stage environment={null} intensity={1} castShadow={false}>\r\n                                        <PotModel\r\n                                            textureUrl={croppedImage}\r\n                                            shape={selectedShape}\r\n                                            size={selectedSize}\r\n                                            scaleX={texScale}\r\n                                            scaleY={texScale}\r\n                                            offsetX={texOffsetX}\r\n                                            offsetY={texOffsetY}\r\n                                            rotation={texRotation}\r\n                                        />\r\n                                    </Stage>\r\n                                </PresentationControls>\r\n                            </Canvas>\r\n                            <div className={styles.rotateHint}><RotateCcw size={16} /> Drag to rotate</div>\r\n                        </div>\r\n\r\n                        {/* TEXTURE CONTROLS */}\r\n                        <div className={styles.textureControls}>\r\n                            <div className={styles.controlRow}>\r\n                                <Maximize size={16} />\r\n                                <input type=\"range\" min=\"0.5\" max=\"3\" step=\"0.1\" value={texScale} onChange={(e) => setTexScale(parseFloat(e.target.value))} />\r\n                            </div>\r\n                            <div className={styles.controlRow}>\r\n                                <Move size={16} />\r\n                                <input type=\"range\" min=\"-1\" max=\"1\" step=\"0.1\" value={texOffsetX} onChange={(e) => setTexOffsetX(parseFloat(e.target.value))} />\r\n                                <input type=\"range\" min=\"-1\" max=\"1\" step=\"0.1\" value={texOffsetY} onChange={(e) => setTexOffsetY(parseFloat(e.target.value))} />\r\n                            </div>\r\n                            <div className={styles.controlRow}>\r\n                                <RotateCw size={16} />\r\n                                <input type=\"range\" min=\"0\" max=\"360\" step=\"10\" value={texRotation} onChange={(e) => setTexRotation(parseFloat(e.target.value))} />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={styles.controls}>\r\n                            <button className={styles.actionBtn} onClick={() => setStep('crop')}><Camera size={20} /> Re-Crop</button>\r\n                            <div className={styles.divider} />\r\n                            {/* Finalize Button */}\r\n                            <button className={styles.saveBtn} onClick={handleFinalize} style={{ width: '100%', justifyContent: 'center' }}>\r\n                                <Check size={20} /> Generate Final View\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* STEP 5: FINAL RESULT */}\r\n                {step === 'result' && finalImage && (\r\n                    <div className={styles.previewContainer}>\r\n                        <div className={styles.canvasWrapper} style={{ background: '#fff', overflow: 'hidden' }}>\r\n                            {/* Display the Captured Image */}\r\n                            <img src={finalImage} alt=\"Final Design\" style={{ width: '100%', height: '100%', objectFit: 'contain' }} />\r\n                        </div>\r\n                        <p style={{ color: '#94a3b8', fontSize: '0.9rem' }}>This is how your masterpiece looks!</p>\r\n\r\n                        <div className={styles.controls}>\r\n                            <button className={styles.actionBtn} onClick={() => setStep('preview')}>\r\n                                <RotateCcw size={20} /> Keep Editing\r\n                            </button>\r\n                            <div className={styles.divider} />\r\n                            <button className={styles.saveBtn} onClick={() => handleSaveDesign()} disabled={saving}>\r\n                                <Save size={20} /> Save & Download\r\n                            </button>\r\n                            <button className={styles.buyBtn} onClick={handleBuy} disabled={saving}>\r\n                                <ShoppingCart size={20} /> Buy <span className={styles.badge}>msg</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <input type=\"file\" ref={fileInputRef} hidden accept=\"image/*\" onChange={handleFileUpload} />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\market\\PlantVendorsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\plants\\PlantCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[815,818],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[815,818],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Plant } from '../../../types';\r\nimport { Heart, Sun, Wind, ShoppingBag, AlertCircle, Clock } from 'lucide-react';\r\nimport styles from './PlantCard.module.css';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\ninterface PlantCardProps {\r\n    plant: Plant;\r\n    onAdd?: (plant: Plant) => void;\r\n    score?: number;\r\n    isTopMatch?: boolean;\r\n    priority?: boolean;\r\n    stockStatus?: {\r\n        totalStock: number;\r\n        minPrice: number | null;\r\n        hasStock: boolean;\r\n    };\r\n}\r\n\r\nexport const PlantCard = ({ plant, score, isTopMatch, priority = false, onAdd, stockStatus }: PlantCardProps) => {\r\n    const { user, toggleFavorite } = useAuth();\r\n    const isFavorite = user?.favorites.includes(plant.id);\r\n    const isPetFriendly = (plant as any).petFriendly;\r\n\r\n    // Determine Price & Stock\r\n    const displayPrice = stockStatus?.minPrice || plant.price || ((plant.name.charCodeAt(0) % 5 + 1) * 150);\r\n    const inStock = stockStatus ? stockStatus.hasStock : true; // Default to true if no stats (mock)\r\n    const stockCount = stockStatus?.totalStock || 0;\r\n\r\n    const handleHeartClick = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        if (!user) {\r\n            toast.error(\"Sign in to save favorites!\");\r\n            return;\r\n        }\r\n        toggleFavorite(plant.id);\r\n        toast.success(isFavorite ? \"Removed from favorites\" : \"Added to favorites\");\r\n    };\r\n\r\n    return (\r\n        <div className={styles.card} style={{\r\n            ...(isTopMatch ? { border: '2px solid rgba(250, 204, 21, 0.5)', boxShadow: '0 0 40px rgba(250, 204, 21, 0.15)' } : {}),\r\n        }}>\r\n            <div className={styles.imageContainer}>\r\n                <img\r\n                    src={plant.imageUrl}\r\n                    alt={`${plant.name} - ${plant.scientificName} plant`}\r\n                    className={styles.image}\r\n                    loading={priority ? \"eager\" : \"lazy\"}\r\n                    decoding=\"async\"\r\n                    width=\"300\"\r\n                    height=\"300\"\r\n                    {...(priority ? { fetchPriority: \"high\" } : {})}\r\n                />\r\n\r\n                <div className={styles.overlayTop}>\r\n                    {score !== undefined && (\r\n                        <div className={styles.matchBadge} style={{\r\n                            background: score >= 80 ? 'linear-gradient(135deg, #10b981, #059669)' :\r\n                                score >= 50 ? 'linear-gradient(135deg, #facc15, #fbbf24)' :\r\n                                    'linear-gradient(135deg, #f87171, #ef4444)',\r\n                            color: score >= 50 && score < 80 ? '#000' : '#fff',\r\n                        }}>\r\n                            {score}% APTNESS\r\n                        </div>\r\n                    )}\r\n                    <button onClick={handleHeartClick} className={styles.favBtn} aria-label={isFavorite ? \"Remove from favorites\" : \"Add to favorites\"}>\r\n                        <Heart size={20} fill={isFavorite ? \"#ef4444\" : \"rgba(0,0,0,0.2)\"} color={isFavorite ? \"#ef4444\" : \"white\"} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Stock Badge - Stacked above Type Badge */}\r\n                {stockStatus && (\r\n                    <div style={{\r\n                        position: 'absolute',\r\n                        bottom: '54px',\r\n                        left: '12px',\r\n                        zIndex: 10,\r\n                        background: inStock ? 'rgba(16, 185, 129, 0.95)' : 'rgba(239, 68, 68, 0.95)',\r\n                        color: 'white',\r\n                        padding: '4px 8px',\r\n                        borderRadius: '6px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: '800',\r\n                        letterSpacing: '0.5px',\r\n                        backdropFilter: 'blur(4px)',\r\n                        boxShadow: '0 4px 6px rgba(0,0,0,0.15)',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: '4px',\r\n                        border: '1px solid rgba(255,255,255,0.2)'\r\n                    }}>\r\n                        {inStock ? (\r\n                            <>\r\n                                <span style={{ width: '6px', height: '6px', background: 'white', borderRadius: '50%' }}></span>\r\n                                IN STOCK ({stockCount})\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                <AlertCircle size={10} /> OUT OF STOCK\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                <div className={styles.overlayBottom}>\r\n                    <div style={{\r\n                        background: plant.type === 'indoor' ? 'rgba(59, 130, 246, 0.9)' : 'rgba(245, 158, 11, 0.9)',\r\n                        color: 'white',\r\n                        padding: '4px 10px',\r\n                        borderRadius: '8px',\r\n                        fontSize: '0.65rem',\r\n                        fontWeight: 800,\r\n                        textTransform: 'uppercase',\r\n                        letterSpacing: '0.5px',\r\n                        backdropFilter: 'blur(4px)',\r\n                        border: '1px solid rgba(255,255,255,0.2)'\r\n                    }}>\r\n                        {plant.type === 'indoor' ? 'Indoor Specimen' : 'Outdoor Nature'}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Kid/Pet Friendly Badges */}\r\n                <div style={{\r\n                    position: 'absolute', bottom: '12px', right: '12px', display: 'flex', gap: '6px', flexWrap: 'wrap', zIndex: 3\r\n                }}>\r\n                    {isPetFriendly && (\r\n                        <span style={{\r\n                            background: 'rgba(255,255,255,0.95)', color: '#10b981', fontSize: '0.65rem', fontWeight: 800,\r\n                            padding: '4px 8px', borderRadius: '8px', display: 'flex', alignItems: 'center', gap: '4px',\r\n                            boxShadow: '0 4px 10px rgba(0,0,0,0.1)'\r\n                        }}>\r\n                            Pet Safe ðŸ¾\r\n                        </span>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.content}>\r\n                <div style={{ marginBottom: '0.25rem' }}>\r\n                    <h3 className={styles.title}>{plant.name}</h3>\r\n                    <p className={styles.scientific}>{plant.scientificName}</p>\r\n                </div>\r\n\r\n                {/* Simplified Specs */}\r\n                <div className={styles.specs}>\r\n                    <div className={styles.specItem}>\r\n                        <Sun size={14} className=\"text-amber-400\" /> {plant.sunlight}\r\n                    </div>\r\n                    <div className={styles.specItem}>\r\n                        <Wind size={14} className=\"text-blue-400\" /> {plant.oxygenLevel} Oâ‚‚\r\n                    </div>\r\n                    {plant.lifespan && plant.lifespan !== 'Unknown' && (\r\n                        <div className={styles.specItem}>\r\n                            <Clock size={14} className=\"text-emerald-400\" /> {plant.lifespan}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Shop Action - Premium UI */}\r\n                <button\r\n                    onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        // If onAdd exists, use it (Add to Cart logic)\r\n                        if (onAdd) {\r\n                            onAdd(plant);\r\n                            // Toast handled in parent or here?\r\n                            // toast.success(`Viewing ${plant.name} in shops`);\r\n                        }\r\n                    }}\r\n                    className={styles.shopBtn}\r\n                    aria-label={`Buy ${plant.name}`}\r\n                    disabled={!inStock}\r\n                    style={!inStock ? { opacity: 0.6, cursor: 'not-allowed', background: '#334155' } : {}}\r\n                >\r\n                    <span style={{ position: 'relative', zIndex: 2, display: 'flex', alignItems: 'center', gap: '8px', fontWeight: 700, letterSpacing: '0.5px' }}>\r\n                        <ShoppingBag size={16} /> Rs. {displayPrice} â€¢ {inStock ? 'BUY' : 'SOLD OUT'}\r\n                    </span>\r\n                    {/* Glossy sheen effect overlay via CSS is best, but inline simpler for now */}\r\n                    <div style={{\r\n                        position: 'absolute', inset: 0,\r\n                        background: 'linear-gradient(45deg, rgba(255,255,255,0) 40%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 60%)',\r\n                        transform: 'skewX(-20deg)',\r\n                        opacity: 0,\r\n                        transition: 'opacity 0.3s'\r\n                    }} className=\"hover-sheen\"></div>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\plants\\PlantDetailsModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[515,518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[515,518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'baseRate' is never reassigned. Use 'const' instead.","line":51,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":51,"endColumn":21,"fix":{"range":[1904,1971],"text":"const baseRate = ox === 'very-high' ? 28 : (ox === 'high' ? 22 : 15);"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4921,4924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4921,4924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { X, Sun, Wind, Droplet, Leaf, Lightbulb, Fan, AlertTriangle, Sparkles, Stethoscope, BookOpen, GraduationCap } from 'lucide-react';\r\nimport type { Plant } from '../../../types';\r\nimport styles from './PlantDetailsModal.module.css';\r\nimport { useState, useMemo, useEffect } from 'react';\r\nimport type { MouseEvent, TouchEvent } from 'react';\r\n\r\ninterface PlantDetailsModalProps {\r\n    plant: Plant;\r\n    weather: {\r\n        avgTemp30Days?: number;\r\n        avgHumidity30Days?: number;\r\n        [key: string]: any;\r\n    } | null;\r\n    onClose: () => void;\r\n}\r\n\r\nexport const PlantDetailsModal = ({ plant, weather, onClose }: PlantDetailsModalProps) => {\r\n    const [isMobile, setIsMobile] = useState(window.innerWidth < 1024);\r\n\r\n    useEffect(() => {\r\n        const handleResize = () => setIsMobile(window.innerWidth < 1024);\r\n        window.addEventListener('resize', handleResize);\r\n        return () => window.removeEventListener('resize', handleResize);\r\n    }, []);\r\n\r\n    // UI States\r\n    const [activeTab, setActiveTab] = useState<'overview' | 'simulation'>('overview');\r\n\r\n    // Simulation States\r\n    const [numPeople, setNumPeople] = useState(1);\r\n    const [isACMode, setIsACMode] = useState(false);\r\n    const [targetTemp, setTargetTemp] = useState(22);\r\n    const [lightLevel, setLightLevel] = useState(70);\r\n\r\n    // Environment\r\n    const currentTemp = isACMode ? targetTemp : (weather?.avgTemp30Days || 25);\r\n    const currentHumidity = weather?.avgHumidity30Days || 50;\r\n\r\n\r\n    // ==========================================\r\n    // SCIENTIFIC LOGIC\r\n    // ==========================================\r\n    const getBasePhotosynthesisRate = useMemo(() => {\r\n        let leafArea = 0.5;\r\n        const ox = plant.oxygenLevel || 'moderate';\r\n\r\n        if (ox === 'very-high') leafArea = 4.2;\r\n        else if (ox === 'high') leafArea = 2.5;\r\n        else leafArea = 1.2;\r\n\r\n        let baseRate = ox === 'very-high' ? 28 : (ox === 'high' ? 22 : 15);\r\n        return baseRate * leafArea;\r\n    }, [plant.oxygenLevel]);\r\n\r\n    const temperatureEffect = useMemo(() => {\r\n        const T = currentTemp + 273.15;\r\n        const T_opt = 298.15;\r\n        if (currentTemp < 10 || currentTemp > 42) return 0.1;\r\n        const sigma = 12;\r\n        return Math.max(0.15, Math.exp(-Math.pow(T - T_opt, 2) / (2 * sigma * sigma)));\r\n    }, [currentTemp]);\r\n\r\n    const humidityEffect = useMemo(() => {\r\n        if (currentHumidity < 25) return 0.65;\r\n        if (currentHumidity > 85) return 0.8;\r\n        return 1.0;\r\n    }, [currentHumidity]);\r\n\r\n    const PLANT_O2_OUTPUT = useMemo(() => {\r\n        const lightFactor = Math.max(0.1, lightLevel / 100);\r\n        const dayYield = getBasePhotosynthesisRate * temperatureEffect * humidityEffect * lightFactor * 3600 * 12 * 22.4 / 1000000;\r\n        return dayYield.toFixed(1);\r\n    }, [getBasePhotosynthesisRate, temperatureEffect, humidityEffect, lightLevel]);\r\n\r\n    const plantsNeeded = Math.max(1, Math.ceil((550 * numPeople) / (parseFloat(PLANT_O2_OUTPUT) || 50)));\r\n\r\n\r\n    // Stop Propagation Helper\r\n    const stopProp = (e: TouchEvent | MouseEvent) => e.stopPropagation();\r\n\r\n    // ==========================================\r\n    // SHARED COMPONENTS\r\n    // ==========================================\r\n\r\n    const renderControls = () => (\r\n        <div className={styles.mobileControlsContainer}>\r\n            {/* GPS Warning */}\r\n            <div className={styles.instructionNotice}>\r\n                <AlertTriangle size={16} className=\"text-yellow-500\" style={{ marginTop: 2, flexShrink: 0 }} />\r\n                <div><strong>Pro Tip:</strong> Enable GPS for accurate local climate simulation results.</div>\r\n            </div>\r\n\r\n            {/* People */}\r\n            <div className={styles.controlItem}>\r\n                <div className={styles.controlHeader}>\r\n                    <span>Occupants</span>\r\n                    <span className={styles.controlValue}>{numPeople}</span>\r\n                </div>\r\n                <input\r\n                    type=\"range\" min=\"1\" max=\"10\" value={numPeople}\r\n                    onChange={(e) => setNumPeople(Number(e.target.value))}\r\n                    className={styles.rangeInput}\r\n                />\r\n            </div>\r\n\r\n            {/* Light */}\r\n            <div className={styles.controlItem}>\r\n                <div className={styles.controlHeader}>\r\n                    <span style={{ display: 'flex', alignItems: 'center', gap: 6 }}><Lightbulb size={14} /> Light Level</span>\r\n                    <span className={styles.controlValue} style={{ color: '#facc15' }}>{lightLevel}%</span>\r\n                </div>\r\n                <input\r\n                    type=\"range\" min=\"10\" max=\"100\" value={lightLevel}\r\n                    onChange={(e) => setLightLevel(Number(e.target.value))}\r\n                    className={styles.rangeInput}\r\n                    style={{ '--thumb-color': '#facc15' } as any}\r\n                />\r\n            </div>\r\n\r\n            {/* AC/Temp */}\r\n            <div className={styles.controlItem}>\r\n                <div className={styles.controlHeader}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}><Fan size={14} /> AC Control</div>\r\n                    <button\r\n                        onClick={() => setIsACMode(!isACMode)}\r\n                        className={`${styles.toggleSwitch} ${isACMode ? styles.active : ''}`}\r\n                    />\r\n                </div>\r\n\r\n                {isACMode ? (\r\n                    <div className=\"animate-fade-in space-y-2 mt-2\">\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '0.8rem', color: '#64748b' }}>\r\n                            <span>Target Temp</span>\r\n                            <span className={styles.controlValue}>{targetTemp}Â°C</span>\r\n                        </div>\r\n                        <input\r\n                            type=\"range\" min=\"16\" max=\"30\" value={targetTemp}\r\n                            onChange={(e) => setTargetTemp(Number(e.target.value))}\r\n                            className={styles.rangeInput}\r\n                        />\r\n                    </div>\r\n                ) : (\r\n                    <div style={{ fontSize: '0.8rem', color: '#64748b', fontStyle: 'italic' }}>\r\n                        Using local weather: <strong style={{ color: '#94a3b8' }}>{weather?.avgTemp30Days || 25}Â°C</strong>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderVisualizer = () => (\r\n        <div style={{ position: 'relative', background: 'rgba(0,0,0,0.3)', borderRadius: '1.5rem', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '220px', border: '1px dashed rgba(255,255,255,0.1)', overflow: 'hidden' }}>\r\n            <div style={{ position: 'absolute', top: '1rem', left: '1rem', fontSize: '0.75rem', color: '#94a3b8', fontWeight: 600, zIndex: 2 }}>RESULTS</div>\r\n            <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap', gap: '8px', maxWidth: '80%', margin: '1rem 0', zIndex: 2 }}>\r\n                {[...Array(Math.min(plantsNeeded, 12))].map((_, i) => (\r\n                    <div key={i} className=\"pop-in\" style={{\r\n                        width: '32px', height: '32px', background: '#10b981', borderRadius: '50%',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                        boxShadow: '0 0 15px rgba(16, 185, 129, 0.4)',\r\n                        animationDelay: `${i * 0.05}s`\r\n                    }}>\r\n                        <Leaf size={14} fill=\"rgba(255,255,255,0.5)\" color=\"white\" />\r\n                    </div>\r\n                ))}\r\n                {plantsNeeded > 12 && <div style={{ color: '#10b981', fontWeight: 700, fontSize: '1.2rem' }}>+{plantsNeeded - 12}</div>}\r\n            </div>\r\n            <div style={{ textAlign: 'center', marginTop: 'auto', marginBottom: '1.5rem', zIndex: 2 }}>\r\n                <div style={{ fontSize: '3rem', fontWeight: 900, color: 'white', lineHeight: 1, textShadow: '0 0 30px rgba(16, 185, 129, 0.3)' }}>\r\n                    {plantsNeeded}\r\n                </div>\r\n                <div style={{ fontSize: '0.9rem', color: '#10b981', fontWeight: 600 }}>Plants Needed</div>\r\n                <div style={{ fontSize: '0.8rem', color: '#64748b' }}>For {numPeople} People (Needs {numPeople * 550}L Oâ‚‚)</div>\r\n            </div>\r\n            <div style={{ position: 'absolute', inset: 0, background: 'radial-gradient(circle at center, rgba(16, 185, 129, 0.1), transparent 70%)' }}></div>\r\n        </div>\r\n    );\r\n\r\n    // ==========================================\r\n    // MOBILE VIEW\r\n    // ==========================================\r\n    if (isMobile) {\r\n        return (\r\n            <div\r\n                className={`${styles.overlay} no-swipe`}\r\n                onClick={onClose}\r\n                onTouchStart={stopProp}\r\n                onTouchMove={stopProp}\r\n                onTouchEnd={stopProp}\r\n                style={{ zIndex: 9999, padding: '10px' }}\r\n            >\r\n                <div className={styles.modal} onClick={(e) => e.stopPropagation()} style={{\r\n                    maxHeight: '90vh', overflowY: 'auto', borderRadius: '24px',\r\n                    background: '#0f172a', border: '1px solid rgba(255,255,255,0.1)'\r\n                }}>\r\n                    <div style={{ height: '200px', position: 'relative' }}>\r\n                        <img src={plant.imageUrl} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                        <div style={{ position: 'absolute', inset: 0, background: 'linear-gradient(to top, #0f172a 0%, transparent 100%)' }}></div>\r\n                        <button onClick={onClose} style={{ position: 'absolute', top: 15, right: 15, background: 'rgba(0,0,0,0.5)', borderRadius: '50%', padding: 8, color: 'white', border: 'none' }}>\r\n                            <X size={20} />\r\n                        </button>\r\n                        <div style={{ position: 'absolute', bottom: 10, left: 20 }}>\r\n                            <h2 style={{ fontSize: '2rem', fontWeight: 800, color: 'white', margin: 0 }}>{plant.name}</h2>\r\n                            <div style={{ display: 'flex', gap: 10, marginTop: 5 }}>\r\n                                <span style={{ fontSize: '0.75rem', background: '#334155', padding: '2px 8px', borderRadius: 4 }}>{plant.oxygenLevel} O2</span>\r\n                                <span style={{ fontSize: '0.75rem', background: '#334155', padding: '2px 8px', borderRadius: 4 }}>{plant.sunlight}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ padding: '20px', display: 'flex', flexDirection: 'column', gap: '2rem' }}>\r\n                        <div className={styles.overviewContainer}>\r\n                            <h3 style={{ fontSize: '1.2rem', color: 'white', marginBottom: '0.5rem' }}>Overview</h3>\r\n                            <p className={styles.descriptionText}>{plant.description}</p>\r\n\r\n                            {/* Mobile Advantages & Medicine */}\r\n                            <div className={styles.infoGrid}>\r\n                                {plant.advantages && plant.advantages.length > 0 && (\r\n                                    <div className={`${styles.infoCard} ${styles.cardGreen}`}>\r\n                                        <div className={`${styles.cardHeader} ${styles.textGreen}`}>\r\n                                            <Sparkles size={16} /> Key Advantages\r\n                                        </div>\r\n                                        <div className={styles.chipsContainer}>\r\n                                            {plant.advantages.map((adv, i) => (\r\n                                                <span key={i} className={`${styles.chip} ${styles.chipGreen}`}>\r\n                                                    {adv}\r\n                                                </span>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {plant.medicinalValues && plant.medicinalValues.length > 0 && (\r\n                                    <div className={`${styles.infoCard} ${styles.cardRose}`}>\r\n                                        <div className={`${styles.cardHeader} ${styles.textRose}`}>\r\n                                            <Stethoscope size={16} /> Medicinal Uses\r\n                                        </div>\r\n                                        <div className={styles.chipsContainer}>\r\n                                            {plant.medicinalValues.map((med, i) => (\r\n                                                <span key={i} className={`${styles.chip} ${styles.chipRose}`}>\r\n                                                    {med}\r\n                                                </span>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: '2rem' }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\r\n                                <h3 style={{ margin: 0, color: '#38bdf8', display: 'flex', alignItems: 'center', gap: 6 }}>\r\n                                    <Wind size={20} /> Room Lab\r\n                                </h3>\r\n                                <div className=\"text-xs text-emerald-400 font-bold border border-emerald-500 rounded px-2\">ACTIVE</div>\r\n                            </div>\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1.5rem' }}>\r\n                                {renderControls()}\r\n                                {renderVisualizer()}\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n                <style>{`\r\n                    .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) backwards; }\r\n                    .animate-fade-in { animation: fadeIn 0.3s ease-out; }\r\n                    @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }\r\n                    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\r\n                `}</style>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ==========================================\r\n    // DESKTOP VIEW\r\n    // ==========================================\r\n    return (\r\n        <div\r\n            className={`${styles.overlay} no-swipe`}\r\n            onClick={onClose}\r\n            onTouchStart={stopProp}\r\n            onTouchMove={stopProp}\r\n            onTouchEnd={stopProp}\r\n            style={{ zIndex: 9999 }}\r\n        >\r\n            <div className={styles.modal} onClick={(e) => e.stopPropagation()} style={{ overflow: 'hidden', padding: 0 }}>\r\n                <div style={{ display: 'flex', height: '100%', flexDirection: 'row' }}>\r\n\r\n                    <div style={{ flex: '0 0 45%', position: 'relative', background: '#0f172a' }}>\r\n                        <img src={plant.imageUrl} alt={plant.name} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                        <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', background: 'linear-gradient(to bottom, rgba(0,0,0,0.2), transparent 50%, rgba(0,0,0,0.8))' }}></div>\r\n                        <button onClick={onClose} style={{ position: 'absolute', top: '2rem', left: '2rem', background: 'rgba(0,0,0,0.5)', padding: '10px', borderRadius: '50%', color: 'white', border: 'none', cursor: 'pointer', backdropFilter: 'blur(4px)' }}>\r\n                            <X size={24} />\r\n                        </button>\r\n                        <div style={{ position: 'absolute', bottom: '3rem', left: '3rem', color: 'white' }}>\r\n                            <h1 style={{ fontSize: '3rem', fontWeight: 900, lineHeight: 1, textShadow: '0 2px 10px rgba(0,0,0,0.5)' }}>{plant.name}</h1>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div style={{ flex: 1, display: 'flex', flexDirection: 'column', background: '#1e293b', borderLeft: '1px solid rgba(255,255,255,0.05)' }}>\r\n                        <div style={{ padding: '2rem 3rem', borderBottom: '1px solid rgba(255,255,255,0.05)', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                            <div style={{ display: 'flex', background: 'rgba(0,0,0,0.2)', padding: '4px', borderRadius: '12px' }}>\r\n                                <button onClick={() => setActiveTab('overview')} style={{ padding: '10px 24px', borderRadius: '8px', border: 'none', cursor: 'pointer', fontWeight: 600, background: activeTab === 'overview' ? '#334155' : 'transparent', color: activeTab === 'overview' ? 'white' : '#64748b', transition: 'all 0.2s' }}>Overview</button>\r\n                                <button onClick={() => setActiveTab('simulation')} style={{ padding: '10px 24px', borderRadius: '8px', border: 'none', cursor: 'pointer', fontWeight: 600, background: activeTab === 'simulation' ? '#334155' : 'transparent', color: activeTab === 'simulation' ? '#38bdf8' : '#64748b', transition: 'all 0.2s' }}>Simulation</button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ flex: 1, overflowY: 'auto', padding: '3rem' }}>\r\n                            {activeTab === 'overview' ? (\r\n                                <div className={`${styles.overviewContainer} animate-fade-in`}>\r\n                                    <p className={styles.descriptionText}>{plant.description}</p>\r\n\r\n                                    {/* Desktop Advantages & Medicine */}\r\n                                    <div className={styles.infoGrid}>\r\n                                        {plant.advantages && plant.advantages.length > 0 && (\r\n                                            <div className={`${styles.infoCard} ${styles.cardGreen}`}>\r\n                                                <div className={`${styles.cardHeader} ${styles.textGreen}`}>\r\n                                                    <Sparkles size={16} /> Key Advantages\r\n                                                </div>\r\n                                                <div className={styles.chipsContainer}>\r\n                                                    {plant.advantages.map((adv, i) => (\r\n                                                        <span key={i} className={`${styles.chip} ${styles.chipGreen}`}>\r\n                                                            {adv}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n\r\n                                        {plant.medicinalValues && plant.medicinalValues.length > 0 && (\r\n                                            <div className={`${styles.infoCard} ${styles.cardRose}`}>\r\n                                                <div className={`${styles.cardHeader} ${styles.textRose}`}>\r\n                                                    <Stethoscope size={16} /> Medicinal Uses\r\n                                                </div>\r\n                                                <div className={styles.chipsContainer}>\r\n                                                    {plant.medicinalValues.map((med, i) => (\r\n                                                        <span key={i} className={`${styles.chip} ${styles.chipRose}`}>\r\n                                                            {med}\r\n                                                        </span>\r\n                                                    ))}\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    <div className={styles.statsRow}>\r\n                                        <div className={styles.statItem}>\r\n                                            <div className={styles.statIcon}><Sun className=\"text-yellow-400\" /></div>\r\n                                            <div className={styles.statText}>\r\n                                                <span className={styles.statLabel}>Sunlight</span>\r\n                                                <span className={styles.statValue}>{plant.sunlight}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.statItem}>\r\n                                            <div className={styles.statIcon}><Droplet className=\"text-blue-400\" /></div>\r\n                                            <div className={styles.statText}>\r\n                                                <span className={styles.statLabel}>Water</span>\r\n                                                <span className={styles.statValue}>Weekly</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* ðŸŽ“ Educational Deep Dive */}\r\n                                    <div className={styles.educationalSection}>\r\n                                        <div className={styles.eduHeader}>\r\n                                            <GraduationCap size={20} color=\"#38bdf8\" />\r\n                                            <h3>Botanical Deep Dive</h3>\r\n                                        </div>\r\n                                        <div className={styles.eduGrid}>\r\n                                            <div className={styles.eduCard}>\r\n                                                <BookOpen size={16} />\r\n                                                <h4>Scientific Trivia</h4>\r\n                                                <p>Did you know? The {plant.name} uses CAM photosynthesis to purify air even during the nocturnal cycle.</p>\r\n                                            </div>\r\n                                            <div className={styles.eduCard}>\r\n                                                <Sparkles size={16} />\r\n                                                <h4>Beginner Friendly</h4>\r\n                                                <p>Top tip: Avoid overwatering. This species thrives when the top 2 inches of soil are dry.</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"animate-fade-in\" style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '2rem' }}>\r\n                                    {renderVisualizer()}\r\n                                    {renderControls()}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Desktop Footer Removed */}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <style>{` .animate-fade-in { animation: fadeIn 0.4s ease-out; } `}</style>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\plants\\PlantSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\vendor\\MarketInsights.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[415,418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[415,418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1930,1933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1930,1933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3137,3140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3137,3140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { TrendingUp, Map, Award, Lightbulb, ArrowUpRight } from 'lucide-react';\r\nimport { fetchVendorAnalytics } from '../../../services/api';\r\nimport styles from './MarketInsights.module.css';\r\n\r\ninterface MarketInsightsProps {\r\n    vendorId: string;\r\n}\r\n\r\nexport const MarketInsights = ({ vendorId }: MarketInsightsProps) => {\r\n    const [stats, setStats] = useState<any>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const load = async () => {\r\n            try {\r\n                const res = await fetchVendorAnalytics(vendorId);\r\n                setStats(res);\r\n            } catch (e) {\r\n                console.error(\"Analytics failure\", e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        load();\r\n    }, [vendorId]);\r\n\r\n    if (loading) return <div style={{ color: '#64748b', padding: '2rem', textAlign: 'center' }}>Synchronizing local market data...</div>;\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <header className={styles.header}>\r\n                <div className={styles.titleGroup}>\r\n                    <div className={styles.iconBox}>\r\n                        <TrendingUp size={24} />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className={styles.title}>Market Intelligence</h2>\r\n                        <p className={styles.subtitle}>Real-time search trends and regional demand within 5km.</p>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <div className={styles.grid}>\r\n                {/* TOP SEARCHES */}\r\n                <div className={styles.card}>\r\n                    <div className={styles.cardHeader}>\r\n                        <Award size={16} /> Most Wanted Species\r\n                    </div>\r\n                    {stats?.topSearches?.map((item: any, idx: number) => (\r\n                        <div key={idx} className={styles.listItem}>\r\n                            <div className={styles.indicator}>\r\n                                <div className={styles.rank}>{idx + 1}</div>\r\n                                <span className={styles.label}>{item._id}</span>\r\n                            </div>\r\n                            <div className={styles.valueGroup}>\r\n                                <span className={styles.count}>{item.count}</span>\r\n                                <span className={styles.growth}>searches</span>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                    {!stats?.topSearches?.length && <div style={{ color: '#475569', textAlign: 'center', padding: '2rem' }}>No search data yet.</div>}\r\n                </div>\r\n\r\n                {/* DEMAND BY CITY */}\r\n                <div className={styles.card}>\r\n                    <div className={styles.cardHeader}>\r\n                        <Map size={16} /> Regional Interest\r\n                    </div>\r\n                    <div className={styles.barContainer}>\r\n                        {stats?.demandByLocation?.map((item: any, idx: number) => {\r\n                            const max = stats.demandByLocation[0].count;\r\n                            const percentage = (item.count / max) * 100;\r\n                            return (\r\n                                <div key={idx} className={styles.barWrapper}>\r\n                                    <div className={styles.barLabel}>\r\n                                        <span className={styles.barName}>{item._id || 'Nearby'}</span>\r\n                                        <span className={styles.barValue}>{item.count} requests</span>\r\n                                    </div>\r\n                                    <div className={styles.track}>\r\n                                        <div className={styles.fill} style={{ width: `${percentage}%` }} />\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                        {!stats?.demandByLocation?.length && <div style={{ color: '#475569', textAlign: 'center', padding: '2rem' }}>Awaiting local GPS signals.</div>}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* AI INSIGHT */}\r\n                <div className={styles.insightBanner}>\r\n                    <Lightbulb className={styles.insightIcon} size={28} />\r\n                    <div className={styles.insightText}>\r\n                        <strong>Smart Tip:</strong> {stats?.topSearches?.[0] ?\r\n                            `There is a 30% surge in searches for \"${stats.topSearches[0]._id}\". Consider restocking this species to maximize visibility.` :\r\n                            \"Keep your inventory updated to track which of your specimens are attracting the most interest.\"\r\n                        }\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '4px', marginTop: '4px', cursor: 'pointer', color: '#10b981', fontWeight: 700 }}>\r\n                            View detailed report <ArrowUpRight size={14} />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\features\\vendor\\VendorInventory.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPlants'. Either include it or remove the dependency array.","line":33,"column":8,"nodeType":"ArrayExpression","endLine":33,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [loadPlants]","fix":{"range":[1512,1514],"text":"[loadPlants]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1973,1976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1973,1976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2821,2824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2821,2824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'newInventory' is never reassigned. Use 'const' instead.","line":113,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":113,"endColumn":25,"fix":{"range":[4406,4447],"text":"const newInventory = [...currentInventory];"}},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":142,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":166,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":166,"endColumn":21}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Search, Save, AlertCircle, CheckCircle, Package, DollarSign, Trash2 } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { fetchPlants, updateVendor } from '../../../services/api';\r\nimport { formatCurrency } from '../../../utils/currency';\r\nimport type { Plant, Vendor } from '../../../types';\r\nimport styles from './VendorInventory.module.css';\r\n\r\ninterface VendorInventoryProps {\r\n    vendor: Vendor;\r\n    onUpdate: () => void; // Callback to refresh parent data\r\n}\r\n\r\nexport const VendorInventory = ({ vendor, onUpdate }: VendorInventoryProps) => {\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [editValues, setEditValues] = useState<Record<string, { price: string, quantity: string, inStock: boolean }>>({});\r\n\r\n    useEffect(() => {\r\n        // Restore state after forced refresh\r\n        const restoreState = sessionStorage.getItem('vendor_restore');\r\n        if (restoreState) {\r\n            const { query, scroll } = JSON.parse(restoreState);\r\n            setSearchQuery(query);\r\n            setTimeout(() => {\r\n                window.scrollTo(0, scroll);\r\n                toast.success(\"Data verified & synched from server!\", { icon: 'ðŸ”' });\r\n            }, 500); // Small delay to allow rendering\r\n            sessionStorage.removeItem('vendor_restore');\r\n        }\r\n        loadPlants();\r\n    }, []);\r\n\r\n    // Auto-refresh: Sync local state when vendor data updates (e.g. after save)\r\n    useEffect(() => {\r\n        if (vendor.inventory && plants.length > 0) {\r\n            const serverState: Record<string, { price: string, quantity: string, inStock: boolean }> = {};\r\n            vendor.inventory.forEach(item => {\r\n                serverState[item.plantId] = {\r\n                    price: item.price.toString(),\r\n                    quantity: ((item as any).quantity || 0).toString(),\r\n                    inStock: item.inStock\r\n                };\r\n            });\r\n            // Merge with existing to keep unsaved input, but overwrite saved ones\r\n            setEditValues(prev => ({ ...prev, ...serverState }));\r\n        }\r\n    }, [vendor, plants]);\r\n\r\n    const loadPlants = async () => {\r\n        try {\r\n            const data = await fetchPlants();\r\n            setPlants(data);\r\n\r\n            // Initialize edit values from existing inventory\r\n            const initialEdits: Record<string, { price: string, quantity: string, inStock: boolean }> = {};\r\n            if (vendor.inventory) {\r\n                vendor.inventory.forEach(item => {\r\n                    initialEdits[item.plantId] = {\r\n                        price: item.price.toString(),\r\n                        quantity: ((item as any).quantity || 0).toString(),\r\n                        inStock: item.inStock\r\n                    };\r\n                });\r\n            }\r\n            setEditValues(initialEdits);\r\n        } catch (err) {\r\n            console.error(err);\r\n            toast.error(\"Failed to load plant catalog\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleFieldChange = (plantId: string, field: 'price' | 'quantity', val: string) => {\r\n        setEditValues(prev => ({\r\n            ...prev,\r\n            [plantId]: {\r\n                ...prev[plantId],\r\n                [field]: val,\r\n                inStock: prev[plantId]?.inStock ?? true\r\n            }\r\n        }));\r\n    };\r\n\r\n    const toggleStock = (plantId: string) => {\r\n        setEditValues(prev => ({\r\n            ...prev,\r\n            [plantId]: { ...prev[plantId], inStock: !prev[plantId]?.inStock }\r\n        }));\r\n    };\r\n\r\n    const handleSaveItem = async (plant: Plant) => {\r\n        const edits = editValues[plant.id];\r\n        if (!edits || !edits.price) {\r\n            toast.error(\"Please set a valid price\");\r\n            return;\r\n        }\r\n\r\n        const newPrice = parseFloat(edits.price);\r\n        const newQty = parseInt(edits.quantity || '0');\r\n\r\n        if (isNaN(newPrice) || newPrice <= 0) {\r\n            toast.error(\"Invalid price entered\");\r\n            return;\r\n        }\r\n\r\n        // Prepare new inventory array\r\n        const currentInventory = vendor.inventory || [];\r\n        const existingIndex = currentInventory.findIndex(i => i.plantId === plant.id);\r\n\r\n        let newInventory = [...currentInventory];\r\n        const newItem = {\r\n            plantId: plant.id,\r\n            price: newPrice,\r\n            quantity: newQty,\r\n            status: 'approved' as const,\r\n            inStock: edits.inStock\r\n        };\r\n\r\n        if (existingIndex >= 0) {\r\n            newInventory[existingIndex] = newItem;\r\n        } else {\r\n            newInventory.push(newItem);\r\n        }\r\n\r\n        const tid = toast.loading(\"Securely saving...\");\r\n        try {\r\n            const success = await updateVendor(vendor.id, { inventory: newInventory });\r\n            if (success) {\r\n                onUpdate();\r\n                // FORCE REFRESH LOGIC\r\n                sessionStorage.setItem('vendor_restore', JSON.stringify({\r\n                    query: searchQuery,\r\n                    scroll: window.scrollY\r\n                }));\r\n                window.location.reload();\r\n            } else {\r\n                throw new Error(\"Update failed\");\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Failed to update inventory\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleRemoveItem = async (plantId: string) => {\r\n        if (!confirm(\"Remove this plant from your inventory?\")) return;\r\n\r\n        const currentInventory = vendor.inventory || [];\r\n        const newInventory = currentInventory.filter(i => i.plantId !== plantId);\r\n\r\n        const tid = toast.loading(\"Removing...\");\r\n        try {\r\n            const success = await updateVendor(vendor.id, { inventory: newInventory });\r\n            if (success) {\r\n                onUpdate();\r\n                sessionStorage.setItem('vendor_restore', JSON.stringify({\r\n                    query: searchQuery,\r\n                    scroll: window.scrollY\r\n                }));\r\n                window.location.reload();\r\n            } else {\r\n                throw new Error(\"Update failed\");\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Failed to remove item\", { id: tid });\r\n        }\r\n    };\r\n\r\n\r\n    const filteredPlants = plants.filter(p =>\r\n        p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        p.scientificName.toLowerCase().includes(searchQuery.toLowerCase())\r\n    );\r\n\r\n    const getInventoryItem = (plantId: string) => {\r\n        return vendor.inventory?.find(i => i.plantId === plantId);\r\n    };\r\n\r\n    if (!vendor.verified) {\r\n        return (\r\n            <div className={styles.container} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', minHeight: '400px', textAlign: 'center' }}>\r\n                <div style={{ background: 'rgba(234, 179, 8, 0.1)', padding: '3rem', borderRadius: '1rem', border: '1px dashed rgba(234, 179, 8, 0.3)' }}>\r\n                    <AlertCircle size={48} color=\"#facc15\" style={{ margin: '0 auto 1.5rem' }} />\r\n                    <h2 style={{ fontSize: '1.5rem', fontWeight: 700, color: '#facc15', marginBottom: '1rem' }}>Account Verification Pending</h2>\r\n                    <p style={{ color: '#94a3b8', maxWidth: '400px', lineHeight: '1.6' }}>\r\n                        Your partner account is currently being reviewed by our administration team.\r\n                        <br /><br />\r\n                        Pricing and inventory controls will be unlocked as soon as your profile is verified by an admin.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.titleGroup}>\r\n                    <h2 className={styles.title}>\r\n                        <Package className=\"text-emerald-400\" /> Inventory & Pricing\r\n                    </h2>\r\n                    <p className={styles.subtitle}>\r\n                        Manage your catalog and pricing.\r\n                    </p>\r\n                </div>\r\n                <div className={styles.searchWrapper}>\r\n                    <Search className={styles.searchIcon} size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search species...\"\r\n                        value={searchQuery}\r\n                        onChange={e => setSearchQuery(e.target.value)}\r\n                        className={styles.searchInput}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className=\"p-12 text-center text-slate-500 animate-pulse\">Loading catalog...</div>\r\n            ) : (\r\n                <div className={styles.grid}>\r\n                    {filteredPlants.map(plant => {\r\n                        const invItem = getInventoryItem(plant.id);\r\n                        const editState = editValues[plant.id] || { price: '', inStock: true };\r\n                        const isPending = invItem?.status === 'pending';\r\n\r\n                        return (\r\n                            <div key={plant.id} className={styles.card}>\r\n                                <div className={styles.imageWrapper}>\r\n                                    <img src={plant.imageUrl} className={styles.image} alt={plant.name} />\r\n                                    {invItem && (\r\n                                        <div className={`${styles.statusBadge} ${isPending ? styles.statusPending : styles.statusLive}`}>\r\n                                            {isPending ? <AlertCircle size={10} /> : <CheckCircle size={10} />}\r\n                                            {isPending ? 'Pending' : 'Live'}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <div className={styles.cardContent}>\r\n                                    <h3 className={styles.plantName}>{plant.name}</h3>\r\n                                    <p className={styles.scientificName}>{plant.scientificName}</p>\r\n\r\n                                    <div className={styles.controls}>\r\n                                        <div className={styles.guidelineRow}>\r\n                                            <span>Market Guideline:</span>\r\n                                            <span className={styles.guidelineValue}>{formatCurrency(plant.price)}</span>\r\n                                        </div>\r\n\r\n                                        <div className={styles.inputGroup}>\r\n                                            <div className={styles.priceInputWrapper}>\r\n                                                <DollarSign size={14} className={styles.currencySymbol} />\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    placeholder=\"Price\"\r\n                                                    value={editState.price}\r\n                                                    onChange={e => handleFieldChange(plant.id, 'price', e.target.value)}\r\n                                                    className={styles.priceInput}\r\n                                                />\r\n                                            </div>\r\n                                            <div className={styles.priceInputWrapper} style={{ width: '80px', marginLeft: '0.5rem' }}>\r\n                                                <span style={{ fontSize: '0.7rem', color: '#64748b', paddingLeft: '8px' }}>Qty:</span>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    placeholder=\"Qty\"\r\n                                                    value={editState.quantity}\r\n                                                    onChange={e => handleFieldChange(plant.id, 'quantity', e.target.value)}\r\n                                                    className={styles.priceInput}\r\n                                                    style={{ paddingLeft: '4px' }}\r\n                                                />\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={() => handleSaveItem(plant)}\r\n                                                className={styles.saveBtn}\r\n                                                title=\"Save Price\"\r\n                                            >\r\n                                                <Save size={18} />\r\n                                            </button>\r\n                                            {invItem && (\r\n                                                <button\r\n                                                    onClick={() => handleRemoveItem(plant.id)}\r\n                                                    className={styles.deleteBtn}\r\n                                                    title=\"Remove from Inventory\"\r\n                                                    style={{ marginLeft: '0.5rem', padding: '0.5rem', borderRadius: '8px', background: 'rgba(239, 68, 68, 0.1)', color: '#ef4444', border: 'none', cursor: 'pointer' }}\r\n                                                >\r\n                                                    <Trash2 size={18} />\r\n                                                </button>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        {invItem && (\r\n                                            <div className={styles.stockToggle}>\r\n                                                <label className={styles.switch}>\r\n                                                    <input\r\n                                                        type=\"checkbox\"\r\n                                                        checked={editState.inStock}\r\n                                                        onChange={() => toggleStock(plant.id)}\r\n                                                    />\r\n                                                    <span className={styles.slider}></span>\r\n                                                </label>\r\n                                                <span className={styles.stockLabel}>\r\n                                                    {editState.inStock ? 'In Stock' : 'Out of Stock'}\r\n                                                </span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\AnimatedRoutes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\MobileBottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\MobileTabBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\Navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\components\\layout\\SwipeNavigator.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'tabs'. Either include it or remove the dependency array.","line":96,"column":8,"nodeType":"ArrayExpression","endLine":96,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [navigate, tabs]","fix":{"range":[4249,4259],"text":"[navigate, tabs]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport const SwipeNavigator = () => {\r\n    const navigate = useNavigate();\r\n\r\n    // Use Refs to maintain mutable state without triggering re-renders or stale closures in listeners\r\n    const touchStartX = useRef<number | null>(null);\r\n    const touchStartY = useRef<number | null>(null);\r\n    const touchEndX = useRef<number | null>(null);\r\n    const touchEndY = useRef<number | null>(null);\r\n\r\n    // Navigation Order (Matches MobileTabBar)\r\n    const tabs = ['/', '/nearby', '/shops', '/contact', '/cart'];\r\n    const minSwipeDistance = 70; // px\r\n\r\n    useEffect(() => {\r\n        const handleTouchStart = (e: TouchEvent) => {\r\n            touchEndX.current = null;\r\n            touchEndY.current = null;\r\n            touchStartX.current = e.targetTouches[0].clientX;\r\n            touchStartY.current = e.targetTouches[0].clientY;\r\n        };\r\n\r\n        const handleTouchMove = (e: TouchEvent) => {\r\n            touchEndX.current = e.targetTouches[0].clientX;\r\n            touchEndY.current = e.targetTouches[0].clientY;\r\n        };\r\n\r\n        const handleTouchEnd = (e: TouchEvent) => {\r\n            if (touchStartX.current === null || touchEndX.current === null) return;\r\n\r\n            const startX = touchStartX.current;\r\n            const endX = touchEndX.current;\r\n            const startY = touchStartY.current || 0;\r\n            const endY = touchEndY.current || 0;\r\n\r\n            const distanceX = startX - endX;\r\n            const distanceY = startY - endY;\r\n\r\n            // 1. Dominant Axis Check (Must be horizontal swipe)\r\n            if (Math.abs(distanceY) > Math.abs(distanceX)) return;\r\n\r\n            // 2. Minimum Distance Check\r\n            if (Math.abs(distanceX) < minSwipeDistance) return;\r\n\r\n            // 3. Conflict Check (Leaflet Map or No-Swipe zones)\r\n            const target = e.target as HTMLElement;\r\n            if (target.closest('.leaflet-container')) return;\r\n            if (target.closest('.no-swipe')) return;\r\n            // Also ignore sliders if we had them (e.g. .overflow-x-scroll)\r\n            // Ideally check if target is scrollable horizontally? \r\n            // For now, strict Map check is critical.\r\n\r\n            const isLeftSwipe = distanceX > 0; // Swipe Left -> Next\r\n            const isRightSwipe = distanceX < 0; // Swipe Right -> Prev\r\n\r\n            // Get current path (use latest location from closure if this effect re-runs, \r\n            // OR use a generic look up if the effect is mounted once. \r\n            // Location changes re-run this effect, so `location.pathname` is fresh.)\r\n\r\n            // Wait, if I bind once, `location.pathname` is stale.\r\n            // I should emit a custom event or navigate based on valid stable check?\r\n            // Actually, if I include `location.pathname` in dependency, it re-binds.\r\n            // Re-binding on route change (navigation) is perfectly fine.\r\n\r\n            // We need to find the index *inside* the event handler, using fresh location?\r\n            // Since this effect depends on location.pathname, the closure *will* have the fresh pathname.\r\n\r\n            const currentPath = window.location.pathname; // Always fresh\r\n            const currentIndex = tabs.findIndex(path => path === currentPath);\r\n\r\n            if (currentIndex === -1) return;\r\n\r\n            if (isLeftSwipe) {\r\n                if (currentIndex < tabs.length - 1) {\r\n                    navigate(tabs[currentIndex + 1]);\r\n                }\r\n            } else if (isRightSwipe) {\r\n                if (currentIndex > 0) {\r\n                    navigate(tabs[currentIndex - 1]);\r\n                }\r\n            }\r\n        };\r\n\r\n        // Attach listeners\r\n        document.addEventListener('touchstart', handleTouchStart, { passive: true });\r\n        document.addEventListener('touchmove', handleTouchMove, { passive: true });\r\n        document.addEventListener('touchend', handleTouchEnd);\r\n\r\n        return () => {\r\n            document.removeEventListener('touchstart', handleTouchStart);\r\n            document.removeEventListener('touchmove', handleTouchMove);\r\n            document.removeEventListener('touchend', handleTouchEnd);\r\n        };\r\n    }, [navigate]); // navigate is stable. location.pathname is handled by window.location check.\r\n\r\n    return null;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\context\\AuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[765,768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[765,768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1703,1706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1703,1706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3659,3662],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3659,3662],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4496,4499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4496,4499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5315,5318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5315,5318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5490,5493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5490,5493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":204,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":204,"endColumn":27},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":221,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":221,"endColumn":21}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, type ReactNode, useEffect } from 'react';\r\nimport type { User } from '../types';\r\nimport { jwtDecode } from \"jwt-decode\";\r\n\r\ninterface LoginCredentials {\r\n    email: string;\r\n    password: string;\r\n}\r\n\r\ninterface SignupData {\r\n    email: string;\r\n    phone?: string;\r\n    password: string;\r\n    name: string;\r\n    role?: string;\r\n    city?: string;\r\n    state?: string;\r\n    country?: string;\r\n}\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    signup: (data: SignupData) => Promise<{ success: boolean; message?: string; registrationToken?: string; captchaSvg?: string }>;\r\n    login: (credentials: LoginCredentials) => Promise<{ success: boolean; message?: string }>;\r\n    googleLogin: (credentialResponse: any) => Promise<boolean>;\r\n    logout: () => void;\r\n    verify: (registrationToken: string, otp: string) => Promise<{ success: boolean; message?: string }>;\r\n    toggleFavorite: (plantId: string) => void;\r\n    updateUser: (updates: Partial<User>) => void;\r\n    loading: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n\r\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Load from local storage on mount\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem('user');\r\n        if (saved) {\r\n            try {\r\n                const parsed = JSON.parse(saved);\r\n\r\n                // Normalizing legacy vs current structures\r\n                let userData: any = null;\r\n\r\n                if (parsed.user && typeof parsed.user === 'object') {\r\n                    // Legacy structure: { user: {...}, token: \"...\" }\r\n                    userData = { ...parsed.user, token: parsed.token || parsed.user.token };\r\n                } else {\r\n                    // Current flat structure: { ..., token: \"...\" }\r\n                    userData = parsed;\r\n                }\r\n\r\n                // Strictly validate role and name to prevent poisoned state\r\n                if (userData && userData.role && userData.name) {\r\n                    // Ensure crucial arrays exist\r\n                    userData.favorites = Array.isArray(userData.favorites) ? userData.favorites : [];\r\n                    userData.cart = Array.isArray(userData.cart) ? userData.cart : [];\r\n                    setUser(userData);\r\n                } else {\r\n                    console.warn(\"Invalid user session detected, purging local storage.\");\r\n                    localStorage.removeItem('user');\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Local storage corruption\", e);\r\n                localStorage.removeItem('user');\r\n            }\r\n        }\r\n        setLoading(false);\r\n    }, []);\r\n\r\n    const login = async (credentials: LoginCredentials) => {\r\n        try {\r\n            const res = await fetch(`${API_URL}/auth/login`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(credentials)\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.error || 'Login failed');\r\n\r\n            // data.user is already normalized by backend\r\n            const userData = { ...data.user, token: data.token };\r\n\r\n            setUser(userData);\r\n            localStorage.setItem('user', JSON.stringify(userData));\r\n            return { success: true };\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            return { success: false, message: err.message };\r\n        }\r\n    };\r\n\r\n    const signup = async (userData: SignupData) => {\r\n        try {\r\n            const res = await fetch(`${API_URL}/auth/signup`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(userData)\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.error || 'Signup failed');\r\n\r\n            // Returning the session token and captcha\r\n            return {\r\n                success: true,\r\n                message: data.message,\r\n                registrationToken: data.registrationToken,\r\n                captchaSvg: data.captchaSvg\r\n            };\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            return { success: false, message: err.message };\r\n        }\r\n    };\r\n\r\n    const verify = async (registrationToken: string, otp: string) => {\r\n        try {\r\n            const res = await fetch(`${API_URL}/auth/verify-otp`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ registrationToken, otp })\r\n            });\r\n\r\n            const data = await res.json();\r\n            if (!res.ok) throw new Error(data.error || 'Verification failed');\r\n\r\n            const fullUser = { ...data.user, token: data.token };\r\n            setUser(fullUser);\r\n            localStorage.setItem('user', JSON.stringify(fullUser));\r\n            return { success: true };\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            return { success: false, message: err.message };\r\n        }\r\n    };\r\n\r\n    const googleLogin = async (credentialResponse: any) => {\r\n        try {\r\n            if (!credentialResponse.credential) return false;\r\n            const decoded = jwtDecode(credentialResponse.credential) as { name: string; email: string };\r\n\r\n            const res = await fetch(`${API_URL}/auth/google-sync`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ email: decoded.email, name: decoded.name })\r\n            });\r\n\r\n            if (!res.ok) throw new Error(\"Google sync failed\");\r\n            const data = await res.json();\r\n            const fullUser = { ...data.user, token: data.token };\r\n\r\n            setUser(fullUser);\r\n            localStorage.setItem('user', JSON.stringify(fullUser));\r\n            return true;\r\n        } catch (error) {\r\n            console.error(\"Google Login Error:\", error);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    const logout = () => {\r\n        setUser(null);\r\n        localStorage.removeItem('user');\r\n        window.location.href = '/';\r\n    };\r\n\r\n    const toggleFavorite = async (plantId: string) => {\r\n        if (!user) return;\r\n        const isFav = user.favorites?.includes(plantId);\r\n        const newFavorites = isFav\r\n            ? user.favorites.filter(id => id !== plantId)\r\n            : [...(user.favorites || []), plantId];\r\n\r\n        updateUser({ favorites: newFavorites });\r\n\r\n        try {\r\n            const { toggleFavorite } = await import('../services/api');\r\n            await toggleFavorite(plantId);\r\n        } catch (e) {\r\n            console.error(\"Failed to sync favorites\", e);\r\n        }\r\n    };\r\n\r\n    const updateUser = (updates: Partial<User>) => {\r\n        setUser(prev => {\r\n            if (!prev) return null;\r\n            const updated = { ...prev, ...updates };\r\n            // Flatten if legacy structure exists in localStorage to prevent corruption\r\n            const saved = localStorage.getItem('user');\r\n            if (saved) {\r\n                try {\r\n                    const parsed = JSON.parse(saved);\r\n                    const base = parsed.user ? { ...parsed.user, token: parsed.token } : parsed;\r\n                    const final = { ...base, ...updates };\r\n                    localStorage.setItem('user', JSON.stringify(final));\r\n                } catch (e) {\r\n                    localStorage.setItem('user', JSON.stringify(updated));\r\n                }\r\n            } else {\r\n                localStorage.setItem('user', JSON.stringify(updated));\r\n            }\r\n            return updated;\r\n        });\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, login, signup, googleLogin, logout, verify, toggleFavorite, updateUser, loading }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) throw new Error('useAuth must be used within an AuthProvider');\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\context\\CartContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2270,2273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2270,2273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2288,2291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2288,2291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3848,3851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3848,3851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":174,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":174,"endColumn":21}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useState, useEffect, type ReactNode } from 'react';\r\nimport type { Plant, CartItem } from '../types';\r\nimport { useAuth } from './AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\ninterface RawCartItem {\r\n    plantId?: string;\r\n    _id?: string;\r\n    quantity: number;\r\n    plant?: Plant;\r\n}\r\n\r\ninterface CartContextType {\r\n    items: CartItem[];\r\n    addToCart: (plant: Plant, vendorId?: string, price?: number) => void;\r\n    removeFromCart: (plantId: string, vendorId?: string) => void;\r\n    removeItems: (itemsToRemove: { plantId: string, vendorId?: string }[]) => void;\r\n    updateQuantity: (plantId: string, quantity: number, vendorId?: string) => void;\r\n}\r\n\r\nconst CartContext = createContext<CartContextType | undefined>(undefined);\r\n\r\nexport const CartProvider = ({ children }: { children: ReactNode }) => {\r\n    const { user, updateUser } = useAuth();\r\n\r\n    // Initial load from localStorage (either from user or guest_cart)\r\n    const [items, setItems] = useState<CartItem[]>(() => {\r\n        const savedUser = localStorage.getItem('user');\r\n        if (savedUser) {\r\n            const parsed = JSON.parse(savedUser);\r\n            if (parsed.cart) {\r\n                // Prevent crash: Only use cached cart if it contains full plant objects.\r\n                if (parsed.cart.length > 0 && !parsed.cart[0].plant) {\r\n                    return [];\r\n                }\r\n                return parsed.cart;\r\n            }\r\n        }\r\n        const guestCart = localStorage.getItem('guest_cart');\r\n        if (guestCart) return JSON.parse(guestCart);\r\n        return [];\r\n    });\r\n\r\n    // Sync local cart with user's DB cart on login\r\n    useEffect(() => {\r\n        const hydrateCart = async () => {\r\n            if (user && user.cart && user.cart.length > 0) {\r\n                const firstItem = user.cart[0] as unknown as RawCartItem;\r\n                const needsHydration = !firstItem.plant && (firstItem.plantId || firstItem._id);\r\n\r\n                if (needsHydration) {\r\n                    try {\r\n                        const { fetchPlants } = await import('../services/api');\r\n                        const allPlants = await fetchPlants();\r\n\r\n                        const hydratedItems: CartItem[] = (user.cart as any[]).map((item: any) => {\r\n                            const raw = item as RawCartItem;\r\n                            const targetId = raw.plantId || raw._id;\r\n                            const fullPlant = allPlants.find(p => p.id === targetId);\r\n                            if (fullPlant) {\r\n                                return {\r\n                                    plant: fullPlant,\r\n                                    quantity: item.quantity || 1,\r\n                                    vendorId: item.vendorId,\r\n                                    vendorPrice: item.vendorPrice\r\n                                } as CartItem;\r\n                            }\r\n                            return null;\r\n                        }).filter((i): i is CartItem => i !== null);\r\n\r\n                        setItems(hydratedItems);\r\n                    } catch (err) {\r\n                        console.error(\"Failed to hydrate cart\", err);\r\n                    }\r\n                } else {\r\n                    setItems(user.cart as unknown as CartItem[]);\r\n                }\r\n            } else if (user && (!user.cart || user.cart.length === 0)) {\r\n                setItems([]);\r\n            }\r\n        };\r\n\r\n        hydrateCart();\r\n    }, [user]);\r\n\r\n    const persistCart = (newItems: CartItem[]) => {\r\n        const cartPayload = newItems.map(i => ({\r\n            plantId: i.plant.id,\r\n            quantity: i.quantity,\r\n            vendorId: i.vendorId,\r\n            vendorPrice: i.vendorPrice\r\n        }));\r\n        if (user) {\r\n            updateUser({ cart: cartPayload as any });\r\n            import('../services/api').then(({ syncCart }) => syncCart(cartPayload));\r\n        } else {\r\n            localStorage.setItem('guest_cart', JSON.stringify(newItems));\r\n        }\r\n    };\r\n\r\n    const addToCart = (plant: Plant, vendorId?: string, price?: number) => {\r\n        setItems(prev => {\r\n            // Check for existing item with same plant AND same vendor\r\n            const existing = prev.find(i => i.plant.id === plant.id && i.vendorId === vendorId);\r\n            let newItems: CartItem[];\r\n\r\n            if (existing) {\r\n                newItems = prev.map(i =>\r\n                    (i.plant.id === plant.id && i.vendorId === vendorId)\r\n                        ? { ...i, quantity: i.quantity + 1 }\r\n                        : i\r\n                );\r\n            } else {\r\n                newItems = [...prev, {\r\n                    plant,\r\n                    quantity: 1,\r\n                    vendorId,\r\n                    vendorPrice: price\r\n                }];\r\n            }\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n        toast.success(`${plant.name} added to cart!`);\r\n    };\r\n\r\n    const updateQuantity = (plantId: string, quantity: number, vendorId?: string) => {\r\n        setItems(prev => {\r\n            let newItems;\r\n            if (quantity <= 0) {\r\n                newItems = prev.filter(i => !(i.plant.id === plantId && i.vendorId === vendorId));\r\n            } else {\r\n                newItems = prev.map(i =>\r\n                    (i.plant.id === plantId && i.vendorId === vendorId)\r\n                        ? { ...i, quantity }\r\n                        : i\r\n                );\r\n            }\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n    };\r\n\r\n    const removeFromCart = (plantId: string, vendorId?: string) => {\r\n        setItems(prev => {\r\n            // Remove specific item matching plantId and vendorId (if provided)\r\n            // If vendorId is undefined, it removes generic entries (or all matching plantId? usually specialized logic needed)\r\n            // For now, assume exact match needed\r\n            const newItems = prev.filter(i => !(i.plant.id === plantId && i.vendorId === vendorId));\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n        toast.success(`Item removed`);\r\n    };\r\n\r\n    const removeItems = (itemsToRemove: { plantId: string, vendorId?: string }[]) => {\r\n        setItems(prev => {\r\n            const newItems = prev.filter(i =>\r\n                !itemsToRemove.some(r => r.plantId === i.plant.id && r.vendorId === i.vendorId)\r\n            );\r\n            persistCart(newItems);\r\n            return newItems;\r\n        });\r\n        toast.success(`Items removed from cart`);\r\n    };\r\n\r\n    return (\r\n        <CartContext.Provider value={{ items, addToCart, removeFromCart, removeItems, updateQuantity }}>\r\n            {children}\r\n        </CartContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useCart = () => {\r\n    const context = useContext(CartContext);\r\n    if (!context) throw new Error('useCart must be used within a CartProvider');\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\context\\ThemeContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":34,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":34,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createContext, useContext, useEffect, useState, type ReactNode } from 'react';\r\n\r\ntype Theme = 'dark' | 'light';\r\n\r\ninterface ThemeContextType {\r\n    theme: Theme;\r\n    toggleTheme: () => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport const ThemeProvider = ({ children }: { children: ReactNode }) => {\r\n    const [theme, setTheme] = useState<Theme>(() => {\r\n        const saved = localStorage.getItem('theme');\r\n        return (saved as Theme) || 'dark';\r\n    });\r\n\r\n    useEffect(() => {\r\n        document.documentElement.setAttribute('data-theme', theme);\r\n        localStorage.setItem('theme', theme);\r\n    }, [theme]);\r\n\r\n    const toggleTheme = () => {\r\n        setTheme(prev => prev === 'dark' ? 'light' : 'dark');\r\n    };\r\n\r\n    return (\r\n        <ThemeContext.Provider value={{ theme, toggleTheme }}>\r\n            {children}\r\n        </ThemeContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useTheme = () => {\r\n    const context = useContext(ThemeContext);\r\n    if (!context) throw new Error('useTheme must be used within a ThemeProvider');\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\countryCodes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\indianPlants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\mocks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\states.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\data\\worldFlora.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\About.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Admin.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Admin.tsx:41:13\n  39 |     useEffect(() => {\n  40 |         if (!authLoading && user?.role === 'admin') {\n> 41 |             loadData();\n     |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  42 |         }\n  43 |     }, [user, loadData, authLoading]);\n  44 |","line":41,"column":13,"nodeType":null,"endLine":41,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n    fetchVendors, fetchPlants, fetchUsers\r\n} from '../services/api';\r\nimport {\r\n    Activity, Users, Sprout, MapPin,\r\n    ArrowUpRight, Zap\r\n} from 'lucide-react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { AdminLayout } from './admin/AdminLayout';\r\nimport styles from './Admin.module.css';\r\n\r\nexport const Admin = () => {\r\n    const { user, loading: authLoading } = useAuth();\r\n    const [stats, setStats] = useState({ plants: 0, users: 0, vendors: 0 });\r\n\r\n    const loadData = useCallback(async () => {\r\n        try {\r\n            const [vendors, plants, users] = await Promise.all([fetchVendors(), fetchPlants(), fetchUsers()]);\r\n            setStats({\r\n                vendors: vendors.length,\r\n                plants: plants.length,\r\n                users: users.length\r\n            });\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    }, []);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        if (!authLoading && (!user || user.role !== 'admin')) {\r\n            navigate('/auth', { replace: true });\r\n        }\r\n    }, [user, authLoading, navigate]);\r\n\r\n    useEffect(() => {\r\n        if (!authLoading && user?.role === 'admin') {\r\n            loadData();\r\n        }\r\n    }, [user, loadData, authLoading]);\r\n\r\n    if (authLoading || !user || user.role !== 'admin') {\r\n        return (\r\n            <div style={{ height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center', background: '#0f172a' }}>\r\n                <div className=\"pre-loader-pulse\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <AdminLayout title=\"System Overview\">\r\n            <div style={{ maxWidth: '1100px', margin: '0 auto' }}>\r\n                <div className={styles.dashboardGrid}>\r\n                    {/* STAT CARDS */}\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Total Users</span>\r\n                            <Users size={20} className=\"text-indigo-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>{stats.users}</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={styles.trendUp}><ArrowUpRight size={14} /> Live</span> Count\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Active Plants</span>\r\n                            <Sprout size={20} className=\"text-emerald-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>{stats.plants}</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={styles.trendUp}><ArrowUpRight size={14} /> Catalog</span> Size\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Partners</span>\r\n                            <MapPin size={20} className=\"text-amber-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>{stats.vendors}</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={styles.trendNeutral}><ArrowUpRight size={14} /> Network</span> Reach\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={`${styles.card} ${styles.cardStat}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>System Load</span>\r\n                            <Zap size={20} className=\"text-blue-400\" />\r\n                        </div>\r\n                        <div className={styles.cardValue}>4%</div>\r\n                        <div className={styles.cardTrend}>\r\n                            <span className={`${styles.trendUp} text-emerald-500`}>Optimal</span> performance\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* CENTRAL MONITOR */}\r\n                    <div className={`${styles.card} ${styles.cardLarge}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>System Pulse</span>\r\n                            <Activity size={20} className=\"text-rose-500\" />\r\n                        </div>\r\n                        <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column', gap: '1rem', opacity: 0.5 }}>\r\n                            <Activity size={48} className=\"animate-pulse\" />\r\n                            <div className=\"text-center\">\r\n                                <h3 className=\"text-white font-bold\">Real-time monitoring active</h3>\r\n                                <p className=\"text-xs text-slate-400 max-w-xs\">Connecting to secure stream... metrics will populate shortly.</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* SERVER STATUS */}\r\n                    <div className={`${styles.card} ${styles.cardTall}`}>\r\n                        <div className={styles.cardHeader}>\r\n                            <span className={styles.cardTitle}>Server Nodes</span>\r\n                        </div>\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            {[\r\n                                { name: 'US-EAST-1', status: 'Online', color: '#10b981' },\r\n                                { name: 'EU-WEST-2', status: 'Online', color: '#10b981' },\r\n                                { name: 'AP-SOUTH-1', status: 'Healthy', color: '#10b981' },\r\n                                { name: 'REPLICA-01', status: 'Syncing', color: '#3b82f6' }\r\n                            ].map(node => (\r\n                                <div key={node.name} style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: 'rgba(255,255,255,0.02)', borderRadius: '0.75rem', fontSize: '0.8rem' }}>\r\n                                    <span className=\"font-bold\">{node.name}</span>\r\n                                    <span style={{ color: node.color }}>{node.status}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n\r\nexport default Admin;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Auth.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'selectedCountry'. Either include it or remove the dependency array.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [selectedCountry]","fix":{"range":[2008,2010],"text":"[selectedCountry]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":94,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5444,5447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5444,5447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8712,8715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8712,8715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":216,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":216,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":235,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10079,10082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10079,10082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { Button } from '../components/common/Button';\r\nimport { User, ArrowLeft, Store, Eye, EyeOff } from 'lucide-react';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { Country, State, type ICountry, type IState } from 'country-state-city';\r\nimport { toast } from 'react-hot-toast';\r\nimport styles from './Auth.module.css';\r\n\r\nexport const Auth = () => {\r\n    const navigate = useNavigate();\r\n    const [searchParams] = useSearchParams();\r\n    const { login, signup, user, verify } = useAuth();\r\n\r\n    type AuthView = 'login' | 'signup' | 'forgot' | 'reset' | 'verify';\r\n\r\n    // Parse URL params\r\n    const initialView = searchParams.get('view') as AuthView || 'login';\r\n    const initialRole = searchParams.get('role') as 'user' | 'vendor' || 'user';\r\n\r\n    const [view, setView] = useState<AuthView>(initialView);\r\n\r\n    // Form States\r\n    const [role, setRole] = useState<'user' | 'vendor'>(initialRole);\r\n    const [email, setEmail] = useState('');\r\n    const [phone, setPhone] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [name, setName] = useState('');\r\n\r\n    // Vendor Specific\r\n    const [selectedCountry, setSelectedCountry] = useState<ICountry | null>(null);\r\n    const [selectedState, setSelectedState] = useState<IState | null>(null);\r\n\r\n    // Derived values for API\r\n    const [country, setCountry] = useState('India'); // defaulting to India if needed, but updated by selection\r\n    const [state, setState] = useState('');\r\n    const [city, setCity] = useState('');\r\n    const [phoneCode, setPhoneCode] = useState('91');\r\n\r\n    // Load initial country (India) if desired\r\n    useEffect(() => {\r\n        const india = Country.getCountryByCode('IN');\r\n        if (india && !selectedCountry) {\r\n            setSelectedCountry(india);\r\n            setCountry(india.name);\r\n            setPhoneCode(india.phonecode);\r\n        }\r\n    }, []);\r\n\r\n    // Handle country change\r\n    const handleCountryChange = (isoCode: string) => {\r\n        const c = Country.getCountryByCode(isoCode);\r\n        if (c) {\r\n            setSelectedCountry(c);\r\n            setCountry(c.name);\r\n            setPhoneCode(c.phonecode);\r\n            setSelectedState(null);\r\n            setState('');\r\n        }\r\n    };\r\n\r\n    // Handle state change\r\n    const handleStateChange = (isoCode: string) => {\r\n        if (!selectedCountry) return;\r\n        const s = State.getStateByCodeAndCountry(isoCode, selectedCountry.isoCode);\r\n        if (s) {\r\n            setSelectedState(s);\r\n            setState(s.name);\r\n        }\r\n    };\r\n\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n\r\n            if (user.role === 'admin') {\r\n                localStorage.setItem('adminAuthenticated', 'true');\r\n                navigate('/admin', { replace: true });\r\n            } else if (user.role === 'vendor') {\r\n                navigate('/vendor', { replace: true });\r\n            } else {\r\n                navigate('/dashboard', { replace: true });\r\n            }\r\n        }\r\n    }, [user, navigate]);\r\n\r\n    const handleNudge = async () => {\r\n        if (!email) { toast.error(\"Please enter your email address first\"); return; }\r\n        const tid = toast.loading(\"Signaling Admin...\");\r\n        try {\r\n            const api = await import('../services/api');\r\n            await api.nudgeAdmin(email);\r\n            toast.success(\"Admin will change the password to 123456 for this email shortly. Please try after 1hr.\", { id: tid, duration: 6000 });\r\n        } catch (e) { toast.error(\"Failed to signal admin\", { id: tid }); }\r\n    };\r\n\r\n    const [showPassword, setShowPassword] = useState(false);\r\n    const [isEmailChecked, setIsEmailChecked] = useState(false);\r\n    const [emailLoading, setEmailLoading] = useState(false);\r\n    const [emailVerifiedResult, setEmailVerifiedResult] = useState<{ name: string, role: string } | null>(null);\r\n\r\n    // Password Validation\r\n    const validatePassword = (pass: string) => {\r\n        const minLen = 4;\r\n        const maxLen = 18;\r\n        const hasUpper = /[A-Z]/.test(pass);\r\n        const hasNumber = /[0-9]/.test(pass);\r\n        const hasSpecial = /[@#$%]/.test(pass);\r\n\r\n        if (pass.length < minLen || pass.length > maxLen) return \"Password must be 4-18 characters.\";\r\n        if (!hasUpper) return \"At least one capital letter required.\";\r\n        if (!hasNumber) return \"At least one number required.\";\r\n        if (!hasSpecial) return \"At least one special character (@,#,$,%) required.\";\r\n        return null; // OK\r\n    };\r\n\r\n    const handleEmailCheck = async () => {\r\n        if (!email) { toast.error(\"Please enter email or phone first\"); return; }\r\n\r\n        // Immediate bypass for Master Admin\r\n        if (email.trim().toLowerCase() === 'admin@plantai.com') {\r\n            setEmailVerifiedResult({ name: 'Master Admin', role: 'admin' });\r\n            setIsEmailChecked(true);\r\n            return;\r\n        }\r\n\r\n        setEmailLoading(true);\r\n        try {\r\n            const api = await import('../services/api');\r\n            const res = await api.checkEmail(email);\r\n            if (res.success && res.verified) {\r\n                toast.success(`Verified account found: ${res.name}`);\r\n                setEmailVerifiedResult({ name: res.name, role: res.role });\r\n                setIsEmailChecked(true);\r\n            }\r\n        } catch (err: any) {\r\n            toast.error(err.message || \"Account not found or not verified.\");\r\n            // If account found but not verified, we can offer to resent OTP?\r\n            if (err.message && err.message.includes(\"not yet verified\")) {\r\n                toast(\"Please sign up again or verify your account using the captcha.\", { icon: 'ðŸ›¡ï¸' });\r\n            }\r\n        } finally {\r\n            setEmailLoading(false);\r\n        }\r\n    };\r\n\r\n    const [otp, setOtp] = useState('');\r\n    const [captchaSvg, setCaptchaSvg] = useState<string | null>(null);\r\n    const [registrationToken, setRegistrationToken] = useState<string | null>(null);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        // Validate password for signup and reset\r\n        if (view === 'signup' || view === 'reset') {\r\n            const error = validatePassword(password);\r\n            if (error) { toast.error(error); return; }\r\n        }\r\n\r\n        if (view === 'login') {\r\n            if (!isEmailChecked) {\r\n                handleEmailCheck();\r\n                return;\r\n            }\r\n            const tid = toast.loading(\"Authenticating...\");\r\n            const result = await login({ email, password });\r\n            if (result.success) {\r\n                toast.success(\"Login Successful! Welcome back.\", { id: tid });\r\n            } else {\r\n                toast.error(\r\n                    result.message || \"Something is wrong. Please type it correctly or change your password.\",\r\n                    { id: tid, duration: 4000 }\r\n                );\r\n            }\r\n        } else if (view === 'signup') {\r\n            const fullPhone = phone ? `+${phoneCode}${phone.replace(/\\D/g, '')}` : undefined;\r\n            const result = await signup({ email, phone: fullPhone, password, name, role, city, state, country });\r\n            if (result.success) {\r\n                toast.success(\"Account ready! Please verify captcha.\");\r\n                if (result.captchaSvg) setCaptchaSvg(result.captchaSvg);\r\n                if (result.registrationToken) setRegistrationToken(result.registrationToken);\r\n                setView('verify');\r\n            } else {\r\n                toast.error(result.message || \"Signup failed\");\r\n            }\r\n        } else if (view === 'verify') {\r\n            if (!registrationToken) {\r\n                toast.error(\"Session expired. Please sign up again.\");\r\n                setView('signup');\r\n                return;\r\n            }\r\n            const tid = toast.loading(\"Verifying Captcha...\");\r\n            const result = await verify(registrationToken, otp);\r\n            if (result.success) {\r\n                toast.success(\"Identity Verified! Welcome.\", { id: tid });\r\n            } else {\r\n                toast.error(result.message || \"Invalid Captcha\", { id: tid });\r\n            }\r\n        } else if (view === 'forgot') {\r\n            const tid = toast.loading(\"Verifying Identity...\");\r\n            try {\r\n                const api = await import('../services/api');\r\n                await api.resetPasswordVerify(email, name, password);\r\n                toast.success(\"Password Reset Successful! Login with new credentials.\", { id: tid });\r\n                setView('login');\r\n            } catch (err: any) {\r\n                toast.error(err.message || \"Verification failed. Check Name/Email.\", { id: tid });\r\n            }\r\n        } else if (view === 'reset') {\r\n            const tid = toast.loading(\"Updating Password...\");\r\n            try {\r\n                const api = await import('../services/api');\r\n                await api.resetPassword(email, password);\r\n                toast.success(\"Password Updated! Please Login.\", { id: tid });\r\n                setView('login');\r\n            } catch (err) {\r\n                toast.error(\"Reset Failed. Try again.\", { id: tid });\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleResendOTP = async () => {\r\n        if (!registrationToken) return;\r\n        const tid = toast.loading(\"Refreshing captcha...\");\r\n        try {\r\n            const res = await fetch(`${import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api'}/auth/resend-otp`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ registrationToken })\r\n            });\r\n            const data = await res.json();\r\n            if (data.captchaSvg) setCaptchaSvg(data.captchaSvg);\r\n            if (data.registrationToken) setRegistrationToken(data.registrationToken);\r\n            toast.success(\"New code generated!\", { id: tid });\r\n        } catch (err: any) {\r\n            toast.error(err.message || \"Failed to refresh captcha\", { id: tid });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.authContainer}>\r\n            <div className={styles.authCard}>\r\n\r\n                {/* Unified Login Notice */}\r\n                {view === 'login' && (\r\n                    <div className={styles.noticeBox} style={{ borderColor: isEmailChecked ? '#10b981' : undefined }}>\r\n                        <div className={styles.noticeDot} style={{ background: isEmailChecked ? '#10b981' : undefined }}></div>\r\n                        <span>\r\n                            {isEmailChecked\r\n                                ? <strong>VanaMap Verified: {emailVerifiedResult?.name}</strong>\r\n                                : <><strong>Users and Vendors</strong> can login here.</>}\r\n                        </span>\r\n                    </div>\r\n                )}\r\n\r\n                <div className={styles.authHeader}>\r\n                    <h2 className={styles.authTitle}>\r\n                        {view === 'login' && (isEmailChecked ? 'Enter Password' : 'Welcome Back')}\r\n                        {view === 'signup' && 'Create Account'}\r\n                        {view === 'verify' && 'Verify Identity'}\r\n                        {view === 'forgot' && 'Reset Password'}\r\n                        {view === 'reset' && 'New Password'}\r\n                    </h2>\r\n                    <p className={styles.authSubtitle}>\r\n                        {view === 'login' && (isEmailChecked ? `Hi ${emailVerifiedResult?.name.split(' ')[0]}, please type your key.` : 'Enter email or phone to verify status')}\r\n                        {view === 'signup' && 'Join the VanaMap community today'}\r\n                        {view === 'verify' && `Please enter the characters shown below`}\r\n                        {view === 'forgot' && 'Weâ€™ll help you get back in'}\r\n                    </p>\r\n                </div>\r\n\r\n\r\n                {/* Role Toggle */}\r\n                {view === 'signup' && (\r\n                    <div className={styles.roleToggle}>\r\n                        <button\r\n                            type=\"button\"\r\n                            className={`${styles.roleBtn} ${role === 'user' ? styles.active : ''} `}\r\n                            onClick={() => setRole('user')}\r\n                        >\r\n                            <div className={styles.roleIcon}>\r\n                                <User size={18} />\r\n                            </div>\r\n                            <span>Plant Lover</span>\r\n                        </button>\r\n                        <button\r\n                            type=\"button\"\r\n                            className={`${styles.roleBtn} ${role === 'vendor' ? styles.active : ''} `}\r\n                            onClick={() => setRole('vendor')}\r\n                        >\r\n                            <div className={styles.roleIcon}>\r\n                                <Store size={18} />\r\n                            </div>\r\n                            <span>Shop Owner</span>\r\n                        </button>\r\n                    </div>\r\n                )}\r\n\r\n                <form onSubmit={handleSubmit}>\r\n                    {/* Signup Fields */}\r\n                    {view === 'signup' && (\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}>\r\n                                {role === 'vendor' ? 'Business Name' : 'Full Name'}\r\n                            </label>\r\n                            <input\r\n                                className={styles.input}\r\n                                type=\"text\"\r\n                                value={name}\r\n                                onChange={(e) => setName(e.target.value)}\r\n                                required\r\n                                placeholder={role === 'vendor' ? \"e.g. Green Earth Nursery\" : \"e.g. John Doe\"}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Unified Location Collection */}\r\n                    {view === 'signup' && (\r\n                        <>\r\n                            <div className={styles.formGroup}>\r\n                                <label className={styles.label}>{role === 'vendor' ? 'Business Location' : 'Your Location'}</label>\r\n                                <div style={{ display: 'grid', gap: '0.75rem' }}>\r\n                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem' }}>\r\n                                        <select\r\n                                            className={styles.select}\r\n                                            value={selectedCountry?.isoCode || ''}\r\n                                            onChange={(e) => handleCountryChange(e.target.value)}\r\n                                            required\r\n                                        >\r\n                                            {Country.getAllCountries().map(c => (\r\n                                                <option key={c.isoCode} value={c.isoCode}>{c.name}</option>\r\n                                            ))}\r\n                                        </select>\r\n\r\n                                        <select\r\n                                            className={styles.select}\r\n                                            value={selectedState?.isoCode || ''}\r\n                                            onChange={(e) => handleStateChange(e.target.value)}\r\n                                            required\r\n                                        >\r\n                                            <option value=\"\">Select State</option>\r\n                                            {selectedCountry && State.getStatesOfCountry(selectedCountry.isoCode).map(s => (\r\n                                                <option key={s.isoCode} value={s.isoCode}>{s.name}</option>\r\n                                            ))}\r\n                                        </select>\r\n                                    </div>\r\n                                    <input\r\n                                        className={styles.input}\r\n                                        type=\"text\"\r\n                                        value={city}\r\n                                        onChange={(e) => setCity(e.target.value)}\r\n                                        placeholder={role === 'vendor' ? \"City / District\" : \"City (e.g. Kathmandu)\"}\r\n                                        required\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Vendor Specific Phone (Only for Vendor) - REMOVED redundant here, handled below */}\r\n                        </>\r\n                    )}\r\n\r\n                    {/* email/Phone Field - Step 1 for Login */}\r\n                    <div className={styles.formGroup} style={{ opacity: (isEmailChecked && view === 'login') ? 0.6 : 1, transition: '0.3s' }}>\r\n                        <label className={styles.label}>{view === 'login' ? 'Email or Phone Number' : 'Email Address'}</label>\r\n                        <input\r\n                            className={styles.input}\r\n                            type={view === 'login' ? \"text\" : \"email\"}\r\n                            value={email}\r\n                            onChange={(e) => { setEmail(e.target.value); setIsEmailChecked(false); }}\r\n                            required\r\n                            disabled={(isEmailChecked && view === 'login') || view === 'verify'}\r\n                            placeholder={view === 'login' ? \"Email or Mobile Number\" : \"name@example.com\"}\r\n                        />\r\n                        {isEmailChecked && view === 'login' && (\r\n                            <button\r\n                                type=\"button\"\r\n                                className={styles.changeEmailBtn}\r\n                                onClick={() => { setIsEmailChecked(false); setPassword(''); }}\r\n                            >\r\n                                Change\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {view === 'signup' && (\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}>WhatsApp / Mobile Number</label>\r\n                            <div className={styles.inputWrapper}>\r\n                                <div className={styles.phonePrefix}>+{phoneCode}</div>\r\n                                <input\r\n                                    className={styles.input}\r\n                                    type=\"tel\"\r\n                                    value={phone}\r\n                                    onChange={(e) => setPhone(e.target.value)}\r\n                                    required\r\n                                    placeholder=\"XXXXX XXXXX\"\r\n                                    style={{ paddingLeft: '4.5rem' }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {view === 'verify' && (\r\n                        <div className={`${styles.formGroup} ${styles.revealAnimation}`}>\r\n                            <label className={styles.label}>Enter Captcha</label>\r\n\r\n                            {captchaSvg && (\r\n                                <div\r\n                                    className={styles.captchaBox}\r\n                                    dangerouslySetInnerHTML={{ __html: captchaSvg }}\r\n                                    style={{\r\n                                        background: '#f8fafc',\r\n                                        padding: '10px',\r\n                                        borderRadius: '12px',\r\n                                        marginBottom: '1rem',\r\n                                        display: 'flex',\r\n                                        justifyContent: 'center',\r\n                                        border: '1px solid #e2e8f0'\r\n                                    }}\r\n                                />\r\n                            )}\r\n\r\n                            <input\r\n                                className={styles.input}\r\n                                type=\"text\"\r\n                                maxLength={4}\r\n                                value={otp}\r\n                                onChange={(e) => setOtp(e.target.value)}\r\n                                required\r\n                                placeholder=\"Type 4 characters\"\r\n                                autoFocus\r\n                                style={{ textAlign: 'center', fontSize: '1.5rem', letterSpacing: '4px', textTransform: 'lowercase' }}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {view === 'forgot' && (\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}>Username (As Before)</label>\r\n                            <input\r\n                                className={styles.input}\r\n                                type=\"text\"\r\n                                value={name}\r\n                                onChange={(e) => setName(e.target.value)}\r\n                                required\r\n                                placeholder=\"Verify your identity\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Step 2: Password Field */}\r\n                    {((view === 'signup' || view === 'reset' || view === 'forgot') || (view === 'login' && isEmailChecked)) && (\r\n                        <div className={`${styles.formGroup} ${styles.revealAnimation}`}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem', alignItems: 'center' }}>\r\n                                <label className={styles.label} style={{ marginBottom: 0 }}>\r\n                                    {(view === 'reset' || view === 'forgot') ? 'New Password' : 'Password'}\r\n                                </label>\r\n                                {(view === 'signup' || view === 'reset') && (\r\n                                    <span className={styles.hintText} style={{ color: password.length > 0 && validatePassword(password) ? '#ef4444' : '#10b981' }}>\r\n                                        {password.length === 0 ? '' : (validatePassword(password) || 'Strong Key')}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            <div className={styles.passwordWrapper}>\r\n                                <input\r\n                                    className={styles.input}\r\n                                    type={showPassword ? \"text\" : \"password\"}\r\n                                    value={password}\r\n                                    onChange={(e) => setPassword(e.target.value)}\r\n                                    required\r\n                                    autoFocus\r\n                                    placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                />\r\n                                <button\r\n                                    type=\"button\"\r\n                                    className={styles.passwordToggle}\r\n                                    onClick={() => setShowPassword(!showPassword)}\r\n                                >\r\n                                    {showPassword ? (\r\n                                        <EyeOff size={18} className={styles.eyeIcon} />\r\n                                    ) : (\r\n                                        <Eye size={18} className={styles.eyeIcon} />\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n                            {view === 'signup' && (\r\n                                <p className={styles.passwordRules}>\r\n                                    4-18 chars, 1 Upper, 1 Number, 1 Special (@#$%)\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {!isEmailChecked && view === 'login' ? (\r\n                        <Button\r\n                            type=\"button\"\r\n                            onClick={handleEmailCheck}\r\n                            disabled={emailLoading}\r\n                            variant=\"primary\"\r\n                            className={styles.submitBtn}\r\n                        >\r\n                            {emailLoading ? 'Verifying...' : 'Next'}\r\n                        </Button>\r\n                    ) : (\r\n                        <Button type=\"submit\" variant=\"primary\" className={styles.submitBtn}>\r\n                            {view === 'login' && 'Log In'}\r\n                            {view === 'signup' && 'Send Code'}\r\n                            {view === 'verify' && 'Verify & Enter'}\r\n                            {view === 'forgot' && 'Reset Password'}\r\n                            {view === 'reset' && 'Update Password'}\r\n                        </Button>\r\n                    )}\r\n\r\n                    {view === 'login' && !isEmailChecked && (\r\n                        <div style={{ textAlign: 'center', marginTop: '1rem' }}>\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setView('forgot')}\r\n                                className={styles.forgotLink}\r\n                            >\r\n                                Forgot Password?\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n\r\n                    {view === 'forgot' && (\r\n                        <div style={{ marginTop: '1.5rem', textAlign: 'center', borderTop: '1px solid rgba(255,255,255,0.1)', paddingTop: '1rem' }}>\r\n                            <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '0.5rem' }}>\r\n                                Forgot username too?\r\n                            </p>\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleNudge}\r\n                                className={styles.linkBtn}\r\n                                style={{ color: '#f59e0b', fontSize: '0.9rem', marginBottom: '1rem' }}\r\n                            >\r\n                                Contact Admin (Manual Reset)\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n                </form>\r\n\r\n                <div className={styles.footer}>\r\n                    {view === 'login' && (\r\n                        <>\r\n                            <p style={{ marginBottom: '1rem', color: 'var(--color-text-muted)', fontSize: '0.9rem' }}>\r\n                                New to VanaMap? <button onClick={() => { setView('signup'); setIsEmailChecked(false); }} style={{ color: '#10b981', fontWeight: 600 }}>Create Account</button>\r\n                            </p>\r\n                        </>\r\n                    )}\r\n                    {view === 'signup' && (\r\n                        <>Already have an account? <button onClick={() => { setView('login'); setIsEmailChecked(false); }} style={{ color: '#10b981', fontWeight: 600 }}>Log In</button></>\r\n                    )}\r\n                    {view === 'verify' && (\r\n                        <div style={{ marginTop: '1rem', textAlign: 'center' }}>\r\n                            <div className={styles.hintText}>\r\n                                Can't read the code? <button type=\"button\" onClick={handleResendOTP} style={{ color: '#10b981', fontWeight: 600 }}>Refresh Captcha</button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    {(view === 'forgot' || view === 'reset') && (\r\n                        <><button onClick={() => { setView('login'); setIsEmailChecked(false); }} style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem', margin: '0 auto', color: '#cbd5e1' }}>\r\n                            <ArrowLeft size={16} /> Return to Login\r\n                        </button></>\r\n                    )}\r\n                </div>\r\n            </div >\r\n        </div >\r\n    );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Cart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Contact.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`generateCaptcha` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Contact.tsx:15:9\n  13 |\n  14 |     useEffect(() => {\n> 15 |         generateCaptcha();\n     |         ^^^^^^^^^^^^^^^ `generateCaptcha` accessed before it is declared\n  16 |     }, []);\n  17 |\n  18 |     const generateCaptcha = () => {\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Contact.tsx:18:5\n  16 |     }, []);\n  17 |\n> 18 |     const generateCaptcha = () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 19 |         const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 20 |         let result = '';\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 21 |         for (let i = 0; i < 4; i++) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 22 |             result += chars.charAt(Math.floor(Math.random() * chars.length));\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 23 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |         setCaptchaText(result);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |     };\n     | ^^^^^^^ `generateCaptcha` is declared here\n  26 |\n  27 |     const handleSendMessage = async (e: React.FormEvent) => {\n  28 |         e.preventDefault();","line":15,"column":9,"nodeType":null,"endLine":15,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Mail, Phone, MapPin, Send, Sparkles } from 'lucide-react';\r\nimport { Button } from '../components/common/Button';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-hot-toast';\r\nimport styles from './Contact.module.css';\r\nimport { sendInquiry } from '../services/api';\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport const Contact = () => {\r\n    const navigate = useNavigate();\r\n    const [captchaText, setCaptchaText] = useState('');\r\n    const [userCaptcha, setUserCaptcha] = useState('');\r\n\r\n    useEffect(() => {\r\n        generateCaptcha();\r\n    }, []);\r\n\r\n    const generateCaptcha = () => {\r\n        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n        let result = '';\r\n        for (let i = 0; i < 4; i++) {\r\n            result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n        }\r\n        setCaptchaText(result);\r\n    };\r\n\r\n    const handleSendMessage = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (userCaptcha !== captchaText) {\r\n            toast.error(\"Incorrect Captcha Code. Please try again.\");\r\n            setUserCaptcha(''); // Clear input\r\n            generateCaptcha(); // Refresh code for security\r\n            return;\r\n        }\r\n\r\n        const form = e.target as HTMLFormElement;\r\n        const name = (form.elements[0] as HTMLInputElement).value;\r\n        const email = (form.elements[1] as HTMLInputElement).value;\r\n        const message = (form.elements[2] as HTMLTextAreaElement).value;\r\n\r\n        const toastId = toast.loading(\"Sending your message...\");\r\n\r\n        try {\r\n            await sendInquiry({ name, email, message });\r\n            toast.success(\"Message sent successfully! We'll reply via email.\", {\r\n                id: toastId,\r\n                icon: 'ðŸš€',\r\n                style: {\r\n                    borderRadius: '1rem',\r\n                    background: '#0f172a',\r\n                    color: '#fff',\r\n                    border: '1px solid rgba(16, 185, 129, 0.2)'\r\n                }\r\n            });\r\n            form.reset();\r\n            setUserCaptcha('');\r\n            generateCaptcha();\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Failed to send message. Please try again.\", {\r\n                id: toastId,\r\n                style: {\r\n                    borderRadius: '1rem',\r\n                    background: '#0f172a',\r\n                    color: '#fff',\r\n                    border: '1px solid rgba(244, 63, 94, 0.2)'\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.contactContainer}>\r\n            {/* Header */}\r\n            <header className={styles.header}>\r\n                <div className={styles.badge}>\r\n                    READY TO ASSIST\r\n                </div>\r\n                <h1 className={styles.title}>VANAMAP<br />CONCIERGE</h1>\r\n                <p className={styles.subtitle}>\r\n                    Have questions about your specimens, orders, or ecosystem? Our botanical experts are standing by.\r\n                </p>\r\n            </header>\r\n\r\n            <div className={styles.grid}>\r\n                {/* Contact Information */}\r\n                <div className={styles.infoSection}>\r\n                    <div className={styles.infoCard}>\r\n                        <div className={styles.iconBox} style={{ background: 'rgba(56, 189, 248, 0.1)' }}>\r\n                            <Mail size={24} color=\"#38bdf8\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className={styles.cardTitle}>Email Support</h3>\r\n                            <p className={styles.cardValue}>jiibruh86@gmail.com</p>\r\n                            <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem' }}>Average response: 2h</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.infoCard}>\r\n                        <div className={styles.iconBox} style={{ background: 'rgba(16, 185, 129, 0.1)' }}>\r\n                            <Phone size={24} color=\"#10b981\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className={styles.cardTitle}>Botanist Hotline</h3>\r\n                            <p className={styles.cardValue}>+91 9188773534</p>\r\n                            <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.25rem' }}>WhatsApp Available</p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.infoCard}>\r\n                        <div className={styles.iconBox} style={{ background: 'rgba(244, 63, 94, 0.1)' }}>\r\n                            <MapPin size={24} color=\"#f43f5e\" />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className={styles.cardTitle}>Global HQ</h3>\r\n                            <p className={styles.cardValue}>Calicut, Kerala<br />India</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Contact Form */}\r\n                <div className={styles.formCard}>\r\n                    <h2 style={{ fontSize: '1.5rem', fontWeight: 800, color: 'white', marginBottom: '2rem' }}>Send Inquiry</h2>\r\n                    <form onSubmit={handleSendMessage}>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Identity</label>\r\n                            <input type=\"text\" placeholder=\"Your Name\" className={styles.input} required />\r\n                        </div>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Channel</label>\r\n                            <input type=\"email\" placeholder=\"Email Address\" className={styles.input} required />\r\n                        </div>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Manifesto</label>\r\n                            <textarea rows={4} placeholder=\"How can we help your ecosystem grow?\" className={styles.textarea} required />\r\n                        </div>\r\n\r\n                        {/* Captcha Section */}\r\n                        <div className={styles.inputGroup} style={{ marginBottom: '2rem' }}>\r\n                            <label className={styles.label}>Security Check</label>\r\n                            <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                                <div style={{\r\n                                    background: '#22d3ee', color: '#000', fontWeight: '900',\r\n                                    fontSize: '1.5rem', letterSpacing: '8px', padding: '0.5rem 1rem',\r\n                                    borderRadius: '8px', fontFamily: 'monospace',\r\n                                    textTransform: 'uppercase', userSelect: 'none',\r\n                                    position: 'relative', overflow: 'hidden'\r\n                                }}>\r\n                                    {/* Noise lines for effect */}\r\n                                    <div style={{ position: 'absolute', top: '50%', left: 0, width: '100%', height: '2px', background: 'rgba(0,0,0,0.3)', transform: 'rotate(5deg)' }}></div>\r\n                                    <div style={{ position: 'absolute', top: '20%', left: 0, width: '100%', height: '1px', background: 'rgba(0,0,0,0.3)', transform: 'rotate(-10deg)' }}></div>\r\n                                    {captchaText}\r\n                                </div>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"Enter Code\"\r\n                                    className={styles.input}\r\n                                    style={{ letterSpacing: '2px', textTransform: 'uppercase' }}\r\n                                    value={userCaptcha}\r\n                                    onChange={(e) => setUserCaptcha(e.target.value.toUpperCase().slice(0, 4))}\r\n                                    maxLength={4}\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <Button\r\n                            variant=\"primary\"\r\n                            style={{ width: '100%', padding: '1.25rem', borderRadius: '1rem', fontWeight: '800', opacity: userCaptcha.length === 4 ? 1 : 0.6 }}\r\n                            disabled={userCaptcha.length !== 4}\r\n                        >\r\n                            <Send size={18} /> DISPATCH MESSAGE\r\n                        </Button>\r\n                    </form>\r\n                </div>\r\n\r\n                {/* Plant Suggestion Promotion */}\r\n                <div className={styles.suggestionPromo}>\r\n                    <div className={styles.promoContent}>\r\n                        <h2 className={styles.promoTitle}>Missing a Specimen?</h2>\r\n                        <p className={styles.promoDesc}>\r\n                            If you've discovered a rare plant species that isn't in our database yet, let us know!\r\n                            Our team will analyze its oxygen output and add it to the ecosystem.\r\n                        </p>\r\n                    </div>\r\n                    <button className={styles.suggestionBtn} onClick={() => navigate('/support')}>\r\n                        <Sparkles size={20} /> SUGGEST A PLANT\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Heaven.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_type' is defined but never used.","line":41,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":29},{"ruleId":"prefer-const","severity":2,"message":"'newWater' is never reassigned. Use 'const' instead.","line":52,"column":25,"nodeType":"Identifier","messageId":"useConst","endLine":52,"endColumn":33,"fix":{"range":[2116,2159],"text":"const newWater = Math.max(0, plot.water - 2);"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6688,6691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6688,6691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { useState, useEffect, type MouseEvent } from 'react';\r\nimport { Sprout, CloudRain, Coins, Volume2, VolumeX, Sparkles, Heart, Info, Newspaper, Recycle, ArrowLeft } from 'lucide-react';\r\nimport styles from './Heaven.module.css';\r\nimport confetti from 'canvas-confetti';\r\nimport { updateGameProgress } from '../services/api';\r\nimport toast from 'react-hot-toast';\r\nimport { PotMaker } from '../components/features/games/PotMaker';\r\n\r\ninterface PlantState {\r\n    id: number;\r\n    stage: number;\r\n    type: string;\r\n    water: number;\r\n    timeToNextStage: number;\r\n}\r\n\r\nconst PLANT_TYPES = [\r\n    { name: 'Sunflower', stages: ['ðŸ•³ï¸', 'ðŸŒ°', 'ðŸŒ±', 'ðŸŒ¿', 'ðŸŒ»'], reward: 50 },\r\n    { name: 'Rose', stages: ['ðŸ•³ï¸', 'ðŸŒ°', 'ðŸŒ±', 'ðŸŒ¿', 'ðŸŒ¹'], reward: 60 },\r\n    { name: 'Tree', stages: ['ðŸ•³ï¸', 'ðŸŒ°', 'ðŸŒ±', 'ðŸŒ³', 'ðŸŽ'], reward: 100 },\r\n    { name: 'Cactus', stages: ['ðŸ•³ï¸', 'ðŸŒ°', 'ðŸŒµ', 'ðŸŒµ', 'ðŸŒ¸'], reward: 80 }\r\n];\r\n\r\nexport const Heaven = () => {\r\n    // Hub State\r\n    const [view, setView] = useState<'menu' | 'game' | 'lifecycle' | 'news' | 'pot-maker'>('menu');\r\n\r\n    // Game Logic State\r\n    const [coins, setCoins] = useState(100);\r\n    const [level, setLevel] = useState(1);\r\n    const [xp, setXp] = useState(0);\r\n    const xpToNextLevel = level * 200;\r\n    const [plots, setPlots] = useState<PlantState[]>(Array(6).fill(null).map((_, i) => ({\r\n        id: i, stage: 0, type: 'Sunflower', water: 100, timeToNextStage: 0\r\n    })));\r\n    const [selectedTool, setSelectedTool] = useState<'plant' | 'water' | 'harvest' | null>(null);\r\n    const [isSoundOn, setIsSoundOn] = useState(true);\r\n    const [showTutorial, setShowTutorial] = useState(true);\r\n\r\n\r\n    const playSound = (_type: 'pop' | 'success' | 'water' | 'level') => {\r\n        if (!isSoundOn) return;\r\n        // In a real app, use new Audio('/sounds/' + type + '.mp3').play();\r\n    };\r\n\r\n    // --- GAME EFFECTS ---\r\n    useEffect(() => {\r\n        if (view !== 'game') return;\r\n        const timer = setInterval(() => {\r\n            setPlots(current => current.map(plot => {\r\n                if (plot.stage > 0 && plot.stage < 4) {\r\n                    let newWater = Math.max(0, plot.water - 2);\r\n                    if (newWater > 0) {\r\n                        const newTime = plot.timeToNextStage - 1;\r\n                        if (newTime <= 0) return { ...plot, stage: plot.stage + 1, timeToNextStage: 8, water: newWater - 10 };\r\n                        return { ...plot, timeToNextStage: newTime, water: newWater };\r\n                    }\r\n                    return { ...plot, water: newWater };\r\n                }\r\n                return plot;\r\n            }));\r\n        }, 1000);\r\n        return () => clearInterval(timer);\r\n    }, [view]);\r\n\r\n    useEffect(() => {\r\n        if (level > 1 || xp > 0) updateGameProgress(level, Math.floor(xp)).catch(err => console.error(err));\r\n    }, [level, xp]);\r\n\r\n    // --- GAME HANDLERS ---\r\n    const handlePlotClick = (index: number, e: MouseEvent<HTMLDivElement>) => {\r\n        const plot = plots[index];\r\n        const rect = e.currentTarget.getBoundingClientRect();\r\n        const x = (rect.left + rect.width / 2) / window.innerWidth;\r\n        const y = (rect.top + rect.height / 2) / window.innerHeight;\r\n\r\n        if (selectedTool === 'plant') {\r\n            if (plot.stage !== 0) { toast.error(\"Already planted here!\", { icon: 'ðŸŒ±' }); return; }\r\n            if (coins < 10) { toast.error(\"Need 10 coins!\", { icon: 'ðŸª™' }); return; }\r\n            setCoins(c => c - 10);\r\n            playSound('pop');\r\n            updatePlot(index, { stage: 1, type: PLANT_TYPES[Math.floor(Math.random() * PLANT_TYPES.length)].name, timeToNextStage: 5, water: 100 });\r\n            confetti({ particleCount: 15, spread: 40, origin: { x, y } });\r\n        } else if (selectedTool === 'water') {\r\n            if (plot.stage === 0) return;\r\n            playSound('water');\r\n            updatePlot(index, { water: 100 });\r\n            confetti({ particleCount: 5, colors: ['#38bdf8'], spread: 20, origin: { x, y }, ticks: 50 });\r\n        } else if (selectedTool === 'harvest') {\r\n            if (plot.stage !== 4) return;\r\n            const plantType = PLANT_TYPES.find(p => p.name === plot.type) || PLANT_TYPES[0];\r\n            setCoins(c => c + plantType.reward);\r\n            addXp(plantType.reward);\r\n            playSound('success');\r\n            updatePlot(index, { stage: 0 });\r\n            confetti({ particleCount: 60, spread: 80, origin: { x, y } });\r\n        }\r\n    };\r\n\r\n    const addXp = (amount: number) => {\r\n        setXp(curr => {\r\n            const next = curr + amount;\r\n            if (next >= xpToNextLevel) {\r\n                setLevel(l => l + 1);\r\n                playSound('level');\r\n                toast.success(`Level Up! You are now Level ${level + 1}!`);\r\n                return next - xpToNextLevel;\r\n            }\r\n            return next;\r\n        });\r\n    };\r\n\r\n    const updatePlot = (index: number, updates: Partial<PlantState>) => {\r\n        setPlots(curr => { const n = [...curr]; n[index] = { ...n[index], ...updates }; return n; });\r\n    };\r\n\r\n    const getPlantEmoji = (plot: PlantState) => {\r\n        const plantDef = PLANT_TYPES.find(p => p.name === plot.type) || PLANT_TYPES[0];\r\n        return plantDef.stages[plot.stage];\r\n    };\r\n\r\n    // --- LIFE CYCLE COMPONENT ---\r\n    const LifecycleView = () => (\r\n        <div className={styles.subPage}>\r\n            <h2 className={styles.sectionTitle}>The Eternal Cycle</h2>\r\n            <div className={styles.lifecycleContainer}>\r\n                <div className={styles.cycleStage}>\r\n                    <div className={styles.stageIcon}>ðŸŒ°</div>\r\n                    <h3>Birth</h3>\r\n                    <p>Every giant tree begins as a tiny dream wrapped in a seed shell.</p>\r\n                </div>\r\n                <div className={styles.cycleArrow}>âž¡ï¸</div>\r\n                <div className={styles.cycleStage}>\r\n                    <div className={styles.stageIcon}>ðŸŒ³</div>\r\n                    <h3>Life</h3>\r\n                    <p>Providing oxygen, shelter, and beauty to the world.</p>\r\n                </div>\r\n                <div className={styles.cycleArrow}>âž¡ï¸</div>\r\n                <div className={styles.cycleStage}>\r\n                    <div className={styles.stageIcon}>ðŸ‚</div>\r\n                    <h3>Return</h3>\r\n                    <p>Returning to the earth to nourish the next generation.</p>\r\n                </div>\r\n            </div>\r\n            <p className={styles.cycleQuote}>\"Nature does not hurry, yet everything is accomplished.\"</p>\r\n        </div>\r\n    );\r\n\r\n    // --- NEWS COMPONENT ---\r\n    const NewsView = () => {\r\n        const [newsData, setNewsData] = useState<any[]>([]);\r\n        const [loading, setLoading] = useState(true);\r\n\r\n        useEffect(() => {\r\n            const fetchNews = async () => {\r\n                try {\r\n                    // Try fetch from backend\r\n                    const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\r\n                    const res = await fetch(`${apiUrl}/news`);\r\n                    if (res.ok) {\r\n                        const data = await res.json();\r\n                        setNewsData(data);\r\n                    } else {\r\n                        throw new Error(\"Failed\");\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"News fetch failed, using fallback\", e);\r\n                    // Fallback if backend offline/fails\r\n                    const fallbackNews = [\r\n                        { title: 'Global Forest Cover Increases by 2% this Year', source: 'Earth Watch', time: 'Today', link: 'https://www.sciencedaily.com/news/plants_animals/nature/' },\r\n                        { title: 'New Species of Orchid Discovered in Amazon', source: 'Botany Today', time: 'Yesterday', link: 'https://news.mongabay.com/' }\r\n                    ];\r\n                    setNewsData(fallbackNews);\r\n                } finally {\r\n                    setLoading(false);\r\n                }\r\n            };\r\n            fetchNews();\r\n        }, []);\r\n\r\n        return (\r\n            <div className={styles.subPage}>\r\n                <h2 className={styles.sectionTitle}>Global Nature Pulse</h2>\r\n                {loading ? (\r\n                    <div style={{ textAlign: 'center', padding: '2rem', color: '#94a3b8' }}>Loading fresh news from nature...</div>\r\n                ) : (\r\n                    <div className={styles.newsGrid}>\r\n                        {newsData.length === 0 && <p style={{ textAlign: 'center' }}>No news available today.</p>}\r\n                        {newsData.map((item, i) => (\r\n                            <div key={i} className={styles.newsCard}>\r\n                                <div className={styles.newsSource}>\r\n                                    {item.source} â€¢ {new Date(item.pubDate || Date.now()).toLocaleDateString()}\r\n                                </div>\r\n                                <h3 className={styles.newsTitle}>{item.title}</h3>\r\n                                {item.snippet && <p style={{ fontSize: '0.9rem', color: '#64748b', marginBottom: '1rem' }}>{item.snippet}</p>}\r\n                                <a\r\n                                    href={item.link}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className={styles.readMoreBtn}\r\n                                >\r\n                                    Read Full Story\r\n                                </a>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    // --- RENDER ---\r\n    return (\r\n        <div className={styles.pageWrapper}>\r\n            {/* Background Atmosphere */}\r\n            <div className={styles.sky}>\r\n                <CloudRain size={120} className={styles.cloud} style={{ top: '10%', left: '-10%', opacity: 0.4 }} />\r\n                <CloudRain size={80} className={styles.cloud} style={{ top: '20%', animationDelay: '5s', opacity: 0.3 }} />\r\n            </div>\r\n\r\n            {/* HEADER / NAV */}\r\n            <div className={styles.topNav}>\r\n                {view !== 'menu' && (\r\n                    <button onClick={() => setView('menu')} className={styles.backBtn}>\r\n                        <ArrowLeft /> Back to Heaven\r\n                    </button>\r\n                )}\r\n                <h1 className={styles.mainLogo}>HEAVEN ðŸŒ¿</h1>\r\n            </div>\r\n\r\n            {/* MAIN MENU VIEW */}\r\n            {view === 'menu' && (\r\n                <div className={styles.menuContainer}>\r\n                    <div className={styles.menuCard} onClick={() => setView('game')}>\r\n                        <div className={`${styles.cardIcon} ${styles.iconGreen}`}><Sprout size={40} /></div>\r\n                        <h2>Tiny Gardeners</h2>\r\n                        <p>Grow your own magical virtual garden. Plant, water, and harvest!</p>\r\n                    </div>\r\n\r\n                    <div className={styles.menuCard} onClick={() => setView('pot-maker')}>\r\n                        {/* Using a distinct color/icon for Pot Maker */}\r\n                        <div style={{\r\n                            background: 'linear-gradient(135deg, #f472b6 0%, #db2777 100%)',\r\n                            boxShadow: '0 8px 16px -4px rgba(219, 39, 119, 0.4)'\r\n                        }} className={styles.cardIcon}>\r\n                            <Sparkles size={40} color=\"white\" />\r\n                        </div>\r\n                        <h2>Pot Studio</h2>\r\n                        <p>Design your own custom 3D plant pots. Upload art & create!</p>\r\n                    </div>\r\n\r\n                    <div className={styles.menuCard} onClick={() => setView('lifecycle')}>\r\n                        <div className={`${styles.cardIcon} ${styles.iconYellow}`}><Recycle size={40} /></div>\r\n                        <h2>Life Cycle</h2>\r\n                        <p>Witness the beautiful journey of birth, life, and renewal.</p>\r\n                    </div>\r\n\r\n                    <div className={styles.menuCard} onClick={() => setView('news')}>\r\n                        <div className={`${styles.cardIcon} ${styles.iconBlue}`}><Newspaper size={40} /></div>\r\n                        <h2>Nature News</h2>\r\n                        <p>Real-time updates on our planet's breathing ecosystems.</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* GAME VIEW */}\r\n            {view === 'game' && (\r\n                <div className={styles.gameContainer}>\r\n                    {showTutorial && (\r\n                        <div className={styles.overlay}>\r\n                            <div className={styles.modal}>\r\n                                <h1>ðŸŒ± Magic Garden</h1>\r\n                                <p>Build your pocket ecosystem! Plants grow in real-time.</p>\r\n                                <button className={styles.ctaBtn} onClick={() => setShowTutorial(false)}>Let's Grow!</button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className={styles.header}>\r\n                        <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '8px' }}>\r\n                            <h1 className={styles.title}>Tiny Gardeners</h1>\r\n                            <button onClick={() => setShowTutorial(true)} className={styles.iconBtn}><Info size={20} /></button>\r\n                        </div>\r\n                        <p className={styles.subtitle}>Level {level}</p>\r\n                        <div className={styles.xpBarContainer}>\r\n                            <div className={styles.xpBarFill} style={{ width: `${(xp / xpToNextLevel) * 100}%` }} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.statsBar}>\r\n                        <div className={`${styles.stat} ${styles.textYellow}`}><Coins size={20} fill=\"#eab308\" /> {coins}</div>\r\n                        <div className={`${styles.stat} ${styles.textRed}`}><Heart size={20} fill=\"#ef4444\" /> {plots.filter(p => p.stage > 0).length} Alive</div>\r\n                        <button onClick={() => setIsSoundOn(!isSoundOn)} className={styles.iconBtn}>\r\n                            {isSoundOn ? <Volume2 /> : <VolumeX />}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className={styles.gardenGrid}>\r\n                        {plots.map((plot, i) => (\r\n                            <div key={i} className={`${styles.plot} ${plot.stage === 0 ? styles.plotLocked : ''}`} onClick={(e) => handlePlotClick(i, e)}>\r\n                                <div className={`${styles.plantContent} ${plot.stage > 0 && plot.stage < 4 ? styles.plantGrowing : ''}`}>{getPlantEmoji(plot)}</div>\r\n                                {plot.stage > 0 && plot.stage < 4 && (\r\n                                    <div className={styles.waterMeter}>\r\n                                        <div className={styles.waterFill} style={{ width: `${plot.water}%`, background: plot.water < 30 ? '#ef4444' : '#38bdf8' }} />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <div className={styles.controls}>\r\n                        <button className={`${styles.toolBtn} ${selectedTool === 'plant' ? styles.seed + ' ' + styles.toolBtnActive : ''}`} onClick={() => setSelectedTool('plant')}>\r\n                            <Sprout size={28} /><span>Seed</span>\r\n                        </button>\r\n                        <button className={`${styles.toolBtn} ${selectedTool === 'water' ? styles.water + ' ' + styles.toolBtnActive : ''}`} onClick={() => setSelectedTool('water')}>\r\n                            <CloudRain size={28} /><span>Water</span>\r\n                        </button>\r\n                        <button className={`${styles.toolBtn} ${selectedTool === 'harvest' ? styles.harvest + ' ' + styles.toolBtnActive : ''}`} onClick={() => setSelectedTool('harvest')}>\r\n                            <Sparkles size={28} /><span>Harvest</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* POT MAKER VIEW */}\r\n            {view === 'pot-maker' && (\r\n                <PotMaker onBack={() => setView('menu')} />\r\n            )}\r\n\r\n            {/* SUB VIEWS */}\r\n            {view === 'lifecycle' && <LifecycleView />}\r\n            {view === 'news' && <NewsView />}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Home.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1507,1510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1507,1510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1958,1961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1958,1961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":79,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":79,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'isFromCache' and 'plantsLoading'. Either include them or remove the dependency array.","line":118,"column":8,"nodeType":"ArrayExpression","endLine":118,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [isFromCache, plantsLoading]","fix":{"range":[6150,6152],"text":"[isFromCache, plantsLoading]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":230,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10717,10720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10717,10720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":338,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16984,16987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16984,16987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":523,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":523,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28554,28557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28554,28557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, lazy, Suspense, useMemo } from 'react';\r\nimport toast from 'react-hot-toast';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\nimport { PlantCard } from '../components/features/plants/PlantCard';\r\nimport { Button } from '../components/common/Button';\r\nimport { fetchPlants, fetchVendors } from '../services/api';\r\nimport { getWeather, geocodeCity, reverseGeocode } from '../services/weather';\r\nimport { calculateAptness } from '../utils/logic';\r\nimport type { Plant, Vendor } from '../types';\r\nimport { Sprout, MapPin, Thermometer, Wind, ArrowDown, Sparkles, Search, AlertCircle, Heart, Sun, Activity, GraduationCap, ShoppingBag, PlusCircle, MoveRight, MessageCircle } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\n// Lazy load modal for performance\r\nconst PlantDetailsModal = lazy(() => import('../components/features/plants/PlantDetailsModal').then(module => ({ default: module.PlantDetailsModal })));\r\nimport { PlantSkeleton } from '../components/features/plants/PlantSkeleton';\r\nimport styles from './Home.module.css';\r\n\r\nexport const Home = () => {\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [vendors, setVendors] = useState<Vendor[]>([]);\r\n    const [filter, setFilter] = useState<'all' | 'indoor' | 'outdoor'>('all');\r\n\r\n\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [lightFilter, setLightFilter] = useState<'all' | 'low' | 'medium' | 'high'>('all');\r\n    const [weather, setWeather] = useState<any>(null);\r\n    const [locationLoading, setLocationLoading] = useState(false);\r\n    const [plantsLoading, setPlantsLoading] = useState(true);\r\n    const [isFromCache, setIsFromCache] = useState(false);\r\n    const [isSlowLoading, setIsSlowLoading] = useState(false);\r\n    const [selectedPlant, setSelectedPlant] = useState<Plant | null>(null);\r\n    const [citySearch, setCitySearch] = useState('');\r\n    const [suggestions, setSuggestions] = useState<any[]>([]);\r\n    const [showSuggestions, setShowSuggestions] = useState(false);\r\n    const [visibleLimit, setVisibleLimit] = useState(() => window.innerWidth < 768 ? 4 : 10);\r\n\r\n    const plantsSectionRef = useRef<HTMLDivElement>(null);\r\n    const filterSectionRef = useRef<HTMLDivElement>(null);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    // Mobile Card Logic\r\n    const [expandedCards, setExpandedCards] = useState<Record<string, boolean>>({});\r\n\r\n    const toggleCard = (id: string) => {\r\n        setExpandedCards(prev => ({ ...prev, [id]: !prev[id] }));\r\n    };\r\n\r\n    const capabilities = [\r\n        { id: 'cap-smart', title: 'Smart Match', icon: <Sparkles size={32} />, color: '#34d399', bg: 'rgba(52, 211, 153, 0.1)', desc: 'We score plants based on your local temperature and air quality to ensure they survive.' },\r\n        { id: 'cap-oxygen', title: 'Oxygen Boost', icon: <Wind size={32} />, color: '#38bdf8', bg: 'rgba(56, 189, 248, 0.1)', desc: 'See how much oxygen each plant produces to help you breathe better and sleep deeper.' }\r\n    ];\r\n\r\n    const personas = [\r\n        { id: 'role-student', title: 'For Students', icon: <GraduationCap size={32} />, color: '#38bdf8', bg: 'rgba(56, 189, 248, 0.1)', desc: 'Learn plant biology, analyze local weather effects, and use our oxygen simulation for your research projects.', meta: 'Educational Mode' },\r\n        { id: 'role-vendor', title: 'For Vendors', icon: <ShoppingBag size={32} />, color: '#facc15', bg: 'rgba(250, 204, 21, 0.1)', desc: 'Register your nursery, list rare specimens, and connect with local plant lovers in your area instantly.', meta: 'Business Portal' },\r\n        { id: 'role-lover', title: 'For Plant Lovers', icon: <Heart size={32} />, color: '#10b981', bg: 'rgba(16, 185, 129, 0.1)', desc: 'Find the perfect match for your home, track your collection, and learn how to care for your green companions.', meta: 'Social Collector' }\r\n    ];\r\n\r\n    useEffect(() => {\r\n        const handlePopState = () => {\r\n            setSelectedPlant(null);\r\n        };\r\n        window.addEventListener('popstate', handlePopState);\r\n        return () => {\r\n            window.removeEventListener('popstate', handlePopState);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const cachedPlants = localStorage.getItem('vanamap_plants_cache');\r\n        if (cachedPlants) {\r\n            try {\r\n                const parsed = JSON.parse(cachedPlants);\r\n                if (Array.isArray(parsed) && parsed.length > 0) {\r\n                    setPlants(parsed);\r\n                    setPlantsLoading(false);\r\n                    setIsFromCache(true);\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Cache corrupted\");\r\n            }\r\n        }\r\n\r\n        const loadFreshData = async () => {\r\n            const timer = setTimeout(() => {\r\n                if (plantsLoading) setIsSlowLoading(true);\r\n            }, 3500);\r\n\r\n            try {\r\n                const [data, vendorData] = await Promise.all([\r\n                    fetchPlants(),\r\n                    fetchVendors()\r\n                ]);\r\n                setVendors(vendorData);\r\n                if (data.length === 0) {\r\n                    const { PLANTS } = await import('../data/mocks');\r\n                    await import('../services/api').then(api => api.seedDatabase(PLANTS, []));\r\n                    const newData = await fetchPlants();\r\n                    setPlants(newData);\r\n                    localStorage.setItem('vanamap_plants_cache', JSON.stringify(newData));\r\n                } else {\r\n                    if (!isFromCache || JSON.stringify(data) !== localStorage.getItem('vanamap_plants_cache')) {\r\n                        setPlants(data);\r\n                        localStorage.setItem('vanamap_plants_cache', JSON.stringify(data));\r\n                    }\r\n                }\r\n                setIsFromCache(false);\r\n            } catch (err) {\r\n                console.error(\"Fetch failed\", err);\r\n            } finally {\r\n                setPlantsLoading(false);\r\n                setIsSlowLoading(false);\r\n                clearTimeout(timer);\r\n            }\r\n        };\r\n\r\n        loadFreshData();\r\n    }, []);\r\n\r\n    const scrollToPlants = () => {\r\n        setTimeout(() => {\r\n            plantsSectionRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n        }, 300);\r\n    };\r\n\r\n    const scrollToFilters = () => {\r\n        setTimeout(() => {\r\n            filterSectionRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n        }, 100);\r\n    };\r\n\r\n    useEffect(() => {\r\n        const timer = setTimeout(async () => {\r\n            if (citySearch.length > 2 && !weather && showSuggestions) {\r\n                try {\r\n                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(citySearch)}&limit=5`);\r\n                    const data = await response.json();\r\n                    setSuggestions(data);\r\n                } catch (e) {\r\n                    console.error(\"Suggestion fetch failed\", e);\r\n                }\r\n            } else {\r\n                setSuggestions([]);\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [citySearch, weather, showSuggestions]);\r\n\r\n    const handleCitySearch = async (overrideCity?: string) => {\r\n        const query = overrideCity || citySearch;\r\n        if (!query) return;\r\n        setLocationLoading(true);\r\n        const result = await geocodeCity(query);\r\n        if (result) {\r\n            const weatherData = await getWeather(result.lat, result.lng);\r\n            if (weatherData) {\r\n                const cityName = query.split(',')[0].trim();\r\n                const cleanName = cityName.charAt(0).toUpperCase() + cityName.slice(1);\r\n                setWeather({ ...weatherData, locationName: cleanName });\r\n                toast.success(`Synced location: ${cleanName}`);\r\n                scrollToFilters();\r\n                setSuggestions([]);\r\n            } else {\r\n                toast.error(\"Data unavailable.\");\r\n            }\r\n        } else {\r\n            toast.error(\"City not found.\");\r\n        }\r\n        setLocationLoading(false);\r\n    };\r\n\r\n    const handleGetLocation = () => {\r\n        setLocationLoading(true);\r\n        if (navigator.geolocation) {\r\n            const toastId = toast.loading(\"Finding your location...\");\r\n            const options = { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 };\r\n            navigator.geolocation.getCurrentPosition(async (position) => {\r\n                const { latitude, longitude } = position.coords;\r\n                try {\r\n                    const [weatherData, locationName] = await Promise.all([\r\n                        getWeather(latitude, longitude),\r\n                        reverseGeocode(latitude, longitude)\r\n                    ]);\r\n\r\n                    if (weatherData) {\r\n                        setWeather({ ...weatherData, locationName: locationName });\r\n                        toast.success(`Located: ${locationName}`, { id: toastId });\r\n                        scrollToFilters();\r\n                    } else {\r\n                        toast.error(\"Weather data unavailable.\", { id: toastId });\r\n                    }\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    toast.error(\"Network error.\", { id: toastId });\r\n                } finally {\r\n                    setLocationLoading(false);\r\n                }\r\n            }, (err) => {\r\n                console.error(err);\r\n                setLocationLoading(false);\r\n                let msg = \"GPS access denied.\";\r\n                if (err.code === 3) msg = \"Location timeout.\";\r\n                if (err.code === 2) msg = \"Location unavailable.\";\r\n                toast.error(msg, { id: toastId });\r\n            }, options);\r\n        } else {\r\n            toast.error(\"GPS not supported.\");\r\n            setLocationLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleAddToCart = (plant: Plant) => {\r\n        // Navigate to Shops page with the selected plant ID to open it immediately\r\n        navigate('/shops', { state: { openPlantId: plant.id } });\r\n    };\r\n\r\n    const openDetails = (plant: Plant) => {\r\n        window.history.pushState({ modal: 'plantDetails' }, document.title);\r\n        setSelectedPlant(plant);\r\n    };\r\n\r\n    const getVendorStats = (plantId: string) => {\r\n        const sellingVendors = vendors.filter(v => v.inventory?.some(i => i.plantId === plantId && i.inStock));\r\n\r\n        let totalStock = 0;\r\n        sellingVendors.forEach(v => {\r\n            const item = v.inventory?.find(i => i.plantId === plantId);\r\n            if (item) {\r\n                const qty = (item as any).quantity;\r\n                totalStock += (typeof qty === 'number' ? qty : 1);\r\n            }\r\n        });\r\n\r\n        const prices = sellingVendors.map(v => v.inventory?.find(i => i.plantId === plantId)?.price || 99999);\r\n        const minPrice = prices.length > 0 ? Math.min(...prices) : null;\r\n\r\n        return { totalStock, minPrice, sellerCount: sellingVendors.length, hasStock: totalStock > 0 };\r\n    };\r\n\r\n    const getPollutionStatus = (aqi: number = 0) => {\r\n        if (aqi <= 20) return { label: 'Excellent', color: '#10b981', desc: 'Fresh Air' };\r\n        if (aqi <= 50) return { label: 'Good', color: '#facc15', desc: 'Air is Okay' };\r\n        if (aqi <= 100) return { label: 'Moderate', color: '#fb923c', desc: 'Not very Clean' };\r\n        return { label: 'High Pollution', color: '#f87171', desc: 'You need plants!' };\r\n    };\r\n\r\n    const displayedPlants = useMemo(() => {\r\n        const processed = [...plants]\r\n            .filter(p => {\r\n                const matchesType = filter === 'all' ? true : p.type === filter;\r\n                const matchesSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n                    p.scientificName.toLowerCase().includes(searchQuery.toLowerCase());\r\n                const matchesLight = lightFilter === 'all' ? true : (() => {\r\n                    const s = p.sunlight.toLowerCase();\r\n                    if (lightFilter === 'low') return s.includes('low') || s.includes('shade') || s.includes('shadow');\r\n                    if (lightFilter === 'medium') return s.includes('indirect') || s.includes('partial') || s.includes('medium');\r\n                    if (lightFilter === 'high') return s.includes('full') || s.includes('high') || s.includes('direct') || s.includes('bright');\r\n                    return false;\r\n                })();\r\n                return matchesType && matchesSearch && matchesLight;\r\n            })\r\n            .map(p => {\r\n                if (!weather) return { ...p, score: 0 };\r\n                return { ...p, score: calculateAptness(p, weather.avgTemp30Days, weather.air_quality?.aqi, weather.avgHumidity30Days) };\r\n            })\r\n            .sort((a, b) => (weather ? b.score - a.score : 0));\r\n\r\n        if (weather && processed.length > 0) {\r\n            const topScore = processed[0].score;\r\n            if (topScore > 0) {\r\n                processed.forEach(p => {\r\n                    p.score = Math.round((p.score / topScore) * 100);\r\n                });\r\n            }\r\n        }\r\n        return processed;\r\n    }, [plants, filter, searchQuery, lightFilter, weather]);\r\n\r\n    return (\r\n        <div className={styles.homeContainer}>\r\n            {selectedPlant && (\r\n                <Suspense fallback={<div style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 2000, backdropFilter: 'blur(10px)' }}>Starting Simulation...</div>}>\r\n                    <PlantDetailsModal\r\n                        plant={selectedPlant}\r\n                        weather={weather}\r\n                        onClose={() => window.history.back()}\r\n                    />\r\n                </Suspense>\r\n            )}\r\n\r\n            <section className={styles.hero}>\r\n                <div className={styles.heroContent}>\r\n                    <div className={styles.heroMainStack}>\r\n                        <div className={styles.heroBadge}>\r\n                            <Sparkles size={16} /> Home Ecosystem Intelligence\r\n                        </div>\r\n                        <h1 className={styles.heroTitle}>Bring Nature<br />Home</h1>\r\n                        <p className={styles.heroSubtitle}>\r\n                            Turn your home into a green sanctuary.\r\n                            <strong> Detect your location</strong> to find plants that thrive in your space.\r\n                        </p>\r\n                    </div>\r\n\r\n                    {!weather ? (\r\n                        <div id=\"location-action-area\" className={styles.heroActionArea}>\r\n                            <div className={styles.actionContainer}>\r\n                                <Button\r\n                                    variant=\"primary\"\r\n                                    onClick={handleGetLocation}\r\n                                    className={styles.gpsBtn}\r\n                                    disabled={locationLoading}\r\n                                    aria-label=\"Detect current location for plant recommendations\"\r\n                                >\r\n                                    <MapPin size={22} className={locationLoading ? \"animate-spin\" : \"animate-bounce\"} style={{ marginRight: '12px' }} />\r\n                                    {locationLoading ? \"DETERMINING CLIMATE...\" : \"Auto-Detect Local Climate\"}\r\n                                </Button>\r\n\r\n                                <div className={styles.divider}>\r\n                                    <span>OR SEARCH MANUALLY</span>\r\n                                </div>\r\n\r\n                                <div className={styles.searchBox}>\r\n                                    <Search size={22} className={styles.searchIcon} />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Enter your city...\"\r\n                                        value={citySearch}\r\n                                        onChange={(e) => setCitySearch(e.target.value)}\r\n                                        onFocus={() => setShowSuggestions(true)}\r\n                                        onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}\r\n                                        onKeyDown={(e) => e.key === 'Enter' && handleCitySearch()}\r\n                                        className={styles.searchInput}\r\n                                        aria-label=\"Search for a city manually\"\r\n                                    />\r\n                                    {showSuggestions && Array.isArray(suggestions) && suggestions.length > 0 && (\r\n                                        <ul className={styles.suggestionsList}>\r\n                                            {suggestions.map((place: any, i) => (\r\n                                                <li key={i} className={styles.suggestionItem} onClick={() => {\r\n                                                    const cityName = place.display_name.split(',')[0];\r\n                                                    setCitySearch(cityName);\r\n                                                    setShowSuggestions(false);\r\n                                                    handleCitySearch(cityName);\r\n                                                }}>\r\n                                                    <MapPin size={16} style={{ marginRight: '12px', color: '#10b981' }} />\r\n                                                    <span style={{ whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{place.display_name}</span>\r\n                                                </li>\r\n                                            ))}\r\n                                        </ul>\r\n                                    )}\r\n                                </div>\r\n\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate('/nearby')} className={styles.ghostBtn}>\r\n                                    <Sprout size={16} style={{ marginRight: '8px' }} /> Find Nearby Shop Instead\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className={styles.weatherDashboard}>\r\n                            <div className={styles.weatherCard}>\r\n                                <div className={styles.statIcon} style={{ background: 'rgba(56, 189, 248, 0.1)', color: '#38bdf8' }}>\r\n                                    <MapPin size={24} />\r\n                                </div>\r\n                                <div className={styles.statInfo}>\r\n                                    <span className={styles.statLabel}>LOCATION</span>\r\n                                    <div className={styles.statValue} style={{ fontSize: '1.1rem' }}>\r\n                                        {weather.locationName || weather.city || 'Local Zone'}\r\n                                    </div>\r\n                                    <button onClick={() => setWeather(null)} className={styles.changeLocationBtn}>\r\n                                        Change Location\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.weatherCard}>\r\n                                <div className={styles.statIcon} style={{ background: 'rgba(250, 204, 21, 0.1)', color: '#facc15' }}>\r\n                                    <Thermometer size={24} />\r\n                                </div>\r\n                                <div className={styles.statInfo}>\r\n                                    <span className={styles.statLabel}>AVG TEMPERATURE</span>\r\n                                    <div className={styles.statValue}>\r\n                                        {typeof weather.avgTemp30Days === 'number' ? weather.avgTemp30Days.toFixed(1) : '--'}Â°C\r\n                                    </div>\r\n                                    <span style={{ color: '#94a3b8', fontSize: '0.7rem' }}>30-Day Mean</span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.weatherCard}>\r\n                                <div className={`${styles.statIcon}`} style={{\r\n                                    background: `${getPollutionStatus(weather.air_quality?.aqi).color}15`,\r\n                                    color: getPollutionStatus(weather.air_quality?.aqi).color\r\n                                }}>\r\n                                    <Activity size={24} />\r\n                                </div>\r\n                                <div className={styles.statInfo}>\r\n                                    <span className={styles.statLabel}>AIR QUALITY (AQI)</span>\r\n                                    <div className={styles.statValue}>\r\n                                        {weather.air_quality?.aqi ?? 'N/A'}\r\n                                    </div>\r\n                                    <span style={{ color: getPollutionStatus(weather.air_quality?.aqi).color, fontSize: '0.7rem', fontWeight: 800 }}>\r\n                                        {getPollutionStatus(weather.air_quality?.aqi).label.toUpperCase()}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </section>\r\n\r\n            <div className={styles.intelligenceSection}>\r\n                <div className={styles.sectionHeader}>\r\n                    <span className={styles.sectionBadge}>CORE CAPABILITIES</span>\r\n                    <h2 className={styles.sectionTitle}>Built for Deep Biological Insights</h2>\r\n                    <p className={styles.sectionSubtitle}>VanaMap bridges the gap between atmospheric science and interior design.</p>\r\n                </div>\r\n                <div className={styles.onboardingGrid} style={{ marginTop: '4rem' }}>\r\n                    {capabilities.map((cap) => (\r\n                        <div\r\n                            key={cap.id}\r\n                            className={`${styles.capabilityCard} ${expandedCards[cap.id] ? styles.cardExpanded : ''}`}\r\n                            onClick={() => toggleCard(cap.id)}\r\n                            role=\"button\"\r\n                            tabIndex={0}\r\n                        >\r\n                            <div className={styles.onboardingIcon} style={{ background: cap.bg, color: cap.color }}>\r\n                                {cap.icon}\r\n                            </div>\r\n                            <h3>{cap.title}</h3>\r\n                            <p>{cap.desc}</p>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <section className={styles.onboardingSection}>\r\n                <div className={styles.sectionHeader}>\r\n                    <span className={styles.sectionBadge}>WHO ARE YOU?</span>\r\n                    <h2 className={styles.sectionTitle}>Designed for our Community</h2>\r\n                    <p className={styles.sectionSubtitle}>Discover how VanaMap empowers different roles in our green ecosystem.</p>\r\n                </div>\r\n\r\n                <div className={styles.onboardingGrid}>\r\n                    {personas.map((p) => (\r\n                        <div\r\n                            key={p.id}\r\n                            className={`${styles.onboardingCard} ${expandedCards[p.id] ? styles.cardExpanded : ''}`}\r\n                            onClick={() => toggleCard(p.id)}\r\n                            role=\"button\"\r\n                            tabIndex={0}\r\n                        >\r\n                            <div className={styles.onboardingIcon} style={{ background: p.bg, color: p.color }}>\r\n                                {p.icon}\r\n                            </div>\r\n                            <h3>{p.title}</h3>\r\n                            <p>{p.desc}</p>\r\n                            {expandedCards[p.id] && p.id === 'role-vendor' && (\r\n                                <Button\r\n                                    size=\"sm\"\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        navigate('/auth?role=vendor&view=signup');\r\n                                    }}\r\n                                    style={{ marginTop: '1rem', width: '100%', background: p.color, color: 'black', fontWeight: 800 }}\r\n                                >\r\n                                    JOIN AS VENDOR\r\n                                </Button>\r\n                            )}\r\n                            <span className={styles.onboardingMeta}>{p.meta}</span>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </section>\r\n\r\n            <div className=\"container\" id=\"plant-grid\" style={{ scrollMarginTop: '2rem' }}>\r\n                <div className={styles.sectionHeader}>\r\n                    <span className={styles.sectionBadge}>PLANT DISCOVERY</span>\r\n                    <h2 className={styles.sectionTitle}>{weather ? 'SMART MATCHES FOR YOU' : 'GLOBAL SPECIES ARCHIVE'}</h2>\r\n                    <p className={styles.sectionSubtitle}>{weather ? 'Biologically optimized for your current atmospheric zone.' : 'Browse our scientific collection of air-purifying plants.'}</p>\r\n                </div>\r\n\r\n                <div className={styles.filterDiscoverySection} ref={filterSectionRef} style={{ scrollMarginTop: '100px' }}>\r\n\r\n\r\n                    <div className={styles.filterWrapper}>\r\n                        <h3 className={styles.filterQuestion}>Which plant are you looking for?</h3>\r\n                        <div className={styles.categorySelectionList}>\r\n                            <div\r\n                                className={`${styles.categoryCard} ${filter === 'indoor' ? styles.categoryCardActive : ''}`}\r\n                                onClick={() => {\r\n                                    setFilter(filter === 'indoor' ? 'all' : 'indoor');\r\n                                    scrollToPlants();\r\n                                }}\r\n                            >\r\n                                <div className={styles.categoryIcon}>ðŸ </div>\r\n                                <div className={styles.categoryText}>\r\n                                    <h3 className={styles.categoryName}>Indoor Collection</h3>\r\n                                    <p className={styles.categoryDesc}>Air-purifying specimens for your room.</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div\r\n                                className={`${styles.categoryCard} ${filter === 'outdoor' ? styles.categoryCardActive : ''}`}\r\n                                onClick={() => {\r\n                                    setFilter(filter === 'outdoor' ? 'all' : 'outdoor');\r\n                                    scrollToPlants();\r\n                                }}\r\n                            >\r\n                                <div className={styles.categoryIcon}>ðŸŒ¿</div>\r\n                                <div className={styles.categoryText}>\r\n                                    <h3 className={styles.categoryName}>Outdoor Nature</h3>\r\n                                    <p className={styles.categoryDesc}>Resilient varieties for your garden.</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={styles.filterChipGroup}>\r\n                            <span className={styles.statLabel} style={{ fontSize: '0.7rem', marginBottom: '0.5rem', display: 'block' }}>PRECISE SUNLIGHT FILTER</span>\r\n                            <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>\r\n                                {['all', 'low', 'medium', 'high'].map((l) => (\r\n                                    <button\r\n                                        key={l}\r\n                                        className={`${styles.suggestionBtn} ${lightFilter === l ? styles.categoryCardActive : ''}`}\r\n                                        onClick={() => setLightFilter(l as any)}\r\n                                        style={{ padding: '0.5rem 1rem', fontSize: '0.8rem' }}\r\n                                    >\r\n                                        <Sun size={12} style={{ marginRight: '4px', display: 'inline-block' }} />\r\n                                        {l.toUpperCase()}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n\r\n\r\n                <div className={styles.searchBarWrapper} style={{ margin: '0 auto 3rem auto' }}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search by species name, genus, or air benefit...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className={styles.searchSpeciesInput}\r\n                    />\r\n                </div>\r\n\r\n                <div className={styles.grid} ref={plantsSectionRef} style={{ scrollMarginTop: '80px' }}>\r\n                    {plantsLoading ? (\r\n                        <div style={{ gridColumn: '1 / -1', display: 'flex', flexDirection: 'column', gap: '2rem' }}>\r\n                            {isSlowLoading && (\r\n                                <div style={{ background: 'rgba(251, 191, 36, 0.1)', border: '1px solid rgba(251, 191, 36, 0.2)', padding: '1.5rem', borderRadius: '1rem', textAlign: 'center' }}>\r\n                                    <h3 style={{ color: '#facc15', marginBottom: '0.5rem', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>\r\n                                        <AlertCircle size={20} /> Loading Plants...\r\n                                    </h3>\r\n                                    <p style={{ color: '#94a3b8', fontSize: '0.9rem' }}>Getting fresh data from the server...</p>\r\n                                </div>\r\n                            )}\r\n                            <div style={{ display: 'grid', gridTemplateColumns: 'inherit', gap: 'inherit', width: '100%' }}>\r\n                                {[...Array(10)].map((_, i) => <PlantSkeleton key={i} />)}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        displayedPlants.slice(0, visibleLimit).map((plant: Plant, index: number) => (\r\n                            <div\r\n                                key={plant.id}\r\n                                onClick={() => openDetails(plant)}\r\n                                className={styles.fadeIn}\r\n                                style={{\r\n                                    animationDelay: isFromCache ? '0s' : `${Math.min(index * 0.05, 1)}s`,\r\n                                    cursor: 'pointer'\r\n                                }}\r\n                            >\r\n                                <PlantCard\r\n                                    plant={plant}\r\n                                    onAdd={handleAddToCart}\r\n                                    score={weather ? plant.score : undefined}\r\n                                    isTopMatch={weather ? index === 0 && (plant.score || 0) > 0 : false}\r\n                                    priority={index < 2}\r\n                                    stockStatus={getVendorStats(plant.id)}\r\n                                />\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n\r\n                {!plantsLoading && displayedPlants.length > visibleLimit && (\r\n                    <div style={{ textAlign: 'center', marginTop: '3rem', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem' }}>\r\n                        <p style={{ color: 'var(--color-text-dim)', fontSize: '0.9rem', fontWeight: 500 }}>\r\n                            Showing {visibleLimit} of {displayedPlants.length} specimens\r\n                        </p>\r\n                        <Button\r\n                            onClick={() => setVisibleLimit(prev => prev + 12)}\r\n                            variant=\"primary\"\r\n                            size=\"lg\"\r\n                            className={styles.pulseBtn}\r\n                        >\r\n                            Load More <ArrowDown size={18} />\r\n                        </Button>\r\n                    </div>\r\n                )}\r\n\r\n                <div className={styles.suggestionButtonSection}>\r\n                    <Button onClick={() => navigate('/support')} className={styles.suggestionBtn}>\r\n                        <PlusCircle size={18} style={{ marginRight: '8px' }} /> Don't see a plant? Suggest it here\r\n                    </Button>\r\n                </div>\r\n\r\n                <div className={styles.sponsorCTA}>\r\n                    <div className={styles.sponsorContent}>\r\n                        <div className={styles.sponsorIcon}>\r\n                            <Heart size={32} fill=\"#facc15\" color=\"#facc15\" />\r\n                        </div>\r\n                        <div className={styles.sponsorText}>\r\n                            <h3>Support the Green Future</h3>\r\n                            <p>Partner with VanaMap to help us grow our ecosystem database.</p>\r\n                        </div>\r\n                        <Button onClick={() => navigate('/sponsor')} className={styles.sponsorButton}>\r\n                            Become a Sponsor <MoveRight size={20} style={{ marginLeft: '12px' }} />\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div style={{ textAlign: 'center', marginTop: '4rem', marginBottom: '2rem' }}>\r\n                    <p style={{ color: 'var(--color-text-dim)', marginBottom: '1rem' }}>Need help with the app?</p>\r\n                    <Button\r\n                        onClick={() => navigate('/contact')}\r\n                        variant=\"ghost\"\r\n                        size=\"lg\"\r\n                        style={{ border: '1px solid var(--color-border)', borderRadius: '99px' }}\r\n                    >\r\n                        <MessageCircle size={20} style={{ marginRight: '8px' }} /> Contact Support\r\n                    </Button>\r\n                </div>\r\n\r\n                <footer style={{\r\n                    marginTop: '6rem',\r\n                    padding: '4rem 2rem 2rem',\r\n                    borderTop: '1px solid var(--color-border)',\r\n                    background: 'var(--color-bg-alt)',\r\n                    textAlign: 'center'\r\n                }}>\r\n                    <div style={{ display: 'flex', gap: '4rem', flexWrap: 'wrap', justifyContent: 'center', marginBottom: '4rem' }}>\r\n                        <div>\r\n                            <p style={{ color: 'var(--color-text-dim)', fontSize: '0.9rem', marginBottom: '1rem' }}>Get it on Mobile</p>\r\n                            <div style={{ padding: '0.75rem', background: 'white', border: '1px solid var(--color-border)', borderRadius: '1rem', display: 'inline-block' }}>\r\n                                <QRCodeSVG value=\"https://www.vanamap.online\" size={120} />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ textAlign: 'left' }}>\r\n                            <h4 style={{ color: 'var(--color-text-main)', marginBottom: '1.5rem' }}>Ecosystem</h4>\r\n                            <ul style={{ listStyle: 'none', padding: 0, display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                                <li><a href=\"/support\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>Suggestions</a></li>\r\n                                <li><a href=\"/sponsor\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>Sponsorship</a></li>\r\n                                <li><a href=\"/vendor\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>For Vendors</a></li>\r\n                                <li><a href=\"/about\" style={{ color: 'var(--color-text-muted)', textDecoration: 'none', fontSize: '0.9rem' }}>About Us</a></li>\r\n                            </ul>\r\n                        </div>\r\n                    </div>\r\n                    <p style={{ color: 'var(--color-text-dim)', fontSize: '0.8rem' }}>Â© 2025 VanaMap - Earth's Digital Botanical Archive</p>\r\n                </footer>\r\n            </div>\r\n        </div >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Leaderboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[281,284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[281,284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[301,304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[301,304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Trophy, Crown, MapPin, Building, Sprout, TrendingUp, Users } from 'lucide-react';\r\nimport { fetchLeaderboard } from '../services/api';\r\nimport styles from './Leaderboard.module.css';\r\n\r\ninterface LeaderboardData {\r\n    users: any[];\r\n    cities: any[];\r\n}\r\n\r\nexport const Leaderboard = () => {\r\n    const [data, setData] = useState<LeaderboardData>({ users: [], cities: [] });\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const load = async () => {\r\n            try {\r\n                const res = await fetchLeaderboard();\r\n                setData(res);\r\n            } catch (e) {\r\n                console.error(\"Leaderboard load failed\", e);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        load();\r\n    }, []);\r\n\r\n    if (loading) {\r\n        return <div style={{ display: 'flex', height: '100vh', alignItems: 'center', justifyContent: 'center', color: 'white' }}>Analyzing Ecosystem Rankings...</div>;\r\n    }\r\n\r\n    // Sort top 3 for podium\r\n    const top3 = data.users.slice(0, 3);\r\n    const rest = data.users.slice(3);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <header className={styles.header}>\r\n                <div className={styles.badge}>\r\n                    <Trophy size={14} /> Global Ecosystem Rankings\r\n                </div>\r\n                <h1 className={styles.title}>Hall of Fame</h1>\r\n                <p className={styles.subtitle}>\r\n                    Celebrating the most dedicated caretakers in the VanaMap network.\r\n                    Earn Chlorophyll Points (CP) by expanding your home ecosystem.\r\n                </p>\r\n            </header>\r\n\r\n            {/* PODIUM */}\r\n            <div className={styles.podium}>\r\n                {/* 2nd Place */}\r\n                {top3[1] && (\r\n                    <div className={`${styles.podiumCard} ${styles.silver}`}>\r\n                        <div className={styles.avatar}>{top3[1].name.charAt(0)}</div>\r\n                        <h3 className={styles.userName}>{top3[1].name}</h3>\r\n                        <div className={styles.userPoints}>{top3[1].points.toLocaleString()}</div>\r\n                        <div className={styles.pointsLabel}>CP Points</div>\r\n                        <div className={styles.location}>\r\n                            <MapPin size={14} /> {top3[1].city || 'Earth'}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* 1st Place */}\r\n                {top3[0] && (\r\n                    <div className={`${styles.podiumCard} ${styles.gold}`}>\r\n                        <Crown className={styles.crown} size={48} />\r\n                        <div className={styles.avatar}>{top3[0].name.charAt(0)}</div>\r\n                        <h3 className={styles.userName}>{top3[0].name}</h3>\r\n                        <div className={styles.userPoints}>{top3[0].points.toLocaleString()}</div>\r\n                        <div className={styles.pointsLabel}>CP Points</div>\r\n                        <div className={styles.location}>\r\n                            <MapPin size={14} /> {top3[0].city || 'Earth'}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* 3rd Place */}\r\n                {top3[2] && (\r\n                    <div className={`${styles.podiumCard} ${styles.bronze}`}>\r\n                        <div className={styles.avatar}>{top3[2].name.charAt(0)}</div>\r\n                        <h3 className={styles.userName}>{top3[2].name}</h3>\r\n                        <div className={styles.userPoints}>{top3[2].points.toLocaleString()}</div>\r\n                        <div className={styles.pointsLabel}>CP Points</div>\r\n                        <div className={styles.location}>\r\n                            <MapPin size={14} /> {top3[2].city || 'Earth'}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* FULL RANKINGS */}\r\n            <div className={styles.tableContainer}>\r\n                {rest.map((user, idx) => (\r\n                    <div key={idx} className={styles.row}>\r\n                        <span className={styles.rankNumber}>#{idx + 4}</span>\r\n                        <div className={styles.userInfo}>\r\n                            <div className={styles.smallAvatar}>{user.name.charAt(0)}</div>\r\n                            <span className={styles.name}>{user.name}</span>\r\n                        </div>\r\n                        <span className={styles.rowLocation}>{user.city || 'Global'}</span>\r\n                        <div className={styles.levelBadge} style={{ marginRight: '1rem', display: 'flex', alignItems: 'center', gap: '4px', background: '#334155', padding: '4px 8px', borderRadius: '8px', fontSize: '0.8rem', color: '#fbbf24' }}>\r\n                            <Sprout size={12} /> Lvl {user.gameLevel || 1}\r\n                        </div>\r\n                        <div className={styles.rowPoints}>{user.points.toLocaleString()} CP</div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* CITY RANKINGS */}\r\n            <div className={styles.sectionHeader}>\r\n                <h2 className={styles.sectionTitle}>Neighborhood Rankings</h2>\r\n                <div style={{ color: '#64748b', fontSize: '0.9rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                    <TrendingUp size={16} /> Updated 1h ago\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.grid}>\r\n                {data.cities.length > 0 ? data.cities.map((cityData, idx) => (\r\n                    <div key={idx} className={styles.cityCard}>\r\n                        <div className={styles.cityIcon}>\r\n                            <Building size={32} />\r\n                        </div>\r\n                        <div className={styles.cityInfo}>\r\n                            <span className={styles.cityName}>{cityData._id.city || 'Wilderness'}</span>\r\n                            <div className={styles.cityMeta}>\r\n                                <Users size={12} style={{ marginRight: '4px' }} /> {cityData.userCount} Citizens\r\n                            </div>\r\n                        </div>\r\n                        <div className={styles.cityPoints}>\r\n                            <span className={styles.cityPointsValue}>{cityData.totalPoints.toLocaleString()}</span>\r\n                            <span className={styles.cityPointsLabel}>Total CP</span>\r\n                        </div>\r\n                    </div>\r\n                )) : (\r\n                    <div style={{ color: '#64748b', textAlign: 'center', gridColumn: '1/-1', padding: '4rem' }}>\r\n                        No urban ecosystem data yet. Be the first to represent your neighborhood!\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* CALL TO ACTION */}\r\n            <div style={{\r\n                background: 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%)',\r\n                padding: '3rem',\r\n                borderRadius: '2rem',\r\n                textAlign: 'center',\r\n                marginTop: '4rem',\r\n                border: '1px solid rgba(255, 255, 255, 0.05)'\r\n            }}>\r\n                <Sprout size={48} color=\"#10b981\" style={{ marginBottom: '1.5rem' }} />\r\n                <h2 style={{ color: 'white', fontSize: '1.5rem', fontWeight: 700, marginBottom: '0.75rem' }}>Increase Your Contribution</h2>\r\n                <p style={{ color: '#94a3b8', maxWidth: '500px', margin: '0 auto 2rem' }}>\r\n                    Every plant you add to your dashboard increases your home's air quality and moves your neighborhood up the charts.\r\n                </p>\r\n                <button\r\n                    onClick={() => window.location.href = '/shops'}\r\n                    style={{\r\n                        padding: '1rem 2rem',\r\n                        background: 'white',\r\n                        color: 'black',\r\n                        border: 'none',\r\n                        borderRadius: '1rem',\r\n                        fontWeight: 700,\r\n                        cursor: 'pointer'\r\n                    }}\r\n                >\r\n                    Explore Marketplace\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Nearby.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2320,2323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2320,2323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { fetchVendors, seedDatabase, logVendorContact } from '../services/api';\r\nimport { getDistanceFromLatLonInKm, formatDistance } from '../utils/logic';\r\nimport type { Vendor } from '../types';\r\nimport { MessageCircle, MapPin, ExternalLink, RefreshCw, AlertCircle, Star, Sparkles, Search, Zap } from 'lucide-react';\r\nimport { Button } from '../components/common/Button';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { useCart } from '../context/CartContext';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './Nearby.module.css';\r\n\r\ninterface OSMElement {\r\n    id: number;\r\n    lat: number;\r\n    lon: number;\r\n    tags?: {\r\n        name?: string;\r\n        shop?: string;\r\n        landuse?: string;\r\n        \"addr:full\"?: string;\r\n        \"addr:street\"?: string;\r\n        \"addr:city\"?: string;\r\n        phone?: string;\r\n        \"contact:phone\"?: string;\r\n        \"contact:whatsapp\"?: string;\r\n        [key: string]: string | undefined;\r\n    };\r\n}\r\n\r\n// Leaflet icon setup\r\nimport icon from 'leaflet/dist/images/marker-icon.png';\r\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\r\n\r\nconst DefaultIcon = L.icon({\r\n    iconUrl: icon,\r\n    shadowUrl: iconShadow,\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41]\r\n});\r\nL.Marker.prototype.options.icon = DefaultIcon;\r\n\r\nfunction ChangeView({ center }: { center: [number, number] }) {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        map.setView(center, map.getZoom());\r\n    }, [center, map]);\r\n    return null;\r\n}\r\n\r\nexport const Nearby = () => {\r\n    const { user } = useAuth();\r\n    const { items } = useCart();\r\n    const location = useLocation(); // Hook usage\r\n    const [position, setPosition] = useState<[number, number] | null>(null);\r\n    const [placeName, setPlaceName] = useState<string>(\"\");\r\n    const [nearbyVendors, setNearbyVendors] = useState<Vendor[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Initialize tab from navigation state or default to verified\r\n    const [activeTab, setActiveTab] = useState<'verified' | 'unverified' | 'all'>((location.state as any)?.tab || 'verified');\r\n\r\n    const [manualSearchQuery, setManualSearchQuery] = useState('');\r\n    const hasInitialLocateRef = useRef(false);\r\n\r\n    const handleManualLocationSearch = async () => {\r\n        if (!manualSearchQuery.trim()) return;\r\n        setLoading(true);\r\n        const tid = toast.loading(`Scanning satellite data for \"${manualSearchQuery}\"...`);\r\n\r\n        try {\r\n            // Forward Geocoding\r\n            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(manualSearchQuery)}`);\r\n            const data = await res.json();\r\n\r\n            if (data && data.length > 0) {\r\n                const { lat, lon, display_name } = data[0];\r\n                const latitude = parseFloat(lat);\r\n                const longitude = parseFloat(lon);\r\n\r\n                setPosition([latitude, longitude]);\r\n                setPlaceName(display_name.split(',')[0]); // Take safe first part\r\n                toast.success(\"Target area locked!\", { id: tid });\r\n\r\n                await fetchAllData(latitude, longitude);\r\n            } else {\r\n                toast.error(\"Location signature not found.\", { id: tid });\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            toast.error(\"Network triangulation failed.\", { id: tid });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const fetchAllData = async (lat: number, lng: number) => {\r\n        setLoading(true);\r\n        try {\r\n            // Reverse Geocoding\r\n            try {\r\n                const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);\r\n                const geoData = await geoRes.json();\r\n                if (geoData.address) {\r\n                    const city = geoData.address.city || geoData.address.town || geoData.address.village || geoData.address.suburb || \"Unknown Area\";\r\n                    setPlaceName(city);\r\n                }\r\n            } catch (e) {\r\n                console.warn(\"Geocoding failed\", e);\r\n            }\r\n\r\n            let allVendors = await fetchVendors();\r\n            if (allVendors.length === 0) {\r\n                const { VENDORS } = await import('../data/mocks');\r\n                await seedDatabase([], VENDORS);\r\n                allVendors = await fetchVendors();\r\n            }\r\n            const verifiedVendors = allVendors.filter(v => v.verified === true);\r\n\r\n            // Improved Overpass Query - Strictly Gardens and Nurseries\r\n            const overpassQuery = `\r\n[out:json][timeout:25];\r\n(\r\n    node[\"shop\"=\"garden_centre\"](around:50000,${lat},${lng});\r\n    node[\"shop\"=\"garden\"](around:50000,${lat},${lng});\r\n    node[\"leisure\"=\"garden\"](around:50000,${lat},${lng});\r\n    node[\"tourism\"=\"botanical_garden\"](around:50000,${lat},${lng});\r\n    node[\"landuse\"=\"plant_nursery\"][\"name\"](around:50000,${lat},${lng});\r\n);\r\nout body;\r\n>;\r\nout skel qt;\r\n`;\r\n\r\n            let unverifiedVendors: Vendor[] = [];\r\n            try {\r\n                const osmRes = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(overpassQuery)}`);\r\n                const osmData = await osmRes.json();\r\n                if (osmData.elements) {\r\n                    unverifiedVendors = osmData.elements\r\n                        .filter((el: OSMElement) => {\r\n                            // Must have coordinates\r\n                            if (!el.lat || !el.lon) return false;\r\n\r\n                            // If it's a shop, it must have a name. If it's a public garden, name is optional but good.\r\n                            const tags = el.tags || {};\r\n                            const name = tags.name || \"Unknown Garden\";\r\n\r\n                            // Filter out non-garden related shops\r\n                            const nameLower = name.toLowerCase();\r\n                            const excludeKeywords = ['hardware', 'supermarket', 'grocery', 'general store', 'convenience', 'department store'];\r\n                            if (excludeKeywords.some(keyword => nameLower.includes(keyword))) return false;\r\n\r\n                            return true;\r\n                        })\r\n                        .map((el: OSMElement) => {\r\n                            const tags = el.tags || {};\r\n                            let category = \"Garden\";\r\n                            if (tags.shop === 'garden_centre' || tags.landuse === 'plant_nursery') {\r\n                                category = \"Plant Shop\";\r\n                            }\r\n\r\n                            return {\r\n                                id: `osm-${el.id}`,\r\n                                name: tags.name || (category === 'Garden' ? \"Public Garden\" : \"Local Nursery\"),\r\n                                latitude: el.lat,\r\n                                longitude: el.lon,\r\n                                address: tags[\"addr:full\"] || tags[\"addr:street\"] || tags[\"addr:city\"] || (category === 'Garden' ? \"Public Space\" : \"Local Listing\"),\r\n                                phone: tags.phone || tags[\"contact:phone\"] || \"N/A\",\r\n                                whatsapp: tags[\"contact:whatsapp\"] || \"\",\r\n                                verified: false,\r\n                                highlyRecommended: false,\r\n                                category: category,\r\n                                inventoryIds: []\r\n                            };\r\n                        });\r\n                }\r\n            } catch (err) { console.error(\"OSM Error\", err); }\r\n\r\n            const combined = [...verifiedVendors, ...unverifiedVendors];\r\n            const nearby = combined.filter(v => getDistanceFromLatLonInKm(lat, lng, v.latitude, v.longitude) <= 50)\r\n                .map(v => ({ ...v, distance: getDistanceFromLatLonInKm(lat, lng, v.latitude, v.longitude) }))\r\n                .sort((a, b) => (a.distance || 0) - (b.distance || 0));\r\n\r\n            setNearbyVendors(nearby);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleGetLocation = useCallback((isManual = false) => {\r\n        if (loading) return;\r\n        const tid = isManual ? toast.loading(\"Syncing with satellite...\") : null;\r\n        setLoading(true);\r\n\r\n        if (!navigator.geolocation) {\r\n            if (tid) toast.error(\"GPS Not Supported\", { id: tid });\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        navigator.geolocation.getCurrentPosition(\r\n            async (pos) => {\r\n                const { latitude, longitude } = pos.coords;\r\n                setPosition([latitude, longitude]);\r\n                if (tid) toast.success(\"Satellites locked!\", { id: tid });\r\n                await fetchAllData(latitude, longitude);\r\n            },\r\n            () => {\r\n                if (tid) toast.error(\"Precision tracking failed\", { id: tid });\r\n                setPosition(prev => prev || [28.6139, 77.2090]); // Fallback\r\n                setLoading(false);\r\n            },\r\n            { enableHighAccuracy: true, timeout: 15000 }\r\n        );\r\n    }, [loading]);\r\n\r\n    useEffect(() => {\r\n        if (!hasInitialLocateRef.current) {\r\n            hasInitialLocateRef.current = true;\r\n            handleGetLocation(false);\r\n        }\r\n    }, [handleGetLocation]);\r\n\r\n    const displayVendors = nearbyVendors.filter(v => {\r\n        if (activeTab === 'all') return true;\r\n        return activeTab === 'verified' ? v.verified : !v.verified;\r\n    });\r\n\r\n    const resultsHeaderRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (!loading && displayVendors.length > 0 && position) {\r\n            // Scroll to first outlet after short delay for map zoom\r\n            setTimeout(() => {\r\n                resultsHeaderRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n            }, 800);\r\n        }\r\n    }, [loading, displayVendors.length, position]);\r\n\r\n    return (\r\n        <div className={styles.nearbyContainer}>\r\n            <div className={styles.noticeBanner} style={{ background: 'rgba(16, 185, 129, 0.1)', border: '1px solid rgba(16, 185, 129, 0.2)' }}>\r\n                <MapPin className={styles.noticeIcon} size={20} color=\"#10b981\" />\r\n                <div className={styles.noticeText} style={{ color: '#ecfdf5' }}>\r\n                    {placeName ? (\r\n                        <>\r\n                            <span style={{ color: '#34d399', fontWeight: 700 }}>{placeName.toUpperCase()}</span> â€” Identifying nearby green spaces...\r\n                        </>\r\n                    ) : (\r\n                        <>\r\n                            <span>GPS Active:</span> Finding the best plant shops around you.\r\n                        </>\r\n                    )}\r\n                </div>\r\n                <Button variant=\"outline\" size=\"sm\" onClick={() => handleGetLocation(true)} disabled={loading} style={{ marginLeft: 'auto', borderColor: 'rgba(255,255,255,0.2)', color: 'white' }}>\r\n                    <RefreshCw size={14} className={loading ? 'animate-spin' : ''} /> Refresh GPS\r\n                </Button>\r\n            </div>\r\n\r\n            <div className={styles.headerSection} style={{ textAlign: 'center', marginBottom: '3rem' }}>\r\n                <h1 className={styles.title} style={{ fontSize: '2.5rem', fontWeight: 900, marginBottom: '0.5rem' }}>Plant Shops Near You</h1>\r\n                <p className={styles.subtitle} style={{ fontSize: '1.1rem', color: '#94a3b8', maxWidth: '600px', margin: '0 auto' }}>\r\n                    Find trusted local nurseries and garden centers in your neighborhood.\r\n                </p>\r\n            </div>\r\n\r\n            <div className={styles.splitLayout}>\r\n                <div className={styles.mapWrapper}>\r\n                    {/* Search by Location Bar Moved Above Map */}\r\n                    <div className={styles.mapSearchBar}>\r\n                        <div className={styles.mapSearchInput}>\r\n                            <Search size={18} className={styles.mapSearchIcon} />\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Search city, neighborhood, or zip...\"\r\n                                value={manualSearchQuery}\r\n                                onChange={(e) => setManualSearchQuery(e.target.value)}\r\n                                onKeyDown={(e) => e.key === 'Enter' && handleManualLocationSearch()}\r\n                            />\r\n                        </div>\r\n                        <Button onClick={handleManualLocationSearch} disabled={loading} size=\"sm\" style={{ minWidth: '100px', height: '48px' }}>\r\n                            {loading ? <RefreshCw className=\"animate-spin\" size={20} /> : 'Search'}\r\n                        </Button>\r\n                    </div>\r\n\r\n                    <div className={styles.mapContainer}>\r\n                        {position ? (\r\n                            <MapContainer center={position} zoom={11} style={{ height: '100%', width: '100%' }}>\r\n                                <TileLayer url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\" />\r\n                                <ChangeView center={position} />\r\n                                <Marker position={position} icon={L.divIcon({\r\n                                    className: 'u-marker',\r\n                                    html: `<div style=\"background:transparent;width:30px;height:30px;display:flex;align-items:center;justify-content:center;\"><div style=\"background:var(--color-primary);width:14px;height:14px;border-radius:50%;border:2px solid #fff;box-shadow:0 0 15px var(--color-primary)\"></div></div>`\r\n                                })}><Popup>Origin point (You)</Popup></Marker>\r\n                                {displayVendors.map(v => (\r\n                                    <Marker key={v.id} position={[v.latitude, v.longitude]}>\r\n                                        <Popup><strong>{v.name}</strong><br />{formatDistance((v.distance || 0) * 1000)} away</Popup>\r\n                                    </Marker>\r\n                                ))}\r\n                            </MapContainer>\r\n                        ) : (\r\n                            <div style={{ background: 'var(--color-bg-card)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--color-text-muted)' }}>\r\n                                Initializing precision tracking...\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.resultsSection}>\r\n                    <div className={styles.resultsHeader} ref={resultsHeaderRef} style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem', scrollMarginTop: '2rem' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' }}>\r\n                            <h3 style={{ margin: 0, fontSize: '1.25rem', fontWeight: 800 }}>Nearby Outlets ({displayVendors.length})</h3>\r\n                        </div>\r\n                        {/* Subtitle - hidden on very small screens via CSS/Inline if needed, but simpler text helps */}\r\n                        <p style={{ margin: '-0.25rem 0 0 0', fontSize: '0.75rem', color: 'var(--color-text-muted)', maxWidth: '100%', overflow: 'hidden', whiteSpace: 'nowrap', textOverflow: 'ellipsis' }}>\r\n                            Showing results within a 50km radius\r\n                        </p>\r\n\r\n                        <div className={styles.tabGroup} style={{ width: '100%', display: 'flex', gap: '0.5rem', overflowX: 'auto', paddingBottom: '4px' }}>\r\n                            <button className={`${styles.tabBtn} ${activeTab === 'all' ? styles.active : ''}`} onClick={() => setActiveTab('all')} style={{ flex: 1, justifyContent: 'center', whiteSpace: 'nowrap' }}>\r\n                                <Sparkles size={16} fill={activeTab === 'all' ? 'var(--color-primary)' : 'none'} /> All\r\n                            </button>\r\n                            <button className={`${styles.tabBtn} ${activeTab === 'verified' ? styles.active : ''}`} onClick={() => setActiveTab('verified')} style={{ flex: 1, justifyContent: 'center', whiteSpace: 'nowrap' }}>\r\n                                <Star size={16} fill={activeTab === 'verified' ? 'var(--color-text-main)' : 'none'} /> Verified\r\n                            </button>\r\n                            <button className={`${styles.tabBtn} ${activeTab === 'unverified' ? styles.active : ''}`} onClick={() => setActiveTab('unverified')} style={{ flex: 1, justifyContent: 'center', whiteSpace: 'nowrap' }}>\r\n                                <AlertCircle size={16} /> Public\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Public/All Tab Warning Hint Actions - Output moved OUT of header but inside Section */}\r\n                    {/* Public/All Tab Warning Hint Actions - Shown only when no results found */}\r\n                    {!loading && (activeTab === 'unverified' || activeTab === 'all') && displayVendors.length === 0 && (\r\n                        <div style={{\r\n                            marginBottom: '1rem',\r\n                            padding: '1rem',\r\n                            background: 'var(--color-bg-card)',\r\n                            border: '1px solid var(--glass-border)',\r\n                            borderRadius: '16px',\r\n                            boxShadow: '0 4px 15px rgba(0,0,0,0.05)',\r\n                            display: 'flex',\r\n                            flexDirection: 'column', // Ensures vertical layout\r\n                            gap: '1rem',\r\n                            animation: 'fadeIn 0.5s ease-out'\r\n                        }}>\r\n                            <div style={{ display: 'flex', gap: '0.8rem', alignItems: 'flex-start' }}>\r\n                                <div style={{\r\n                                    padding: '10px',\r\n                                    background: 'rgba(234, 179, 8, 0.1)',\r\n                                    borderRadius: '12px',\r\n                                    flexShrink: 0\r\n                                }}>\r\n                                    <AlertCircle size={20} color=\"#fbbf24\" />\r\n                                </div>\r\n                                <div>\r\n                                    <h4 style={{ margin: '0 0 4px 0', fontSize: '0.95rem', fontWeight: 700 }}>Don't see any shops?</h4>\r\n                                    <p style={{ margin: 0, fontSize: '0.85rem', lineHeight: '1.4', color: 'var(--color-text-muted)' }}>\r\n                                        The map might be looking in the wrong spot. Sync your GPS to find public nurseries near you.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <Button\r\n                                size=\"md\"\r\n                                onClick={() => handleGetLocation(false)}\r\n                                style={{\r\n                                    width: '100%',\r\n                                    background: 'var(--color-text-main)',\r\n                                    color: 'var(--color-bg-main)',\r\n                                    borderRadius: '10px',\r\n                                    fontWeight: 600,\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center',\r\n                                    gap: '8px'\r\n                                }}\r\n                            >\r\n                                <MapPin size={16} /> Sync My Location\r\n                            </Button>\r\n                        </div>\r\n                    )}\r\n\r\n                    {loading ? (\r\n                        <div style={{ padding: '2rem', textAlign: 'center', animation: 'fadeIn 0.3s' }}>\r\n                            <div className=\"pulse-fast\" style={{ display: 'inline-block', marginBottom: '1rem' }}>\r\n                                <Zap size={56} color=\"#facc15\" fill=\"#facc15\" style={{ filter: 'drop-shadow(0 0 10px #facc15)' }} />\r\n                            </div>\r\n                            <h3 style={{ color: '#facc15', margin: '0 0 0.5rem', fontWeight: 800 }}>Searching for Vendors...</h3>\r\n                            <p style={{ color: 'var(--color-text-muted)', fontSize: '0.9rem' }}>Scanning nearby network at lightning speed</p>\r\n                            <style>{`\r\n                                @keyframes pulseFast {\r\n                                    0% { transform: scale(1); opacity: 1; }\r\n                                    50% { transform: scale(1.15); opacity: 0.8; }\r\n                                    100% { transform: scale(1); opacity: 1; }\r\n                                }\r\n                                .pulse-fast { animation: pulseFast 0.6s infinite ease-in-out; }\r\n                            `}</style>\r\n                        </div>\r\n                    ) : displayVendors.length === 0 ? (\r\n                        /* Only show generic empty state for Verified tab, others use the Action Card above */\r\n                        activeTab === 'verified' ? (\r\n                            <div style={{ textAlign: 'center', padding: '4rem', background: 'var(--color-bg-card)', borderRadius: '2rem', border: '1px dashed var(--glass-border)' }}>\r\n                                <MapPin size={48} color=\"var(--color-text-muted)\" style={{ marginBottom: '1rem' }} />\r\n                                <p style={{ color: 'var(--color-text-muted)' }}>No confirmed partners found. Try the 'Public' tab.</p>\r\n                            </div>\r\n                        ) : null\r\n                    ) : (\r\n                        <>\r\n                            <div className={styles.vendorGrid}>\r\n                                {displayVendors.map(vendor => (\r\n                                    <div key={vendor.id} className={`${styles.vendorCard} ${vendor.highlyRecommended ? styles.premiumCard : ''}`}>\r\n                                        {vendor.highlyRecommended && <div className={styles.premiumBadge}>Partner</div>}\r\n                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.5rem' }}>\r\n                                            <h4 className={styles.vendorName}>{vendor.name}</h4>\r\n                                            {vendor.verified && <Star size={18} fill=\"var(--color-primary)\" color=\"var(--color-primary)\" />}\r\n                                        </div>\r\n                                        <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center', marginBottom: '1rem' }}>\r\n                                            <div className={styles.vendorDist}>{formatDistance((vendor.distance || 0) * 1000)} away</div>\r\n                                            {vendor.category && <div className={styles.categoryTag}>{vendor.category}</div>}\r\n                                        </div>\r\n                                        <p className={styles.vendorAddr}>{vendor.address}</p>\r\n\r\n                                        <div className={styles.cardActions}>\r\n                                            <Button variant=\"outline\" size=\"sm\" className={styles.actionBtn} onClick={() => window.open(`https://www.google.com/maps/dir/?api=1&destination=${vendor.latitude},${vendor.longitude}`)}>\r\n                                                <ExternalLink size={14} /> Navigate\r\n                                            </Button>\r\n                                            <Button variant=\"outline\" size=\"sm\" className={styles.actionBtn} onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(vendor.name)}&query_place_id=${vendor.latitude},${vendor.longitude}`)}>\r\n                                                <MapPin size={14} /> Google Places\r\n                                            </Button>\r\n                                            {(vendor.whatsapp || vendor.phone !== 'N/A') && (\r\n                                                <Button size=\"sm\" className={styles.actionBtn} style={{ background: '#25D366', color: '#fff', border: 'none' }} onClick={() => {\r\n                                                    logVendorContact({ vendorId: vendor.id, vendorName: vendor.name, userEmail: user?.email || 'guest', contactType: 'whatsapp' });\r\n\r\n                                                    // Generate Message from Cart\r\n                                                    let message = `Hi ${vendor.name},`;\r\n                                                    if (items.length > 0) {\r\n                                                        message += ` I am interested in checking availability for:\\n`;\r\n                                                        items.forEach(item => {\r\n                                                            message += `- ${item.plant.name} (x${item.quantity})\\n`;\r\n                                                        });\r\n                                                        message += `\\nDo you have these in stock?`;\r\n                                                    } else {\r\n                                                        message += ` I saw your shop on VanaMap. Do you have [Plant Name] in stock?`;\r\n                                                    }\r\n\r\n                                                    window.open(`https://wa.me/${(vendor.whatsapp || vendor.phone).replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`, '_blank');\r\n                                                }}>\r\n                                                    <MessageCircle size={14} /> {(vendor.whatsapp || vendor.phone)}\r\n                                                </Button>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n\r\n                            {/* Partnership CTA */}\r\n                            <div style={{\r\n                                marginTop: '3rem',\r\n                                background: 'linear-gradient(45deg, rgba(25,25,25,0.8), rgba(16,185,129,0.1))',\r\n                                border: '1px solid rgba(16,185,129,0.2)',\r\n                                borderRadius: '1.5rem',\r\n                                padding: '2rem',\r\n                                textAlign: 'center'\r\n                            }}>\r\n                                <h4 style={{ margin: '0 0 0.5rem 0', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' }}>\r\n                                    <Sparkles size={18} color=\"#facc15\" /> Join VanaMap as a Seller\r\n                                </h4>\r\n                                <p style={{ color: '#94a3b8', fontSize: '0.9rem', marginBottom: '1.5rem', maxWidth: '600px', marginInline: 'auto' }}>\r\n                                    Own a nursery or plant shop? List your business here to reach more local customers.\r\n                                </p>\r\n                                <Button variant=\"primary\" size=\"sm\" onClick={() => {\r\n                                    import('react-hot-toast').then(({ default: toast }) => toast.success(\"Opening WhatsApp contact...\"));\r\n                                    window.open('https://wa.me/9188773534', '_blank');\r\n                                }}>\r\n                                    Apply via WhatsApp (+91 88773534)\r\n                                </Button>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Shops.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1402,1405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1402,1405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1479,1482],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1479,1482],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'location.state'. Either include it or remove the dependency array.","line":47,"column":8,"nodeType":"ArrayExpression","endLine":47,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [location.state]","fix":{"range":[2188,2190],"text":"[location.state]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3165,3168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3165,3168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport type { Plant, Vendor } from '../types';\r\nimport { fetchPlants, fetchVendors, logSearch } from '../services/api';\r\nimport { Search, ShoppingBag, AlertCircle } from 'lucide-react';\r\nimport { PlantVendorsModal } from '../components/features/market/PlantVendorsModal';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport styles from './Shops.module.css';\r\n\r\nexport const Shops = () => {\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [vendors, setVendors] = useState<Vendor[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [activeCategory, setActiveCategory] = useState<'all' | 'indoor' | 'outdoor'>('all');\r\n    const [loading, setLoading] = useState(true);\r\n    const [selectedPlant, setSelectedPlant] = useState<Plant | null>(null);\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            try {\r\n                const [plantsData, vendorsData] = await Promise.all([\r\n                    fetchPlants(),\r\n                    fetchVendors()\r\n                ]);\r\n                setPlants(plantsData);\r\n                setVendors(vendorsData.filter(v => v.verified));\r\n\r\n                // Check for auto-open request from navigation\r\n                if (location.state && (location.state as any).openPlantId) {\r\n                    const targetId = (location.state as any).openPlantId;\r\n                    const found = plantsData.find(p => p.id === targetId);\r\n                    if (found) {\r\n                        setSelectedPlant(found);\r\n                        // Optional: Scroll to it? Or just showing the modal is enough.\r\n                        // Modal covers screen so no scroll needed.\r\n                        window.history.replaceState({}, document.title); // Clear state so refresh doesn't reopen\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to load shop items\", error);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        loadData();\r\n    }, []);\r\n\r\n    // Log search with debounce\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) return;\r\n        const timer = setTimeout(() => {\r\n            logSearch(searchQuery);\r\n        }, 1500);\r\n        return () => clearTimeout(timer);\r\n    }, [searchQuery]);\r\n\r\n    const filteredPlants = plants.filter(p => {\r\n        const matchesCategory = activeCategory === 'all' ? true : p.type === activeCategory;\r\n        const q = searchQuery.toLowerCase();\r\n        const matchesSearch = p.name.toLowerCase().includes(q) ||\r\n            (p.scientificName?.toLowerCase().includes(q) ?? false);\r\n        return matchesCategory && matchesSearch;\r\n    });\r\n\r\n    const getStockStatus = (plant: Plant) => {\r\n        const selling = vendors.filter(v => v.inventory?.some(i => i.plantId === plant.id && i.inStock));\r\n        let count = 0;\r\n        selling.forEach(v => {\r\n            const item = v.inventory?.find(i => i.plantId === plant.id);\r\n            const qty = (item as any).quantity;\r\n            count += (typeof qty === 'number' ? qty : 1);\r\n        });\r\n        return { inStock: count > 0, count };\r\n    };\r\n\r\n    const getPriceInfo = (plant: Plant) => {\r\n        // Collect all potential prices\r\n        const potentialPrices: number[] = [];\r\n\r\n        vendors.forEach(v => {\r\n            const invItem = v.inventory?.find(i => i.plantId === plant.id && i.inStock);\r\n            if (invItem) {\r\n                potentialPrices.push(invItem.price);\r\n            }\r\n        });\r\n\r\n        if (potentialPrices.length > 0) {\r\n            const minPrice = Math.min(...potentialPrices);\r\n            return {\r\n                display: `From Rs. ${minPrice}`,\r\n                value: minPrice,\r\n                hasVendors: true,\r\n                count: potentialPrices.length\r\n            };\r\n        }\r\n\r\n        // Fallback to base price\r\n        const base = plant.price || ((plant.name.charCodeAt(0) % 5 + 1) * 150);\r\n        return {\r\n            display: `Approx Rs. ${base}`,\r\n            value: base,\r\n            hasVendors: false,\r\n            count: 0\r\n        };\r\n    };\r\n\r\n    return (\r\n        <div className={styles.shopContainer}>\r\n            {/* Header Section */}\r\n            <div className={styles.header}>\r\n                <div className={styles.badgeMain}>\r\n                    <ShoppingBag size={16} /> OFFICIAL MARKET\r\n                </div>\r\n                <h1 className={styles.titleMain}>VANAMAP<br />MARKET</h1>\r\n                <p className={styles.subtitleMain}>Curated specimens for your premium home ecosystem.</p>\r\n\r\n                {/* Search Bar */}\r\n                <div className={styles.searchContainer}>\r\n                    <Search size={20} className={styles.searchIcon} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search species...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className={styles.searchInput}\r\n                    />\r\n                </div>\r\n\r\n                {/* New Premium Filter Section */}\r\n                <div className={styles.filterContainer}>\r\n                    <div\r\n                        className={`${styles.filterCard} ${activeCategory === 'indoor' ? styles.active : ''}`}\r\n                        onClick={() => setActiveCategory(activeCategory === 'indoor' ? 'all' : 'indoor')}\r\n                    >\r\n                        <div className={styles.filterIcon}>ðŸ </div>\r\n                        <div className={styles.filterInfo}>\r\n                            <span className={styles.filterName}>Indoor</span>\r\n                            <span className={styles.filterDesc}>Interior Species</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div\r\n                        className={`${styles.filterCard} ${activeCategory === 'outdoor' ? styles.active : ''}`}\r\n                        onClick={() => setActiveCategory(activeCategory === 'outdoor' ? 'all' : 'outdoor')}\r\n                    >\r\n                        <div className={styles.filterIcon}>ðŸŒ²</div>\r\n                        <div className={styles.filterInfo}>\r\n                            <span className={styles.filterName}>Outdoor</span>\r\n                            <span className={styles.filterDesc}>Natural Resilience</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Product Grid */}\r\n            {loading ? (\r\n                <div style={{ textAlign: 'center', padding: '4rem', color: '#94a3b8' }}>Loading Shop...</div>\r\n            ) : (\r\n                <div className={styles.grid}>\r\n                    {filteredPlants.map(plant => (\r\n                        <div key={plant.id} className={styles.card} onClick={() => setSelectedPlant(plant)}>\r\n                            {/* Image Area */}\r\n                            <div className={styles.imageContainer}>\r\n                                <img\r\n                                    src={plant.imageUrl}\r\n                                    alt={plant.name}\r\n                                    className={styles.image}\r\n                                    loading=\"lazy\"\r\n                                />\r\n\r\n                                {(() => {\r\n                                    const { inStock, count } = getStockStatus(plant);\r\n                                    return (\r\n                                        <div style={{\r\n                                            position: 'absolute',\r\n                                            bottom: '54px',\r\n                                            left: '12px',\r\n                                            zIndex: 10,\r\n                                            background: inStock ? 'rgba(16, 185, 129, 0.95)' : 'rgba(239, 68, 68, 0.95)',\r\n                                            color: 'white',\r\n                                            padding: '4px 8px',\r\n                                            borderRadius: '6px',\r\n                                            fontSize: '0.65rem',\r\n                                            fontWeight: '800',\r\n                                            letterSpacing: '0.5px',\r\n                                            backdropFilter: 'blur(4px)',\r\n                                            boxShadow: '0 4px 6px rgba(0,0,0,0.15)',\r\n                                            display: 'flex',\r\n                                            alignItems: 'center',\r\n                                            gap: '4px',\r\n                                            border: '1px solid rgba(255,255,255,0.2)'\r\n                                        }}>\r\n                                            {inStock ? (\r\n                                                <>\r\n                                                    <span style={{ width: '6px', height: '6px', background: 'white', borderRadius: '50%' }}></span>\r\n                                                    IN STOCK ({count})\r\n                                                </>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <AlertCircle size={10} /> OUT OF STOCK\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                })()}\r\n\r\n                                <div className={styles.badge}>\r\n                                    {plant.type === 'indoor' ? 'Indoor' : 'Outdoor'}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Content Area */}\r\n                            <div className={styles.content}>\r\n                                <div style={{ marginBottom: 'auto' }}>\r\n                                    <h3 className={styles.title}>{plant.name}</h3>\r\n                                    <p className={styles.scientific}>{plant.scientificName}</p>\r\n\r\n                                    <div className={styles.tags}>\r\n                                        <span style={{ fontSize: '0.75rem', padding: '0.2rem 0.5rem', background: 'rgba(16, 185, 129, 0.1)', color: '#10b981', borderRadius: '4px', whiteSpace: 'nowrap' }}>\r\n                                            Air Purifying\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Price and Action */}\r\n                                <div className={styles.footer}>\r\n                                    <div className={styles.price}>\r\n                                        {(() => {\r\n                                            const info = getPriceInfo(plant);\r\n                                            return (\r\n                                                <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                                                    <span style={{ fontSize: '1.1rem', fontWeight: 700 }}>{info.display}</span>\r\n                                                    {info.hasVendors && (\r\n                                                        <span style={{ fontSize: '0.7rem', color: '#10b981' }}>\r\n                                                            {info.count} local seller{info.count !== 1 ? 's' : ''}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                            );\r\n                                        })()}\r\n                                    </div>\r\n                                    <button className={styles.btn}>\r\n                                        View Options\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {/* Vendor CTA Section */}\r\n            <div className={styles.vendorCTA}>\r\n                <div style={{ display: 'inline-flex', padding: '1rem', background: 'rgba(250, 204, 21, 0.1)', borderRadius: '1rem', marginBottom: '1.5rem' }}>\r\n                    <ShoppingBag size={32} color=\"#facc15\" />\r\n                </div>\r\n                <h2 className={styles.vendorCTATitle}>Own a Plant Shop?</h2>\r\n                <p className={styles.vendorCTADesc}>\r\n                    Join our verified network of nurseries and start connecting with thousands of plant lovers in your area.\r\n                </p>\r\n                <button\r\n                    onClick={() => navigate('/auth?role=vendor&view=signup')}\r\n                    style={{\r\n                        padding: '1.25rem 2.5rem',\r\n                        fontSize: '1.1rem',\r\n                        fontWeight: '800',\r\n                        background: 'linear-gradient(135deg, #facc15 0%, #ca8a04 100%)',\r\n                        color: '#000',\r\n                        border: 'none',\r\n                        borderRadius: '1.25rem',\r\n                        cursor: 'pointer',\r\n                        boxShadow: '0 10px 30px rgba(250, 204, 21, 0.3)',\r\n                        transition: 'all 0.3s ease'\r\n                    }}\r\n                    onMouseOver={(e) => {\r\n                        e.currentTarget.style.transform = 'translateY(-4px)';\r\n                        e.currentTarget.style.boxShadow = '0 15px 40px rgba(250, 204, 21, 0.4)';\r\n                    }}\r\n                    onMouseOut={(e) => {\r\n                        e.currentTarget.style.transform = 'translateY(0)';\r\n                        e.currentTarget.style.boxShadow = '0 10px 30px rgba(250, 204, 21, 0.3)';\r\n                    }}\r\n                >\r\n                    REGISTER AS VENDOR\r\n                </button>\r\n            </div>\r\n\r\n            {selectedPlant && (\r\n                <PlantVendorsModal\r\n                    plant={selectedPlant}\r\n                    onClose={() => setSelectedPlant(null)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Sponsor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\Support.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":36,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { ArrowLeft, Send, Sparkles, AlertTriangle, Store, MoveRight, Heart } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Button } from '../components/common/Button';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { toast } from 'react-hot-toast';\r\nimport { submitSuggestion } from '../services/api';\r\nimport styles from './Support.module.css';\r\n\r\nexport const Support = () => {\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const [plantName, setPlantName] = useState('');\r\n    const [reason, setReason] = useState('');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    const handleSubmitSuggestion = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!plantName || !reason) {\r\n            toast.error(\"Please fill in all fields.\");\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            await submitSuggestion({\r\n                userId: user?.id,\r\n                userName: user?.name,\r\n                plantName,\r\n                description: reason\r\n            });\r\n\r\n            toast.success(\"Suggestion sent successfully!\");\r\n            setPlantName('');\r\n            setReason('');\r\n        } catch (err) {\r\n            toast.error(\"Failed to send suggestion.\");\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.supportContainer}>\r\n            <button onClick={() => navigate(-1)} className={styles.backBtn}>\r\n                <ArrowLeft size={18} /> Back to Ecosystem\r\n            </button>\r\n\r\n            <header className={styles.header}>\r\n                <div className={styles.badge}>\r\n                    COMMUNITY POWERED\r\n                </div>\r\n                <h1 className={styles.title}>How can we<br />help you?</h1>\r\n                <p className={styles.subtitle}>Join our mission to bridge nature with technology. Whether you want to contribute, partner, or fix an issue, we're here.</p>\r\n            </header>\r\n\r\n            <div className={styles.sectionGrid}>\r\n                {/* Sponsor Section */}\r\n                <div className={`${styles.glassCard} ${styles.sponsorCard}`}>\r\n                    <div className={styles.cardHeader}>\r\n                        <div className={`${styles.iconWrapper} ${styles.sponsorIcon}`}>\r\n                            <Heart size={32} fill=\"#facc15\" color=\"#facc15\" />\r\n                        </div>\r\n                        <h2 className={styles.cardTitle} style={{ color: '#facc15' }}>Partner with VanaMap</h2>\r\n                    </div>\r\n                    <p className={styles.cardDesc}>\r\n                        We're looking for visionary partners to help us scale.\r\n                        Your support directly funds reforestation projects and advanced research.\r\n                    </p>\r\n                    <Button\r\n                        onClick={() => navigate('/sponsor')}\r\n                        className={styles.sponsorActionBtn}\r\n                        style={{\r\n                            width: '100%',\r\n                            background: 'linear-gradient(135deg, #facc15 0%, #ca8a04 100%)',\r\n                            color: '#000',\r\n                            fontWeight: '900',\r\n                            borderRadius: '1.25rem',\r\n                            padding: '1.5rem',\r\n                            fontSize: '1.1rem',\r\n                            border: 'none',\r\n                            boxShadow: '0 15px 30px -10px rgba(250, 204, 21, 0.4)'\r\n                        }}\r\n                    >\r\n                        BECOME A SPONSOR <MoveRight size={22} style={{ marginLeft: '12px' }} />\r\n                    </Button>\r\n                </div>\r\n\r\n                {/* Plant Suggestion */}\r\n                <div className={styles.glassCard}>\r\n                    <div className={styles.cardHeader}>\r\n                        <div className={`${styles.iconWrapper} ${styles.sparkleIcon}`}>\r\n                            <Sparkles size={32} />\r\n                        </div>\r\n                        <div>\r\n                            <h2 className={styles.cardTitle}>Suggest a Plant</h2>\r\n                            <span className={styles.cardSubtitle}>Help us grow our database of oxygen-rich species.</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <form onSubmit={handleSubmitSuggestion} className={styles.formGrid}>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Plant Name</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"e.g. Rare Monstera Adansonii\"\r\n                                value={plantName}\r\n                                onChange={e => setPlantName(e.target.value)}\r\n                                className={styles.input}\r\n                            />\r\n                        </div>\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Why should we add this?</label>\r\n                            <textarea\r\n                                placeholder=\"Tell us about its benefits, where it grows, or why you love it...\"\r\n                                value={reason}\r\n                                onChange={e => setReason(e.target.value)}\r\n                                rows={3}\r\n                                className={styles.textarea}\r\n                            />\r\n                        </div>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            disabled={isSubmitting}\r\n                            variant=\"primary\"\r\n                            style={{ padding: '1.25rem', borderRadius: '1rem', fontWeight: '800' }}\r\n                        >\r\n                            {isSubmitting ? 'PROCESSING...' : 'SUBMIT REQUEST'} <Send size={18} />\r\n                        </Button>\r\n                    </form>\r\n                </div>\r\n\r\n                {/* Mini Actions Grid */}\r\n                <div className={styles.actionGrid}>\r\n                    <div className={`${styles.glassCard} ${styles.miniCard}`}>\r\n                        <Store size={32} color=\"#10b981\" className={styles.miniIcon} />\r\n                        <h3 className={styles.miniTitle}>Vendor Hub</h3>\r\n                        <p className={styles.miniDesc}>Scale your nursery business by joining our verified network.</p>\r\n                        <Button variant=\"outline\" style={{ width: '100%' }} onClick={() => navigate('/auth?role=vendor&view=signup')}>JOIN NETWORK</Button>\r\n                    </div>\r\n\r\n                    <div className={`${styles.glassCard} ${styles.miniCard}`}>\r\n                        <AlertTriangle size={32} color=\"#f43f5e\" className={styles.miniIcon} />\r\n                        <h3 className={styles.miniTitle}>Report Data Issue</h3>\r\n                        <p className={styles.miniDesc}>Spotted an error? Help us keep our plant data accurate.</p>\r\n                        <Button variant=\"outline\" style={{ width: '100%' }} onClick={() => window.location.href = 'mailto:support@vanamap.com'}>REPORT AN ISSUE</Button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\UserDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2045,2048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2045,2048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2096,2099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2096,2099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'navigate'. Either include it or remove the dependency array.","line":70,"column":8,"nodeType":"ArrayExpression","endLine":70,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [navigate, user]","fix":{"range":[3066,3072],"text":"[navigate, user]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":112,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":112,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'user'. Either include it or remove the dependency array.","line":134,"column":8,"nodeType":"ArrayExpression","endLine":134,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [user, user.email]","fix":{"range":[5106,5119],"text":"[user, user.email]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":160,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":362,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18749,18752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18749,18752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":376,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19499,19502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19499,19502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useCart } from '../context/CartContext';\r\nimport { Button } from '../components/common/Button';\r\nimport { Trash2, ShoppingBag, MapPin, Heart, ArrowRight, Loader2, Store, Shield, Lock, Trophy, Zap, TrendingUp, Wind, Award } from 'lucide-react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport { fetchPlants, fetchVendors, updateVendor, changePassword } from '../services/api';\r\nimport type { Plant, Vendor } from '../types';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './UserDashboard.module.css';\r\n\r\nexport const UserDashboard = () => {\r\n    const { items, removeFromCart } = useCart();\r\n    const { user, loading, toggleFavorite } = useAuth();\r\n    const navigate = useNavigate();\r\n\r\n    // Favorites State\r\n    const [allPlants, setAllPlants] = useState<Plant[]>([]);\r\n    const [loadingFavs, setLoadingFavs] = useState(true);\r\n\r\n    // Vendor Onboarding State\r\n    const [showVendorModal, setShowVendorModal] = useState(false);\r\n    const [detectingLoc, setDetectingLoc] = useState(false);\r\n    const [myVendor, setMyVendor] = useState<Vendor | null>(null);\r\n    const [vendorForm, setVendorForm] = useState({\r\n        name: '',\r\n        address: '',\r\n        phone: '',\r\n        latitude: 0,\r\n        longitude: 0\r\n    });\r\n\r\n    const [showPasswordModal, setShowPasswordModal] = useState(false);\r\n    const [pwdForm, setPwdForm] = useState({ old: '', new: '', confirm: '' });\r\n\r\n    useEffect(() => {\r\n        const loadVendorData = async () => {\r\n            if (user?.role === 'vendor') {\r\n                try {\r\n                    const vendors = await fetchVendors();\r\n                    // Soft match on ID (mongo _id vs. string id)\r\n                    // Robust matching for different ID formats (mongo _id vs. string id)\r\n                    const vendor = vendors.find(v =>\r\n                        String(v.id) === String(user.id) ||\r\n                        String(v.id) === String((user as any)._id) ||\r\n                        String((v as any)._id) === String(user.id)\r\n                    );\r\n                    if (vendor) {\r\n                        setMyVendor(vendor);\r\n                        setVendorForm(prev => ({\r\n                            ...prev,\r\n                            name: vendor.name,\r\n                            address: vendor.address || '',\r\n                            phone: vendor.phone || '',\r\n                            latitude: vendor.latitude || 0,\r\n                            longitude: vendor.longitude || 0\r\n                        }));\r\n\r\n                        // Prompt if location missing (essential for Nearby Shops)\r\n                        if (!vendor.latitude || !vendor.longitude) {\r\n                            navigate('/vendor');\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Vendor check failed\", e);\r\n                }\r\n            }\r\n        };\r\n        loadVendorData();\r\n    }, [user]);\r\n\r\n    const detectLocation = () => {\r\n        setDetectingLoc(true);\r\n        if (!navigator.geolocation) {\r\n            toast.error(\"GPS not supported\");\r\n            setDetectingLoc(false);\r\n            return;\r\n        }\r\n        navigator.geolocation.getCurrentPosition(\r\n            (pos) => {\r\n                setVendorForm(prev => ({\r\n                    ...prev,\r\n                    latitude: pos.coords.latitude,\r\n                    longitude: pos.coords.longitude\r\n                }));\r\n                setDetectingLoc(false);\r\n                toast.success(\"Location detected!\");\r\n            },\r\n            (err) => {\r\n                console.error(err);\r\n                toast.error(\"Could not fetch location\");\r\n                setDetectingLoc(false);\r\n            }\r\n        );\r\n    };\r\n\r\n    const submitVendorProfile = async () => {\r\n        if (!myVendor) return;\r\n        const tid = toast.loading(\"Updating shop profile...\");\r\n        try {\r\n            const updated = await updateVendor(myVendor.id, {\r\n                ...vendorForm,\r\n                verified: false // Admin approval required now\r\n            });\r\n\r\n            if (updated) {\r\n                toast.success(\"Profile submitted! Awaiting Admin verification.\", { id: tid });\r\n                setShowVendorModal(false);\r\n            } else {\r\n                toast.error(\"Failed to update profile\", { id: tid });\r\n            }\r\n        } catch (e) {\r\n            toast.error(\"Network error saving profile\", { id: tid });\r\n        }\r\n    };\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            if (user) {\r\n                setLoadingFavs(true);\r\n                try {\r\n                    const plants = await fetchPlants();\r\n                    setAllPlants(plants);\r\n                } catch (e) {\r\n                    console.error(\"Failed to load plants\", e);\r\n                } finally {\r\n                    setLoadingFavs(false);\r\n                }\r\n            }\r\n        };\r\n        loadData();\r\n    }, [user?.email]); // Only reload if user email changes, simplified dependency\r\n\r\n    // Compute favorites from allPlants based on user.favorites IDs\r\n    const favoritePlants = allPlants.filter(p => user?.favorites?.includes(p.id));\r\n\r\n    const handleRemoveFavorite = (plantId: string) => {\r\n        if (!user) return;\r\n        toggleFavorite(plantId); // Context handles optimistic update & API\r\n    };\r\n\r\n    const handlePasswordChange = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (pwdForm.new !== pwdForm.confirm) {\r\n            toast.error(\"New passwords do not match!\");\r\n            return;\r\n        }\r\n        const tid = toast.loading(\"Updating security key...\");\r\n        try {\r\n            const res = await changePassword(pwdForm.old, pwdForm.new);\r\n            if (res.success) {\r\n                toast.success(\"Password Updated Successfully!\", { id: tid });\r\n                setShowPasswordModal(false);\r\n                setPwdForm({ old: '', new: '', confirm: '' });\r\n            } else {\r\n                toast.error(res.error || \"Failed to update\", { id: tid });\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"System error updating password\", { id: tid });\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div style={{ height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\r\n                <div className=\"pre-loader-pulse\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!user) {\r\n        navigate('/auth');\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className=\"container\" style={{ padding: '3rem 1rem' }}>\r\n            {/* VENDOR ONBOARDING MODAL */}\r\n            {showVendorModal && (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, zIndex: 1000,\r\n                    background: 'rgba(0,0,0,0.8)', backdropFilter: 'blur(8px)',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem'\r\n                }}>\r\n                    <div style={{\r\n                        width: '100%', maxWidth: '500px',\r\n                        background: 'var(--color-bg-card)', border: '1px solid var(--glass-border)',\r\n                        borderRadius: '1.5rem', padding: '2rem',\r\n                        boxShadow: '0 20px 50px rgba(0,0,0,0.3)',\r\n                        animation: 'fadeIn 0.3s ease-out'\r\n                    }}>\r\n                        <div style={{ textAlign: 'center', marginBottom: '2rem' }}>\r\n                            <div style={{ display: 'inline-flex', padding: '1rem', background: 'rgba(250, 204, 21, 0.1)', borderRadius: '50%', marginBottom: '1rem' }}>\r\n                                <Store size={32} color=\"#facc15\" />\r\n                            </div>\r\n                            <h2 style={{ fontSize: '1.8rem', fontWeight: 800, margin: 0 }}>Register Your Shop</h2>\r\n                            <p style={{ color: 'var(--color-text-muted)', marginTop: '0.5rem' }}>\r\n                                To appear on the \"Nearby Shops\" map, we need your exact location.\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Shop Name</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={vendorForm.name}\r\n                                    onChange={e => setVendorForm({ ...vendorForm, name: e.target.value })}\r\n                                    style={{\r\n                                        width: '100%', padding: '0.8rem', borderRadius: '0.75rem',\r\n                                        background: 'rgba(255,255,255,0.05)', border: '1px solid var(--glass-border)',\r\n                                        color: 'var(--color-text-main)'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Phone / WhatsApp</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={vendorForm.phone}\r\n                                    placeholder=\"+91...\"\r\n                                    onChange={e => setVendorForm({ ...vendorForm, phone: e.target.value })}\r\n                                    style={{\r\n                                        width: '100%', padding: '0.8rem', borderRadius: '0.75rem',\r\n                                        background: 'rgba(255,255,255,0.05)', border: '1px solid var(--glass-border)',\r\n                                        color: 'var(--color-text-main)'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Store Coordinates (GPS)</label>\r\n                                <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        readOnly\r\n                                        placeholder=\"Latitude\"\r\n                                        value={vendorForm.latitude || ''}\r\n                                        style={{ flex: 1, padding: '0.8rem', borderRadius: '0.75rem', background: 'rgba(0,0,0,0.2)', border: 'none', color: 'var(--color-text-muted)' }}\r\n                                    />\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        readOnly\r\n                                        placeholder=\"Longitude\"\r\n                                        value={vendorForm.longitude || ''}\r\n                                        style={{ flex: 1, padding: '0.8rem', borderRadius: '0.75rem', background: 'rgba(0,0,0,0.2)', border: 'none', color: 'var(--color-text-muted)' }}\r\n                                    />\r\n                                </div>\r\n                                <Button\r\n                                    onClick={detectLocation}\r\n                                    disabled={detectingLoc}\r\n                                    variant=\"outline\"\r\n                                    style={{\r\n                                        width: '100%', marginTop: '0.5rem',\r\n                                        display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem'\r\n                                    }}\r\n                                >\r\n                                    {detectingLoc ? <Loader2 className=\"animate-spin\" size={16} /> : <MapPin size={16} />}\r\n                                    {vendorForm.latitude ? 'Update GPS Location' : 'Auto-Detect My Shop Location'}\r\n                                </Button>\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Full Address</label>\r\n                                <textarea\r\n                                    value={vendorForm.address}\r\n                                    onChange={e => setVendorForm({ ...vendorForm, address: e.target.value })}\r\n                                    placeholder=\"Street, City, Landmark...\"\r\n                                    style={{\r\n                                        width: '100%', padding: '0.8rem', borderRadius: '0.75rem',\r\n                                        background: 'rgba(255,255,255,0.05)', border: '1px solid var(--glass-border)',\r\n                                        color: 'var(--color-text-main)', minHeight: '80px'\r\n                                    }}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ marginTop: '2rem', display: 'flex', gap: '1rem' }}>\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => setShowVendorModal(false)}\r\n                                style={{ flex: 1 }}\r\n                            >\r\n                                Cancel\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"primary\"\r\n                                onClick={submitVendorProfile}\r\n                                disabled={!vendorForm.latitude || !vendorForm.name}\r\n                                style={{ flex: 2, background: 'var(--color-primary)', color: 'white' }}\r\n                            >\r\n                                Save & Go Live\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* PASSWORD RESET MODAL */}\r\n            {showPasswordModal && (\r\n                <div style={{\r\n                    position: 'fixed', inset: 0, zIndex: 1001,\r\n                    background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(8px)',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem'\r\n                }}>\r\n                    <div className=\"glass-panel\" style={{\r\n                        width: '100%', maxWidth: '400px', padding: '2.5rem', borderRadius: '24px'\r\n                    }}>\r\n                        <div style={{ textAlign: 'center', marginBottom: '2rem' }}>\r\n                            <div className={styles.passwordModalIcon}>\r\n                                <Lock size={28} />\r\n                            </div>\r\n                            <h2 className={styles.passwordModalTitle}>Update Security</h2>\r\n                            <p className={styles.passwordModalSubtitle}>Change your account password</p>\r\n                        </div>\r\n                        <form onSubmit={handlePasswordChange} style={{ display: 'flex', flexDirection: 'column', gap: '1.25rem' }}>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 600, color: '#94a3b8' }}>Current Password</label>\r\n                                <input\r\n                                    type=\"password\" required\r\n                                    value={pwdForm.old}\r\n                                    onChange={e => setPwdForm({ ...pwdForm, old: e.target.value })}\r\n                                    style={{ width: '100%', padding: '0.9rem', borderRadius: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', color: 'white' }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 600, color: '#94a3b8' }}>New Password</label>\r\n                                <input\r\n                                    type=\"password\" required\r\n                                    value={pwdForm.new}\r\n                                    onChange={e => setPwdForm({ ...pwdForm, new: e.target.value })}\r\n                                    style={{ width: '100%', padding: '0.9rem', borderRadius: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', color: 'white' }}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.85rem', fontWeight: 600, color: '#94a3b8' }}>Confirm New Password</label>\r\n                                <input\r\n                                    type=\"password\" required\r\n                                    value={pwdForm.confirm}\r\n                                    onChange={e => setPwdForm({ ...pwdForm, confirm: e.target.value })}\r\n                                    style={{ width: '100%', padding: '0.9rem', borderRadius: '12px', background: 'rgba(255,255,255,0.05)', border: '1px solid rgba(255,255,255,0.1)', color: 'white' }}\r\n                                />\r\n                            </div>\r\n\r\n                            <div style={{ display: 'flex', gap: '1rem', marginTop: '1rem' }}>\r\n                                <Button type=\"button\" variant=\"outline\" onClick={() => setShowPasswordModal(false)} style={{ flex: 1 }}>Cancel</Button>\r\n                                <Button type=\"submit\" variant=\"primary\" style={{ flex: 2 }}>Update Now</Button>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* PREMIUM STATS BOARD */}\r\n            <div className={styles.statsBoard}>\r\n                {/* Points Card */}\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', color: 'white' }}>\r\n                        <Zap size={20} />\r\n                    </div>\r\n                    <div className={styles.statInfo}>\r\n                        <div className={styles.statValue}>{(user as any).points || 0}</div>\r\n                        <div className={styles.statLabel}>Points</div>\r\n                    </div>\r\n                    <div className={styles.statTrend} style={{ color: '#10b981' }}>\r\n                        <TrendingUp size={12} /> +12%\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Rank Card */}\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'linear-gradient(135deg, #facc15 0%, #ca8a04 100%)', color: 'black' }}>\r\n                        <Trophy size={20} />\r\n                    </div>\r\n                    <div className={styles.statInfo}>\r\n                        <div className={styles.statValue}>#{(user as any).points > 0 ? '4' : 'N/A'}</div>\r\n                        <div className={styles.statLabel}>Ranking</div>\r\n                    </div>\r\n                    <div className={styles.statTrend} style={{ color: '#facc15' }}>\r\n                        <Award size={12} /> Elite\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Impact Card */}\r\n                <div className={styles.statCard}>\r\n                    <div className={styles.statIcon} style={{ background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)', color: 'white' }}>\r\n                        <Wind size={20} />\r\n                    </div>\r\n                    <div className={styles.statInfo}>\r\n                        <div className={styles.statValue}>{((favoritePlants.length || items.length) * 1.2).toFixed(1)}L</div>\r\n                        <div className={styles.statLabel}>Oxygen</div>\r\n                    </div>\r\n                    <div className={styles.statTrend} style={{ color: '#3b82f6' }}>\r\n                        Positive\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.header}>\r\n                <div className={styles.titleSection}>\r\n                    <div className={styles.welcomeTag}>VANAMAP ECOSYSTEM</div>\r\n                    <h1 className={styles.dashboardTitle}>\r\n                        Hello, {user.name.split(' ')[0]}!\r\n                    </h1>\r\n                </div>\r\n\r\n                <div className={styles.actionGroup}>\r\n                    <button onClick={() => setShowPasswordModal(true)} className={styles.iconActionBtn} title=\"Security Settings\">\r\n                        <Lock size={18} />\r\n                    </button>\r\n\r\n                    <button onClick={() => navigate('/leaderboard')} className={styles.iconActionBtn} title=\"Leaderboard\">\r\n                        <Trophy size={18} />\r\n                    </button>\r\n\r\n                    {user.role === 'vendor' && (\r\n                        <Button onClick={() => navigate('/vendor')} variant=\"primary\" size=\"sm\" style={{ padding: '0.6rem 1.2rem', borderRadius: '0.75rem' }}>\r\n                            <Store size={18} /> Shop Portal\r\n                        </Button>\r\n                    )}\r\n\r\n                    {user.role === 'admin' && (\r\n                        <button\r\n                            onClick={() => navigate('/admin')}\r\n                            className={styles.adminHubBtn}\r\n                        >\r\n                            <Shield size={18} />\r\n                            ADMIN\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {user.role === 'admin' && (\r\n                <div className={styles.adminMiniPanel}>\r\n                    <div className={styles.adminMiniHeader}>\r\n                        <div className={styles.adminStatus}>â€¢ System Root Active</div>\r\n                        <Button onClick={() => navigate('/admin')} variant=\"outline\" size=\"sm\" style={{ fontSize: '0.7rem', height: '30px', padding: '0 12px' }}>\r\n                            Open Panel\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className={styles.mainGrid}>\r\n                {/* FAVORITES SECTION */}\r\n                <section className={styles.dashboardSection}>\r\n                    <div className={styles.sectionHeader}>\r\n                        <h2 className={styles.sectionTitle}>Collection</h2>\r\n                        <span className={styles.sectionCount}>{user.favorites?.length || 0}</span>\r\n                    </div>\r\n\r\n                    {loadingFavs ? (\r\n                        <div className={styles.loadingBox}>\r\n                            <Loader2 className=\"animate-spin\" />\r\n                        </div>\r\n                    ) : favoritePlants.length === 0 ? (\r\n                        <div className={styles.emptyState}>\r\n                            <Heart size={32} />\r\n                            <p>No favorites yet</p>\r\n                            <Link to=\"/\"><Button variant=\"outline\" size=\"sm\">Explore</Button></Link>\r\n                        </div>\r\n                    ) : (\r\n                        <div className={styles.compactGrid}>\r\n                            {favoritePlants.map(plant => (\r\n                                <div key={plant.id} className={styles.compactCard}>\r\n                                    <div className={styles.compactCardImage}>\r\n                                        <img src={plant.imageUrl} alt={plant.name} />\r\n                                        <button\r\n                                            onClick={() => handleRemoveFavorite(plant.id)}\r\n                                            className={styles.removeFavBtn}\r\n                                        >\r\n                                            <Heart size={14} fill=\"#ef4444\" color=\"#ef4444\" />\r\n                                        </button>\r\n                                    </div>\r\n                                    <div className={styles.compactCardContent}>\r\n                                        <h3>{plant.name}</h3>\r\n                                        <p>{plant.scientificName}</p>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </section>\r\n\r\n                <aside className={styles.dashboardSidebar}>\r\n                    {/* WISHLIST / CART SECTION */}\r\n                    <section className={styles.dashboardSection} style={{ marginBottom: '2rem' }}>\r\n                        <div className={styles.sectionHeader}>\r\n                            <h2 className={styles.sectionTitle}>Cart Items</h2>\r\n                            <span className={styles.sectionCount} style={{ background: 'rgba(56, 189, 248, 0.1)', color: '#38bdf8' }}>{items.length}</span>\r\n                        </div>\r\n\r\n                        {items.length === 0 ? (\r\n                            <div className={styles.emptySidebarState}>\r\n                                <ShoppingBag size={24} />\r\n                                <p>Cart is empty</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.cartList}>\r\n                                {items.slice(0, 3).map(({ plant }) => (\r\n                                    <div key={plant.id} className={styles.cartItemMini}>\r\n                                        <img src={plant.imageUrl} alt={plant.name} />\r\n                                        <div className={styles.cartItemInfo}>\r\n                                            <h4>{plant.name}</h4>\r\n                                        </div>\r\n                                        <button onClick={() => removeFromCart(plant.id)} className={styles.cartRemoveBtn}>\r\n                                            <Trash2 size={14} />\r\n                                        </button>\r\n                                    </div>\r\n                                ))}\r\n                                {items.length > 3 && <p className={styles.moreItems}>+{items.length - 3} more items</p>}\r\n                                <Link to=\"/cart\" className={styles.sidebarActionLink}>\r\n                                    View Full Cart <ArrowRight size={14} />\r\n                                </Link>\r\n                            </div>\r\n                        )}\r\n                    </section>\r\n\r\n                    {/* Nearby Shops Section */}\r\n                    <section className={styles.dashboardSection}>\r\n                        <div className={styles.sectionHeader}>\r\n                            <h2 className={styles.sectionTitle}>Nearby Shops</h2>\r\n                        </div>\r\n                        <div className={styles.shopPreviewCard}>\r\n                            <div className={styles.shopPreviewImage}>\r\n                                <div className={styles.shopPreviewOverlay}>\r\n                                    <MapPin size={24} />\r\n                                    <span>Find Nurseries</span>\r\n                                </div>\r\n                            </div>\r\n                            <Link to=\"/nearby\">\r\n                                <Button variant=\"primary\" style={{ width: '100%', borderRadius: '0.75rem' }}>Open interactive Map</Button>\r\n                            </Link>\r\n                        </div>\r\n                    </section>\r\n                </aside>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\VendorPortal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[880,883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[880,883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadVendorData'. Either include it or remove the dependency array.","line":84,"column":8,"nodeType":"ArrayExpression","endLine":84,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [loadVendorData, user]","fix":{"range":[3288,3294],"text":"[loadVendorData, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3500,3503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3500,3503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { MapContainer, TileLayer, Marker, Popup, useMapEvents, useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { Button } from '../components/common/Button';\r\nimport { Store, Phone, MessageCircle, Info, Locate, AlertTriangle, BadgeCheck } from 'lucide-react';\r\nimport { registerVendor, fetchVendors, updateVendor } from '../services/api';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\nimport type { LatLng } from 'leaflet';\r\nimport type { Vendor } from '../types';\r\nimport { VendorInventory } from '../components/features/vendor/VendorInventory';\r\nimport { MarketInsights } from '../components/features/vendor/MarketInsights';\r\nimport styles from './VendorPortal.module.css';\r\n\r\n// Fix Leaflet's default icon path issues\r\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n    iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\r\n    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\r\n    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\r\n});\r\n\r\n// Component to recenter map when marker moves\r\nconst RecenterMap = ({ center }: { center: LatLng }) => {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        map.flyTo(center, 15);\r\n    }, [center, map]);\r\n    return null;\r\n};\r\n\r\nfunction DraggableMarker({ pos, setPos }: { pos: L.LatLng, setPos: (pos: L.LatLng) => void }) {\r\n    useMapEvents({\r\n        click(e) {\r\n            setPos(e.latlng);\r\n            toast.success(\"Location pinned!\");\r\n        },\r\n    });\r\n\r\n    return (\r\n        <Marker\r\n            draggable={true}\r\n            eventHandlers={{\r\n                dragend: (e) => {\r\n                    const marker = e.target;\r\n                    if (marker != null) {\r\n                        setPos(marker.getLatLng());\r\n                        toast.success(\"Location updated!\");\r\n                    }\r\n                },\r\n            }}\r\n            position={pos}>\r\n            <Popup>\r\n                <div style={{ textAlign: 'center', padding: '0.5rem' }}>\r\n                    <strong style={{ display: 'block', marginBottom: '4px' }}>Shop Marker</strong>\r\n                    <span style={{ fontSize: '0.75rem', color: '#64748b' }}>Move to exact warehouse/shop spot</span>\r\n                </div>\r\n            </Popup>\r\n        </Marker>\r\n    );\r\n}\r\n\r\nexport const VendorPortal = () => {\r\n    const { user } = useAuth();\r\n    const [markerPos, setMarkerPos] = useState<L.LatLng>(new L.LatLng(20.5937, 78.9629));\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [existingVendorId, setExistingVendorId] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n    const [isLocating, setIsLocating] = useState(false);\r\n    const [currentVendor, setCurrentVendor] = useState<Vendor | null>(null);\r\n\r\n    const [formData, setFormData] = useState({\r\n        shopName: '',\r\n        phone: '',\r\n        whatsapp: '',\r\n        address: ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (user?.role === 'vendor' || user?.role === 'admin') {\r\n            loadVendorData();\r\n        }\r\n    }, [user]);\r\n\r\n    const loadVendorData = async () => {\r\n        const vendors = await fetchVendors();\r\n        if (!user) return;\r\n\r\n        const myVendor = vendors.find(v => v.id === user.id || v.id === (user as any)._id);\r\n\r\n        if (myVendor) {\r\n            setCurrentVendor(myVendor);\r\n            setIsEditing(true);\r\n            setExistingVendorId(myVendor.id);\r\n            setFormData({\r\n                shopName: myVendor.name,\r\n                phone: myVendor.phone || '',\r\n                whatsapp: myVendor.whatsapp || '',\r\n                address: myVendor.address || ''\r\n            });\r\n            if (myVendor.latitude && myVendor.longitude) {\r\n                setMarkerPos(new L.LatLng(myVendor.latitude, myVendor.longitude));\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleAutoLocate = useCallback(() => {\r\n        if (isLocating) return;\r\n        setIsLocating(true);\r\n        const tid = toast.loading(\"Accessing GPS...\");\r\n\r\n        if (!navigator.geolocation) {\r\n            toast.error(\"Geolocation is not supported by your browser\", { id: tid });\r\n            setIsLocating(false);\r\n            return;\r\n        }\r\n\r\n        navigator.geolocation.getCurrentPosition(\r\n            (pos) => {\r\n                const newPos = new L.LatLng(pos.coords.latitude, pos.coords.longitude);\r\n                setMarkerPos(newPos);\r\n                toast.success(\"Current location captured!\", { id: tid });\r\n                setIsLocating(false);\r\n            },\r\n            () => {\r\n                toast.error(\"Failed to get location. Please pin manually.\", { id: tid });\r\n                setIsLocating(false);\r\n            },\r\n            { enableHighAccuracy: true, timeout: 10000 }\r\n        );\r\n    }, [isLocating]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        const vendorData = {\r\n            id: existingVendorId || user?.id || Date.now().toString(),\r\n            name: formData.shopName,\r\n            phone: formData.phone,\r\n            whatsapp: formData.whatsapp,\r\n            address: formData.address,\r\n            latitude: markerPos.lat,\r\n            longitude: markerPos.lng,\r\n            verified: isEditing // Keep verification status if editing\r\n        };\r\n\r\n        try {\r\n            if (isEditing && existingVendorId) {\r\n                const result = await updateVendor(existingVendorId, vendorData);\r\n                if (result) toast.success(\"Shop details updated!\");\r\n                else throw new Error(\"Update failed\");\r\n            } else {\r\n                const result = await registerVendor(vendorData);\r\n                if (result) {\r\n                    toast.success(`Shop \"${formData.shopName}\" registered!`);\r\n                    setIsEditing(true);\r\n                } else {\r\n                    throw new Error(\"Registration failed\");\r\n                }\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Process failed. Please try again.\");\r\n            console.error(err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.portalContainer}>\r\n            <div className={styles.header}>\r\n                <h1 className={styles.portalTitle}>\r\n                    {isEditing ? 'Shop Manager' : 'Register Shop'}\r\n                </h1>\r\n                <p className={styles.portalSubtitle}>\r\n                    {isEditing ? `Managing: ${formData.shopName}` : 'Join our network of verified plant suppliers.'}\r\n                </p>\r\n            </div>\r\n\r\n            {/* Verified Partner Banner */}\r\n            {isEditing && (\r\n                <div className={styles.verifiedBanner}>\r\n                    <div className={styles.verifiedIconBox}>\r\n                        <AlertTriangle size={24} />\r\n                    </div>\r\n                    <div className={styles.verifiedContent}>\r\n                        <div className={styles.verifiedTitle}>\r\n                            <BadgeCheck size={18} />\r\n                            Verified Partner Status\r\n                        </div>\r\n                        <p className={styles.verifiedText}>\r\n                            Get Verified to rank higher in search results and gain customer trust. Your shop will be marked as \"Verified Partner\" across the platform.\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => window.open('https://wa.me/9188773534', '_blank')}\r\n                        className={styles.whatsappBtn}\r\n                    >\r\n                        <MessageCircle size={18} />\r\n                        WhatsApp Support\r\n                        <span>Contact Admin</span>\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            <div className={styles.portalGrid}>\r\n                {/* Form Section */}\r\n                <form onSubmit={handleSubmit} className={styles.formCard}>\r\n                    <div className={styles.formSectionHeader}>\r\n                        <Store size={20} />\r\n                        <h2>Profile Settings</h2>\r\n                    </div>\r\n\r\n                    <div className={styles.formGroup}>\r\n                        <label className={styles.label}>Official Shop Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            required\r\n                            placeholder=\"e.g. Green Valley Nursery\"\r\n                            className={styles.input}\r\n                            value={formData.shopName}\r\n                            onChange={e => setFormData({ ...formData, shopName: e.target.value })}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className={styles.inputGrid}>\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}><Phone size={12} /> Phone Number</label>\r\n                            <input\r\n                                type=\"tel\"\r\n                                required\r\n                                className={styles.input}\r\n                                value={formData.phone}\r\n                                onChange={e => setFormData({ ...formData, phone: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className={styles.formGroup}>\r\n                            <label className={styles.label}><MessageCircle size={12} /> WhatsApp</label>\r\n                            <input\r\n                                type=\"tel\"\r\n                                required\r\n                                className={styles.input}\r\n                                value={formData.whatsapp}\r\n                                onChange={e => setFormData({ ...formData, whatsapp: e.target.value })}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.formGroup}>\r\n                        <label className={styles.label}>Physical Address</label>\r\n                        <textarea\r\n                            rows={3}\r\n                            required\r\n                            placeholder=\"Unit #, Street Name, City, Pincode\"\r\n                            className={styles.textarea}\r\n                            value={formData.address}\r\n                            onChange={e => setFormData({ ...formData, address: e.target.value })}\r\n                        />\r\n                    </div>\r\n\r\n                    <div className={styles.coordsBox}>\r\n                        <div className={styles.coordsInfo}>\r\n                            <h4>Global Pin</h4>\r\n                            <div className={styles.coordsValue}>\r\n                                {markerPos.lat.toFixed(6)}, {markerPos.lng.toFixed(6)}\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleAutoLocate}\r\n                            disabled={isLocating}\r\n                            className={styles.gpsBtn}\r\n                        >\r\n                            <Locate size={14} /> {isLocating ? 'Capturing...' : 'Use GPS'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <Button type=\"submit\" disabled={loading} style={{ width: '100%', borderRadius: '0.75rem', padding: '1rem', fontWeight: 800 }}>\r\n                        {loading ? 'Propagating Changes...' : (isEditing ? 'Save Profile' : 'Register Now')}\r\n                    </Button>\r\n                </form>\r\n\r\n                {/* Map & Notifications Section */}\r\n                <div className={styles.mapWrapper}>\r\n                    <div className={styles.mapHint}>\r\n                        <h3><Info size={14} /> Precise Location Required</h3>\r\n                        <p>\r\n                            Nearby search results use your shop's coordinate. Move the marker to your entrance.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className={styles.mapContainer}>\r\n                        <MapContainer center={markerPos} zoom={13} style={{ height: '100%', width: '100%' }}>\r\n                            <TileLayer\r\n                                attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n                                url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n                            />\r\n                            <DraggableMarker pos={markerPos} setPos={setMarkerPos} />\r\n                            <RecenterMap center={markerPos} />\r\n                        </MapContainer>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Inventory Section */}\r\n            {isEditing && currentVendor && (\r\n                <div style={{ marginTop: '4rem' }}>\r\n                    <MarketInsights vendorId={currentVendor.id} />\r\n                    <VendorInventory\r\n                        vendor={currentVendor}\r\n                        onUpdate={loadVendorData}\r\n                    />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ActivityFeed.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AddPlant.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3709,3712],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3709,3712],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3759,3762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3759,3762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4028,4031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4028,4031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":126,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":126,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5969,5972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5969,5972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6034,6037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6034,6037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6289,6292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6289,6292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":181,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8024,8027],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8024,8027],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":194,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8081,8084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8081,8084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8241,8244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8241,8244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":389,"column":113,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":389,"endColumn":116,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20439,20442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20439,20442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":416,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":416,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22235,22238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22235,22238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":450,"column":120,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":450,"endColumn":123,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24675,24678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24675,24678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef } from 'react';\r\nimport { Button } from '../../components/common/Button';\r\nimport { addPlant, fetchPlants } from '../../services/api';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { Search, Upload, Thermometer, Wind, Droplets, Leaf, ArrowRight, Sparkles, ScanLine } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { INDIAN_PLANT_DB } from '../../data/indianPlants';\r\nimport type { Plant } from '../../types';\r\nimport { PlantCard } from '../../components/features/plants/PlantCard';\r\nimport styles from './AddPlant.module.css';\r\n\r\n// --- HELPERS ---\r\nconst smartFillPlant = (sciName: string) => {\r\n    const search = sciName.toLowerCase().trim();\r\n    if (!search) return null;\r\n\r\n    const entries = Object.entries(INDIAN_PLANT_DB);\r\n    const found = entries.find(([key, val]) => {\r\n        return key.includes(search) || val.name?.toLowerCase().includes(search);\r\n    });\r\n\r\n    if (found) {\r\n        const [key, data] = found;\r\n        return {\r\n            ...(data as any),\r\n            scientificName: key,\r\n            name: data.name,\r\n            type: data.type || 'indoor',\r\n            sunlight: data.sunlight || 'medium'\r\n        };\r\n    }\r\n    return null;\r\n};\r\n\r\nconst compressImage = (file: File): Promise<string> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = (event) => {\r\n            const img = new Image();\r\n            img.src = event.target?.result as string;\r\n            img.onload = () => {\r\n                const canvas = document.createElement('canvas');\r\n                const MAX_WIDTH = 800;\r\n                const MAX_HEIGHT = 800;\r\n                let width = img.width;\r\n                let height = img.height;\r\n                if (width > height && width > MAX_WIDTH) {\r\n                    height *= MAX_WIDTH / width;\r\n                    width = MAX_WIDTH;\r\n                } else if (height > MAX_HEIGHT) {\r\n                    width *= MAX_HEIGHT / height;\r\n                    height = MAX_HEIGHT;\r\n                }\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n                const ctx = canvas.getContext('2d');\r\n                ctx?.drawImage(img, 0, 0, width, height);\r\n                resolve(canvas.toDataURL('image/jpeg', 0.8));\r\n            };\r\n            img.onerror = reject;\r\n        };\r\n        reader.onerror = reject;\r\n    });\r\n};\r\n\r\nexport const AddPlant = () => {\r\n    const [scientificNameSearch, setScientificNameSearch] = useState('');\r\n\r\n    const [newPlant, setNewPlant] = useState<Partial<Plant>>({\r\n        name: '',\r\n        scientificName: '',\r\n        description: '',\r\n        imageUrl: '',\r\n        price: 0,\r\n        type: 'indoor',\r\n        sunlight: 'medium',\r\n        idealTempMin: 18,\r\n        idealTempMax: 30,\r\n        minHumidity: 40,\r\n        oxygenLevel: 'high',\r\n        medicinalValues: [],\r\n        advantages: [],\r\n        foliageTexture: '',\r\n        leafShape: '',\r\n        stemStructure: '',\r\n        overallHabit: '',\r\n        biometricFeatures: [],\r\n        lifespan: ''\r\n    });\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleSmartFill = () => {\r\n        if (!scientificNameSearch) return;\r\n        const found = smartFillPlant(scientificNameSearch);\r\n        if (found) {\r\n            setNewPlant(prev => ({\r\n                ...prev,\r\n                name: found.name || prev.name,\r\n                scientificName: found.scientificName,\r\n                description: found.description || prev.description,\r\n                type: (found.type === 'herb' ? 'outdoor' : found.type) as any,\r\n                sunlight: found.sunlight as any,\r\n                idealTempMin: found.idealTempMin || prev.idealTempMin,\r\n                idealTempMax: found.idealTempMax || prev.idealTempMax,\r\n                minHumidity: found.minHumidity || prev.minHumidity,\r\n                oxygenLevel: found.oxygenLevel as any || prev.oxygenLevel,\r\n                medicinalValues: found.medicinalValues || [],\r\n                advantages: found.advantages || []\r\n            }));\r\n            toast.success(`Populated: ${found.name}`, { icon: 'âœ¨' });\r\n        } else {\r\n            toast.error(\"Specimen not found in database.\");\r\n        }\r\n    };\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n        const tid = toast.loading(\"Processing...\");\r\n        try {\r\n            const compressedBase64 = await compressImage(file);\r\n            setNewPlant({ ...newPlant, imageUrl: compressedBase64 });\r\n            toast.success(\"Image Set\", { id: tid });\r\n        } catch (err) {\r\n            toast.error(\"Image Error\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleAddPlant = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const tid = toast.loading(\"Saving Specimen...\");\r\n        try {\r\n            // Check for existing scientific name\r\n            const existingPlants = await fetchPlants();\r\n            const isDuplicate = existingPlants.some(p =>\r\n                p.scientificName?.toLowerCase().trim() === newPlant.scientificName?.toLowerCase().trim()\r\n            );\r\n\r\n            if (isDuplicate) {\r\n                toast.error(\"The plant is already enrolled\", { id: tid });\r\n                return;\r\n            }\r\n\r\n            const plantData: Plant = {\r\n                id: crypto.randomUUID(),\r\n                name: newPlant.name || 'Unknown',\r\n                scientificName: newPlant.scientificName || 'Unknown',\r\n                description: newPlant.description || 'No description.',\r\n                imageUrl: newPlant.imageUrl || 'https://images.unsplash.com/photo-1459411552884-841db9b3cc2a?auto=format&fit=crop',\r\n                price: Number(newPlant.price),\r\n                type: newPlant.type as any || 'indoor',\r\n                sunlight: newPlant.sunlight as any || 'medium',\r\n                idealTempMin: Number(newPlant.idealTempMin),\r\n                idealTempMax: Number(newPlant.idealTempMax),\r\n                minHumidity: Number(newPlant.minHumidity),\r\n                oxygenLevel: newPlant.oxygenLevel as any || 'moderate',\r\n                medicinalValues: newPlant.medicinalValues || [],\r\n                advantages: newPlant.advantages || [],\r\n                isNocturnal: false,\r\n                foliageTexture: newPlant.foliageTexture,\r\n                leafShape: newPlant.leafShape,\r\n                stemStructure: newPlant.stemStructure,\r\n                overallHabit: newPlant.overallHabit,\r\n                biometricFeatures: newPlant.biometricFeatures || [],\r\n                lifespan: newPlant.lifespan || 'Unknown'\r\n            };\r\n            await addPlant(plantData);\r\n            toast.success(\"Specimen Registered\", { id: tid });\r\n\r\n            // Reset\r\n            setNewPlant({\r\n                name: '', scientificName: '', imageUrl: '', price: 0,\r\n                type: 'indoor', sunlight: 'medium', description: '',\r\n                idealTempMin: 18, idealTempMax: 30, minHumidity: 40,\r\n                oxygenLevel: 'high', medicinalValues: [], advantages: [],\r\n                foliageTexture: '', leafShape: '', stemStructure: '', overallHabit: '', biometricFeatures: [], lifespan: ''\r\n            });\r\n            setScientificNameSearch('');\r\n        } catch (err) {\r\n            toast.error(\"Save Failed\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const previewPlant: Plant = {\r\n        id: 'preview',\r\n        name: newPlant.name || 'Botanic Name',\r\n        scientificName: newPlant.scientificName || 'Scientific classification',\r\n        description: newPlant.description || 'Plant description will appear here...',\r\n        imageUrl: newPlant.imageUrl || 'https://images.unsplash.com/photo-1459411552884-841db9b3cc2a?auto=format&fit=crop',\r\n        price: Number(newPlant.price),\r\n        type: newPlant.type as any || 'indoor',\r\n        sunlight: newPlant.sunlight as any || 'medium',\r\n        idealTempMin: 18, idealTempMax: 30,\r\n        minHumidity: Number(newPlant.minHumidity),\r\n        oxygenLevel: newPlant.oxygenLevel as any || 'moderate',\r\n        medicinalValues: [], advantages: [], isNocturnal: false\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Add New Specimen\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                <div className={styles.mainLayout}>\r\n                    {/* --- LEFT PANEL: VISUAL & PREVIEW --- */}\r\n                    <div className={styles.previewPanel}>\r\n                        {/* Dynamic Background */}\r\n                        <div\r\n                            className={styles.previewBg}\r\n                            style={{\r\n                                backgroundImage: `url(${newPlant.imageUrl || 'https://images.unsplash.com/photo-1459411552884-841db9b3cc2a?auto=format&fit=crop'})`\r\n                            }}\r\n                        />\r\n\r\n                        {/* 3D Card Containment */}\r\n                        <div className={styles.cardWrapper}>\r\n                            <PlantCard plant={previewPlant} onAdd={() => { }} />\r\n                        </div>\r\n\r\n                        {/* Interactive Overlay */}\r\n                        <div className={styles.uploadOverlay}>\r\n                            <Button\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                className=\"bg-white text-black hover:bg-slate-200 shadow-xl mb-4\"\r\n                            >\r\n                                <Upload size={18} className=\"mr-2\" /> Upload Photo\r\n                            </Button>\r\n\r\n                            <div className=\"w-64\">\r\n                                <span className=\"text-xs text-slate-300 font-medium mb-1 block text-center\">Or paste external URL</span>\r\n                                <input\r\n                                    value={newPlant.imageUrl}\r\n                                    onChange={(e) => setNewPlant({ ...newPlant, imageUrl: e.target.value })}\r\n                                    placeholder=\"https://...\"\r\n                                    className=\"w-full bg-black/50 border border-white/20 rounded px-3 py-1.5 text-xs text-white outline-none text-center focus:border-emerald-500 transition-colors\"\r\n                                    onClick={(e) => e.stopPropagation()}\r\n                                />\r\n                            </div>\r\n\r\n                            <input\r\n                                ref={fileInputRef}\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                className=\"hidden\"\r\n                                onChange={handleImageUpload}\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"absolute bottom-6 flex items-center gap-2 text-slate-400 text-xs font-mono uppercase tracking-widest z-10 opacity-70\">\r\n                            <Sparkles size={12} className=\"text-emerald-400\" /> Live Preview\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* --- RIGHT PANEL: FORM --- */}\r\n                    <div className={styles.formPanel}>\r\n                        <form onSubmit={handleAddPlant}>\r\n\r\n                            {/* 1. Smart Search */}\r\n                            <div className={styles.smartSearchWrapper}>\r\n                                <div className=\"flex justify-between items-baseline mb-2\">\r\n                                    <label className=\"text-sm text-emerald-500 font-bold uppercase tracking-wider\">Quick Populator</label>\r\n                                    {scientificNameSearch && (\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={handleSmartFill}\r\n                                            className=\"text-xs bg-emerald-500/10 text-emerald-400 px-3 py-1 rounded-full uppercase font-bold tracking-widest hover:bg-emerald-500/20 transition-all flex items-center gap-1\"\r\n                                        >\r\n                                            Auto-Fill <ArrowRight size={12} />\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"relative\">\r\n                                    <input\r\n                                        value={scientificNameSearch}\r\n                                        onChange={(e) => setScientificNameSearch(e.target.value)}\r\n                                        placeholder=\"Type a scientific name (e.g. Ocimum)...\"\r\n                                        className={styles.smartSearchInput}\r\n                                    />\r\n                                    <Search size={22} className={styles.smartSearchIcon} />\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 2. Primary Identity */}\r\n                            <div className=\"mb-10\">\r\n                                <div className={styles.sectionTitle}>\r\n                                    <Leaf size={18} /> Identity\r\n                                </div>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Common Name</label>\r\n                                        <input\r\n                                            value={newPlant.name}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, name: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Peace Lily\"\r\n                                            required\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Scientific Name</label>\r\n                                        <input\r\n                                            value={newPlant.scientificName}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, scientificName: e.target.value })}\r\n                                            className={`${styles.glassInput} italic`}\r\n                                            placeholder=\"e.g. Spathiphyllum\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Description</label>\r\n                                        <textarea\r\n                                            value={newPlant.description}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, description: e.target.value })}\r\n                                            className={styles.glassTextarea}\r\n                                            placeholder=\"Describe the plant's origin, care needs, and unique features...\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Expected Lifespan</label>\r\n                                        <input\r\n                                            value={newPlant.lifespan}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, lifespan: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Perennial (10+ Years), Annual\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n\r\n                            {/* Biometric Profile */}\r\n                            <div className=\"mb-10\">\r\n                                <div className={styles.sectionTitle}>\r\n                                    <ScanLine size={18} /> Biometric Profile\r\n                                </div>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Leaf Shape</label>\r\n                                        <input\r\n                                            value={newPlant.leafShape}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, leafShape: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Ovate, Lanceolate\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Stem Structure</label>\r\n                                        <input\r\n                                            value={newPlant.stemStructure}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, stemStructure: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Woody, Succulent\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Growth Habit</label>\r\n                                        <input\r\n                                            value={newPlant.overallHabit}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, overallHabit: e.target.value })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"e.g. Climbing, Bushy\"\r\n                                        />\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Distinctive Features</label>\r\n                                        <input\r\n                                            value={newPlant.biometricFeatures?.join(', ')}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, biometricFeatures: e.target.value.split(',').map(s => s.trim()) })}\r\n                                            className={styles.glassInput}\r\n                                            placeholder=\"Comma separated e.g. Serrated edges\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 3. Vital Metrics */}\r\n                            <div className=\"mb-10\">\r\n                                <div className={styles.sectionTitle}>\r\n                                    <Thermometer size={18} className=\"text-amber-500\" /> Vital Metrics\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Environment Type</label>\r\n                                        <select\r\n                                            value={newPlant.type}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, type: e.target.value as any })}\r\n                                            className={styles.glassSelect}\r\n                                        >\r\n                                            <option value=\"indoor\">Indoor</option>\r\n                                            <option value=\"outdoor\">Outdoor</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div className={styles.inputGroup}>\r\n                                        <label className={styles.label}>Base Price (Rs)</label>\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            value={newPlant.price}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, price: Number(e.target.value) })}\r\n                                            className={styles.glassInput}\r\n                                            min=\"0\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Sunlight Control */}\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Sunlight Requirement</label>\r\n                                    <div className={styles.segmentedControl}>\r\n                                        {['low', 'medium', 'high', 'direct'].map(lvl => (\r\n                                            <button\r\n                                                key={lvl}\r\n                                                type=\"button\"\r\n                                                onClick={() => setNewPlant({ ...newPlant, sunlight: lvl as any })}\r\n                                                className={`${styles.segmentBtn} ${newPlant.sunlight === lvl ? styles.segmentBtnActive : ''}`}\r\n                                            >\r\n                                                {lvl}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Sliders & Advanced */}\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mt-8\">\r\n                                    <div>\r\n                                        <div className=\"flex justify-between items-center mb-4\">\r\n                                            <label className=\"text-xs font-bold uppercase text-slate-400 flex items-center gap-2\">\r\n                                                <Droplets size={14} className=\"text-blue-400\" /> Humidity\r\n                                            </label>\r\n                                            <span className=\"text-sm font-mono text-blue-400 font-bold\">{newPlant.minHumidity}%</span>\r\n                                        </div>\r\n                                        <div className={styles.rangeWrapper}>\r\n                                            <input\r\n                                                type=\"range\" min=\"0\" max=\"100\" step=\"10\"\r\n                                                value={newPlant.minHumidity}\r\n                                                onChange={(e) => setNewPlant({ ...newPlant, minHumidity: Number(e.target.value) })}\r\n                                                className={styles.rangeInput}\r\n                                            />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold uppercase text-slate-400 flex items-center gap-2 mb-3\">\r\n                                            <Wind size={14} className=\"text-purple-400\" /> Oxygen Output\r\n                                        </label>\r\n                                        <select\r\n                                            value={newPlant.oxygenLevel}\r\n                                            onChange={(e) => setNewPlant({ ...newPlant, oxygenLevel: e.target.value as any })}\r\n                                            className={styles.glassSelect}\r\n                                        >\r\n                                            <option value=\"low\">Low</option>\r\n                                            <option value=\"moderate\">Moderate</option>\r\n                                            <option value=\"high\">High</option>\r\n                                            <option value=\"very-high\">Purifier (Very High)</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Submit Area */}\r\n                            <div className=\"pt-8 border-t border-slate-700/50 flex justify-end\">\r\n                                <button type=\"submit\" className={styles.submitBtn}>\r\n                                    Register Specimen\r\n                                </button>\r\n                            </div>\r\n\r\n                        </form>\r\n                    </div>\r\n\r\n                </div >\r\n            </div >\r\n        </AdminLayout >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AddVendor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":63,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { MapPin, Navigation, Store, CheckCircle, Globe, Crosshair } from 'lucide-react';\r\nimport { MapContainer, TileLayer, Marker, useMap, useMapEvents } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { registerVendor } from '../../services/api';\r\nimport type { Vendor } from '../../types';\r\nimport styles from './AddVendor.module.css';\r\n\r\n// Fix Leaflet's default icon path issues\r\nimport icon from 'leaflet/dist/images/marker-icon.png';\r\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\r\n\r\nconst DefaultIcon = L.icon({\r\n    iconUrl: icon,\r\n    shadowUrl: iconShadow,\r\n    iconSize: [25, 41],\r\n    iconAnchor: [12, 41]\r\n});\r\nL.Marker.prototype.options.icon = DefaultIcon;\r\n\r\n// Sub-component to center map when coords change\r\nconst MapUpdater = ({ center }: { center: [number, number] }) => {\r\n    const map = useMap();\r\n    useEffect(() => {\r\n        map.setView(center, map.getZoom());\r\n    }, [center, map]);\r\n    return null;\r\n};\r\n\r\n// Sub-component to handle clicks\r\nconst LocationMarker = ({ position, setPosition }: { position: [number, number], setPosition: (lat: number, lng: number) => void }) => {\r\n    useMapEvents({\r\n        click(e) {\r\n            setPosition(e.latlng.lat, e.latlng.lng);\r\n        },\r\n    });\r\n    return position === null ? null : (\r\n        <Marker position={position} />\r\n    );\r\n};\r\n\r\nexport const AddVendor = () => {\r\n    const [newVendor, setNewVendor] = useState<Partial<Vendor>>({\r\n        latitude: 28.61,\r\n        longitude: 77.23,\r\n        verified: true,\r\n        address: '',\r\n        name: ''\r\n    });\r\n\r\n    const [isLocating, setIsLocating] = useState(false);\r\n\r\n    const handleSaveVendor = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        const tid = toast.loading(\"Onboarding Partner...\");\r\n        try {\r\n            await registerVendor(newVendor);\r\n            toast.success(\"Partner Onboarded Successfully\", { id: tid, icon: 'ðŸ¤' });\r\n            setNewVendor({ latitude: 28.61, longitude: 77.23, verified: true, address: '', name: '' });\r\n        } catch (err) {\r\n            toast.error(\"Failed to register vendor\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleGPS = () => {\r\n        if (!navigator.geolocation) {\r\n            toast.error(\"Geolocation not supported\");\r\n            return;\r\n        }\r\n        setIsLocating(true);\r\n        navigator.geolocation.getCurrentPosition(\r\n            (pos) => {\r\n                setNewVendor(prev => ({\r\n                    ...prev,\r\n                    latitude: pos.coords.latitude,\r\n                    longitude: pos.coords.longitude\r\n                }));\r\n                setIsLocating(false);\r\n                toast.success(\"Location Updated\");\r\n            },\r\n            () => {\r\n                toast.error(\"Location access denied\");\r\n                setIsLocating(false);\r\n            }\r\n        );\r\n    };\r\n\r\n    const updateCoords = (lat: number, lng: number) => {\r\n        setNewVendor(prev => ({ ...prev, latitude: lat, longitude: lng }));\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Partner Onboarding\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                <div className={styles.mainCard}>\r\n                    <div className={styles.header}>\r\n                        <div className=\"flex justify-center mb-4\">\r\n                            <div className=\"p-4 bg-amber-500/20 rounded-full text-amber-500\">\r\n                                <Store size={40} />\r\n                            </div>\r\n                        </div>\r\n                        <h1 className={styles.title}>Register New Vendor</h1>\r\n                        <p className={styles.subtitle}>Add a verified garden center or nursery to the network.</p>\r\n                    </div>\r\n\r\n                    {/* --- GPS ACTION --- */}\r\n                    <div className=\"absolute top-8 right-8 z-[20]\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleGPS}\r\n                            disabled={isLocating}\r\n                            className=\"bg-amber-500 hover:bg-amber-400 text-black font-bold text-xs uppercase tracking-widest px-4 py-2 rounded-full flex items-center gap-2 transition-transform active:scale-95 shadow-lg shadow-amber-900/40 relative z-50\"\r\n                        >\r\n                            <Crosshair size={16} className={isLocating ? 'animate-spin' : ''} />\r\n                            {isLocating ? 'Locating...' : 'Use GPS'}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <form onSubmit={handleSaveVendor}>\r\n                        {/* 1. Identity Section */}\r\n                        <div className={styles.section}>\r\n                            <div className={styles.sectionTitle}>\r\n                                <CheckCircle size={16} /> Partner Identity\r\n                            </div>\r\n\r\n                            <div className={styles.inputGroup}>\r\n                                <label className={styles.label}>Business Name</label>\r\n                                <input\r\n                                    className={styles.glassInput}\r\n                                    value={newVendor.name || ''}\r\n                                    onChange={e => setNewVendor({ ...newVendor, name: e.target.value })}\r\n                                    placeholder=\"e.g. Green Earth Nursery\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* 2. Visual Location Section */}\r\n                        <div className={styles.section}>\r\n                            <div className={styles.sectionTitle}>\r\n                                <Globe size={16} /> Location & Mapping\r\n                            </div>\r\n\r\n                            <div className=\"mb-4 text-xs text-slate-400 flex items-center gap-2\">\r\n                                <span className=\"bg-amber-500/10 text-amber-500 px-2 py-0.5 rounded border border-amber-500/20\">Tip</span>\r\n                                Click on the map to pinpoint the exact location.\r\n                            </div>\r\n\r\n                            {/* --- INTERACTIVE MAP --- */}\r\n                            <div className={styles.mapContainer}>\r\n                                <MapContainer\r\n                                    center={[newVendor.latitude || 28.61, newVendor.longitude || 77.23]}\r\n                                    zoom={13}\r\n                                    scrollWheelZoom={false}\r\n                                    className=\"h-full w-full\"\r\n                                    style={{ height: '100%', background: '#0f172a' }}\r\n                                >\r\n                                    <TileLayer\r\n                                        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n                                        url=\"https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png\"\r\n                                    />\r\n                                    <MapUpdater center={[newVendor.latitude || 28.61, newVendor.longitude || 77.23]} />\r\n                                    <LocationMarker\r\n                                        position={[newVendor.latitude || 28.61, newVendor.longitude || 77.23]}\r\n                                        setPosition={updateCoords}\r\n                                    />\r\n                                </MapContainer>\r\n                            </div>\r\n\r\n                            <div className={styles.coordGrid}>\r\n                                <div>\r\n                                    <label className={styles.label}>Latitude</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        type=\"number\"\r\n                                        step=\"any\"\r\n                                        value={newVendor.latitude || ''}\r\n                                        onChange={e => setNewVendor({ ...newVendor, latitude: Number(e.target.value) })}\r\n                                        placeholder=\"28.61\"\r\n                                    />\r\n                                </div>\r\n                                <div>\r\n                                    <label className={styles.label}>Longitude</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        type=\"number\"\r\n                                        step=\"any\"\r\n                                        value={newVendor.longitude || ''}\r\n                                        onChange={e => setNewVendor({ ...newVendor, longitude: Number(e.target.value) })}\r\n                                        placeholder=\"77.23\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* 3. Address Section */}\r\n                        <div className={styles.section}>\r\n                            <div className={styles.sectionTitle}>\r\n                                <Navigation size={16} /> Physical Address\r\n                            </div>\r\n\r\n                            <div>\r\n                                <label className={styles.label}>Full Street Address</label>\r\n                                <textarea\r\n                                    className={styles.glassTextarea}\r\n                                    value={newVendor.address || ''}\r\n                                    onChange={e => setNewVendor({ ...newVendor, address: e.target.value })}\r\n                                    placeholder=\"Enter the complete address for navigation purposes...\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Submit */}\r\n                        <div className=\"pt-2\">\r\n                            <button type=\"submit\" className={styles.submitBtn}>\r\n                                <MapPin size={20} />\r\n                                Confirm Registration\r\n                            </button>\r\n                        </div>\r\n\r\n                    </form>\r\n                </div>\r\n\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AdminLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[805,808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[805,808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useLocation, Link } from 'react-router-dom';\r\nimport {\r\n    LayoutDashboard, Sprout, Store,\r\n    Users, Activity, Bell, Settings, Layers,\r\n    Menu, X, LogOut, ChevronRight, MessageSquare, DollarSign, Trophy, Database, ScanLine\r\n} from 'lucide-react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { fetchAdminStats } from '../../services/api';\r\nimport styles from './AdminLayout.module.css';\r\n\r\n\r\n\r\ninterface AdminLayoutProps {\r\n    title: string;\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport const AdminLayout = ({ title, children }: AdminLayoutProps) => {\r\n    const location = useLocation();\r\n    const { logout, user } = useAuth();\r\n    const [isSidebarOpen, setSidebarOpen] = useState(true);\r\n    const [stats, setStats] = useState<any>({ unread: {} });\r\n\r\n    React.useEffect(() => {\r\n        if (user?.role === 'admin') {\r\n            const loadStats = async () => {\r\n                try {\r\n                    const data = await fetchAdminStats();\r\n                    if (data.unread) setStats(data);\r\n                } catch (e) { console.error(\"Stats error\", e); }\r\n            };\r\n            loadStats();\r\n            const interval = setInterval(loadStats, 30000); // Poll every 30s\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [user]);\r\n\r\n    const navItems = [\r\n        { path: '/admin', icon: LayoutDashboard, label: 'Dashboard' },\r\n        { path: '/admin/manage-plants', icon: Sprout, label: 'Manage Plants', badge: stats.unread?.plants },\r\n        { path: '/admin/identify', icon: ScanLine, label: 'Biometric Scanner', sub: true },\r\n        { path: '/admin/simulation-data', icon: Database, label: 'Simulation Data', sub: true },\r\n        { path: '/admin/pot-designs', icon: Layers, label: 'Pot Designs', sub: true },\r\n        { path: '/admin/add-plant', icon: Activity, label: 'Add New Plant', sub: true },\r\n        { path: '/admin/manage-vendors', icon: Store, label: 'Manage Vendors', badge: stats.unread?.vendors },\r\n        { path: '/admin/price-management', icon: DollarSign, label: 'Price Management', badge: stats.unread?.prices },\r\n        { path: '/admin/manage-points', icon: Trophy, label: 'Leaderboard Points' },\r\n        { path: '/admin/seed-bank', icon: Database, label: 'Seed Data Bank' },\r\n        { path: '/admin/manage-users', icon: Users, label: 'User Directory', badge: stats.unread?.users },\r\n        { path: '/admin/suggestions', icon: MessageSquare, label: 'User Suggestions' }, // Could add badge if API supported\r\n        { path: '/admin/notifications', icon: Bell, label: 'Notifications', badge: stats.unread?.total },\r\n        { path: '/admin/diag', icon: Activity, label: 'System Health' },\r\n        { path: '/admin/settings', icon: Settings, label: 'Settings' },\r\n    ];\r\n\r\n    const isActive = (path: string) => location.pathname === path;\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            {/* BACKDROP FOR MOBILE */}\r\n            {isSidebarOpen && <div className={styles.backdrop} onClick={() => setSidebarOpen(false)} />}\r\n\r\n            {/* SIDEBAR */}\r\n            <aside className={`${styles.sidebar} ${isSidebarOpen ? styles.sidebarOpen : styles.sidebarClosed}`}>\r\n                <div className={styles.sidebarHeader}>\r\n                    <div className={styles.brand}>\r\n                        <div className={styles.logoBox}>\r\n                            <img src=\"/logo.png?v=3\" alt=\"VanaMap\" style={{ width: '32px', height: '32px', objectFit: 'contain' }} />\r\n                        </div>\r\n                        <span className={styles.brandName}>VANAMAP</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <nav className={styles.nav}>\r\n                    {navItems.map((item) => (\r\n                        <Link\r\n                            key={item.path}\r\n                            to={item.path}\r\n                            onClick={() => window.innerWidth < 1024 && setSidebarOpen(false)}\r\n                            className={`${styles.navItem} ${isActive(item.path) ? styles.navActive : ''} ${item.sub ? styles.navSub : ''}`}\r\n                        >\r\n                            <item.icon size={20} className={styles.navIcon} />\r\n                            <span className={styles.navLabel}>{item.label}</span>\r\n                            {item.badge > 0 && (\r\n                                <span style={{\r\n                                    background: '#ef4444',\r\n                                    color: 'white',\r\n                                    fontSize: '0.7rem',\r\n                                    fontWeight: 'bold',\r\n                                    padding: '2px 6px',\r\n                                    borderRadius: '99px',\r\n                                    marginLeft: 'auto'\r\n                                }}>\r\n                                    {item.badge}\r\n                                </span>\r\n                            )}\r\n\r\n                            {isActive(item.path) && <div className={styles.activeIndicator} />}\r\n                        </Link>\r\n                    ))}\r\n                </nav>\r\n\r\n                <div className={styles.sidebarFooter}>\r\n                    <button onClick={logout} className={styles.logoutBtn}>\r\n                        <LogOut size={20} />\r\n                        <span>Logout Session</span>\r\n                    </button>\r\n                </div>\r\n            </aside>\r\n\r\n            {/* MAIN CONTENT */}\r\n            < main className={styles.main} >\r\n                <header className={styles.topBar}>\r\n                    <div className={styles.topBarLeft}>\r\n                        <button onClick={() => setSidebarOpen(!isSidebarOpen)} className={styles.toggleBtn}>\r\n                            {isSidebarOpen ? <X size={20} /> : <Menu size={20} />}\r\n                        </button>\r\n                        <div className={styles.breadcrumbs}>\r\n                            <span className={styles.rootCrumb}>Admin</span>\r\n                            <ChevronRight size={14} className={styles.crumbDivider} />\r\n                            <span className={styles.activeCrumb}>{title}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.topBarRight}>\r\n                        <div className={styles.adminBadge}>\r\n                            <div className={styles.adminAvatar}>\r\n                                {user?.name?.charAt(0) || 'A'}\r\n                            </div>\r\n                            <div className={styles.adminInfo}>\r\n                                <div className={styles.adminName}>{user?.name || 'Administrator'}</div>\r\n                                <div className={styles.adminRole}>System Overlord</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </header>\r\n\r\n                <section className={styles.content}>\r\n                    <header className={styles.contentHeader}>\r\n                        <h1 className={styles.pageTitle}>{title}</h1>\r\n                    </header>\r\n                    <div className={styles.pageBody}>\r\n                        {children}\r\n                    </div>\r\n                </section>\r\n\r\n            </main>\r\n        </div >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\AdminLogin.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":38,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Shield, Lock, Mail, ArrowLeft, Terminal } from 'lucide-react';\r\nimport { useAuth } from '../../context/AuthContext';\r\nimport { toast } from 'react-hot-toast';\r\nimport styles from './AdminLogin.module.css';\r\n\r\nexport const AdminLogin = () => {\r\n    const navigate = useNavigate();\r\n    const { login, user, loading: authLoading } = useAuth();\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!authLoading && user?.role === 'admin') {\r\n            navigate('/admin', { replace: true });\r\n        }\r\n    }, [user, authLoading, navigate]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsSubmitting(true);\r\n        const tid = toast.loading(\"Verifying Security Credentials...\");\r\n\r\n        try {\r\n            const result = await login({ email, password });\r\n            if (result.success) {\r\n                toast.success(\"Access Granted. Welcome, Overseer.\", { id: tid });\r\n                // Explicitly navigate to admin dashboard\r\n                setTimeout(() => {\r\n                    navigate('/admin', { replace: true });\r\n                }, 500);\r\n            } else {\r\n                toast.error(result.message || \"Invalid credentials for security level 4\", { id: tid });\r\n                setIsSubmitting(false);\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Gateway timeout. Check connection.\", { id: tid });\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.loginCard}>\r\n                <div className={styles.header}>\r\n                    <div className={styles.shieldIcon}>\r\n                        <Shield size={32} />\r\n                    </div>\r\n                    <h1 className={styles.title}>Admin Access</h1>\r\n                    <p className={styles.subtitle}>Secure Registry Terminal</p>\r\n                </div>\r\n\r\n                <form className={styles.form} onSubmit={handleSubmit}>\r\n                    <div className={styles.inputGroup}>\r\n                        <label className={styles.label}>Designation ID</label>\r\n                        <div className={styles.inputWrapper}>\r\n                            <input\r\n                                type=\"email\"\r\n                                className={styles.input}\r\n                                placeholder=\"admin@vanamap.com\"\r\n                                value={email}\r\n                                onChange={(e) => setEmail(e.target.value)}\r\n                                required\r\n                            />\r\n                            <Mail className={styles.inputIcon} size={20} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.inputGroup}>\r\n                        <label className={styles.label}>Security Key</label>\r\n                        <div className={styles.inputWrapper}>\r\n                            <input\r\n                                type=\"password\"\r\n                                className={styles.input}\r\n                                placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\r\n                                value={password}\r\n                                onChange={(e) => setPassword(e.target.value)}\r\n                                required\r\n                            />\r\n                            <Lock className={styles.inputIcon} size={20} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        className={styles.submitBtn}\r\n                        disabled={isSubmitting}\r\n                    >\r\n                        <Terminal size={20} />\r\n                        {isSubmitting ? 'Syncing...' : 'Initialize Link'}\r\n                    </button>\r\n                </form>\r\n\r\n                <div className={styles.footer}>\r\n                    <button className={styles.backLink} onClick={() => navigate('/auth')}>\r\n                        <ArrowLeft size={16} /> Return to Primary Hub\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.securityBadge}>\r\n                <Lock size={12} />\r\n                <span>256-bit Encrypted Session</span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\EditPlant.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":93,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":93,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":109,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":109,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":235,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10474,10477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10474,10477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":254,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11654,11657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11654,11657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":267,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12555,12558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12555,12558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-hot-toast';\r\nimport {\r\n    ChevronLeft, Save, Image as ImageIcon, Sparkles,\r\n    Thermometer, Droplets, Upload, Wind, Sun, Leaf, Activity,\r\n    ShieldCheck, PlusCircle, XCircle\r\n} from 'lucide-react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchPlants, updatePlant } from '../../services/api';\r\nimport type { Plant } from '../../types';\r\nimport styles from './EditPlant.module.css';\r\n\r\n// --- HELPERS ---\r\nconst compressImage = (file: File): Promise<string> => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = (event) => {\r\n            const img = new Image();\r\n            img.src = event.target?.result as string;\r\n            img.onload = () => {\r\n                const canvas = document.createElement('canvas');\r\n                const MAX_WIDTH = 800;\r\n                const MAX_HEIGHT = 800;\r\n                let width = img.width;\r\n                let height = img.height;\r\n                if (width > height && width > MAX_WIDTH) {\r\n                    height *= MAX_WIDTH / width;\r\n                    width = MAX_WIDTH;\r\n                } else if (height > MAX_HEIGHT) {\r\n                    width *= MAX_HEIGHT / height;\r\n                    height = MAX_HEIGHT;\r\n                }\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n                const ctx = canvas.getContext('2d');\r\n                ctx?.drawImage(img, 0, 0, width, height);\r\n                resolve(canvas.toDataURL('image/jpeg', 0.8));\r\n            };\r\n            img.onerror = reject;\r\n        };\r\n        reader.onerror = reject;\r\n    });\r\n};\r\n\r\nexport const EditPlant = () => {\r\n    const { id } = useParams<{ id: string }>();\r\n    const navigate = useNavigate();\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [plant, setPlant] = useState<Partial<Plant>>({});\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Tags state for array fields\r\n    const [medicinalInput, setMedicinalInput] = useState('');\r\n    const [advantageInput, setAdvantageInput] = useState('');\r\n\r\n    useEffect(() => {\r\n        const loadPlantData = async () => {\r\n            if (!id) return;\r\n            try {\r\n                const plants = await fetchPlants();\r\n                const found = plants.find(p => p.id === id);\r\n                if (found) {\r\n                    setPlant({\r\n                        ...found,\r\n                        medicinalValues: found.medicinalValues || [],\r\n                        advantages: found.advantages || []\r\n                    });\r\n                } else {\r\n                    toast.error(\"Plant not found in registry\");\r\n                    navigate('/admin/manage-plants');\r\n                }\r\n            } catch (err) {\r\n                console.error(err);\r\n                toast.error(\"Failed to load flora data\");\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        loadPlantData();\r\n    }, [id, navigate]);\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n        const tid = toast.loading(\"Processing image...\");\r\n        try {\r\n            const compressedBase64 = await compressImage(file);\r\n            setPlant({ ...plant, imageUrl: compressedBase64 });\r\n            toast.success(\"Image updated\", { id: tid });\r\n        } catch (err) {\r\n            toast.error(\"Compression failed\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleSave = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!id) return;\r\n\r\n        setSaving(true);\r\n        const tid = toast.loading(\"Recording modifications to registry...\");\r\n\r\n        try {\r\n            await updatePlant(id, plant);\r\n            toast.success(\"Specimen updated successfully\", { id: tid });\r\n            setTimeout(() => navigate('/admin/manage-plants'), 1000);\r\n        } catch (err) {\r\n            toast.error(\"An error occurred during verification\", { id: tid });\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const addMedicinal = () => {\r\n        if (!medicinalInput.trim()) return;\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            medicinalValues: [...(prev.medicinalValues || []), medicinalInput.trim()]\r\n        }));\r\n        setMedicinalInput('');\r\n    };\r\n\r\n    const removeMedicinal = (index: number) => {\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            medicinalValues: (prev.medicinalValues || []).filter((_, i) => i !== index)\r\n        }));\r\n    };\r\n\r\n    const addAdvantage = () => {\r\n        if (!advantageInput.trim()) return;\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            advantages: [...(prev.advantages || []), advantageInput.trim()]\r\n        }));\r\n        setAdvantageInput('');\r\n    };\r\n\r\n    const removeAdvantage = (index: number) => {\r\n        setPlant(prev => ({\r\n            ...prev,\r\n            advantages: (prev.advantages || []).filter((_, i) => i !== index)\r\n        }));\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <AdminLayout title=\"Specimen Analysis\">\r\n                <div className=\"flex items-center justify-center p-20 text-slate-400\">\r\n                    <div className=\"animate-pulse flex flex-col items-center gap-4\">\r\n                        <Sparkles size={48} className=\"text-blue-500 animate-spin\" />\r\n                        <p className=\"font-bold tracking-widest text-sm uppercase\">Accessing Flora Database...</p>\r\n                    </div>\r\n                </div>\r\n            </AdminLayout>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <AdminLayout title=\"Specimen Editor\">\r\n            <div className={styles.editContainer}>\r\n                <header className={styles.header}>\r\n                    <div className={styles.headerTitle}>\r\n                        <div className={styles.titleIcon}>\r\n                            <Sparkles size={24} />\r\n                        </div>\r\n                        <div className={styles.titleText}>\r\n                            <h1>{plant.name || 'New Specimen'}</h1>\r\n                            <p>Refinery ID: {id}</p>\r\n                        </div>\r\n                    </div>\r\n                    <button onClick={() => navigate(-1)} className={styles.btnCancel}>\r\n                        <ChevronLeft size={18} className=\"mr-2\" /> Back\r\n                    </button>\r\n                </header>\r\n\r\n                <form onSubmit={handleSave} className={styles.formGrid}>\r\n                    <div className={styles.formSection}>\r\n                        {/* Identity Section */}\r\n                        <div className=\"mb-8\">\r\n                            <h3 className={styles.sectionSubtitle}>\r\n                                <Leaf size={16} className=\"text-emerald-500\" /> Identity\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Common Name</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={plant.name || ''}\r\n                                        onChange={e => setPlant({ ...plant, name: e.target.value })}\r\n                                        placeholder=\"e.g. Silver Queen Snake Plant\"\r\n                                    />\r\n                                </div>\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Scientific Designation</label>\r\n                                    <input\r\n                                        className={`${styles.glassInput} italic`}\r\n                                        value={plant.scientificName || ''}\r\n                                        onChange={e => setPlant({ ...plant, scientificName: e.target.value })}\r\n                                        placeholder=\"e.g. Sansevieria trifasciata\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"mt-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Expected Lifespan</label>\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={plant.lifespan || ''}\r\n                                        onChange={e => setPlant({ ...plant, lifespan: e.target.value })}\r\n                                        placeholder=\"e.g. Perennial, 10-15 Years\"\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Economics & Type Section */}\r\n                        <div className=\"mb-8\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Base Price (Rs)</label>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        className={styles.glassInput}\r\n                                        value={plant.price || 0}\r\n                                        onChange={e => setPlant({ ...plant, price: Number(e.target.value) })}\r\n                                    />\r\n                                </div>\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Environment Type</label>\r\n                                    <select\r\n                                        className={styles.glassSelect}\r\n                                        value={plant.type || 'indoor'}\r\n                                        onChange={e => setPlant({ ...plant, type: e.target.value as any })}\r\n                                    >\r\n                                        <option value=\"indoor\">Indoor (Lab)</option>\r\n                                        <option value=\"outdoor\">Outdoor (Natural)</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Sunlight & Oxygen */}\r\n                        <div className=\"mb-8\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Sunlight Requirement</label>\r\n                                    <div className={styles.segmentedControl}>\r\n                                        {['low', 'medium', 'high', 'direct'].map(lvl => (\r\n                                            <button\r\n                                                key={lvl}\r\n                                                type=\"button\"\r\n                                                onClick={() => setPlant({ ...plant, sunlight: lvl as any })}\r\n                                                className={`${styles.segmentBtn} ${plant.sunlight === lvl ? styles.segmentBtnActive : ''}`}\r\n                                            >\r\n                                                {lvl}\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                <div className={styles.inputGroup}>\r\n                                    <label className={styles.label}>Oxygen Output</label>\r\n                                    <select\r\n                                        className={styles.glassSelect}\r\n                                        value={plant.oxygenLevel || 'moderate'}\r\n                                        onChange={e => setPlant({ ...plant, oxygenLevel: e.target.value as any })}\r\n                                    >\r\n                                        <option value=\"low\">Low Output</option>\r\n                                        <option value=\"moderate\">Moderate</option>\r\n                                        <option value=\"high\">High Purifier</option>\r\n                                        <option value=\"very-high\">Superior Purifier</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Vital Metrics (Sliders) */}\r\n                        <div className=\"mb-8\">\r\n                            <h3 className={styles.sectionSubtitle}>\r\n                                <Activity size={16} className=\"text-blue-500\" /> Vital Metrics\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 my-4\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between items-center mb-4\">\r\n                                        <label className={styles.label}>\r\n                                            <Droplets size={14} className=\"text-blue-400 inline mr-1\" /> Min Humidity\r\n                                        </label>\r\n                                        <span className=\"text-sm font-mono text-blue-400 font-bold\">{plant.minHumidity || 0}%</span>\r\n                                    </div>\r\n                                    <div className={styles.rangeWrapper}>\r\n                                        <input\r\n                                            type=\"range\" min=\"0\" max=\"100\" step=\"5\"\r\n                                            className={styles.rangeInput}\r\n                                            value={plant.minHumidity || 0}\r\n                                            onChange={e => setPlant({ ...plant, minHumidity: Number(e.target.value) })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"flex justify-between items-center mb-4\">\r\n                                        <label className={styles.label}>\r\n                                            <Thermometer size={14} className=\"text-amber-400 inline mr-1\" /> Ideal Temp (Min)\r\n                                        </label>\r\n                                        <span className=\"text-sm font-mono text-amber-400 font-bold\">{plant.idealTempMin || 18}Â°C</span>\r\n                                    </div>\r\n                                    <div className={styles.rangeWrapper}>\r\n                                        <input\r\n                                            type=\"range\" min=\"0\" max=\"40\" step=\"1\"\r\n                                            className={styles.rangeInput}\r\n                                            value={plant.idealTempMin || 18}\r\n                                            onChange={e => setPlant({ ...plant, idealTempMin: Number(e.target.value) })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mt-6\">\r\n                                <div>\r\n                                    <div className=\"flex justify-between items-center mb-4\">\r\n                                        <label className={styles.label}>\r\n                                            <Thermometer size={14} className=\"text-red-400 inline mr-1\" /> Ideal Temp (Max)\r\n                                        </label>\r\n                                        <span className=\"text-sm font-mono text-red-400 font-bold\">{plant.idealTempMax || 30}Â°C</span>\r\n                                    </div>\r\n                                    <div className={styles.rangeWrapper}>\r\n                                        <input\r\n                                            type=\"range\" min=\"0\" max=\"50\" step=\"1\"\r\n                                            className={styles.rangeInput}\r\n                                            value={plant.idealTempMax || 30}\r\n                                            onChange={e => setPlant({ ...plant, idealTempMax: Number(e.target.value) })}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* medicinalValues & Advantages Section */}\r\n                        <div className=\"mb-8 grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                            <div className={styles.inputGroup}>\r\n                                <label className={styles.label}><Activity size={14} className=\"inline mr-1\" /> Medicinal Values</label>\r\n                                <div className=\"flex gap-2 mb-2\">\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={medicinalInput}\r\n                                        onChange={e => setMedicinalInput(e.target.value)}\r\n                                        placeholder=\"Add value...\"\r\n                                        onKeyPress={e => e.key === 'Enter' && (e.preventDefault(), addMedicinal())}\r\n                                    />\r\n                                    <button type=\"button\" onClick={addMedicinal} className={styles.addTagBtn}><PlusCircle size={20} /></button>\r\n                                </div>\r\n                                <div className={styles.tagCloud}>\r\n                                    {plant.medicinalValues?.map((val, i) => (\r\n                                        <span key={i} className={styles.tag}>\r\n                                            {val} <button type=\"button\" onClick={() => removeMedicinal(i)}><XCircle size={12} /></button>\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                            <div className={styles.inputGroup}>\r\n                                <label className={styles.label}><ShieldCheck size={14} className=\"inline mr-1\" /> Key Advantages</label>\r\n                                <div className=\"flex gap-2 mb-2\">\r\n                                    <input\r\n                                        className={styles.glassInput}\r\n                                        value={advantageInput}\r\n                                        onChange={e => setAdvantageInput(e.target.value)}\r\n                                        placeholder=\"Add advantage...\"\r\n                                        onKeyPress={e => e.key === 'Enter' && (e.preventDefault(), addAdvantage())}\r\n                                    />\r\n                                    <button type=\"button\" onClick={addAdvantage} className={styles.addTagBtn}><PlusCircle size={20} /></button>\r\n                                </div>\r\n                                <div className={styles.tagCloud}>\r\n                                    {plant.advantages?.map((val, i) => (\r\n                                        <span key={i} className={styles.tag}>\r\n                                            {val} <button type=\"button\" onClick={() => removeAdvantage(i)}><XCircle size={12} /></button>\r\n                                        </span>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Botanical Description</label>\r\n                            <textarea\r\n                                className={`${styles.glassInput} ${styles.textarea}`}\r\n                                value={plant.description || ''}\r\n                                onChange={e => setPlant({ ...plant, description: e.target.value })}\r\n                                placeholder=\"Enter detailed physiological characteristics...\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className={styles.inputGroup}>\r\n                            <label className={styles.label}>Asset URL (External)</label>\r\n                            <input\r\n                                className={styles.glassInput}\r\n                                value={plant.imageUrl || ''}\r\n                                onChange={e => setPlant({ ...plant, imageUrl: e.target.value })}\r\n                                placeholder=\"https://...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.imageSection}>\r\n                        <label className={styles.label}>Live Preview & Upload</label>\r\n                        <div className={styles.previewCard}>\r\n                            {plant.imageUrl ? (\r\n                                <img src={plant.imageUrl} className={styles.previewImage} alt=\"Preview\" />\r\n                            ) : (\r\n                                <div className={styles.noImage}>\r\n                                    <ImageIcon size={64} />\r\n                                    <p className=\"text-sm font-bold opacity-30\">NO ASSET FOUND</p>\r\n                                </div>\r\n                            )}\r\n                            <div className={styles.uploadOverlay}>\r\n                                <button type=\"button\" onClick={() => fileInputRef.current?.click()} className={styles.uploadBtn}>\r\n                                    <Upload size={18} /> Update Photo\r\n                                </button>\r\n                                <p className=\"text-[10px] text-white/60 mt-2 uppercase tracking-tight\">Auto-compressed JPG</p>\r\n                            </div>\r\n                            <div className={styles.badge}>{plant.type}</div>\r\n                        </div>\r\n\r\n                        <input\r\n                            ref={fileInputRef}\r\n                            type=\"file\"\r\n                            accept=\"image/*\"\r\n                            className=\"hidden\"\r\n                            onChange={handleImageUpload}\r\n                        />\r\n\r\n                        <div className=\"mt-8 grid grid-cols-2 gap-3 opacity-50 text-white\">\r\n                            <div className=\"p-3 border border-slate-800 rounded-lg flex items-center gap-3\">\r\n                                <Sun size={16} className=\"text-amber-500\" /> <span className=\"text-[10px] uppercase font-bold\">{plant.sunlight}</span>\r\n                            </div>\r\n                            <div className=\"p-3 border border-slate-800 rounded-lg flex items-center gap-3\">\r\n                                <Wind size={16} className=\"text-purple-400\" /> <span className=\"text-[10px] uppercase font-bold\">{plant.oxygenLevel}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={styles.footer}>\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => navigate('/admin/manage-plants')}\r\n                            className={styles.btnCancel}\r\n                        >\r\n                            Discard Changes\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={saving}\r\n                            className={styles.btnSave}\r\n                        >\r\n                            <Save size={18} /> {saving ? 'Verifying...' : 'Seal Registry'}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePlants.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadPlants` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePlants.tsx:17:9\n  15 |\n  16 |     useEffect(() => {\n> 17 |         loadPlants();\n     |         ^^^^^^^^^^ `loadPlants` accessed before it is declared\n  18 |     }, []);\n  19 |\n  20 |     useEffect(() => {\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePlants.tsx:33:5\n  31 |     }, [searchQuery, allPlants]);\n  32 |\n> 33 |     const loadPlants = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 34 |         const data = await fetchPlants();\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 35 |         setAllPlants(data);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 36 |         setFilteredPlants(data);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 37 |     };\n     | ^^^^^^^ `loadPlants` is declared here\n  38 |\n  39 |     const handleEdit = (plant: Plant) => {\n  40 |         navigate(`/admin/edit-plant/${plant.id}`);","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":50,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":50,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { Edit, Trash2, X, Search, Leaf } from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchPlants, deletePlant } from '../../services/api';\r\nimport type { Plant } from '../../types';\r\nimport styles from './ManagePlants.module.css';\r\n\r\nexport const ManagePlants = () => {\r\n    const [allPlants, setAllPlants] = useState<Plant[]>([]);\r\n    const [filteredPlants, setFilteredPlants] = useState<Plant[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        loadPlants();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) {\r\n            setFilteredPlants(allPlants);\r\n        } else {\r\n            const query = searchQuery.toLowerCase();\r\n            setFilteredPlants(allPlants.filter(p =>\r\n                p.name?.toLowerCase().includes(query) ||\r\n                p.scientificName?.toLowerCase().includes(query) ||\r\n                p.type?.toLowerCase().includes(query)\r\n            ));\r\n        }\r\n    }, [searchQuery, allPlants]);\r\n\r\n    const loadPlants = async () => {\r\n        const data = await fetchPlants();\r\n        setAllPlants(data);\r\n        setFilteredPlants(data);\r\n    };\r\n\r\n    const handleEdit = (plant: Plant) => {\r\n        navigate(`/admin/edit-plant/${plant.id}`);\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!window.confirm(\"Permanently delete this plant?\")) return;\r\n        const tid = toast.loading(\"Deleting...\");\r\n        try {\r\n            await deletePlant(id);\r\n            toast.success(\"Plant Deleted\", { id: tid });\r\n            loadPlants();\r\n        } catch (err) {\r\n            toast.error(\"Deletion failed\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const getBadgeClass = (type: string) => {\r\n        switch (type) {\r\n            case 'indoor': return styles.badgeIndoor;\r\n            case 'outdoor': return styles.badgeOutdoor;\r\n            default: return styles.badgeOther;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Flora Registry\">\r\n            <div className={styles.pageContainer}>\r\n                <div className={styles.searchContainer}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search botanical collection...\"\r\n                        className={styles.searchBar}\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                    {searchQuery && (\r\n                        <button onClick={() => setSearchQuery(\"\")} className={styles.clearButton}>\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n\r\n                    <div className={styles.statsContainer}>\r\n                        <span>Total Flora</span>\r\n                        <span className={styles.countHighlight}>{allPlants.length} SPECIMENS</span>\r\n                    </div>\r\n\r\n                    {searchQuery && (\r\n                        <div className={styles.quickList}>\r\n                            <div className=\"px-4 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider flex justify-between border-b border-slate-700/50 mb-1\">\r\n                                <span>Quick Selection (A-Z)</span>\r\n                                <span className=\"text-emerald-500\">{filteredPlants.length} Matches</span>\r\n                            </div>\r\n                            {filteredPlants.length > 0 ? (\r\n                                [...filteredPlants]\r\n                                    .sort((a, b) => (a.name || '').localeCompare(b.name || ''))\r\n                                    .map((plant) => (\r\n                                        <div key={plant.id} className={styles.quickListItem}>\r\n                                            <span>{plant.name}</span>\r\n                                            <span className={styles.quickListItemIndex}>{plant.type}</span>\r\n                                        </div>\r\n                                    ))\r\n                            ) : (\r\n                                <div className=\"p-4 text-center text-slate-500 text-sm\">\r\n                                    No plants align with your query\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {filteredPlants.length === 0 ? (\r\n                    <div className={styles.emptyState}>\r\n                        <div className={styles.emptyIcon}>\r\n                            <Leaf size={40} />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-white mb-2\">No specimens found</h3>\r\n                        <p>Try refining your search query or add a new plant.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className={styles.grid}>\r\n                        {filteredPlants.map((plant, idx) => (\r\n                            <div key={plant.id} className={styles.card} style={{ animationDelay: `${idx * 50}ms` }}>\r\n                                <div className={styles.imageContainer}>\r\n                                    <img src={plant.imageUrl} alt={plant.name} className={styles.image} loading=\"lazy\" />\r\n                                    <div className={styles.imageOverlay}></div>\r\n\r\n                                    <div className={styles.actions}>\r\n                                        <button onClick={() => handleEdit(plant)} className={`${styles.actionBtn} ${styles.editBtn}`} title=\"Edit Plant\">\r\n                                            <Edit size={18} />\r\n                                        </button>\r\n                                        <button onClick={() => handleDelete(plant.id)} className={`${styles.actionBtn} ${styles.deleteBtn}`} title=\"Delete Plant\">\r\n                                            <Trash2 size={18} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className={styles.content}>\r\n                                    <div className={styles.header}>\r\n                                        <h3 className={styles.plantName} title={plant.name}>\r\n                                            {plant.name}\r\n                                        </h3>\r\n                                        <p className={styles.scientificName}>{plant.scientificName}</p>\r\n                                    </div>\r\n\r\n                                    <div className={styles.footer}>\r\n                                        <div>\r\n                                            <span className={styles.priceLabel}>Price</span>\r\n                                            <span className={styles.price}>Rs. {plant.price}</span>\r\n                                        </div>\r\n                                        <span className={`${styles.badge} ${getBadgeClass(plant.type || '')}`}>\r\n                                            {plant.type}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManagePoints.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[345,348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[345,348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[786,789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[786,789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[822,825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[822,825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[830,833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[830,833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":22,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":35,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":21}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Trophy, Search, User as UserIcon } from 'lucide-react';\r\nimport { fetchUsers, updateUserPoints } from '../../services/api';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './ManagePoints.module.css';\r\n\r\nexport const ManagePoints = () => {\r\n    const [users, setUsers] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [saving, setSaving] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const data = await fetchUsers();\r\n            // Filter only standard users, and sort by points\r\n            setUsers(data.filter((u: any) => u.role === 'user').sort((a: any, b: any) => (b.points || 0) - (a.points || 0)));\r\n        } catch (err) {\r\n            toast.error(\"Failed to load users\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleUpdatePoints = async (userId: string, newPoints: number) => {\r\n        setSaving(userId);\r\n        try {\r\n            await updateUserPoints(userId, newPoints);\r\n            toast.success(\"Points updated successfully\");\r\n            setUsers(prev => prev.map(u => u.id === userId ? { ...u, points: newPoints } : u));\r\n        } catch (err) {\r\n            toast.error(\"Failed to update points\");\r\n        } finally {\r\n            setSaving(null);\r\n        }\r\n    };\r\n\r\n    const filteredUsers = users.filter(u =>\r\n        u.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        u.email.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.searchBar}>\r\n                    <Search size={18} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search by name or email...\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n                <div className={styles.statsBadge}>\r\n                    <Trophy size={16} /> {users.length} Active Participants\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.userGrid}>\r\n                {loading ? (\r\n                    <div className={styles.loading}>Synchronizing Ecosystem Rankings...</div>\r\n                ) : filteredUsers.length === 0 ? (\r\n                    <div className={styles.empty}>No users found.</div>\r\n                ) : (\r\n                    filteredUsers.map((user, idx) => (\r\n                        <div key={user.id} className={styles.userCard}>\r\n                            <div className={styles.rankBadge}>#{idx + 1}</div>\r\n                            <div className={styles.userMain}>\r\n                                <div className={styles.avatar}>\r\n                                    <UserIcon size={24} />\r\n                                </div>\r\n                                <div className={styles.info}>\r\n                                    <h3 className={styles.name}>{user.name}</h3>\r\n                                    <p className={styles.email}>{user.email}</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.pointsControl}>\r\n                                <div className={styles.pointsLabel}>Chlorophyll Points</div>\r\n                                <div className={styles.inputWrapper}>\r\n                                    <input\r\n                                        type=\"number\"\r\n                                        defaultValue={user.points || 0}\r\n                                        onBlur={(e) => {\r\n                                            const val = parseInt(e.target.value);\r\n                                            if (val !== user.points) {\r\n                                                handleUpdatePoints(user.id, val);\r\n                                            }\r\n                                        }}\r\n                                        className={styles.pointsInput}\r\n                                    />\r\n                                    {saving === user.id && <div className={styles.loader} />}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManageSuggestions.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[436,439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[436,439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":17,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":133,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":153,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":51}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { Clock, User, Sparkles, MessageSquare, CheckCircle, XCircle } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { fetchSuggestions as apiFetchSuggestions, updateSuggestion, deleteSuggestion } from '../../services/api';\r\n\r\nexport const ManageSuggestions = () => {\r\n    const [suggestions, setSuggestions] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchSuggestions = async () => {\r\n        try {\r\n            const data = await apiFetchSuggestions();\r\n            if (Array.isArray(data)) {\r\n                setSuggestions(data);\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Failed to load suggestions\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchSuggestions();\r\n    }, []);\r\n\r\n    const formatDate = (dateString: string) => {\r\n        const date = new Date(dateString);\r\n        return date.toLocaleDateString('en-US', {\r\n            month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'\r\n        });\r\n    };\r\n\r\n    const getTimeAgo = (dateString: string) => {\r\n        const seconds = Math.floor((new Date().getTime() - new Date(dateString).getTime()) / 1000);\r\n        if (seconds < 60) return 'Just now';\r\n        const minutes = Math.floor(seconds / 60);\r\n        if (minutes < 60) return `${minutes}m ago`;\r\n        const hours = Math.floor(minutes / 60);\r\n        if (hours < 24) return `${hours}h ago`;\r\n        return formatDate(dateString);\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Ecosystem Requests\">\r\n            <div style={{ marginBottom: '2rem' }}>\r\n                <p style={{ color: '#94a3b8', fontSize: '1rem' }}>\r\n                    Review plant species suggested by the community for inclusion in the VanaMap database.\r\n                </p>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div style={{ padding: '4rem', textAlign: 'center' }}>\r\n                    <div className=\"animate-spin\" style={{ width: '40px', height: '40px', border: '3px solid rgba(16, 185, 129, 0.2)', borderTopColor: '#10b981', borderRadius: '50%', margin: '0 auto 1rem' }}></div>\r\n                    <p style={{ color: '#94a3b8' }}>Synchronizing requests...</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6\">\r\n                    {suggestions.length === 0 && (\r\n                        <div style={{ gridColumn: '1/-1', textAlign: 'center', padding: '6rem 2rem', background: 'rgba(30, 41, 59, 0.3)', borderRadius: '2rem', border: '1px dashed rgba(255,255,255,0.1)' }}>\r\n                            <Sparkles size={64} style={{ margin: '0 auto 1.5rem', opacity: 0.2, color: '#10b981' }} />\r\n                            <h3 style={{ color: 'white', fontSize: '1.25rem', marginBottom: '0.5rem' }}>Ecosystem is Up to Date</h3>\r\n                            <p style={{ color: '#64748b' }}>No pending plant suggestions found at this time.</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {suggestions.map((s) => (\r\n                        <div key={s._id} className=\"glass-panel\" style={{\r\n                            padding: '2rem',\r\n                            borderRadius: '1.5rem',\r\n                            border: '1px solid rgba(255, 255, 255, 0.05)',\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            gap: '1.5rem',\r\n                            transition: 'transform 0.3s ease'\r\n                        }}>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                                <div style={{ background: 'rgba(16, 185, 129, 0.1)', padding: '0.75rem', borderRadius: '1rem' }}>\r\n                                    <MessageSquare size={24} color=\"#10b981\" />\r\n                                </div>\r\n                                <div style={{ textAlign: 'right' }}>\r\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.4rem', color: '#64748b', fontSize: '0.75rem', fontWeight: '800' }}>\r\n                                        <Clock size={12} /> {getTimeAgo(s.submittedAt)}\r\n                                    </div>\r\n                                    <span style={{\r\n                                        display: 'inline-block',\r\n                                        marginTop: '0.5rem',\r\n                                        fontSize: '0.65rem',\r\n                                        padding: '0.2rem 0.6rem',\r\n                                        borderRadius: '6px',\r\n                                        background: 'rgba(255,255,255,0.05)',\r\n                                        color: '#cbd5e1',\r\n                                        fontWeight: '800',\r\n                                        letterSpacing: '0.5px'\r\n                                    }}>\r\n                                        ID: {s._id.substring(18)}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <h3 style={{ fontSize: '1.25rem', fontWeight: '800', color: '#fff', marginBottom: '0.5rem' }}>{s.plantName}</h3>\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', fontSize: '0.85rem', color: '#94a3b8' }}>\r\n                                    <User size={14} /> Submitted by <strong style={{ color: '#cbd5e1' }}>{s.userName || 'Root User'}</strong>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div style={{\r\n                                background: 'rgba(0,0,0,0.3)',\r\n                                padding: '1.25rem',\r\n                                borderRadius: '1rem',\r\n                                fontSize: '0.95rem',\r\n                                color: '#94a3b8',\r\n                                lineHeight: '1.6',\r\n                                fontStyle: 'italic',\r\n                                border: '1px solid rgba(255,255,255,0.03)'\r\n                            }}>\r\n                                \"{s.description}\"\r\n                            </div>\r\n\r\n                            <div style={{ display: 'flex', gap: '1rem', marginTop: 'auto', paddingTop: '1rem', borderTop: '1px solid rgba(255,255,255,0.05)' }}>\r\n                                {s.status !== 'approved' ? (\r\n                                    <button\r\n                                        className=\"flex-1 flex items-center justify-center gap-2\"\r\n                                        style={{ background: 'rgba(16, 185, 129, 0.1)', color: '#10b981', border: '1px solid rgba(16, 185, 129, 0.2)', padding: '0.75rem', borderRadius: '0.75rem', fontSize: '0.85rem', fontWeight: '700', cursor: 'pointer' }}\r\n                                        onClick={async () => {\r\n                                            const tid = toast.loading(\"Approving...\");\r\n                                            try {\r\n                                                await updateSuggestion(s._id, { status: 'approved' });\r\n                                                toast.success(\"Suggestion Approved\", { id: tid });\r\n                                                fetchSuggestions();\r\n                                            } catch (e) { toast.error(\"Failed to approve\", { id: tid }); }\r\n                                        }}\r\n                                    >\r\n                                        <CheckCircle size={16} /> APPROVE\r\n                                    </button>\r\n                                ) : (\r\n                                    <div className=\"flex-1 flex items-center justify-center gap-2\" style={{ color: '#10b981', padding: '0.75rem', fontSize: '0.85rem', fontWeight: '800' }}>\r\n                                        <CheckCircle size={16} /> APPROVED\r\n                                    </div>\r\n                                )}\r\n                                <button\r\n                                    className=\"flex-shrink-0\"\r\n                                    style={{ background: 'rgba(244, 63, 94, 0.1)', color: '#f43f5e', border: '1px solid rgba(244, 63, 94, 0.2)', padding: '0.75rem', borderRadius: '0.75rem', cursor: 'pointer' }}\r\n                                    onClick={async () => {\r\n                                        if (!window.confirm(\"Delete this suggestion permanently?\")) return;\r\n                                        const tid = toast.loading(\"Removing...\");\r\n                                        try {\r\n                                            await deleteSuggestion(s._id);\r\n                                            toast.success(\"Suggestion Removed\", { id: tid });\r\n                                            setSuggestions(prev => prev.filter(item => item._id !== s._id));\r\n                                        } catch (e) { toast.error(\"Failed to remove\", { id: tid }); }\r\n                                    }}\r\n                                >\r\n                                    <XCircle size={16} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManageUsers.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[467,470],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[467,470],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[535,538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[535,538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[658,661],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[658,661],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[763,766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[763,766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1848,1851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1848,1851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":63,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":76,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":88,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":125,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":125,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":144,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":144,"endColumn":55}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { fetchUsers, adminResetPassword, deleteUser, fetchNotifications } from '../../services/api';\r\nimport { AlertCircle, Users, Key, Shield, Search, X, User as UserIcon, Lock } from 'lucide-react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport styles from './ManageUsers.module.css';\r\n\r\nexport const ManageUsers = () => {\r\n    const [allUsers, setAllUsers] = useState<any[]>([]);\r\n    const [filteredUsers, setFilteredUsers] = useState<any[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n    const [selectedUser, setSelectedUser] = useState<any>(null);\r\n    const [resetPwd, setResetPwd] = useState(\"\");\r\n    const [alerts, setAlerts] = useState<any[]>([]);\r\n\r\n    useEffect(() => {\r\n        loadUsers();\r\n        loadAlerts();\r\n    }, []);\r\n\r\n    // client-side search filtering\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) {\r\n            setFilteredUsers(allUsers);\r\n        } else {\r\n            const query = searchQuery.toLowerCase();\r\n            setFilteredUsers(allUsers.filter(u =>\r\n                u.name?.toLowerCase().includes(query) ||\r\n                u.email?.toLowerCase().includes(query) ||\r\n                u.role?.toLowerCase().includes(query)\r\n            ));\r\n        }\r\n    }, [searchQuery, allUsers]);\r\n\r\n    const loadUsers = async () => {\r\n        try {\r\n            const data = await fetchUsers();\r\n            setAllUsers(data);\r\n            setFilteredUsers(data);\r\n        } catch (e) {\r\n            console.error(e);\r\n            toast.error(\"Failed to load users\");\r\n        }\r\n    };\r\n\r\n    const loadAlerts = async () => {\r\n        try {\r\n            const notifs = await fetchNotifications();\r\n            // Filter only help/contact triggers\r\n            setAlerts(notifs.filter((n: any) => n.type === 'help'));\r\n        } catch (e) { console.error(\"Alerts load failed\", e); }\r\n    };\r\n\r\n    const handlePasswordReset = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!selectedUser || !resetPwd) return;\r\n        const tid = toast.loading(\"Updating Credentials...\");\r\n        try {\r\n            await adminResetPassword(selectedUser.id, resetPwd);\r\n            toast.success(\"Security Credentials Updated\", { id: tid, icon: 'ðŸ”' });\r\n            setResetPwd(\"\");\r\n            setSelectedUser(null);\r\n        } catch (err) {\r\n            toast.error(\"Update prevented by security policy\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleQuickReset = async () => {\r\n        if (!selectedUser) return;\r\n        if (!window.confirm(\"Reset password to '123456'?\")) return;\r\n        const tid = toast.loading(\"Reseting to Default...\");\r\n        try {\r\n            await adminResetPassword(selectedUser.id, '123456');\r\n            toast.success(\"Password Reset to '123456'\", { id: tid });\r\n            setSelectedUser(null);\r\n        } catch (e) { toast.error(\"Reset Failed\"); }\r\n    };\r\n\r\n    const handleDelete = async () => {\r\n        if (!selectedUser) return;\r\n        if (!window.confirm(`Permanently DELETE user ${selectedUser.email}?`)) return;\r\n        const tid = toast.loading(\"Deleting User...\");\r\n        try {\r\n            await deleteUser(selectedUser.id);\r\n            toast.success(\"User Deleted\", { id: tid });\r\n            setSelectedUser(null);\r\n            loadUsers();\r\n        } catch (e) { toast.error(\"Delete Failed\", { id: tid }); }\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"User Security Directory\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                {/* ALARM / ALERTS SECTION */}\r\n                {alerts.length > 0 && (\r\n                    <div className={styles.alarmContainer}>\r\n                        {alerts.map(alert => (\r\n                            <div key={alert._id} className={styles.alarmCard}>\r\n                                <div className={styles.alarmContent}>\r\n                                    <AlertCircle className={styles.alarmIcon} size={24} />\r\n                                    <div>\r\n                                        <span style={{ color: 'white' }}>CRITICAL HELP REQUEST:</span>{' '}\r\n                                        User <span className={styles.alarmEmail}>{alert.details?.email || alert.message.split(' ')[1]}</span> triggered admin recovery.\r\n                                        <span className={styles.alarmTime}>{new Date(alert.createdAt).toLocaleTimeString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex gap-2\">\r\n                                    <button\r\n                                        className={styles.actionBtn}\r\n                                        style={{ background: '#f59e0b', color: 'black', fontWeight: 'bold' }}\r\n                                        onClick={async () => {\r\n                                            const emailStr = alert.details?.email || alert.message.split(' ')[1];\r\n                                            const userToReset = allUsers.find(u => u.email === emailStr);\r\n                                            if (userToReset) {\r\n                                                if (window.confirm(`Reset password to '123456' for ${emailStr}?`)) {\r\n                                                    const tid = toast.loading(\"Reseting...\");\r\n                                                    try {\r\n                                                        await adminResetPassword(userToReset.id, '123456');\r\n                                                        toast.success(\"Password Reset Successfully\", { id: tid });\r\n                                                        // Automatically clear alert after reset\r\n                                                        const { deleteNotification } = await import('../../services/api');\r\n                                                        await deleteNotification(alert._id);\r\n                                                        loadAlerts();\r\n                                                    } catch (e) { toast.error(\"Reset Failed\"); }\r\n                                                }\r\n                                            } else {\r\n                                                toast.error(\"User not found in directory. Try searching manually.\");\r\n                                                setSearchQuery(emailStr || \"\");\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        RESET TO 123456\r\n                                    </button>\r\n                                    <button\r\n                                        className={styles.actionBtn}\r\n                                        style={{ background: 'rgba(255, 255, 255, 0.1)', color: 'white' }}\r\n                                        onClick={async () => {\r\n                                            try {\r\n                                                const { deleteNotification } = await import('../../services/api');\r\n                                                await deleteNotification(alert._id);\r\n                                                loadAlerts();\r\n                                                toast.success(\"Alert cleared\");\r\n                                            } catch (e) {\r\n                                                toast.error(\"Failed to clear alert\");\r\n                                            }\r\n                                        }}\r\n                                    >\r\n                                        <X size={16} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Search Bar */}\r\n                <div className={styles.searchContainer}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search users by name, email, or role...\"\r\n                        className={styles.searchBar}\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                    {searchQuery && (\r\n                        <button onClick={() => setSearchQuery(\"\")} className={styles.clearButton}>\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                <div className={styles.layoutGrid}>\r\n                    {/* LEFT COLUMN: User List */}\r\n                    <div className={styles.userList}>\r\n                        {filteredUsers.length === 0 ? (\r\n                            <div className=\"text-center py-12 text-slate-500 bg-slate-800/20 rounded-2xl border border-slate-700/50\">\r\n                                <Users size={48} className=\"mx-auto mb-4 opacity-30\" />\r\n                                <h3 className=\"text-lg font-bold\">No Users Found</h3>\r\n                            </div>\r\n                        ) : (\r\n                            filteredUsers.map(user => (\r\n                                <div\r\n                                    key={user.id}\r\n                                    className={`${styles.userCard} ${selectedUser?.id === user.id ? styles.active : ''}`}\r\n                                    onClick={() => setSelectedUser(user)}\r\n                                >\r\n                                    <div className={styles.userInfo}>\r\n                                        <div className={`${styles.avatar} ${user.role === 'admin' ? styles.avatarAdmin : ''}`}>\r\n                                            {user.name ? user.name.charAt(0).toUpperCase() : <UserIcon size={20} />}\r\n                                        </div>\r\n                                        <div className={styles.userDetails}>\r\n                                            <div className={styles.userName}>{user.name || \"Unknown User\"}</div>\r\n                                            <div className={styles.userEmail}>{user.email}</div>\r\n                                            <div>\r\n                                                <span className={`${styles.roleBadge} ${user.role === 'admin' ? styles.roleAdmin : styles.roleUser}`}>\r\n                                                    {user.role || 'user'}\r\n                                                </span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        className={styles.actionBtn}\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            setSelectedUser(user);\r\n                                        }}\r\n                                        title=\"Manage User Security\"\r\n                                    >\r\n                                        <Key size={18} />\r\n                                    </button>\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* RIGHT COLUMN: Action Sidebar */}\r\n                    <div className={styles.sidebar}>\r\n                        {selectedUser ? (\r\n                            <div className={styles.actionPanel}>\r\n                                <div className={styles.panelTitle}>\r\n                                    <Shield size={20} className=\"text-indigo-400\" />\r\n                                    Security Actions\r\n                                </div>\r\n\r\n                                <div className=\"mb-4\">\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={handleQuickReset}\r\n                                        className={styles.quickResetBtn}\r\n                                    >\r\n                                        Auto-Reset to '123456'\r\n                                    </button>\r\n                                </div>\r\n\r\n                                <form onSubmit={handlePasswordReset}>\r\n                                    <div className={styles.targetInfo}>\r\n                                        <div className={styles.targetLabel}>Target Account</div>\r\n                                        <div className={styles.targetValue}>{selectedUser.email}</div>\r\n                                    </div>\r\n\r\n                                    <div className={styles.formGroup}>\r\n                                        <label className={styles.label}>Custom Password</label>\r\n                                        <div className=\"relative\">\r\n                                            <input\r\n                                                type=\"text\"\r\n                                                placeholder=\"Enter new password...\"\r\n                                                required\r\n                                                className={styles.glassInput}\r\n                                                value={resetPwd}\r\n                                                onChange={e => setResetPwd(e.target.value)}\r\n                                            />\r\n                                            <Lock size={16} className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400\" />\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button type=\"submit\" className={styles.submitBtn}>\r\n                                        Update Credentials\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        className={styles.cancelBtn}\r\n                                        onClick={() => { setSelectedUser(null); setResetPwd(\"\"); }}\r\n                                    >\r\n                                        Cancel\r\n                                    </button>\r\n                                </form>\r\n\r\n                                <div className=\"mt-8 pt-4 border-t border-slate-700\">\r\n                                    <button\r\n                                        onClick={handleDelete}\r\n                                        className={styles.deleteBtn}\r\n                                    >\r\n                                        Delete Account\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className={styles.emptyPanel}>\r\n                                <UserIcon size={48} className=\"mb-4 opacity-20\" />\r\n                                <h3 className=\"text-lg font-bold text-slate-400 mb-2\">No Selection</h3>\r\n                                <p className=\"text-sm px-4\">Select a user from the list to view security options and manage credentials.</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\ManageVendors.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":46,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":55,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":65,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":83,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":19}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { Store, Star, Trash2, ShieldCheck, AlertCircle, MapPin, Search, X, Lock } from 'lucide-react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchVendors, updateVendor, deleteVendor } from '../../services/api';\r\nimport type { Vendor } from '../../types';\r\nimport styles from './ManageVendors.module.css';\r\n\r\nexport const ManageVendors = () => {\r\n    const [allVendors, setAllVendors] = useState<Vendor[]>([]);\r\n    const [filteredVendors, setFilteredVendors] = useState<Vendor[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState(\"\");\r\n\r\n    // Password Reset State\r\n    const [showResetModal, setShowResetModal] = useState(false);\r\n    const [selectedVendorForReset, setSelectedVendorForReset] = useState<Vendor | null>(null);\r\n    const [newPassword, setNewPassword] = useState(\"\");\r\n\r\n    useEffect(() => { loadVendors(); }, []);\r\n\r\n    useEffect(() => {\r\n        if (!searchQuery.trim()) {\r\n            setFilteredVendors(allVendors);\r\n        } else {\r\n            const query = searchQuery.toLowerCase();\r\n            setFilteredVendors(allVendors.filter(v =>\r\n                v.name?.toLowerCase().includes(query) ||\r\n                v.address?.toLowerCase().includes(query)\r\n            ));\r\n        }\r\n    }, [searchQuery, allVendors]);\r\n\r\n    const loadVendors = async () => {\r\n        const data = await fetchVendors();\r\n        setAllVendors(data);\r\n        setFilteredVendors(data);\r\n    };\r\n\r\n    const toggleVerification = async (v: Vendor) => {\r\n        const newStatus = !v.verified;\r\n        const tid = toast.loading(newStatus ? \"Verifying Partner...\" : \"Revoking Status...\");\r\n        try {\r\n            await updateVendor(v.id, { verified: newStatus });\r\n            toast.success(newStatus ? \"Partner Verified\" : \"Verification Revoked\", { id: tid });\r\n            loadVendors();\r\n        } catch (e) { toast.error(\"Status Update Failed\", { id: tid }); }\r\n    };\r\n\r\n    const toggleRecommendation = async (v: Vendor) => {\r\n        const newStatus = !v.highlyRecommended;\r\n        try {\r\n            await updateVendor(v.id, { highlyRecommended: newStatus });\r\n            if (newStatus) toast.success(\"Marked as Top Partner!\", { icon: 'ðŸŒŸ' });\r\n            loadVendors();\r\n        } catch (e) { toast.error(\"Promotion Failed\"); }\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!window.confirm(\"Permanently delete this partner account?\")) return;\r\n        const tid = toast.loading(\"Removing Partner...\");\r\n        try {\r\n            await deleteVendor(id);\r\n            toast.success(\"Partner Removed\", { id: tid });\r\n            loadVendors();\r\n        } catch (e) { toast.error(\"Deletion failed\", { id: tid }); }\r\n    };\r\n\r\n    const handlePasswordResetClick = (vendor: Vendor) => {\r\n        setSelectedVendorForReset(vendor);\r\n        setShowResetModal(true);\r\n        setNewPassword(\"\");\r\n    };\r\n\r\n    const submitPasswordReset = async () => {\r\n        if (!selectedVendorForReset) return;\r\n        const tid = toast.loading(\"Resetting password...\");\r\n        try {\r\n            const { adminResetPassword } = await import('../../services/api');\r\n            // Assuming the Vendor ID matches the User ID for signed-up vendors\r\n            await adminResetPassword(selectedVendorForReset.id, newPassword || '123456');\r\n            toast.success(\"Password Reset Successfully!\", { id: tid });\r\n            setShowResetModal(false);\r\n        } catch (e) {\r\n            toast.error(\"Failed to reset password. Is this a linked account?\", { id: tid });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Partner Network\">\r\n            <div className={styles.pageContainer}>\r\n\r\n                {/* Password Reset Modal */}\r\n                {showResetModal && selectedVendorForReset && (\r\n                    <div style={{\r\n                        position: 'fixed', inset: 0, zIndex: 2000,\r\n                        background: 'rgba(0,0,0,0.8)', backdropFilter: 'blur(4px)',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                    }} onClick={() => setShowResetModal(false)}>\r\n                        <div style={{\r\n                            background: '#1e293b', padding: '2rem', borderRadius: '1rem',\r\n                            border: '1px solid #334155', minWidth: '350px'\r\n                        }} onClick={e => e.stopPropagation()}>\r\n                            <h3 style={{ margin: '0 0 1rem 0', color: '#f8fafc' }}>Reset Password for {selectedVendorForReset.name}</h3>\r\n                            <p style={{ fontSize: '0.85rem', color: '#94a3b8', marginBottom: '1rem' }}>\r\n                                Enter a new secure password for this partner account.\r\n                            </p>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"New Password (default: 123456)\"\r\n                                value={newPassword}\r\n                                onChange={e => setNewPassword(e.target.value)}\r\n                                style={{\r\n                                    width: '100%', padding: '0.75rem', marginBottom: '1rem',\r\n                                    borderRadius: '0.5rem', border: '1px solid #475569',\r\n                                    background: '#0f172a', color: 'white'\r\n                                }}\r\n                            />\r\n                            <div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'flex-end' }}>\r\n                                <button onClick={() => setShowResetModal(false)} style={{ padding: '0.5rem 1rem', borderRadius: '0.5rem', background: 'transparent', color: '#cbd5e1', border: '1px solid #475569', cursor: 'pointer' }}>Cancel</button>\r\n                                <button onClick={submitPasswordReset} style={{ padding: '0.5rem 1rem', borderRadius: '0.5rem', background: '#3b82f6', color: 'white', border: 'none', cursor: 'pointer', fontWeight: 600 }}>Reset Now</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Search Bar */}\r\n                <div className={styles.searchContainer}>\r\n                    <Search className={styles.searchIcon} size={22} />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search partners by name or address...\"\r\n                        className={styles.searchBar}\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                    {searchQuery && (\r\n                        <button onClick={() => setSearchQuery(\"\")} className={styles.clearButton}>\r\n                            <X size={18} />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                {filteredVendors.length === 0 ? (\r\n                    <div className={styles.emptyState}>\r\n                        <Store size={48} className=\"mx-auto mb-4 opacity-50\" />\r\n                        <h3 className=\"text-xl font-bold mb-2\">No Partners Found</h3>\r\n                        <p>Try refining your search query or add a new vendor.</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className={styles.listLayout}>\r\n                        {filteredVendors.map((vendor, idx) => (\r\n                            <div key={vendor.id} className={styles.card} style={{ animationDelay: `${idx * 50}ms`, animationName: 'slideIn' }}>\r\n\r\n                                {/* Info Block */}\r\n                                <div className={styles.infoSection}>\r\n                                    <div className={`${styles.iconBox} ${vendor.verified ? styles.verifiedIconBox : styles.pendingIconBox}`}>\r\n                                        <Store size={28} strokeWidth={1.5} />\r\n                                    </div>\r\n\r\n                                    <div className={styles.details}>\r\n                                        <div className={styles.nameRow}>\r\n                                            <h3 className={styles.vendorName}>{vendor.name}</h3>\r\n\r\n                                            {/* Badges */}\r\n                                            {vendor.verified ? (\r\n                                                <span className={`${styles.badge} ${styles.verifiedBadge}`}>\r\n                                                    <ShieldCheck size={10} /> Verified\r\n                                                </span>\r\n                                            ) : (\r\n                                                <span className={`${styles.badge} ${styles.pendingBadge}`}>\r\n                                                    <AlertCircle size={10} /> Pending\r\n                                                </span>\r\n                                            )}\r\n\r\n                                            {vendor.highlyRecommended && (\r\n                                                <span className={`${styles.badge} ${styles.hotBadge}`}>\r\n                                                    <Star size={10} fill=\"currentColor\" /> Top Rated\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n\r\n                                        <div className=\"flex items-start gap-1.5 text-slate-400\">\r\n                                            <MapPin size={14} className=\"mt-0.5 shrink-0\" />\r\n                                            <p className={styles.address}>{vendor.address || \"No physical address listed\"}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Actions Block */}\r\n                                <div className={styles.actionSection}>\r\n                                    <button\r\n                                        onClick={() => toggleVerification(vendor)}\r\n                                        className={`${styles.actionBtn} ${vendor.verified ? styles.btnRevoke : styles.btnVerify}`}\r\n                                    >\r\n                                        {vendor.verified ? 'Revoke Status' : 'Approve Partner'}\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        onClick={() => toggleRecommendation(vendor)}\r\n                                        className={`${styles.actionBtn} ${vendor.highlyRecommended ? styles.btnStarActive : styles.btnStar}`}\r\n                                        title={vendor.highlyRecommended ? \"Remove from Top Rated\" : \"Mark as Top Rated\"}\r\n                                    >\r\n                                        <Star size={16} fill={vendor.highlyRecommended ? \"currentColor\" : \"none\"} />\r\n                                        {vendor.highlyRecommended && <span className=\"text-xs\">Featured</span>}\r\n                                    </button>\r\n\r\n                                    {/* Generic Reset Password Button */}\r\n                                    <button\r\n                                        onClick={() => handlePasswordResetClick(vendor)}\r\n                                        className={`${styles.actionBtn}`}\r\n                                        style={{ color: '#38bdf8', background: 'rgba(56, 189, 248, 0.1)' }}\r\n                                        title=\"Reset Password\"\r\n                                    >\r\n                                        <Lock size={16} />\r\n                                    </button>\r\n\r\n                                    <button\r\n                                        onClick={() => handleDelete(vendor.id)}\r\n                                        className={`${styles.actionBtn} ${styles.btnDelete}`}\r\n                                        title=\"Delete Account\"\r\n                                    >\r\n                                        <Trash2 size={16} />\r\n                                    </button>\r\n                                </div>\r\n\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\Notifications.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[611,614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[611,614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3318,3321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3318,3321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport {\r\n    User, Store, Sprout, Clock, Search, DollarSign, CheckCheck, AlertTriangle\r\n} from 'lucide-react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport styles from './Notifications.module.css';\r\nimport { fetchAdminNotifications, markNotificationRead, markAllNotificationsRead } from '../../services/api';\r\n\r\ninterface Notification {\r\n    _id: string;\r\n    type: 'user' | 'vendor' | 'plant' | 'price' | 'suggestion' | 'security' | 'help' | 'vendor_contact';\r\n    message: string;\r\n    details: any;\r\n    date: string;\r\n    read: boolean;\r\n}\r\n\r\nexport const Notifications = () => {\r\n    const [allNotifs, setAllNotifs] = useState<Notification[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const data = await fetchAdminNotifications();\r\n            setAllNotifs(data);\r\n        } catch (err) {\r\n            console.error(\"Failed to load notifications\", err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    const handleItemClick = async (notif: Notification) => {\r\n        if (!notif.read) {\r\n            try {\r\n                await markNotificationRead(notif._id);\r\n                setAllNotifs(prev => prev.map(n => n._id === notif._id ? { ...n, read: true } : n));\r\n            } catch (e) {\r\n                console.error(\"Failed to mark read\", e);\r\n            }\r\n        }\r\n\r\n        // Navigate based on type\r\n        if (notif.type === 'user') navigate('/admin/manage-users');\r\n        if (notif.type === 'vendor') navigate('/admin/manage-vendors');\r\n        if (notif.type === 'plant') navigate('/admin/manage-plants');\r\n        if (notif.type === 'price') navigate('/admin/price-management');\r\n        if (notif.type === 'suggestion') navigate('/admin/suggestions');\r\n    };\r\n\r\n    const handleMarkAllRead = async () => {\r\n        await markAllNotificationsRead();\r\n        loadData();\r\n    }\r\n\r\n    const filteredNotifs = useMemo(() =>\r\n        allNotifs.filter(n => n.message.toLowerCase().includes(searchQuery.toLowerCase())),\r\n        [allNotifs, searchQuery]);\r\n\r\n    const userNotifs = filteredNotifs.filter(n => n.type === 'user');\r\n    const vendorNotifs = filteredNotifs.filter(n => n.type === 'vendor');\r\n    const plantNotifs = filteredNotifs.filter(n => n.type === 'plant');\r\n    const priceNotifs = filteredNotifs.filter(n => n.type === 'price');\r\n    const suggestionNotifs = filteredNotifs.filter(n => n.type === 'suggestion');\r\n    const systemNotifs = filteredNotifs.filter(n => ['security', 'help', 'vendor_contact'].includes(n.type));\r\n\r\n    const formatTime = (dateStr: string) => {\r\n        const date = new Date(dateStr);\r\n        const now = new Date();\r\n        const diff = (now.getTime() - date.getTime()) / 60000; // mins\r\n\r\n        if (diff < 1) return 'Just now';\r\n        if (diff < 60) return `${Math.floor(diff)}m ago`;\r\n        if (diff < 1440) return `${Math.floor(diff / 60)}h ago`;\r\n        return `${Math.floor(diff / 1440)}d ago`;\r\n    };\r\n\r\n    const renderCard = (title: string, icon: any, items: Notification[], colorClass: string) => (\r\n        <div className={styles.card}>\r\n            <div className={styles.cardHeader}>\r\n                <div className={`${styles.iconBox} ${colorClass}`}>\r\n                    {icon}\r\n                </div>\r\n                <span className={styles.sectionTitle}>{title}</span>\r\n                <span className=\"text-xs text-slate-500 ml-auto\">{items.filter(i => !i.read).length} new</span>\r\n            </div>\r\n            <div className={styles.scrollArea}>\r\n                {items.length > 0 ? items.map(item => (\r\n                    <button\r\n                        key={item._id}\r\n                        className={`${styles.item} ${!item.read ? styles.unread : ''}`}\r\n                        onClick={() => handleItemClick(item)}\r\n                    >\r\n                        <div className={styles.content}>\r\n                            <div className={styles.mainText}>\r\n                                {item.message}\r\n                            </div>\r\n                            <div className={styles.subText}>\r\n                                {item.type === 'price' && item.details?.location ? `Shop: ${item.details.location}` : ''}\r\n                            </div>\r\n                            <span className={styles.time}>\r\n                                <Clock size={10} className=\"inline mr-1\" />{formatTime(item.date)}\r\n                            </span>\r\n                        </div>\r\n                    </button>\r\n                )) : (\r\n                    <div className=\"text-center py-10 text-slate-600 text-sm italic\">No updates</div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    if (loading) return (\r\n        <AdminLayout title=\"System Notifications\">\r\n            <div className=\"p-8 text-center text-slate-500\">Loading...</div>\r\n        </AdminLayout>\r\n    );\r\n\r\n    return (\r\n        <AdminLayout title=\"System Notifications\">\r\n            <div className={styles.pageContainer}>\r\n                <header className={styles.header}>\r\n                    <div className={styles.searchContainer}>\r\n                        <Search className={styles.searchIcon} size={18} />\r\n                        <input\r\n                            type=\"text\"\r\n                            className={styles.searchInput}\r\n                            placeholder=\"Search logs...\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <button onClick={handleMarkAllRead} className={styles.markAllBtn}>\r\n                        <CheckCheck size={16} /> Mark All Read\r\n                    </button>\r\n                </header>\r\n\r\n                <div className={styles.grid4}>\r\n                    {renderCard(\"New Users\", <User size={20} />, userNotifs, styles.userIcon)}\r\n                    {renderCard(\"Vendor Joins\", <Store size={20} />, vendorNotifs, styles.vendorIcon)}\r\n                    {renderCard(\"Plant Updates\", <Sprout size={20} />, plantNotifs, styles.plantIcon)}\r\n                    {renderCard(\"Price Alerts\", <DollarSign size={20} />, priceNotifs, styles.priceIcon)}\r\n                    {renderCard(\"Suggestions\", <CheckCheck size={20} />, suggestionNotifs, styles.plantIcon)}\r\n                    {renderCard(\"Security & System\", <AlertTriangle size={20} />, systemNotifs, styles.priceIcon)}\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1256,1259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1256,1259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1314,1317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1314,1317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`startCamera` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:35:9\n  33 |\n  34 |     useEffect(() => {\n> 35 |         startCamera();\n     |         ^^^^^^^^^^^ `startCamera` accessed before it is declared\n  36 |         return () => stopCamera();\n  37 |     }, []);\n  38 |\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:43:5\n  41 |     }, []);\n  42 |\n> 43 |     const startCamera = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |         try {\n     | ^^^^^^^^^^^^^\n> 45 |             const stream = await navigator.mediaDevices.getUserMedia({\n     â€¦\n     | ^^^^^^^^^^^^^\n> 59 |         }\n     | ^^^^^^^^^^^^^\n> 60 |     };\n     | ^^^^^^^ `startCamera` is declared here\n  61 |\n  62 |     const stopCamera = () => {\n  63 |         if (stream) {","line":35,"column":9,"nodeType":null,"endLine":35,"endColumn":20},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`stopCamera` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:36:22\n  34 |     useEffect(() => {\n  35 |         startCamera();\n> 36 |         return () => stopCamera();\n     |                      ^^^^^^^^^^ `stopCamera` accessed before it is declared\n  37 |     }, []);\n  38 |\n  39 |     useEffect(() => {\n\nC:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PlantIdentifier.tsx:62:5\n  60 |     };\n  61 |\n> 62 |     const stopCamera = () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 63 |         if (stream) {\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 64 |             stream.getTracks().forEach(track => track.stop());\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 65 |             setStream(null);\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 66 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^\n> 67 |     };\n     | ^^^^^^^ `stopCamera` is declared here\n  68 |\n  69 |     const handleFocus = async () => {\n  70 |         if (!stream) return;","line":36,"column":22,"nodeType":null,"endLine":36,"endColumn":32},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'stopCamera'. Either include it or remove the dependency array.","line":37,"column":8,"nodeType":"ArrayExpression","endLine":37,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [stopCamera]","fix":{"range":[1458,1460],"text":"[stopCamera]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":57,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2619,2622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2619,2622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2828,2831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2828,2831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3122,3125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3122,3125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'colorSum' is assigned a value but never used.","line":120,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":120,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7134,7137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7134,7137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7169,7172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7169,7172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7237,7240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7237,7240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7383,7386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7383,7386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7470,7473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7470,7473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7564,7567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7564,7567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7665,7668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7665,7668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7773,7776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7773,7776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":382,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20221,20224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20221,20224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":479,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29455,29458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29455,29458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { Camera, RefreshCw, Check, Search, Plus, ScanLine, Leaf, Image as ImageIcon, Activity, Target, Filter } from 'lucide-react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { fetchPlants } from '../../services/api';\r\nimport { worldFlora } from '../../data/worldFlora';\r\n\r\nexport const PlantIdentifier = () => {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const [stream, setStream] = useState<MediaStream | null>(null);\r\n    const [capturedImages, setCapturedImages] = useState({\r\n        full: null as string | null,\r\n        leaf: null as string | null,\r\n        stem: null as string | null\r\n    });\r\n    const [filters, setFilters] = useState({\r\n        lifeForm: '',\r\n        habitat: '',\r\n        stemNature: ''\r\n    });\r\n\r\n    const areFiltersComplete = filters.lifeForm && filters.habitat && filters.stemNature;\r\n\r\n    const [scanningStep, setScanningStep] = useState<'full' | 'leaf' | 'stem' | 'complete'>('full');\r\n    const [isAnalyzing, setIsAnalyzing] = useState(false);\r\n    const [result, setResult] = useState<any>(null);\r\n    const [dbPlants, setDbPlants] = useState<any[]>([]);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        startCamera();\r\n        return () => stopCamera();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        fetchPlants().then(setDbPlants).catch(console.error);\r\n    }, []);\r\n\r\n    const startCamera = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({\r\n                video: {\r\n                    facingMode: 'environment',\r\n                    width: { ideal: 1920 },\r\n                    height: { ideal: 1080 }\r\n                    // Removes any potential default filters\r\n                }\r\n            });\r\n            setStream(stream);\r\n            if (videoRef.current) {\r\n                videoRef.current.srcObject = stream;\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Camera permission denied\");\r\n        }\r\n    };\r\n\r\n    const stopCamera = () => {\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n            setStream(null);\r\n        }\r\n    };\r\n\r\n    const handleFocus = async () => {\r\n        if (!stream) return;\r\n        const track = stream.getVideoTracks()[0];\r\n        try {\r\n            // Check if advanced capabilities are supported\r\n            const capabilities = track.getCapabilities() as any;\r\n            if (capabilities.focusMode && capabilities.focusMode.includes('continuous')) {\r\n                await track.applyConstraints({\r\n                    advanced: [{ focusMode: 'continuous' }] as any\r\n                });\r\n                toast.success(\"Auto-focus triggered\");\r\n            } else if (capabilities.focusMode && capabilities.focusMode.includes('single-shot')) {\r\n                await track.applyConstraints({\r\n                    advanced: [{ focusMode: 'single-shot' }] as any\r\n                });\r\n                toast.success(\"Focused\");\r\n            } else {\r\n                toast(\"Manual focus not supported on this device. Tap screen to focus if available.\", { icon: 'â„¹ï¸' });\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Focus failed\", e);\r\n            toast(\"Focus adjustment failed\");\r\n        }\r\n    };\r\n\r\n    const captureFrame = (type: 'full' | 'leaf' | 'stem') => {\r\n        if (!areFiltersComplete) {\r\n            toast.error(\"Please complete the Field Observations above before scanning.\");\r\n            return;\r\n        }\r\n        if (!videoRef.current || !canvasRef.current) return;\r\n        const context = canvasRef.current.getContext('2d');\r\n        if (!context) return;\r\n\r\n        canvasRef.current.width = videoRef.current.videoWidth;\r\n        canvasRef.current.height = videoRef.current.videoHeight;\r\n        context.drawImage(videoRef.current, 0, 0);\r\n\r\n        // Simple Detection Simulation: Check for \"Blank\" or \"Dark\" image\r\n        const frame = context.getImageData(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        const data = frame.data;\r\n        let r, g, b, avg;\r\n        let colorSum = 0;\r\n        let brightnessSum = 0;\r\n\r\n        // Sample every 100th pixel for speed\r\n        for (let x = 0; x < data.length; x += 400) {\r\n            r = data[x];\r\n            g = data[x + 1];\r\n            b = data[x + 2];\r\n            avg = (r + g + b) / 3;\r\n            colorSum += avg;\r\n            brightnessSum += avg;\r\n        }\r\n\r\n        const totalPixels = data.length / 400;\r\n        const avgBrightness = brightnessSum / totalPixels;\r\n\r\n        // Thresholds: Too dark or effectively blank\r\n        if (avgBrightness < 20) {\r\n            toast.error(\"âŒ No Biological Subject Detected!\\n\\nImage is too dark or empty. Please ensure the plant is well-lit and in frame.\", { duration: 5000, icon: 'ðŸŒ‘' });\r\n            return;\r\n        }\r\n\r\n        const dataUrl = canvasRef.current.toDataURL('image/jpeg', 0.8);\r\n        setCapturedImages(prev => ({ ...prev, [type]: dataUrl }));\r\n\r\n        // Advance step & Instructional Notifications\r\n        if (type === 'full') {\r\n            setScanningStep('leaf');\r\n            toast.success(\"Full Plant Captured. ðŸŒ¿\\nNow, move closer to scan a single LEAF.\", { duration: 4000 });\r\n        } else if (type === 'leaf') {\r\n            setScanningStep('stem');\r\n            toast.success(\"Leaf Architecture Scanned. ðŸƒ\\nFinally, capture the STEM or Bark texture.\", { duration: 4000 });\r\n        } else if (type === 'stem') {\r\n            setScanningStep('complete');\r\n            toast.success(\"Biometric Data Collection Complete! âœ…\\nProceed to Analysis.\", { duration: 4000 });\r\n        }\r\n    };\r\n\r\n    const resetCapture = () => {\r\n        setCapturedImages({ full: null, leaf: null, stem: null });\r\n        setScanningStep('full');\r\n        setResult(null);\r\n        // Optional: Reset filters? No, user might want to scan again with same settings.\r\n    };\r\n\r\n    const analyzePlant = () => {\r\n        setIsAnalyzing(true);\r\n        stopCamera();\r\n\r\n        // Simulation\r\n        setTimeout(() => {\r\n            setIsAnalyzing(false);\r\n\r\n            // Biometric Feature Detection Simulation\r\n            // We simulate the extraction of distinctive morphological features.\r\n            const detectedFeaturesCount = Math.floor(Math.random() * 6); // Randomly find 0 to 5 features\r\n\r\n            if (detectedFeaturesCount >= 3) {\r\n                // Sufficient data: Match found\r\n                // Prioritize \"Global Simulation Data\" for high accuracy look, fallback to DB\r\n                const sourceData = worldFlora.length > 0 ? worldFlora : dbPlants;\r\n                const randomMatch = sourceData[Math.floor(Math.random() * sourceData.length)];\r\n\r\n                // Map worldFlora format to Plant result format if needed\r\n\r\n                setResult({\r\n                    type: 'found',\r\n                    data: {\r\n                        name: (randomMatch as any).commonName || (randomMatch as any).name,\r\n                        scientificName: (randomMatch as any).scientificName || 'Plantae',\r\n                        description: `Identified via global biometric database. Match Index: ${(randomMatch as any).rarityIndex || 'Standard'}.`,\r\n                        leafShape: (randomMatch as any).leafVenation || 'Observed Data',\r\n                        stemStructure: (randomMatch as any).inflorescencePattern || 'Observed Data',\r\n                        overallHabit: (randomMatch as any).flowerType || 'Observed Data',\r\n                        biometricFeatures: [`Rarity: ${(randomMatch as any).rarityIndex || 'N/A'}`, 'High Confidence Match'],\r\n                        likelyMatches: []\r\n                    },\r\n                    confidence: 96 + Math.floor(Math.random() * 4) // High accuracy\r\n                });\r\n            } else {\r\n                // Insufficient data or No Match\r\n                setResult({\r\n                    type: 'unknown',\r\n                    data: {\r\n                        name: 'No Plant Identified',\r\n                        scientificName: 'Analysis Inconclusive',\r\n                        description: detectedFeaturesCount < 3\r\n                            ? `Biometric scan failed. Only ${detectedFeaturesCount} valid characteristic(s) detected. A minimum of 3 unique features (e.g., Venation, Leaf Margin, Phyllotaxy) is required for identification.`\r\n                            : `Biometric profile complete (${detectedFeaturesCount} features), but no matching specimen found in the global registry.`,\r\n                        leafShape: 'Undetermined',\r\n                        stemStructure: 'Undetermined',\r\n                        overallHabit: 'Undetermined',\r\n                        biometricFeatures: [],\r\n                        likelyMatches: []\r\n                    }\r\n                });\r\n            }\r\n        }, 3000); // 3s analysis simulation\r\n    };\r\n\r\n    const addToDatabase = () => {\r\n        // Navigate to Add Plant with pre-filled state (mock)\r\n        // In a real app, we'd pass state via location\r\n        navigate('/admin/add-plant', {\r\n            state: {\r\n                prefill: {\r\n                    name: result.data.name !== 'Unknown Species' ? result.data.name : result.data.likelyMatches[0].name,\r\n                    scientificName: result.data.scientificName !== 'Plantae Incognita' ? result.data.scientificName : '',\r\n                    description: result.data.description,\r\n                    // Potentially pass the captured images too\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <AdminLayout title=\"Plant Identifier AI\">\r\n            <div style={{ maxWidth: '1200px', margin: '0 auto', color: '#fff' }}>\r\n\r\n                {/* Header Section */}\r\n                <div style={{\r\n                    background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n                    borderRadius: '24px',\r\n                    padding: '3rem',\r\n                    marginBottom: '2rem',\r\n                    position: 'relative',\r\n                    overflow: 'hidden',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between'\r\n                }}>\r\n                    <div style={{ position: 'relative', zIndex: 2 }}>\r\n                        <h2 style={{ fontSize: '2.5rem', fontWeight: 800, marginBottom: '0.5rem' }}>Bio-Scanner v2.0</h2>\r\n                        <p style={{ opacity: 0.9, fontSize: '1.1rem' }}>Capture plant morphology for standard identification.</p>\r\n                    </div>\r\n                    <div style={{\r\n                        width: '60px', height: '60px',\r\n                        background: 'rgba(255,255,255,0.2)',\r\n                        backdropFilter: 'blur(10px)',\r\n                        borderRadius: '50%',\r\n                        display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n                    }}>\r\n                        <ScanLine size={32} />\r\n                    </div>\r\n                    {/* Abstract Shapes */}\r\n                    <div style={{ position: 'absolute', top: -50, right: -50, width: 200, height: 200, background: 'rgba(255,255,255,0.1)', borderRadius: '50%' }}></div>\r\n                </div>\r\n\r\n                {/* Main Workflow Grid */}\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '2rem' }}>\r\n\r\n                    {/* Left Col: Camera & Capture */}\r\n                    <div style={{ gridColumn: 'span 2' }}>\r\n\r\n                        {/* Pre-Scan Context Filters - NEW SECTION */}\r\n                        <div style={{\r\n                            background: '#1e293b',\r\n                            borderRadius: '24px',\r\n                            padding: '1.5rem',\r\n                            marginBottom: '1.5rem',\r\n                            border: '1px solid #334155',\r\n                            display: result ? 'none' : 'block' // Hide if result shown\r\n                        }}>\r\n                            <h3 style={{ marginBottom: '1rem', color: '#10b981', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                                <Filter size={20} /> Field Observations\r\n                            </h3>\r\n                            <p style={{ fontSize: '0.9rem', color: '#94a3b8', marginBottom: '1rem' }}>\r\n                                Select environmental traits to calibrate the visual scanner.\r\n                            </p>\r\n\r\n                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>\r\n\r\n                                {/* Life Form Select */}\r\n                                <div>\r\n                                    <label style={{ display: 'block', fontSize: '0.8rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>Life Form</label>\r\n                                    <select\r\n                                        value={filters.lifeForm}\r\n                                        onChange={(e) => setFilters({ ...filters, lifeForm: e.target.value })}\r\n                                        style={{ width: '100%', padding: '0.8rem', borderRadius: '12px', background: '#0f172a', border: '1px solid #334155', color: 'white' }}\r\n                                    >\r\n                                        <option value=\"\">-- Select Type --</option>\r\n                                        <option value=\"herb\">Herb</option>\r\n                                        <option value=\"shrub\">Shrub</option>\r\n                                        <option value=\"tree\">Tree</option>\r\n                                        <option value=\"climber\">Climber</option>\r\n                                        <option value=\"creeper\">Creeper</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                {/* Habitat Select */}\r\n                                <div>\r\n                                    <label style={{ display: 'block', fontSize: '0.8rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>Habitat</label>\r\n                                    <select\r\n                                        value={filters.habitat}\r\n                                        onChange={(e) => setFilters({ ...filters, habitat: e.target.value })}\r\n                                        style={{ width: '100%', padding: '0.8rem', borderRadius: '12px', background: '#0f172a', border: '1px solid #334155', color: 'white' }}\r\n                                    >\r\n                                        <option value=\"\">-- Select Habitat --</option>\r\n                                        <option value=\"terrestrial\">Terrestrial</option>\r\n                                        <option value=\"aquatic\">Aquatic</option>\r\n                                        <option value=\"epiphytic\">Epiphytic</option>\r\n                                        <option value=\"xerophytic\">Xerophytic</option>\r\n                                    </select>\r\n                                </div>\r\n\r\n                                {/* Stem Nature Select */}\r\n                                <div>\r\n                                    <label style={{ display: 'block', fontSize: '0.8rem', color: '#cbd5e1', marginBottom: '0.5rem' }}>Stem Nature</label>\r\n                                    <select\r\n                                        value={filters.stemNature}\r\n                                        onChange={(e) => setFilters({ ...filters, stemNature: e.target.value })}\r\n                                        style={{ width: '100%', padding: '0.8rem', borderRadius: '12px', background: '#0f172a', border: '1px solid #334155', color: 'white' }}\r\n                                    >\r\n                                        <option value=\"\">-- Select Stem --</option>\r\n                                        <option value=\"woody\">Woody</option>\r\n                                        <option value=\"semi-woody\">Semi-Woody</option>\r\n                                        <option value=\"herbaceous\">Herbaceous</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{\r\n                            background: '#1e293b',\r\n                            borderRadius: '24px',\r\n                            overflow: 'hidden',\r\n                            border: '1px solid #334155',\r\n                            boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\r\n                            opacity: areFiltersComplete ? 1 : 0.5,\r\n                            pointerEvents: areFiltersComplete ? 'auto' : 'none',\r\n                            transition: 'opacity 0.3s'\r\n                        }}>\r\n                            {!result && !isAnalyzing ? (\r\n                                <div style={{ position: 'relative', height: '500px', background: '#000' }}>\r\n                                    {scanningStep !== 'complete' ? (\r\n                                        <>\r\n                                            <video\r\n                                                ref={videoRef}\r\n                                                autoPlay\r\n                                                playsInline\r\n                                                muted\r\n                                                style={{ width: '100%', height: '100%', objectFit: 'cover' }}\r\n                                            />\r\n                                            {/* HUD Overlay */}\r\n                                            <div style={{ position: 'absolute', inset: 0, border: '50px solid rgba(0,0,0,0.5)', pointerEvents: 'none' }}>\r\n                                                <div style={{ width: '100%', height: '100%', border: '2px dashed rgba(255,255,255,0.5)', position: 'relative' }}>\r\n                                                    <div style={{\r\n                                                        position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)',\r\n                                                        color: 'white', textAlign: 'center', background: 'rgba(0,0,0,0.6)', padding: '10px 20px', borderRadius: '99px'\r\n                                                    }}>\r\n                                                        {scanningStep === 'full' && \"Align Full Plant\"}\r\n                                                        {scanningStep === 'leaf' && \"Focus on a Single Leaf\"}\r\n                                                        {scanningStep === 'stem' && \"Capture Stem Details\"}\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n\r\n                                            <button\r\n                                                onClick={handleFocus}\r\n                                                style={{\r\n                                                    position: 'absolute', top: '20px', right: '20px',\r\n                                                    background: 'rgba(0,0,0,0.5)', border: '1px solid rgba(255,255,255,0.3)',\r\n                                                    color: 'white', padding: '10px', borderRadius: '50%',\r\n                                                    cursor: 'pointer', zIndex: 10\r\n                                                }}\r\n                                                title=\"Trigger Auto-Focus\"\r\n                                            >\r\n                                                <Target size={20} />\r\n                                            </button>\r\n\r\n                                            <button\r\n                                                onClick={() => captureFrame(scanningStep as any)}\r\n                                                style={{\r\n                                                    position: 'absolute', bottom: '30px', left: '50%', transform: 'translateX(-50%)',\r\n                                                    width: '80px', height: '80px', borderRadius: '50%', background: 'white',\r\n                                                    border: '4px solid rgba(255,255,255,0.5)', cursor: 'pointer',\r\n                                                    display: 'grid', placeItems: 'center',\r\n                                                    boxShadow: '0 0 20px rgba(255,255,255,0.3)'\r\n                                                }}\r\n                                            >\r\n                                                <Camera size={32} color=\"#000\" />\r\n                                            </button>\r\n                                        </>\r\n                                    ) : (\r\n                                        <div style={{ height: '100%', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', gap: '2rem' }}>\r\n                                            <div style={{ width: 100, height: 100, borderRadius: '50%', background: '#10b981', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                                                <Check size={48} color=\"white\" />\r\n                                            </div>\r\n                                            <h2>Scans Complete</h2>\r\n                                            <div style={{ display: 'flex', gap: '1rem' }}>\r\n                                                <button\r\n                                                    onClick={analyzePlant}\r\n                                                    style={{ background: '#10b981', color: 'white', border: 'none', padding: '1rem 3rem', borderRadius: '12px', fontSize: '1.2rem', fontWeight: 600, cursor: 'pointer' }}\r\n                                                >\r\n                                                    Analyze Evidence\r\n                                                </button>\r\n                                                <button\r\n                                                    onClick={resetCapture}\r\n                                                    style={{ background: '#334155', color: 'white', border: 'none', padding: '1rem', borderRadius: '12px', cursor: 'pointer' }}\r\n                                                >\r\n                                                    <RefreshCw />\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ) : isAnalyzing ? (\r\n                                <div style={{ height: '500px', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', background: '#0f172a' }}>\r\n                                    <div className=\"pre-loader-pulse\"></div>\r\n                                    <p style={{ marginTop: '2rem', color: '#94a3b8', fontSize: '1.1rem' }}>Simulating Neural Network Analysis...</p>\r\n                                    <div style={{ width: '300px', marginTop: '1rem', height: '4px', background: '#334155', borderRadius: '2px', overflow: 'hidden' }}>\r\n                                        <div style={{ width: '100%', height: '100%', background: '#10b981', animation: 'progress 3s ease-in-out' }}>\r\n                                            <style>{`@keyframes progress { from { width: 0%} to { width: 100% } }`}</style>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div style={{ padding: '2rem', height: '500px', overflowY: 'auto' }}>\r\n                                    {/* RESULTS */}\r\n                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                                        <h3 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Analysis Report</h3>\r\n                                        <button onClick={resetCapture} style={{ background: '#334155', border: 'none', padding: '0.5rem 1rem', borderRadius: '8px', color: '#fff', cursor: 'pointer' }}>New Scan</button>\r\n                                    </div>\r\n\r\n                                    <div style={{ display: 'flex', gap: '2rem', alignItems: 'flex-start' }}>\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <div style={{\r\n                                                background: result.type === 'found' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(245, 158, 11, 0.1)',\r\n                                                border: `1px solid ${result.type === 'found' ? '#10b981' : '#f59e0b'}`,\r\n                                                borderRadius: '16px', padding: '1.5rem'\r\n                                            }}>\r\n                                                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>\r\n                                                    {result.type === 'found' ? <Check size={24} color=\"#10b981\" /> : <Search size={24} color=\"#f59e0b\" />}\r\n                                                    <span style={{ fontSize: '1.2rem', fontWeight: 700, color: result.type === 'found' ? '#10b981' : '#f59e0b' }}>\r\n                                                        {result.type === 'found' ? 'Database Match Confirmed' : 'New Species Discovery'}\r\n                                                    </span>\r\n                                                    <span style={{ marginLeft: 'auto', fontSize: '0.9rem', opacity: 0.7 }}>Confidence: {result.confidence}%</span>\r\n                                                </div>\r\n\r\n                                                <h1 style={{ fontSize: '2rem', fontWeight: 800, marginBottom: '0.5rem' }}>{result.data.name}</h1>\r\n                                                {result.data.scientificName && <p style={{ fontStyle: 'italic', opacity: 0.7, marginBottom: '1rem', fontSize: '1.1rem' }}>{result.data.scientificName}</p>}\r\n\r\n                                                {/* BIOMETRIC DETAILS GRID */}\r\n                                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem', background: 'rgba(255,255,255,0.05)', padding: '1rem', borderRadius: '12px' }}>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Leaf Structure</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.leafShape || 'Unknown'}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Stem Type</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.stemStructure || 'Unknown'}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Habit</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.overallHabit || 'Unknown'}</p>\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <span style={{ fontSize: '0.8rem', opacity: 0.6, textTransform: 'uppercase', letterSpacing: '1px' }}>Features</span>\r\n                                                        <p style={{ fontWeight: 600 }}>{result.data.biometricFeatures?.join(', ') || 'Standard'}</p>\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <p style={{ lineHeight: 1.6, color: '#ecfdf5' }}>{result.data.description}</p>\r\n\r\n                                                {result.type === 'unknown' && (\r\n                                                    <div style={{ marginTop: '1.5rem', padding: '1rem', background: 'rgba(0,0,0,0.2)', borderRadius: '12px' }}>\r\n                                                        <h4 style={{ marginBottom: '0.5rem', opacity: 0.8 }}>Web Search Suggestions:</h4>\r\n                                                        <ul style={{ paddingLeft: '1.2rem' }}>\r\n                                                            {result.data.likelyMatches.map((m: any) => (\r\n                                                                <li key={m.name} style={{ marginBottom: '0.25rem' }}>{m.name} ({m.confidence}% match)</li>\r\n                                                            ))}\r\n                                                        </ul>\r\n                                                        <a href={`https://www.google.com/search?tbm=isch&q=${result.data.likelyMatches[0].name}`} target=\"_blank\" rel=\"noreferrer\" style={{ display: 'inline-block', marginTop: '1rem', color: '#60a5fa', textDecoration: 'none' }}>\r\n                                                            Verify on Google Images &rarr;\r\n                                                        </a>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n\r\n                                            <button\r\n                                                onClick={addToDatabase}\r\n                                                style={{\r\n                                                    width: '100%', marginTop: '1.5rem',\r\n                                                    background: '#10b981', color: 'white', border: 'none',\r\n                                                    padding: '1rem', borderRadius: '12px', fontSize: '1.1rem', fontWeight: 700,\r\n                                                    display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem',\r\n                                                    cursor: 'pointer',\r\n                                                    boxShadow: '0 4px 6px rgba(16, 185, 129, 0.4)'\r\n                                                }}\r\n                                            >\r\n                                                <Plus size={20} />\r\n                                                Add to Official Database\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Right Col: Evidence Gallery */}\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            <div style={{ background: '#1e293b', padding: '1.5rem', borderRadius: '24px', border: '1px solid #334155' }}>\r\n                                <h3 style={{ marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}><ImageIcon size={18} /> Evidence Locker</h3>\r\n\r\n                                {['full', 'leaf', 'stem'].map((type, idx) => (\r\n                                    <div key={type} style={{\r\n                                        marginBottom: '1rem',\r\n                                        background: '#0f172a',\r\n                                        borderRadius: '16px',\r\n                                        overflow: 'hidden',\r\n                                        border: scanningStep === type ? '2px solid #10b981' : '1px solid #334155',\r\n                                        opacity: capturedImages[type as keyof typeof capturedImages] ? 1 : 0.5,\r\n                                        transition: '0.3s'\r\n                                    }}>\r\n                                        {capturedImages[type as keyof typeof capturedImages] ? (\r\n                                            <img src={capturedImages[type as keyof typeof capturedImages]!} alt={type} style={{ width: '100%', height: '150px', objectFit: 'cover' }} />\r\n                                        ) : (\r\n                                            <div style={{ height: '150px', display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column', gap: '0.5rem' }}>\r\n                                                {type === 'full' && <ScanLine size={32} color=\"#475569\" />}\r\n                                                {type === 'leaf' && <Leaf size={32} color=\"#475569\" />}\r\n                                                {type === 'stem' && <Activity size={32} color=\"#475569\" />}\r\n                                                <span style={{ textTransform: 'capitalize', color: '#64748b', fontSize: '0.8rem' }}>{type}</span>\r\n                                            </div>\r\n                                        )}\r\n                                        <div style={{ padding: '0.5rem 1rem', fontSize: '0.8rem', fontWeight: 600, textTransform: 'uppercase', letterSpacing: '1px', background: '#1e293b', color: capturedImages[type as keyof typeof capturedImages] ? '#10b981' : '#64748b' }}>\r\n                                            {idx + 1}. {type} Scan\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n\r\n                    </div>\r\n\r\n                    <canvas ref={canvasRef} style={{ display: 'none' }} />\r\n                </div>\r\n            </div>\r\n        </AdminLayout >\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PotDesigns.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":58,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\r\nimport { Download, Search, Package, ToggleLeft, ToggleRight } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './PotDesigns.module.css';\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';\r\n\r\ninterface Design {\r\n    id: string;\r\n    imageUrl: string;\r\n    shape: string;\r\n    size: string;\r\n    createdAt: string;\r\n}\r\n\r\ninterface UserWithDesigns {\r\n    _id: string;\r\n    name: string;\r\n    email: string;\r\n    designs: Design[];\r\n}\r\n\r\nexport default function PotDesigns() {\r\n    const [users, setUsers] = useState<UserWithDesigns[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [autoSaveOn, setAutoSaveOn] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetchDesigns();\r\n        fetchSettings();\r\n    }, []);\r\n\r\n    const fetchSettings = async () => {\r\n        try {\r\n            const res = await fetch(`${API_URL}/settings/pot_save_on_buy`);\r\n            const data = await res.json();\r\n            if (data.key) setAutoSaveOn(data.value);\r\n        } catch (e) { console.error(e); }\r\n    };\r\n\r\n    const toggleAutoSave = async () => {\r\n        const newValue = !autoSaveOn;\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n            const res = await fetch(`${API_URL}/admin/settings`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({ key: 'pot_save_on_buy', value: newValue })\r\n            });\r\n            if (res.ok) {\r\n                setAutoSaveOn(newValue);\r\n                toast.success(`Auto-save: ${newValue ? 'ON' : 'OFF'}`);\r\n            }\r\n        } catch (e) { toast.error(\"Failed to update setting\"); }\r\n    };\r\n\r\n    const fetchDesigns = async () => {\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n            // We need a new endpoint generally, but for now let's assume we can fetch all users or a specific designs endpoint.\r\n            // Since we don't have a specific \"get all designs\" admin endpoint, I'll create one shortly.\r\n            // For now, I'll stub the fetch and assume the endpoint /api/admin/designs will exist.\r\n            const res = await fetch(`${API_URL}/admin/designs`, {\r\n                headers: { 'Authorization': `Bearer ${token}` }\r\n            });\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setUsers(data);\r\n            } else {\r\n                toast.error(\"Failed to load designs\");\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Connection error\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDownload = (imageUrl: string, userName: string, designId: string) => {\r\n        const link = document.createElement('a');\r\n        link.href = imageUrl;\r\n        link.download = `VanaMap_Pot_${userName}_${designId}.png`;\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        toast.success(\"Download started\");\r\n    };\r\n\r\n    const filteredUsers = users.filter(user =>\r\n        user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        user.email.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    // Flatten logic for grid display if desired, or keep grouped by user.\r\n    // Let's Group by User for better admin context.\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.titleInfo}>\r\n                    <h1><Package className={styles.icon} /> User Pot Designs</h1>\r\n                    <p>Review and download custom pot creations</p>\r\n                </div>\r\n                <div className={styles.headerRight}>\r\n                    <div className={styles.toggleWrapper} onClick={toggleAutoSave}>\r\n                        <span>Auto-Save on Buy:</span>\r\n                        {autoSaveOn ? (\r\n                            <ToggleRight size={32} color=\"#10b981\" className={styles.toggleIcon} />\r\n                        ) : (\r\n                            <ToggleLeft size={32} color=\"#64748b\" className={styles.toggleIcon} />\r\n                        )}\r\n                    </div>\r\n                    <div className={styles.searchBar}>\r\n                        <Search size={18} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search by user...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div className={styles.loading}>Loading designs...</div>\r\n            ) : (\r\n                <div className={styles.content}>\r\n                    {filteredUsers.map(user => (\r\n                        <div key={user._id} className={styles.userSection}>\r\n                            <div className={styles.userHeader}>\r\n                                <div className={styles.userInfo}>\r\n                                    <div className={styles.avatar}>{user.name[0]}</div>\r\n                                    <div>\r\n                                        <h3>{user.name}</h3>\r\n                                        <span>{user.email}</span>\r\n                                    </div>\r\n                                </div>\r\n                                <div className={styles.designCount}>\r\n                                    {user.designs.length} Designs\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className={styles.grid}>\r\n                                {user.designs.map((design) => (\r\n                                    <div key={design.id} className={styles.card}>\r\n                                        <div className={styles.imageWrapper}>\r\n                                            <img src={design.imageUrl} alt=\"Pot Design\" loading=\"lazy\" />\r\n                                            <div className={styles.overlay}>\r\n                                                <button\r\n                                                    onClick={() => handleDownload(design.imageUrl, user.name, design.id)}\r\n                                                    className={styles.downloadBtn}\r\n                                                >\r\n                                                    <Download size={20} /> Download\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className={styles.cardInfo}>\r\n                                            <span className={styles.badge}>{design.shape}</span>\r\n                                            <span className={styles.badge}>{design.size}</span>\r\n                                            <span className={styles.date}>{new Date(design.createdAt).toLocaleDateString()}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n\r\n                    {filteredUsers.length === 0 && !loading && (\r\n                        <div className={styles.empty}>No designs found matching your search.</div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\PriceManagement.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":27,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":85,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":103,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":103,"endColumn":21}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { AdminLayout } from './AdminLayout';\r\nimport { fetchPlants, fetchVendors, updateVendor } from '../../services/api';\r\nimport type { Plant, Vendor } from '../../types';\r\nimport { Search, Edit2, Trash2, Save, X, Store } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\nimport styles from './PriceManagement.module.css';\r\n\r\nexport const PriceManagement = () => {\r\n    const [plants, setPlants] = useState<Plant[]>([]);\r\n    const [vendors, setVendors] = useState<Vendor[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    // Editing State\r\n    const [editingItem, setEditingItem] = useState<{ vendorId: string, plantId: string, price: number } | null>(null);\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const [pData, vData] = await Promise.all([fetchPlants(), fetchVendors()]);\r\n            setPlants(pData);\r\n            setVendors(vData);\r\n        } catch (err) {\r\n            toast.error(\"Failed to load data\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <AdminLayout title=\"Vendor Price Management\">\r\n                <div style={{ height: '60vh', display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\r\n                    <div className=\"pre-loader-pulse\" />\r\n                </div>\r\n            </AdminLayout>\r\n        );\r\n    }\r\n\r\n    // Flatten Inventory\r\n    const allPrices = vendors.flatMap(v => {\r\n        const items = v.inventory || [];\r\n        return items.map(item => {\r\n            const plant = plants.find(p => p.id === item.plantId);\r\n            return {\r\n                uniqueKey: `${v.id}-${item.plantId}`,\r\n                vendor: v,\r\n                plantId: item.plantId,\r\n                plantName: plant ? plant.name : 'Unknown Plant',\r\n                plantImage: plant?.imageUrl,\r\n                price: item.price,\r\n                inStock: item.inStock\r\n            };\r\n        });\r\n    });\r\n\r\n    const filteredItems = allPrices.filter(item =>\r\n        item.vendor.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        item.plantName.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    const handleSave = async () => {\r\n        if (!editingItem) return;\r\n\r\n        const vendor = vendors.find(v => v.id === editingItem.vendorId);\r\n        if (!vendor) return;\r\n\r\n        const updatedInventory = (vendor.inventory || []).map(i => {\r\n            if (i.plantId === editingItem.plantId) {\r\n                return { ...i, price: Number(editingItem.price) };\r\n            }\r\n            return i;\r\n        });\r\n\r\n        const tid = toast.loading(\"Updating price...\");\r\n        try {\r\n            await updateVendor(vendor.id, { inventory: updatedInventory });\r\n            toast.success(\"Price updated\", { id: tid });\r\n            setEditingItem(null);\r\n            loadData(); // Refresh to ensure sync\r\n        } catch (err) {\r\n            toast.error(\"Failed to update\", { id: tid });\r\n        }\r\n    };\r\n\r\n    const handleRemove = async (vendorId: string, plantId: string) => {\r\n        if (!confirm(\"Are you sure you want to remove this price listing?\")) return;\r\n\r\n        const vendor = vendors.find(v => v.id === vendorId);\r\n        if (!vendor) return;\r\n\r\n        const updatedInventory = (vendor.inventory || []).filter(i => i.plantId !== plantId);\r\n\r\n        const tid = toast.loading(\"Removing listing...\");\r\n        try {\r\n            await updateVendor(vendor.id, { inventory: updatedInventory });\r\n            toast.success(\"Listing removed\", { id: tid });\r\n            loadData();\r\n        } catch (err) {\r\n            toast.error(\"Failed to remove\", { id: tid });\r\n        }\r\n    };\r\n\r\n    // Calculate Stats\r\n    const totalListings = filteredItems.length;\r\n    const activeVendors = new Set(filteredItems.map(i => i.vendor.id)).size;\r\n    const avgPrice = totalListings > 0\r\n        ? Math.round(filteredItems.reduce((acc, curr) => acc + curr.price, 0) / totalListings)\r\n        : 0;\r\n\r\n    return (\r\n        <AdminLayout title=\"Capital Control\">\r\n            <div className={styles.container}>\r\n\r\n                {/* Header & Stats */}\r\n                <div className={styles.headerGroup}>\r\n                    <div>\r\n                        <h1 className={styles.title}>Price Management</h1>\r\n                        <p className={styles.subtitle}>Monitor and regulate market rates across the vendor network.</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={styles.statsGrid}>\r\n                    <div className={styles.statCard}>\r\n                        <div className={styles.statIconWrapper}><Store size={48} /></div>\r\n                        <div className={styles.statValue}>{activeVendors}</div>\r\n                        <div className={styles.statLabel}>Active Vendors</div>\r\n                    </div>\r\n                    <div className={styles.statCard}>\r\n                        <div className={styles.statIconWrapper}><Edit2 size={48} /></div>\r\n                        <div className={styles.statValue}>{totalListings}</div>\r\n                        <div className={styles.statLabel}>Price Listings</div>\r\n                    </div>\r\n                    <div className={styles.statCard}>\r\n                        <div className={styles.statIconWrapper}><Save size={48} /></div>\r\n                        <div className={styles.statValue}>â‚¹{avgPrice}</div>\r\n                        <div className={styles.statLabel}>Avg. Market Rate</div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Controls */}\r\n                <div className={styles.controlsBar}>\r\n                    <div className={styles.searchWrapper}>\r\n                        <Search size={20} className={styles.searchIcon} />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search by vendor, plant, or ID...\"\r\n                            value={searchTerm}\r\n                            onChange={e => setSearchTerm(e.target.value)}\r\n                            className={styles.searchInput}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Table */}\r\n                <div className={styles.tableContainer}>\r\n                    <table className={styles.table}>\r\n                        <thead>\r\n                            <tr>\r\n                                <th>Vendor / Shop</th>\r\n                                <th>Plant Details</th>\r\n                                <th>Market Price</th>\r\n                                <th>Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {filteredItems.map(item => (\r\n                                <tr key={item.uniqueKey}>\r\n                                    <td>\r\n                                        <div className={styles.vendorCell}>\r\n                                            <div className={styles.vendorAvatar}>\r\n                                                {item.vendor.name.charAt(0)}\r\n                                            </div>\r\n                                            <div className={styles.vendorInfo}>\r\n                                                <h4>{item.vendor.name}</h4>\r\n                                                <p>{item.vendor.address || 'Online Vendor'}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td>\r\n                                        <div className={styles.plantCell}>\r\n                                            <img\r\n                                                src={item.plantImage || 'https://via.placeholder.com/48'}\r\n                                                className={styles.plantImg}\r\n                                                alt=\"\"\r\n                                            />\r\n                                            <span className={styles.plantName}>{item.plantName}</span>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td>\r\n                                        {editingItem?.vendorId === item.vendor.id && editingItem?.plantId === item.plantId ? (\r\n                                            <div className={styles.editWrapper}>\r\n                                                <span className={styles.currency}>â‚¹</span>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    value={editingItem.price}\r\n                                                    onChange={e => setEditingItem({ ...editingItem, price: Number(e.target.value) })}\r\n                                                    className={styles.editInput}\r\n                                                    autoFocus\r\n                                                />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className={styles.priceDisplay}>\r\n                                                â‚¹ {item.price}\r\n                                            </div>\r\n                                        )}\r\n                                    </td>\r\n                                    <td>\r\n                                        <div className={styles.actionGroup}>\r\n                                            {editingItem?.vendorId === item.vendor.id && editingItem?.plantId === item.plantId ? (\r\n                                                <>\r\n                                                    <button\r\n                                                        onClick={handleSave}\r\n                                                        className={`${styles.iconBtn} ${styles.btnSave}`}\r\n                                                        title=\"Save Changes\"\r\n                                                    >\r\n                                                        <Save size={18} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => setEditingItem(null)}\r\n                                                        className={`${styles.iconBtn} ${styles.btnCancel}`}\r\n                                                        title=\"Cancel\"\r\n                                                    >\r\n                                                        <X size={18} />\r\n                                                    </button>\r\n                                                </>\r\n                                            ) : (\r\n                                                <>\r\n                                                    <button\r\n                                                        onClick={() => setEditingItem({ vendorId: item.vendor.id, plantId: item.plantId, price: item.price })}\r\n                                                        className={`${styles.iconBtn} ${styles.btnEdit}`}\r\n                                                        title=\"Edit Price\"\r\n                                                    >\r\n                                                        <Edit2 size={18} />\r\n                                                    </button>\r\n                                                    <button\r\n                                                        onClick={() => handleRemove(item.vendor.id, item.plantId)}\r\n                                                        className={`${styles.iconBtn} ${styles.btnDelete}`}\r\n                                                        title=\"Remove Listing\"\r\n                                                    >\r\n                                                        <Trash2 size={18} />\r\n                                                    </button>\r\n                                                </>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                            {filteredItems.length === 0 && (\r\n                                <tr>\r\n                                    <td colSpan={4} className={styles.emptyState}>\r\n                                        <Store size={48} style={{ margin: '0 auto 1rem', opacity: 0.2 }} />\r\n                                        <p>No price listings found matching \"{searchTerm}\"</p>\r\n                                    </td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </AdminLayout>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\SeedDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[500,503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[500,503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[516,519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[516,519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1114,1117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1114,1117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1358,1361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1358,1361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1624,1627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1624,1627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1810,1813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1810,1813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2255,2258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2255,2258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":67,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":67,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2852,2855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2852,2855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3105,3108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3105,3108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport styles from './SeedDashboard.module.css';\r\nimport { fetchSeedData, seedSinglePlant, deployAllPlants, fetchPlants, deletePlant } from '../../services/api';\r\nimport { Database, CloudUpload, Check, Rocket, ShieldCheck, Sprout, Search, Trash2 } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nexport const SeedDashboard = () => {\r\n    const [loading, setLoading] = useState(true);\r\n    const [seedData, setSeedData] = useState<{ indoor: any[], outdoor: any[] }>({ indoor: [], outdoor: [] });\r\n    const [deployedIds, setDeployedIds] = useState<Set<string>>(new Set());\r\n    const [deploying, setDeploying] = useState<string | null>(null);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const [seeds, livePlants] = await Promise.all([fetchSeedData(), fetchPlants()]);\r\n            setSeedData(seeds);\r\n            // Store IDs of plants that are already in the DB\r\n            setDeployedIds(new Set(livePlants.map((p: any) => p.id)));\r\n        } catch (error) {\r\n            toast.error(\"Failed to load databank\");\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handlePush = async (plant: any) => {\r\n        setDeploying(plant.id);\r\n        try {\r\n            await seedSinglePlant(plant.id);\r\n            setDeployedIds(prev => new Set(prev).add(plant.id));\r\n            toast.success(`${plant.name} deployed to VanaMap Live!`);\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Deployment failed\");\r\n        } finally {\r\n            setDeploying(null);\r\n        }\r\n    };\r\n\r\n    const handleRemove = async (plant: any) => {\r\n        if (!confirm(`Are you sure you want to REMOVE ${plant.name} from the live database?`)) return;\r\n        try {\r\n            await deletePlant(plant.id);\r\n            setDeployedIds(prev => {\r\n                const newSet = new Set(prev);\r\n                newSet.delete(plant.id);\r\n                return newSet;\r\n            });\r\n            toast.success(`${plant.name} removed from Live Database.`);\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Removal failed\");\r\n        }\r\n    };\r\n\r\n    const handleDeployAll = async () => {\r\n        if (!confirm(\"Are you sure you want to DEPLOY ALL plants to production?\")) return;\r\n        setLoading(true);\r\n        try {\r\n            await deployAllPlants();\r\n            await loadData();\r\n            toast.success(\"SYSTEM OVERHAUL COMPLETE: All plants deployed.\");\r\n        } catch (e) {\r\n            toast.error(\"Mass deployment failed\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const filterPlants = (plants: any[]) => {\r\n        return plants.filter(p =>\r\n            p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n            p.scientificName?.toLowerCase().includes(searchTerm.toLowerCase())\r\n        );\r\n    };\r\n\r\n    const renderCard = (plant: any) => {\r\n        const isDeployed = deployedIds.has(plant.id);\r\n        const isProcessing = deploying === plant.id;\r\n\r\n        return (\r\n            <div key={plant.id} className={`${styles.card} ${isDeployed ? styles.isLive : ''}`}>\r\n                {isDeployed && (\r\n                    <div className={styles.deployedBadge}>\r\n                        <Check size={12} /> LIVE\r\n                    </div>\r\n                )}\r\n                <img src={plant.imageUrl} alt={plant.name} className={styles.cardImage} loading=\"lazy\" />\r\n\r\n                <div className={styles.cardContent}>\r\n                    <div>\r\n                        <h3 className={styles.plantName}>{plant.name}</h3>\r\n                        <p className={styles.scientificName}>{plant.scientificName}</p>\r\n\r\n                        <div className={styles.stats}>\r\n                            <span className={styles.stat}>{plant.type}</span>\r\n                            <span className={styles.stat}>${plant.price}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {isDeployed ? (\r\n                        <button\r\n                            className={styles.removeButton}\r\n                            onClick={() => handleRemove(plant)}\r\n                            disabled={isProcessing || loading}\r\n                        >\r\n                            <Trash2 size={14} /> REMOVE\r\n                        </button>\r\n                    ) : (\r\n                        <button\r\n                            className={styles.pushButton}\r\n                            onClick={() => handlePush(plant)}\r\n                            disabled={isProcessing || loading}\r\n                        >\r\n                            {isProcessing ? (\r\n                                <span className=\"animate-spin\">âŒ›</span>\r\n                            ) : (\r\n                                <><Rocket size={14} /> PUSH TO LIVE</>\r\n                            )}\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const filteredIndoor = filterPlants(seedData.indoor);\r\n    const filteredOutdoor = filterPlants(seedData.outdoor);\r\n\r\n    return (\r\n        <div className={styles.container}>\r\n            <div className={styles.header}>\r\n                <div className={styles.title}>\r\n                    <h1>Biology Databank</h1>\r\n                    <p><Database size={16} /> Secure Seed Vault v9.0</p>\r\n                </div>\r\n                <button className={styles.deployAllBtn} onClick={handleDeployAll} disabled={loading}>\r\n                    <CloudUpload size={20} />\r\n                    DEPLOY ALL SYSTEMS\r\n                </button>\r\n            </div>\r\n\r\n            <div className={styles.searchContainer}>\r\n                <Search className={styles.searchIcon} size={20} />\r\n                <input\r\n                    type=\"text\"\r\n                    className={styles.searchInput}\r\n                    placeholder=\"Search by name, species or type...\"\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                />\r\n            </div>\r\n\r\n            <div className={styles.section}>\r\n                <div className={styles.sectionTitle}>\r\n                    <ShieldCheck size={24} className=\"text-emerald-400\" />\r\n                    Indoor Specimens\r\n                    <span className={styles.sectionBadge}>{filteredIndoor.length} Available</span>\r\n                </div>\r\n                <div className={styles.grid}>\r\n                    {filteredIndoor.map(renderCard)}\r\n                </div>\r\n            </div>\r\n\r\n            <div className={styles.section}>\r\n                <div className={styles.sectionTitle}>\r\n                    <Sprout size={24} className=\"text-amber-400\" />\r\n                    Outdoor Ecosystems\r\n                    <span className={styles.sectionBadge}>{filteredOutdoor.length} Available</span>\r\n                </div>\r\n                <div className={styles.grid}>\r\n                    {filteredOutdoor.map(renderCard)}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\SimulationData.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\pages\\admin\\SystemDiagnostics.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1178,1181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1178,1181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11593,11596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11593,11596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":366,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12440,12443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12440,12443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":386,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":386,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13088,13091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13088,13091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Plant, Vendor } from '../types';\r\n\r\nconst API_URL = import.meta.env.VITE_API_URL || 'https://plantoxy.onrender.com/api';\r\n\r\nconst getHeaders = () => {\r\n    const saved = localStorage.getItem('user');\r\n    const headers: Record<string, string> = { 'Content-Type': 'application/json' };\r\n    if (saved) {\r\n        try {\r\n            const { token } = JSON.parse(saved);\r\n            if (token) headers['Authorization'] = `Bearer ${token}`;\r\n        } catch (e) {\r\n            console.error(\"Token parse error\", e);\r\n        }\r\n    }\r\n    return headers;\r\n};\r\n\r\nexport const fetchPlants = async (): Promise<Plant[]> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/plants`);\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error(`Failed to fetch plants: ${response.status} ${response.statusText}`, errorText);\r\n            throw new Error(`Failed to fetch plants: ${response.status}`);\r\n        }\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching plants:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const fetchUsers = async (): Promise<any[]> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/users`, { headers: getHeaders() });\r\n        if (!response.ok) throw new Error('Failed to fetch users');\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching users:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const fetchVendors = async (): Promise<Vendor[]> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors`);\r\n        if (!response.ok) throw new Error('Failed to fetch vendors');\r\n        const data = await response.json();\r\n        return data;\r\n    } catch (error) {\r\n        console.error(\"Error fetching vendors:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const registerVendor = async (vendorData: Partial<Vendor>): Promise<Vendor | null> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors`, {\r\n            method: 'POST',\r\n            headers: getHeaders(),\r\n            body: JSON.stringify(vendorData)\r\n        });\r\n        if (!response.ok) throw new Error('Failed to register vendor');\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error registering vendor:\", error);\r\n        return null;\r\n    }\r\n};\r\n\r\nexport const updateVendor = async (id: string, updates: Partial<Vendor>): Promise<Vendor | null> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors/${id}`, {\r\n            method: 'PATCH',\r\n            headers: getHeaders(),\r\n            body: JSON.stringify(updates)\r\n        });\r\n        if (!response.ok) throw new Error('Failed to update vendor');\r\n        return await response.json();\r\n    } catch (error) {\r\n        console.error(\"Error updating vendor:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport const deleteVendor = async (id: string): Promise<boolean> => {\r\n    try {\r\n        const response = await fetch(`${API_URL}/vendors/${id}`, {\r\n            method: 'DELETE',\r\n            headers: getHeaders()\r\n        });\r\n        return response.ok;\r\n    } catch (error) {\r\n        console.error(\"Error deleting vendor:\", error);\r\n        return false;\r\n    }\r\n};\r\n\r\nexport const seedDatabase = async (plants: Plant[], vendors: Vendor[], users: unknown[] = []) => {\r\n    await fetch(`${API_URL}/seed`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ plants, vendors, users })\r\n    });\r\n};\r\n\r\nexport const toggleFavorite = async (plantId: string) => {\r\n    const res = await fetch(`${API_URL}/user/favorites`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ plantId })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to toggle favorite\");\r\n    return res.json();\r\n};\r\n\r\nexport const syncCart = async (cart: { plantId: string; quantity: number }[]) => {\r\n    const res = await fetch(`${API_URL}/user/cart`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ cart })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to sync cart\");\r\n    return res.json();\r\n};\r\n\r\nexport const requestPasswordReset = async (email: string) => {\r\n    const res = await fetch(`${API_URL}/auth/reset-password-request`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to request reset\");\r\n    return res.json();\r\n};\r\n\r\nexport const resetPasswordVerify = async (email: string, name: string, newPassword: string) => {\r\n    const res = await fetch(`${API_URL}/auth/reset-password-verify`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, name, newPassword })\r\n    });\r\n    if (!res.ok) {\r\n        const d = await res.json();\r\n        throw new Error(d.error || \"Verification failed\");\r\n    }\r\n    return res.json();\r\n};\r\n\r\nexport const resetPassword = async (email: string, newPassword: string) => {\r\n    const res = await fetch(`${API_URL}/auth/reset-password`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, newPassword })\r\n    });\r\n    if (!res.ok) throw new Error(\"Reset failed. Check if approved.\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchResetRequests = async () => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/admin/requests`, { headers: getHeaders() });\r\n        if (!res.ok) throw new Error(\"Failed to fetch requests\");\r\n        return await res.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching reset requests:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const approveResetRequest = async (userId: string) => {\r\n    const res = await fetch(`${API_URL}/admin/approve-reset`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ userId })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to approve\");\r\n    return res.json();\r\n};\r\n\r\nexport const addPlant = async (plantData: Partial<Plant>) => {\r\n    const res = await fetch(`${API_URL}/plants`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify(plantData)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to add plant\");\r\n    return res.json();\r\n};\r\n\r\nexport const updatePlant = async (id: string, updates: Partial<Plant>) => {\r\n    const res = await fetch(`${API_URL}/plants/${id}`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify(updates)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update plant\");\r\n    return res.json();\r\n};\r\n\r\nexport const deletePlant = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/plants/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to delete plant\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchNotifications = async () => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/admin/notifications`, { headers: getHeaders() });\r\n        if (!res.ok) throw new Error(\"Failed to fetch notifications\");\r\n        return await res.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching notifications:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const deleteNotification = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/admin/notifications/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to clear notification\");\r\n    return res.json();\r\n};\r\n\r\n// Notification Aliases & Methods\r\nexport const fetchAdminNotifications = fetchNotifications;\r\n\r\nexport const markNotificationRead = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/notifications/${id}/read`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to mark read\");\r\n    return res.json();\r\n};\r\n\r\nexport const markAllNotificationsRead = async () => {\r\n    const res = await fetch(`${API_URL}/notifications/mark-all-read`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to mark all read\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchAdminStats = async () => {\r\n    const res = await fetch(`${API_URL}/admin/stats`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch stats\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchVendorNotifications = async () => {\r\n    try {\r\n        const res = await fetch(`${API_URL}/vendor/notifications`, { headers: getHeaders() });\r\n        if (!res.ok) throw new Error(\"Failed to fetch vendor notifications\");\r\n        return await res.json();\r\n    } catch (error) {\r\n        console.error(\"Error fetching vendor notifications:\", error);\r\n        return [];\r\n    }\r\n};\r\n\r\nexport const logVendorContact = async (data: { vendorId: string, vendorName: string, userEmail: string, contactType: 'whatsapp' | 'call' }) => {\r\n    try {\r\n        await fetch(`${API_URL}/tracking/vendor-contact`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(data)\r\n        });\r\n    } catch (err) {\r\n        console.error(\"Failed to log contact\", err);\r\n    }\r\n};\r\n\r\nexport const nudgeAdmin = async (email: string) => {\r\n    return await fetch(`${API_URL}/auth/nudge-admin`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email })\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const deleteUser = async (id: string) => {\r\n    return await fetch(`${API_URL}/users/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const adminResetPassword = async (userId: string, newPassword?: string) => {\r\n    return await fetch(`${API_URL}/admin/reset-user-password`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ userId, newPassword })\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const changePassword = async (oldPassword: string, newPassword: string) => {\r\n    return await fetch(`${API_URL}/user/change-password`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ oldPassword, newPassword })\r\n    }).then(res => res.json());\r\n};\r\n\r\nexport const sendAiChat = async (userId: string, message: string) => {\r\n    const res = await fetch(`${API_URL}/ai/chat`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ userId, message })\r\n    });\r\n    return res.json();\r\n};\r\n\r\nexport const submitSuggestion = async (data: { userId?: string, userName?: string, plantName: string, description: string }) => {\r\n    const res = await fetch(`${API_URL}/suggestions`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to submit suggestion\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchSuggestions = async () => {\r\n    const res = await fetch(`${API_URL}/suggestions`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch suggestions\");\r\n    return res.json();\r\n};\r\n\r\nexport const updateSuggestion = async (id: string, updates: any) => {\r\n    const res = await fetch(`${API_URL}/suggestions/${id}`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify(updates)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update suggestion\");\r\n    return res.json();\r\n};\r\n\r\nexport const deleteSuggestion = async (id: string) => {\r\n    const res = await fetch(`${API_URL}/suggestions/${id}`, {\r\n        method: 'DELETE',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to delete suggestion\");\r\n    return res.json();\r\n};\r\n\r\nexport const fetchLeaderboard = async () => {\r\n    const res = await fetch(`${API_URL}/gamification/leaderboard`);\r\n    if (!res.ok) throw new Error(\"Failed to fetch leaderboard\");\r\n    return res.json();\r\n};\r\n\r\nexport const logSearch = async (query: string, plantId?: string, location?: any) => {\r\n    try {\r\n        await fetch(`${API_URL}/tracking/search`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ query, plantId, location })\r\n        });\r\n    } catch (e) {\r\n        console.error(\"Search logging failed\", e);\r\n    }\r\n};\r\n\r\nexport const fetchVendorAnalytics = async (vendorId: string) => {\r\n    const res = await fetch(`${API_URL}/analytics/vendor/${vendorId}`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch analytics\");\r\n    return res.json();\r\n};\r\n\r\nexport const completePurchase = async (items: any[]) => {\r\n    const res = await fetch(`${API_URL}/user/complete-purchase`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ items })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to complete purchase\");\r\n    return res.json();\r\n};\r\n\r\nexport const updateUserPoints = async (userId: string, points: number) => {\r\n    const res = await fetch(`${API_URL}/admin/users/${userId}/points`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ points })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update user points\");\r\n    return res.json();\r\n};\r\n\r\nexport const updateGameProgress = async (level: number, points: number) => {\r\n    const res = await fetch(`${API_URL}/user/game-progress`, {\r\n        method: 'PATCH',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ level, points })\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to update game progress\");\r\n    return res.json();\r\n};\r\nexport const fetchSeedData = async () => {\r\n    const res = await fetch(`${API_URL}/admin/seed-data`, {\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to fetch seed data\");\r\n    return res.json();\r\n};\r\n\r\nexport const seedSinglePlant = async (plantId: string) => {\r\n    const res = await fetch(`${API_URL}/admin/seed-single`, {\r\n        method: 'POST',\r\n        headers: getHeaders(),\r\n        body: JSON.stringify({ plantId })\r\n    });\r\n    if (!res.ok) {\r\n        const errorData = await res.json().catch(() => ({}));\r\n        throw new Error(errorData.error || \"Failed to deploy plant\");\r\n    }\r\n    return res.json();\r\n};\r\nexport const deployAllPlants = async () => {\r\n    const res = await fetch(`${API_URL}/admin/seed-plants`, {\r\n        method: 'POST',\r\n        headers: getHeaders()\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to deploy all plants\");\r\n    return res.json();\r\n};\r\n\r\n\r\nexport const resendOTP = async (registrationToken: string) => {\r\n    const res = await fetch(`${API_URL}/auth/resend-otp`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ registrationToken })\r\n    });\r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data.error || \"Failed to resend\");\r\n    return data;\r\n};\r\n\r\nexport const verifyOTP = async (registrationToken: string, otp: string) => {\r\n    const res = await fetch(`${API_URL}/auth/verify-otp`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ registrationToken, otp })\r\n    });\r\n    const data = await res.json();\r\n    if (!res.ok) throw new Error(data.error || \"Verification failed\");\r\n    return data;\r\n};\r\n\r\nexport const checkEmail = async (email: string) => {\r\n    const res = await fetch(`${API_URL}/auth/check-email`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email })\r\n    });\r\n    if (!res.ok) {\r\n        const error = await res.json();\r\n        throw new Error(error.error || \"Verification failed\");\r\n    }\r\n    return res.json();\r\n};\r\n\r\nexport const sendInquiry = async (data: { name: string, email: string, message: string }) => {\r\n    const res = await fetch(`${API_URL}/support/inquiry`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(data)\r\n    });\r\n    if (!res.ok) throw new Error(\"Failed to send inquiry\");\r\n    return res.json();\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\services\\weather.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\logic.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\src\\utils\\plantAiDatabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\sabin\\.gemini\\antigravity\\scratch\\plant-finder\\frontend\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]